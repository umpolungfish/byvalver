00000000  2f 2a 0d 0a 20 2a 20 54  69 74 6c 65 3a 20 61 72  |/*.. * Title: ar|
00000010  6d 2d 69 66 63 6f 6e 66  69 67 0d 0a 20 2a 20 42  |m-ifconfig.. * B|
00000020  72 69 65 66 3a 20 42 72  69 6e 67 20 75 70 20 65  |rief: Bring up e|
00000030  74 68 30 20 61 6e 64 20  61 73 73 69 67 6e 20 69  |th0 and assign i|
00000040  74 20 74 68 65 20 61 64  64 72 65 73 73 20 31 39  |t the address 19|
00000050  32 2e 31 36 38 2e 30 2e  32 0d 0a 20 2a 20 41 75  |2.168.0.2.. * Au|
00000060  74 68 6f 72 3a 20 44 61  6e 69 65 6c 20 47 6f 64  |thor: Daniel God|
00000070  61 73 2d 4c 6f 70 65 7a  20 3c 67 6d 61 69 6c 20  |as-Lopez <gmail |
00000080  61 63 63 6f 75 6e 74 20  64 67 6f 64 61 73 3e 0d  |account dgodas>.|
00000090  0a 20 2a 2f 0d 0a 20 0d  0a 20 20 20 20 2f 2a 0d  |. */.. ..    /*.|
000000a0  0a 20 20 20 20 20 20 73  6f 63 5f 64 65 73 20 3d  |.      soc_des =|
000000b0  20 73 6f 63 6b 65 74 28  41 46 5f 49 4e 45 54 2c  | socket(AF_INET,|
000000c0  20 53 4f 43 4b 5f 44 47  52 41 4d 2c 20 49 50 50  | SOCK_DGRAM, IPP|
000000d0  52 4f 54 4f 5f 49 50 29  3b 0d 0a 20 20 20 20 20  |ROTO_IP);..     |
000000e0  2a 2f 0d 0a 20 0d 0a 20  20 20 20 6d 6f 76 20 25  |*/.. ..    mov %|
000000f0  72 30 2c 20 24 32 20 20  20 20 20 2f 2a 20 41 46  |r0, $2     /* AF|
00000100  5f 49 4e 45 54 20 2a 2f  0d 0a 20 20 20 20 6d 6f  |_INET */..    mo|
00000110  76 20 25 72 31 2c 20 24  32 20 20 20 20 20 2f 2a  |v %r1, $2     /*|
00000120  20 53 4f 43 4b 5f 44 47  52 41 4d 20 2a 2f 0d 0a  | SOCK_DGRAM */..|
00000130  20 20 20 20 6d 6f 76 20  25 72 32 2c 20 24 30 20  |    mov %r2, $0 |
00000140  20 20 20 20 2f 2a 20 49  50 50 52 54 4f 54 4f 5f  |    /* IPPRTOTO_|
00000150  49 50 20 2a 2f 0d 0a 20  20 20 20 70 75 73 68 20  |IP */..    push |
00000160  7b 25 72 30 2c 20 25 72  31 2c 20 25 72 32 7d 0d  |{%r0, %r1, %r2}.|
00000170  0a 20 20 20 20 6d 6f 76  20 25 72 30 2c 20 24 31  |.    mov %r0, $1|
00000180  20 20 20 20 20 2f 2a 20  73 6f 63 6b 65 74 20 2a  |     /* socket *|
00000190  2f 0d 0a 20 20 20 20 6d  6f 76 20 25 72 31 2c 20  |/..    mov %r1, |
000001a0  25 73 70 0d 0a 20 20 20  20 73 76 63 20 30 78 30  |%sp..    svc 0x0|
000001b0  30 39 30 30 30 36 36 0d  0a 20 20 20 20 61 64 64  |0900066..    add|
000001c0  20 25 73 70 2c 20 25 73  70 2c 20 24 31 32 0d 0a  | %sp, %sp, $12..|
000001d0  20 0d 0a 20 20 20 20 6d  6f 76 20 25 72 36 2c 20  | ..    mov %r6, |
000001e0  25 72 30 20 20 20 20 20  20 20 20 2f 2a 20 72 36  |%r0        /* r6|
000001f0  20 3d 20 73 6f 63 5f 64  65 73 20 2a 2f 0d 0a 20  | = soc_des */.. |
00000200  0d 0a 20 20 20 20 2f 2a  0d 0a 20 20 20 20 20 20  |..    /*..      |
00000210  69 6f 63 74 6c 28 73 6f  63 5f 64 65 73 2c 20 53  |ioctl(soc_des, S|
00000220  49 4f 43 53 49 46 41 44  44 52 2c 20 26 72 65 71  |IOCSIFADDR, &req|
00000230  29 3b 0d 0a 20 20 20 20  20 2a 2f 0d 0a 20 0d 0a  |);..     */.. ..|
00000240  2e 69 66 20 30 20 2f 2a  20 72 30 20 3d 3d 20 72  |.if 0 /* r0 == r|
00000250  36 20 61 6c 72 65 61 64  79 20 2a 2f 0d 0a 20 20  |6 already */..  |
00000260  20 20 6d 6f 76 20 25 72  30 2c 20 25 72 36 20 20  |  mov %r0, %r6  |
00000270  20 20 20 20 20 20 2f 2a  20 73 6f 63 5f 64 65 73  |      /* soc_des|
00000280  20 2a 2f 0d 0a 2e 65 6e  64 69 66 0d 0a 20 0d 0a  | */...endif.. ..|
00000290  20 20 20 20 73 75 62 20  25 72 31 2c 20 25 72 31  |    sub %r1, %r1|
000002a0  2c 20 25 72 31 0d 0a 20  20 20 20 73 75 62 20 25  |, %r1..    sub %|
000002b0  72 32 2c 20 25 72 32 2c  20 25 72 32 0d 0a 20 20  |r2, %r2, %r2..  |
000002c0  20 20 70 75 73 68 20 7b  20 25 72 31 2c 20 25 72  |  push { %r1, %r|
000002d0  32 20 7d 0d 0a 20 20 20  20 6d 6f 76 20 25 72 32  |2 }..    mov %r2|
000002e0  2c 20 24 32 20 20 20 20  20 2f 2a 20 41 46 5f 49  |, $2     /* AF_I|
000002f0  4e 45 54 20 2a 2f 0d 0a  20 20 20 20 6d 6f 76 20  |NET */..    mov |
00000300  25 72 33 2c 20 24 30 78  32 30 30 30 30 30 30 0d  |%r3, $0x2000000.|
00000310  0a 20 20 20 20 61 64 64  20 25 72 33 2c 20 25 72  |.    add %r3, %r|
00000320  33 2c 20 24 30 78 61 38  30 30 0d 0a 20 20 20 20  |3, $0xa800..    |
00000330  61 64 64 20 25 72 33 2c  20 24 30 78 63 30 20 20  |add %r3, $0xc0  |
00000340  20 20 20 20 2f 2a 20 61  64 64 72 20 3d 20 31 39  |    /* addr = 19|
00000350  32 2e 31 36 38 2e 30 2e  32 20 2a 2f 0d 0a 20 20  |2.168.0.2 */..  |
00000360  20 20 70 75 73 68 20 7b  20 25 72 32 2c 20 25 72  |  push { %r2, %r|
00000370  33 20 7d 0d 0a 20 20 20  20 73 75 62 20 25 72 32  |3 }..    sub %r2|
00000380  2c 20 25 72 32 2c 20 25  72 32 0d 0a 20 20 20 20  |, %r2, %r2..    |
00000390  73 75 62 20 25 72 33 2c  20 25 72 33 2c 20 25 72  |sub %r3, %r3, %r|
000003a0  33 0d 0a 20 20 20 20 70  75 73 68 20 7b 20 25 72  |3..    push { %r|
000003b0  31 2c 20 25 72 32 2c 20  25 72 33 20 7d 0d 0a 20  |1, %r2, %r3 }.. |
000003c0  20 20 20 6d 6f 76 20 25  72 33 2c 20 24 30 78 37  |   mov %r3, $0x7|
000003d0  34 30 30 0d 0a 20 20 20  20 61 64 64 20 25 72 33  |400..    add %r3|
000003e0  2c 20 24 30 78 30 30 36  35 0d 0a 20 20 20 20 6d  |, $0x0065..    m|
000003f0  6f 76 20 25 72 34 2c 20  24 30 78 33 30 30 30 0d  |ov %r4, $0x3000.|
00000400  0a 20 20 20 20 61 64 64  20 25 72 34 2c 20 24 30  |.    add %r4, $0|
00000410  78 30 30 36 38 0d 0a 20  20 20 20 61 64 64 20 25  |x0068..    add %|
00000420  72 33 2c 20 25 72 34 2c  20 6c 73 6c 20 24 31 36  |r3, %r4, lsl $16|
00000430  20 20 20 2f 2a 20 22 65  74 68 30 22 20 2a 2f 0d  |   /* "eth0" */.|
00000440  0a 20 20 20 20 70 75 73  68 20 7b 20 25 72 33 20  |.    push { %r3 |
00000450  7d 0d 0a 20 20 20 20 6d  6f 76 20 25 72 32 2c 20  |}..    mov %r2, |
00000460  25 73 70 20 20 20 20 20  20 20 20 2f 2a 20 73 74  |%sp        /* st|
00000470  72 75 63 74 20 5f 5f 6b  65 72 6e 65 6c 5f 69 66  |ruct __kernel_if|
00000480  72 65 71 20 2a 2f 0d 0a  20 20 20 20 61 64 64 20  |req */..    add |
00000490  25 73 70 2c 20 24 33 32  0d 0a 20 0d 0a 20 20 20  |%sp, $32.. ..   |
000004a0  20 6d 6f 76 20 25 72 31  2c 20 24 30 78 38 39 30  | mov %r1, $0x890|
000004b0  30 0d 0a 20 20 20 20 61  64 64 20 25 72 31 2c 20  |0..    add %r1, |
000004c0  25 72 31 2c 20 24 30 78  31 36 20 2f 2a 20 53 49  |%r1, $0x16 /* SI|
000004d0  4f 43 53 49 46 41 44 44  52 20 2a 2f 0d 0a 20 20  |OCSIFADDR */..  |
000004e0  20 20 73 76 63 20 30 78  30 30 39 30 30 30 33 36  |  svc 0x00900036|
000004f0  0d 0a 20 0d 0a 20 20 20  20 2f 2a 0d 0a 20 20 20  |.. ..    /*..   |
00000500  20 20 20 69 6f 63 74 6c  28 73 6f 63 5f 64 65 73  |   ioctl(soc_des|
00000510  2c 20 53 49 4f 43 47 49  46 46 4c 41 47 53 2c 20  |, SIOCGIFFLAGS, |
00000520  26 72 65 71 29 3b 0d 0a  20 20 20 20 20 2a 2f 0d  |&req);..     */.|
00000530  0a 20 0d 0a 20 20 20 20  6d 6f 76 20 25 72 30 2c  |. ..    mov %r0,|
00000540  20 25 72 36 20 20 20 20  20 20 20 20 2f 2a 20 73  | %r6        /* s|
00000550  6f 63 5f 64 65 73 20 2a  2f 0d 0a 20 0d 0a 20 20  |oc_des */.. ..  |
00000560  20 20 6d 6f 76 20 25 72  31 2c 20 24 30 78 38 39  |  mov %r1, $0x89|
00000570  30 30 0d 0a 20 20 20 20  61 64 64 20 25 72 31 2c  |00..    add %r1,|
00000580  20 25 72 31 2c 20 24 30  78 31 33 20 2f 2a 20 53  | %r1, $0x13 /* S|
00000590  49 4f 43 47 49 46 46 4c  41 47 53 20 2a 2f 0d 0a  |IOCGIFFLAGS */..|
000005a0  20 20 20 20 73 76 63 20  30 78 30 30 39 30 30 30  |    svc 0x009000|
000005b0  33 36 0d 0a 20 0d 0a 20  20 20 20 6c 64 72 20 25  |36.. ..    ldr %|
000005c0  72 33 2c 20 5b 25 72 32  2c 20 24 31 36 5d 0d 0a  |r3, [%r2, $16]..|
000005d0  20 20 20 20 6f 72 72 20  25 72 33 2c 20 25 72 33  |    orr %r3, %r3|
000005e0  2c 20 24 31 0d 0a 20 20  20 20 73 74 72 20 25 72  |, $1..    str %r|
000005f0  33 2c 20 5b 25 72 32 2c  20 24 31 36 5d 20 2f 2a  |3, [%r2, $16] /*|
00000600  20 69 66 72 5f 66 6c 61  67 73 20 7c 3d 20 49 46  | ifr_flags |= IF|
00000610  46 5f 55 50 20 2a 2f 0d  0a 20 0d 0a 20 20 20 20  |F_UP */.. ..    |
00000620  2f 2a 0d 0a 20 20 20 20  20 20 69 6f 63 74 6c 28  |/*..      ioctl(|
00000630  73 6f 63 5f 64 65 73 2c  20 53 49 4f 43 53 49 46  |soc_des, SIOCSIF|
00000640  46 4c 41 47 53 2c 20 26  72 65 71 29 3b 0d 0a 20  |FLAGS, &req);.. |
00000650  20 20 20 20 2a 2f 0d 0a  20 0d 0a 20 20 20 20 6d  |    */.. ..    m|
00000660  6f 76 20 25 72 30 2c 20  25 72 36 20 20 20 20 20  |ov %r0, %r6     |
00000670  20 20 20 2f 2a 20 73 6f  63 5f 64 65 73 20 2a 2f  |   /* soc_des */|
00000680  0d 0a 20 0d 0a 20 20 20  20 6d 6f 76 20 25 72 31  |.. ..    mov %r1|
00000690  2c 20 24 30 78 38 39 30  30 0d 0a 20 20 20 20 61  |, $0x8900..    a|
000006a0  64 64 20 25 72 31 2c 20  25 72 31 2c 20 24 30 78  |dd %r1, %r1, $0x|
000006b0  31 34 20 2f 2a 20 53 49  4f 43 53 49 46 46 4c 41  |14 /* SIOCSIFFLA|
000006c0  47 53 20 2a 2f 0d 0a 20  20 20 20 73 76 63 20 30  |GS */..    svc 0|
000006d0  78 30 30 39 30 30 30 33  36                       |x00900036|
000006d9
