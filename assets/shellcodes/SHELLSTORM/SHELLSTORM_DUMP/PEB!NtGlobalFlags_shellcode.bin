00000000  2f 2a 0d 0a 0d 0a 20 50  45 42 21 4e 74 47 6c 6f  |/*.... PEB!NtGlo|
00000010  62 61 6c 46 6c 61 67 73  20 28 20 31 34 20 42 59  |balFlags ( 14 BY|
00000020  54 45 53 20 29 0d 0a 20  41 75 74 68 6f 72 3a 20  |TES ).. Author: |
00000030  4b 6f 73 68 69 0d 0a 20  44 65 73 63 72 69 70 74  |Koshi.. Descript|
00000040  69 6f 6e 3a 20 55 73 65  73 20 50 45 42 20 6d 65  |ion: Uses PEB me|
00000050  74 68 6f 64 20 74 6f 20  64 65 74 65 72 6d 69 6e  |thod to determin|
00000060  65 20 77 68 65 74 68 65  72 20 61 20 64 65 62 75  |e whether a debu|
00000070  67 67 65 72 20 69 73 0d  0a 09 20 20 20 20 20 20  |gger is...      |
00000080  61 74 74 61 63 68 65 64  20 74 6f 20 74 68 65 20  |attached to the |
00000090  72 75 6e 6e 69 6e 67 20  70 72 6f 63 63 65 73 73  |running proccess|
000000a0  20 6f 72 20 6e 6f 74 2e  20 4e 6f 20 39 78 2e 20  | or not. No 9x. |
000000b0  3a 28 0d 0a 20 4c 65 6e  67 74 68 3a 20 31 34 20  |:(.. Length: 14 |
000000c0  42 79 74 65 73 0d 0a 20  52 65 67 69 73 74 65 72  |Bytes.. Register|
000000d0  73 20 55 73 65 64 3a 20  45 41 58 2c 45 53 49 2c  |s Used: EAX,ESI,|
000000e0  45 53 50 0d 0a 20 43 6f  6d 70 69 6c 65 64 3a 20  |ESP.. Compiled: |
000000f0  6a 70 58 56 33 34 64 64  33 76 30 39 46 68 0d 0a  |jpXV34dd3v09Fh..|
00000100  0d 0a 2a 2f 0d 0a 0d 0a  2f 2a 0d 0a 0d 0a 20 30  |..*/..../*.... 0|
00000110  30 34 30 31 30 30 30 20  3e 20 20 20 36 41 20 37  |0401000 >   6A 7|
00000120  30 20 20 20 20 20 20 20  20 20 20 50 55 53 48 20  |0          PUSH |
00000130  37 30 0d 0a 20 30 30 34  30 31 30 30 32 20 20 20  |70.. 00401002   |
00000140  20 20 35 38 20 20 20 20  20 20 20 20 20 20 20 20  |  58            |
00000150  20 50 4f 50 20 45 41 58  0d 0a 20 30 30 34 30 31  | POP EAX.. 00401|
00000160  30 30 33 20 20 20 20 20  35 36 20 20 20 20 20 20  |003     56      |
00000170  20 20 20 20 20 20 20 50  55 53 48 20 45 53 49 0d  |       PUSH ESI.|
00000180  0a 20 30 30 34 30 31 30  30 34 20 20 20 20 20 33  |. 00401004     3|
00000190  33 33 34 36 34 20 20 20  20 20 20 20 20 20 58 4f  |33464         XO|
000001a0  52 20 45 53 49 2c 44 57  4f 52 44 20 50 54 52 20  |R ESI,DWORD PTR |
000001b0  53 53 3a 5b 45 53 50 5d  0d 0a 20 30 30 34 30 31  |SS:[ESP].. 00401|
000001c0  30 30 37 20 20 20 20 20  36 34 3a 33 33 37 36 20  |007     64:3376 |
000001d0  33 30 20 20 20 20 20 58  4f 52 20 45 53 49 2c 44  |30     XOR ESI,D|
000001e0  57 4f 52 44 20 50 54 52  20 46 53 3a 5b 45 53 49  |WORD PTR FS:[ESI|
000001f0  2b 33 30 5d 0d 0a 20 30  30 34 30 31 30 30 42 20  |+30].. 0040100B |
00000200  20 20 20 20 33 39 34 36  20 36 38 20 20 20 20 20  |    3946 68     |
00000210  20 20 20 43 4d 50 20 44  57 4f 52 44 20 50 54 52  |   CMP DWORD PTR|
00000220  20 44 53 3a 5b 45 53 49  2b 36 38 5d 2c 45 41 58  | DS:[ESI+68],EAX|
00000230  0d 0a 09 09 09 20 20 20  20 20 4a 45 20 44 65 62  |.....     JE Deb|
00000240  75 67 67 65 72 50 72 65  73 65 6e 74 20 28 20 49  |uggerPresent ( I|
00000250  66 20 65 71 75 61 6c 20  64 65 62 75 67 67 65 72  |f equal debugger|
00000260  20 61 74 74 61 63 68 65  64 20 29 0d 0a 2a 2f 0d  | attached )..*/.|
00000270  0a 0d 0a 75 6e 73 69 67  6e 65 64 20 63 68 61 72  |...unsigned char|
00000280  20 53 68 65 6c 6c 63 6f  64 65 5b 5d 20 3d 0d 0a  | Shellcode[] =..|
00000290  7b 22 5c 78 36 41 5c 78  37 30 5c 78 35 38 5c 78  |{"\x6A\x70\x58\x|
000002a0  35 36 5c 78 33 33 5c 78  33 34 5c 78 36 34 22 0d  |56\x33\x34\x64".|
000002b0  0a 22 5c 78 36 34 5c 78  33 33 5c 78 37 36 5c 78  |."\x64\x33\x76\x|
000002c0  33 30 5c 78 33 39 5c 78  34 36 5c 78 36 38 22 7d  |30\x39\x46\x68"}|
000002d0  3b 0d 0a 0d 0a 0d 0a 0d  0a 69 6e 74 20 6d 61 69  |;........int mai|
000002e0  6e 28 20 69 6e 74 20 61  72 67 63 2c 20 63 68 61  |n( int argc, cha|
000002f0  72 20 2a 61 72 67 76 5b  5d 20 29 0d 0a 7b 0d 0a  |r *argv[] )..{..|
00000300  20 70 72 69 6e 74 66 28  20 22 53 68 65 6c 6c 63  | printf( "Shellc|
00000310  6f 64 65 20 69 73 20 25  75 20 62 79 74 65 73 2e  |ode is %u bytes.|
00000320  5c 6e 22 2c 20 73 69 7a  65 6f 66 28 53 68 65 6c  |\n", sizeof(Shel|
00000330  6c 63 6f 64 65 29 2d 31  20 29 3b 0d 0a 20 70 72  |lcode)-1 );.. pr|
00000340  69 6e 74 66 28 20 53 68  65 6c 6c 63 6f 64 65 2c  |intf( Shellcode,|
00000350  20 73 69 7a 65 6f 66 28  53 68 65 6c 6c 63 6f 64  | sizeof(Shellcod|
00000360  65 29 20 29 3b 0d 0a 20  72 65 74 75 72 6e 20 30  |e) );.. return 0|
00000370  3b 0d 0a 7d                                       |;..}|
00000374
