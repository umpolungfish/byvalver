00000000  23 6e 61 6d 65 3a 20 77  69 6e 20 78 70 20 73 70  |#name: win xp sp|
00000010  32 20 50 45 42 20 49 53  62 65 69 6e 67 64 65 62  |2 PEB ISbeingdeb|
00000020  75 67 67 65 64 20 73 68  65 6c 6c 63 6f 64 65 0d  |ugged shellcode.|
00000030  0a 23 41 75 74 68 6f 72  3a 20 41 6e 6f 6e 79 6d  |.#Author: Anonym|
00000040  6f 75 73 0d 0a 23 44 61  74 65 3a 20 31 34 2e 31  |ous..#Date: 14.1|
00000050  32 2e 32 30 30 39 2e 0d  0a 68 65 72 65 20 69 73  |2.2009...here is|
00000060  20 74 68 65 20 41 53 4d  20 63 6f 64 65 20 6d 61  | the ASM code ma|
00000070  64 65 20 75 73 69 6e 67  20 6d 61 73 6d 33 32 0d  |de using masm32.|
00000080  0a 69 66 20 70 72 6f 67  72 61 6d 20 69 73 20 62  |.if program is b|
00000090  65 69 6e 67 20 72 75 6e  20 75 6e 64 65 72 20 64  |eing run under d|
000000a0  65 62 75 67 67 65 72 20  74 68 65 20 73 68 65 6c  |ebugger the shel|
000000b0  6c 63 6f 64 65 20 77 69  6c 20 73 74 61 72 74 20  |lcode wil start |
000000c0  62 65 65 70 69 6e 67 20  3a 44 0d 0a 2f 2f 2f 2f  |beeping :D..////|
000000d0  2f 2f 2f 2f 2f 2f 2f 2f  2f 2f 2f 2f 2f 2f 2f 2f  |////////////////|
000000e0  2f 2f 62 65 67 69 6e 2f  2f 2f 2f 2f 2f 2f 2f 2f  |//begin/////////|
000000f0  2f 2f 2f 2f 2f 2f 2f 2f  2f 2f 2f 2f 2f 2f 2f 2f  |////////////////|
00000100  2f 2f 2f 2f 2f 2f 2f 2f  2f 2f 2f 2f 2f 2f 0d 0a  |//////////////..|
00000110  2e 33 38 36 0d 0a 2e 6d  6f 64 65 6c 20 66 6c 61  |.386...model fla|
00000120  74 2c 20 73 74 64 63 61  6c 6c 0d 0a 6f 70 74 69  |t, stdcall..opti|
00000130  6f 6e 20 63 61 73 65 6d  61 70 20 3a 6e 6f 6e 65  |on casemap :none|
00000140  0d 0a 49 4e 43 4c 55 44  45 20 20 43 3a 5c 4d 41  |..INCLUDE  C:\MA|
00000150  53 4d 33 32 5c 49 4e 43  4c 55 44 45 5c 57 49 4e  |SM32\INCLUDE\WIN|
00000160  44 4f 57 53 2e 49 4e 43  0d 0a 49 4e 43 4c 55 44  |DOWS.INC..INCLUD|
00000170  45 20 20 43 3a 5c 4d 41  53 4d 33 32 5c 49 4e 43  |E  C:\MASM32\INC|
00000180  4c 55 44 45 5c 4b 45 52  4e 45 4c 33 32 2e 49 4e  |LUDE\KERNEL32.IN|
00000190  43 0d 0a 49 4e 43 4c 55  44 45 20 20 43 3a 5c 4d  |C..INCLUDE  C:\M|
000001a0  41 53 4d 33 32 5c 49 4e  43 4c 55 44 45 5c 55 53  |ASM32\INCLUDE\US|
000001b0  45 52 33 32 2e 49 4e 43  0d 0a 49 4e 43 4c 55 44  |ER32.INC..INCLUD|
000001c0  45 20 20 43 3a 5c 4d 41  53 4d 33 32 5c 49 4e 43  |E  C:\MASM32\INC|
000001d0  4c 55 44 45 5c 4d 41 53  4d 33 32 2e 49 4e 43 0d  |LUDE\MASM32.INC.|
000001e0  0a 49 4e 43 4c 55 44 45  4c 49 42 20 20 43 3a 5c  |.INCLUDELIB  C:\|
000001f0  4d 41 53 4d 33 32 5c 4c  49 42 5c 4b 45 52 4e 45  |MASM32\LIB\KERNE|
00000200  4c 33 32 2e 4c 49 42 0d  0a 49 4e 43 4c 55 44 45  |L32.LIB..INCLUDE|
00000210  4c 49 42 20 20 43 3a 5c  4d 41 53 4d 33 32 5c 4c  |LIB  C:\MASM32\L|
00000220  49 42 5c 55 53 45 52 33  32 2e 4c 49 42 0d 0a 49  |IB\USER32.LIB..I|
00000230  4e 43 4c 55 44 45 4c 49  42 20 20 43 3a 5c 4d 41  |NCLUDELIB  C:\MA|
00000240  53 4d 33 32 5c 4c 49 42  5c 4d 41 53 4d 33 32 2e  |SM32\LIB\MASM32.|
00000250  4c 49 42 0d 0a 20 20 20  20 2e 64 61 74 61 0d 0a  |LIB..    .data..|
00000260  45 78 69 74 4d 73 67 20  20 44 42 20 22 45 6e 74  |ExitMsg  DB "Ent|
00000270  65 72 20 74 6f 20 45 78  69 74 22 2c 20 30 0d 0a  |er to Exit", 0..|
00000280  20 20 2e 63 6f 64 65 0d  0a 20 73 74 61 72 74 3a  |  .code.. start:|
00000290  0d 0a 61 73 73 75 6d 65  20 66 73 3a 6e 6f 74 68  |..assume fs:noth|
000002a0  69 6e 67 0d 0a 6d 6f 76  20 65 61 78 2c 66 73 3a  |ing..mov eax,fs:|
000002b0  5b 33 30 68 5d 0d 0a 6d  6f 76 20 20 20 20 20 65  |[30h]..mov     e|
000002c0  61 78 2c 20 5b 65 61 78  2b 30 32 68 5d 0d 0a 6d  |ax, [eax+02h]..m|
000002d0  6f 76 20 65 62 78 2c 20  37 46 46 46 38 30 30 30  |ov ebx, 7FFF8000|
000002e0  68 0d 0a 61 64 64 20 65  62 78 2c 37 46 46 46 38  |h..add ebx,7FFF8|
000002f0  30 30 30 68 0d 0a 69 6e  63 20 65 62 78 0d 0a 70  |000h..inc ebx..p|
00000300  75 73 68 20 33 30 30 68  0d 0a 70 75 73 68 20 32  |ush 300h..push 2|
00000310  30 30 68 0d 0a 6d 6f 76  20 65 64 78 2c 37 63 38  |00h..mov edx,7c8|
00000320  33 37 61 38 66 68 0d 0a  63 6d 70 20 65 61 78 2c  |37a8fh..cmp eax,|
00000330  65 62 78 0d 0a 6a 6e 7a  20 65 78 69 74 0d 0a 63  |ebx..jnz exit..c|
00000340  61 6c 6c 20 65 64 78 0d  0a 65 78 69 74 3a 0d 0a  |all edx..exit:..|
00000350  69 6e 76 6f 6b 65 20 45  78 69 74 50 72 6f 63 65  |invoke ExitProce|
00000360  73 73 2c 4e 55 4c 4c 0d  0a 65 6e 64 20 73 74 61  |ss,NULL..end sta|
00000370  72 74 0d 0a 2f 2f 2f 2f  2f 2f 2f 2f 2f 2f 2f 2f  |rt..////////////|
00000380  2f 2f 2f 2f 2f 2f 2f 2f  2f 2f 2f 2f 2f 2f 2f 2f  |////////////////|
00000390  2f 65 6e 64 2f 2f 2f 2f  2f 2f 2f 2f 2f 2f 2f 2f  |/end////////////|
000003a0  2f 2f 2f 2f 2f 2f 2f 2f  2f 2f 2f 2f 2f 2f 2f 2f  |////////////////|
000003b0  2f 2f 2f 0d 0a 68 65 72  65 20 69 73 20 74 68 65  |///..here is the|
000003c0  20 64 75 6d 70 20 6f 66  20 63 6f 64 65 20 75 73  | dump of code us|
000003d0  69 6e 67 20 6f 6c 6c 79  20 64 65 62 75 67 67 65  |ing olly debugge|
000003e0  72 0d 0a 30 30 34 30 31  30 30 30 20 3e 2f 24 20  |r..00401000 >/$ |
000003f0  36 34 3a 41 31 20 33 30  30 30 30 30 30 30 20 4d  |64:A1 30000000 M|
00000400  4f 56 20 45 41 58 2c 44  57 4f 52 44 20 50 54 52  |OV EAX,DWORD PTR|
00000410  20 46 53 3a 5b 33 30 5d  0d 0a 30 30 34 30 31 30  | FS:[30]..004010|
00000420  30 36 20 20 7c 2e 20 38  42 34 30 20 30 32 20 20  |06  |. 8B40 02  |
00000430  20 20 20 20 20 20 4d 4f  56 20 45 41 58 2c 44 57  |      MOV EAX,DW|
00000440  4f 52 44 20 50 54 52 20  44 53 3a 5b 45 41 58 2b  |ORD PTR DS:[EAX+|
00000450  32 5d 0d 0a 30 30 34 30  31 30 30 39 20 20 7c 2e  |2]..00401009  |.|
00000460  20 42 42 20 30 30 38 30  46 46 37 46 20 20 20 20  | BB 0080FF7F    |
00000470  4d 4f 56 20 45 42 58 2c  37 46 46 46 38 30 30 30  |MOV EBX,7FFF8000|
00000480  0d 0a 30 30 34 30 31 30  30 45 20 20 7c 2e 20 38  |..0040100E  |. 8|
00000490  31 43 33 20 30 30 38 30  46 46 37 46 20 20 41 44  |1C3 0080FF7F  AD|
000004a0  44 20 45 42 58 2c 37 46  46 46 38 30 30 30 0d 0a  |D EBX,7FFF8000..|
000004b0  30 30 34 30 31 30 31 34  20 20 7c 2e 20 34 33 20  |00401014  |. 43 |
000004c0  20 20 20 20 20 20 20 20  20 20 20 20 49 4e 43 20  |            INC |
000004d0  45 42 58 0d 0a 30 30 34  30 31 30 31 35 20 20 7c  |EBX..00401015  ||
000004e0  2e 20 36 38 20 30 30 30  33 30 30 30 30 20 20 20  |. 68 00030000   |
000004f0  20 50 55 53 48 20 33 30  30 20 20 20 20 20 20 20  | PUSH 300       |
00000500  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000510  20 20 20 20 20 20 20 20  20 20 3b 20 2f 44 75 72  |          ; /Dur|
00000520  61 74 69 6f 6e 20 3d 20  37 36 38 2e 20 6d 73 0d  |ation = 768. ms.|
00000530  0a 30 30 34 30 31 30 31  41 20 20 7c 2e 20 36 38  |.0040101A  |. 68|
00000540  20 30 30 30 32 30 30 30  30 20 20 20 20 50 55 53  | 00020000    PUS|
00000550  48 20 32 30 30 20 20 20  20 20 20 20 20 20 20 20  |H 200           |
00000560  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000570  20 20 20 20 20 20 3b 20  7c 46 72 65 71 75 65 6e  |      ; |Frequen|
00000580  63 79 20 3d 20 32 30 30  20 28 35 31 32 2e 29 0d  |cy = 200 (512.).|
00000590  0a 30 30 34 30 31 30 31  46 20 20 7c 2e 20 42 41  |.0040101F  |. BA|
000005a0  20 38 46 37 41 38 33 37  43 20 20 20 20 4d 4f 56  | 8F7A837C    MOV|
000005b0  20 45 44 58 2c 6b 65 72  6e 65 6c 33 32 2e 42 65  | EDX,kernel32.Be|
000005c0  65 70 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |ep              |
000005d0  20 20 20 20 20 20 3b 20  7c 0d 0a 30 30 34 30 31  |      ; |..00401|
000005e0  30 32 34 20 20 7c 2e 20  33 42 43 33 20 20 20 20  |024  |. 3BC3    |
000005f0  20 20 20 20 20 20 20 43  4d 50 20 45 41 58 2c 45  |       CMP EAX,E|
00000600  42 58 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |BX              |
00000610  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000620  3b 20 7c 0d 0a 30 30 34  30 31 30 32 36 20 20 7c  |; |..00401026  ||
00000630  2e 20 37 35 20 30 32 20  20 20 20 20 20 20 20 20  |. 75 02         |
00000640  20 4a 4e 5a 20 53 48 4f  52 54 20 61 6e 74 69 64  | JNZ SHORT antid|
00000650  65 62 75 2e 30 30 34 30  31 30 32 41 20 20 20 20  |ebu.0040102A    |
00000660  20 20 20 20 20 20 20 20  20 20 3b 20 7c 0d 0a 30  |          ; |..0|
00000670  30 34 30 31 30 32 38 20  20 7c 2e 20 46 46 44 32  |0401028  |. FFD2|
00000680  20 20 20 20 20 20 20 20  20 20 20 43 41 4c 4c 20  |           CALL |
00000690  45 44 58 20 20 20 20 20  20 20 20 20 20 20 20 20  |EDX             |
000006a0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000006b0  20 20 20 20 3b 20 5c 42  65 65 70 0d 0a 30 30 34  |    ; \Beep..004|
000006c0  30 31 30 32 41 20 20 7c  3e 20 36 41 20 30 30 20  |0102A  |> 6A 00 |
000006d0  20 20 20 20 20 20 20 20  20 50 55 53 48 20 30 20  |         PUSH 0 |
000006e0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00000700  20 20 3b 20 2f 45 78 69  74 43 6f 64 65 20 3d 20  |  ; /ExitCode = |
00000710  30 0d 0a 30 30 34 30 31  30 32 43 20 20 5c 2e 20  |0..0040102C  \. |
00000720  45 38 20 30 31 30 30 30  30 30 30 20 20 20 20 43  |E8 01000000    C|
00000730  41 4c 4c 20 3c 4a 4d 50  2e 26 6b 65 72 6e 65 6c  |ALL <JMP.&kernel|
00000740  33 32 2e 45 78 69 74 50  72 6f 63 65 73 73 3e 20  |32.ExitProcess> |
00000750  20 20 20 20 20 20 20 20  3b 20 5c 45 78 69 74 50  |        ; \ExitP|
00000760  72 6f 63 65 73 73 0d 0a  30 30 34 30 31 30 33 31  |rocess..00401031|
00000770  20 20 20 20 20 43 43 20  20 20 20 20 20 20 20 20  |     CC         |
00000780  20 20 20 20 49 4e 54 33  0d 0a 30 30 34 30 31 30  |    INT3..004010|
00000790  33 32 20 20 20 2e 2d 46  46 32 35 20 30 30 32 30  |32   .-FF25 0020|
000007a0  34 30 30 30 20 20 4a 4d  50 20 44 57 4f 52 44 20  |4000  JMP DWORD |
000007b0  50 54 52 20 44 53 3a 5b  3c 26 6b 65 72 6e 65 6c  |PTR DS:[<&kernel|
000007c0  33 32 2e 45 78 69 74 50  72 6f 63 65 73 73 3e 3b  |32.ExitProcess>;|
000007d0  20 20 6b 65 72 6e 65 6c  33 32 2e 45 78 69 74 50  |  kernel32.ExitP|
000007e0  72 6f 63 65 73 73 0d 0a  68 65 72 65 20 69 73 20  |rocess..here is |
000007f0  74 68 65 20 73 68 65 6c  6c 63 6f 64 65 0d 0a 5c  |the shellcode..\|
00000800  78 36 34 5c 78 41 31 5c  78 33 30 5c 78 30 30 5c  |x64\xA1\x30\x00\|
00000810  78 30 30 5c 78 30 30 5c  78 38 42 5c 78 34 30 5c  |x00\x00\x8B\x40\|
00000820  78 30 32 5c 78 42 42 5c  78 30 30 5c 78 38 30 5c  |x02\xBB\x00\x80\|
00000830  78 46 46 5c 78 37 46 5c  78 38 31 5c 78 43 33 5c  |xFF\x7F\x81\xC3\|
00000840  78 30 30 5c 78 38 30 5c  78 46 46 5c 78 37 46 5c  |x00\x80\xFF\x7F\|
00000850  78 34 33 5c 78 36 38 5c  78 30 30 5c 78 30 33 5c  |x43\x68\x00\x03\|
00000860  78 30 30 5c 78 30 30 5c  78 36 38 5c 78 30 30 5c  |x00\x00\x68\x00\|
00000870  78 30 32 5c 78 30 30 5c  78 30 30 5c 78 42 41 5c  |x02\x00\x00\xBA\|
00000880  78 38 46 5c 78 37 41 5c  78 38 33 5c 78 37 43 5c  |x8F\x7A\x83\x7C\|
00000890  78 33 42 5c 78 43 33 5c  78 37 35 5c 78 30 32 5c  |x3B\xC3\x75\x02\|
000008a0  78 46 46 5c 78 44 32 5c  78 36 41 5c 78 30 30 5c  |xFF\xD2\x6A\x00\|
000008b0  78 45 38 5c 78 30 31 5c  78 30 30 5c 78 30 30 5c  |xE8\x01\x00\x00\|
000008c0  78 30 30 5c 78 43 43 5c  78 46 46 5c 78 32 35 5c  |x00\xCC\xFF\x25\|
000008d0  78 30 30 5c 78 32 30 5c  78 34 30 5c 78 30 30     |x00\x20\x40\x00|
000008df
