00000000  2f 2a 0d 0a 54 69 74 6c  65 3a 20 41 6c 6c 77 69  |/*..Title: Allwi|
00000010  6e 20 4d 65 73 73 61 67  65 42 6f 78 41 20 53 68  |n MessageBoxA Sh|
00000020  65 6c 6c 63 6f 64 65 0d  0a 44 61 74 65 3a 20 32  |ellcode..Date: 2|
00000030  30 31 30 2d 30 36 2d 31  31 0d 0a 41 75 74 68 6f  |010-06-11..Autho|
00000040  72 3a 20 52 75 62 62 65  72 44 75 63 6b 0d 0a 57  |r: RubberDuck..W|
00000050  65 62 3a 20 68 74 74 70  3a 2f 2f 62 66 6c 6f 77  |eb: http://bflow|
00000060  2e 73 65 63 75 72 69 74  79 2d 70 6f 72 74 61 6c  |.security-portal|
00000070  2e 63 7a 0d 0a 54 65 73  74 65 64 20 6f 6e 3a 20  |.cz..Tested on: |
00000080  57 69 6e 20 32 6b 2c 20  57 69 6e 20 32 30 30 33  |Win 2k, Win 2003|
00000090  2c 20 57 69 6e 20 58 50  20 48 6f 6d 65 20 53 50  |, Win XP Home SP|
000000a0  32 2f 53 50 33 20 43 5a  2f 45 4e 47 20 28 33 32  |2/SP3 CZ/ENG (32|
000000b0  29 2c 20 57 69 6e 20 56  69 73 74 61 20 28 33 32  |), Win Vista (32|
000000c0  29 2f 28 36 34 29 2c 20  57 69 6e 20 37 20 28 33  |)/(64), Win 7 (3|
000000d0  32 29 2f 28 36 34 29 2c  20 57 69 6e 20 32 6b 38  |2)/(64), Win 2k8|
000000e0  20 28 33 32 29 0d 0a 54  68 61 6e 6b 73 20 74 6f  | (32)..Thanks to|
000000f0  3a 20 6b 65 72 6e 65 6c  68 75 6e 74 65 72 2c 20  |: kernelhunter, |
00000100  4c 6f 64 75 73 2c 20 56  72 74 75 6c 65 2c 20 4d  |Lodus, Vrtule, M|
00000110  61 74 6f 2c 20 63 6d 33  6c 31 6b 31 2c 20 65 61  |ato, cm3l1k1, ea|
00000120  74 2c 20 73 74 31 67 64  33 72 20 61 6e 64 20 6f  |t, st1gd3r and o|
00000130  74 68 65 72 73 0d 0a 2a  2f 0d 0a 20 0d 0a 23 69  |thers..*/.. ..#i|
00000140  6e 63 6c 75 64 65 20 3c  73 74 64 69 6f 2e 68 3e  |nclude <stdio.h>|
00000150  0d 0a 23 69 6e 63 6c 75  64 65 20 3c 73 74 72 69  |..#include <stri|
00000160  6e 67 2e 68 3e 0d 0a 23  69 6e 63 6c 75 64 65 20  |ng.h>..#include |
00000170  3c 73 74 64 6c 69 62 2e  68 3e 0d 0a 20 0d 0a 69  |<stdlib.h>.. ..i|
00000180  6e 74 20 6d 61 69 6e 28  29 7b 0d 0a 20 20 20 20  |nt main(){..    |
00000190  75 6e 73 69 67 6e 65 64  20 63 68 61 72 20 73 68  |unsigned char sh|
000001a0  65 6c 6c 63 6f 64 65 5b  5d 3d 0d 0a 20 20 20 20  |ellcode[]=..    |
000001b0  22 5c 78 46 43 5c 78 33  33 5c 78 44 32 5c 78 42  |"\xFC\x33\xD2\xB|
000001c0  32 5c 78 33 30 5c 78 36  34 5c 78 46 46 5c 78 33  |2\x30\x64\xFF\x3|
000001d0  32 5c 78 35 41 5c 78 38  42 22 0d 0a 20 20 20 20  |2\x5A\x8B"..    |
000001e0  22 5c 78 35 32 5c 78 30  43 5c 78 38 42 5c 78 35  |"\x52\x0C\x8B\x5|
000001f0  32 5c 78 31 34 5c 78 38  42 5c 78 37 32 5c 78 32  |2\x14\x8B\x72\x2|
00000200  38 5c 78 33 33 5c 78 43  39 22 0d 0a 20 20 20 20  |8\x33\xC9"..    |
00000210  22 5c 78 42 31 5c 78 31  38 5c 78 33 33 5c 78 46  |"\xB1\x18\x33\xF|
00000220  46 5c 78 33 33 5c 78 43  30 5c 78 41 43 5c 78 33  |F\x33\xC0\xAC\x3|
00000230  43 5c 78 36 31 5c 78 37  43 22 0d 0a 20 20 20 20  |C\x61\x7C"..    |
00000240  22 5c 78 30 32 5c 78 32  43 5c 78 32 30 5c 78 43  |"\x02\x2C\x20\xC|
00000250  31 5c 78 43 46 5c 78 30  44 5c 78 30 33 5c 78 46  |1\xCF\x0D\x03\xF|
00000260  38 5c 78 45 32 5c 78 46  30 22 0d 0a 20 20 20 20  |8\xE2\xF0"..    |
00000270  22 5c 78 38 31 5c 78 46  46 5c 78 35 42 5c 78 42  |"\x81\xFF\x5B\xB|
00000280  43 5c 78 34 41 5c 78 36  41 5c 78 38 42 5c 78 35  |C\x4A\x6A\x8B\x5|
00000290  41 5c 78 31 30 5c 78 38  42 22 0d 0a 20 20 20 20  |A\x10\x8B"..    |
000002a0  22 5c 78 31 32 5c 78 37  35 5c 78 44 41 5c 78 38  |"\x12\x75\xDA\x8|
000002b0  42 5c 78 35 33 5c 78 33  43 5c 78 30 33 5c 78 44  |B\x53\x3C\x03\xD|
000002c0  33 5c 78 46 46 5c 78 37  32 22 0d 0a 20 20 20 20  |3\xFF\x72"..    |
000002d0  22 5c 78 33 34 5c 78 38  42 5c 78 35 32 5c 78 37  |"\x34\x8B\x52\x7|
000002e0  38 5c 78 30 33 5c 78 44  33 5c 78 38 42 5c 78 37  |8\x03\xD3\x8B\x7|
000002f0  32 5c 78 32 30 5c 78 30  33 22 0d 0a 20 20 20 20  |2\x20\x03"..    |
00000300  22 5c 78 46 33 5c 78 33  33 5c 78 43 39 5c 78 34  |"\xF3\x33\xC9\x4|
00000310  31 5c 78 41 44 5c 78 30  33 5c 78 43 33 5c 78 38  |1\xAD\x03\xC3\x8|
00000320  31 5c 78 33 38 5c 78 34  37 22 0d 0a 20 20 20 20  |1\x38\x47"..    |
00000330  22 5c 78 36 35 5c 78 37  34 5c 78 35 30 5c 78 37  |"\x65\x74\x50\x7|
00000340  35 5c 78 46 34 5c 78 38  31 5c 78 37 38 5c 78 30  |5\xF4\x81\x78\x0|
00000350  34 5c 78 37 32 5c 78 36  46 22 0d 0a 20 20 20 20  |4\x72\x6F"..    |
00000360  22 5c 78 36 33 5c 78 34  31 5c 78 37 35 5c 78 45  |"\x63\x41\x75\xE|
00000370  42 5c 78 38 31 5c 78 37  38 5c 78 30 38 5c 78 36  |B\x81\x78\x08\x6|
00000380  34 5c 78 36 34 5c 78 37  32 22 0d 0a 20 20 20 20  |4\x64\x72"..    |
00000390  22 5c 78 36 35 5c 78 37  35 5c 78 45 32 5c 78 34  |"\x65\x75\xE2\x4|
000003a0  39 5c 78 38 42 5c 78 37  32 5c 78 32 34 5c 78 30  |9\x8B\x72\x24\x0|
000003b0  33 5c 78 46 33 5c 78 36  36 22 0d 0a 20 20 20 20  |3\xF3\x66"..    |
000003c0  22 5c 78 38 42 5c 78 30  43 5c 78 34 45 5c 78 38  |"\x8B\x0C\x4E\x8|
000003d0  42 5c 78 37 32 5c 78 31  43 5c 78 30 33 5c 78 46  |B\x72\x1C\x03\xF|
000003e0  33 5c 78 38 42 5c 78 31  34 22 0d 0a 20 20 20 20  |3\x8B\x14"..    |
000003f0  22 5c 78 38 45 5c 78 30  33 5c 78 44 33 5c 78 35  |"\x8E\x03\xD3\x5|
00000400  32 5c 78 33 33 5c 78 46  46 5c 78 35 37 5c 78 36  |2\x33\xFF\x57\x6|
00000410  38 5c 78 36 31 5c 78 37  32 22 0d 0a 20 20 20 20  |8\x61\x72"..    |
00000420  22 5c 78 37 39 5c 78 34  31 5c 78 36 38 5c 78 34  |"\x79\x41\x68\x4|
00000430  43 5c 78 36 39 5c 78 36  32 5c 78 37 32 5c 78 36  |C\x69\x62\x72\x6|
00000440  38 5c 78 34 43 5c 78 36  46 22 0d 0a 20 20 20 20  |8\x4C\x6F"..    |
00000450  22 5c 78 36 31 5c 78 36  34 5c 78 35 34 5c 78 35  |"\x61\x64\x54\x5|
00000460  33 5c 78 46 46 5c 78 44  32 5c 78 36 38 5c 78 33  |3\xFF\xD2\x68\x3|
00000470  33 5c 78 33 32 5c 78 30  31 22 0d 0a 20 20 20 20  |3\x32\x01"..    |
00000480  22 5c 78 30 31 5c 78 36  36 5c 78 38 39 5c 78 37  |"\x01\x66\x89\x7|
00000490  43 5c 78 32 34 5c 78 30  32 5c 78 36 38 5c 78 37  |C\x24\x02\x68\x7|
000004a0  35 5c 78 37 33 5c 78 36  35 22 0d 0a 20 20 20 20  |5\x73\x65"..    |
000004b0  22 5c 78 37 32 5c 78 35  34 5c 78 46 46 5c 78 44  |"\x72\x54\xFF\xD|
000004c0  30 5c 78 36 38 5c 78 36  46 5c 78 37 38 5c 78 34  |0\x68\x6F\x78\x4|
000004d0  31 5c 78 30 31 5c 78 38  42 22 0d 0a 20 20 20 20  |1\x01\x8B"..    |
000004e0  22 5c 78 44 46 5c 78 38  38 5c 78 35 43 5c 78 32  |"\xDF\x88\x5C\x2|
000004f0  34 5c 78 30 33 5c 78 36  38 5c 78 36 31 5c 78 36  |4\x03\x68\x61\x6|
00000500  37 5c 78 36 35 5c 78 34  32 22 0d 0a 20 20 20 20  |7\x65\x42"..    |
00000510  22 5c 78 36 38 5c 78 34  44 5c 78 36 35 5c 78 37  |"\x68\x4D\x65\x7|
00000520  33 5c 78 37 33 5c 78 35  34 5c 78 35 30 5c 78 46  |3\x73\x54\x50\xF|
00000530  46 5c 78 35 34 5c 78 32  34 22 0d 0a 20 20 20 20  |F\x54\x24"..    |
00000540  22 5c 78 32 43 5c 78 35  37 5c 78 36 38 5c 78 34  |"\x2C\x57\x68\x4|
00000550  46 5c 78 35 46 5c 78 36  46 5c 78 32 31 5c 78 38  |F\x5F\x6F\x21\x8|
00000560  42 5c 78 44 43 5c 78 35  37 22 0d 0a 20 20 20 20  |B\xDC\x57"..    |
00000570  22 5c 78 35 33 5c 78 35  33 5c 78 35 37 5c 78 46  |"\x53\x53\x57\xF|
00000580  46 5c 78 44 30 5c 78 36  38 5c 78 36 35 5c 78 37  |F\xD0\x68\x65\x7|
00000590  33 5c 78 37 33 5c 78 30  31 22 0d 0a 20 20 20 20  |3\x73\x01"..    |
000005a0  22 5c 78 38 42 5c 78 44  46 5c 78 38 38 5c 78 35  |"\x8B\xDF\x88\x5|
000005b0  43 5c 78 32 34 5c 78 30  33 5c 78 36 38 5c 78 35  |C\x24\x03\x68\x5|
000005c0  30 5c 78 37 32 5c 78 36  46 22 0d 0a 20 20 20 20  |0\x72\x6F"..    |
000005d0  22 5c 78 36 33 5c 78 36  38 5c 78 34 35 5c 78 37  |"\x63\x68\x45\x7|
000005e0  38 5c 78 36 39 5c 78 37  34 5c 78 35 34 5c 78 46  |8\x69\x74\x54\xF|
000005f0  46 5c 78 37 34 5c 78 32  34 22 0d 0a 20 20 20 20  |F\x74\x24"..    |
00000600  22 5c 78 34 30 5c 78 46  46 5c 78 35 34 5c 78 32  |"\x40\xFF\x54\x2|
00000610  34 5c 78 34 30 5c 78 35  37 5c 78 46 46 5c 78 44  |4\x40\x57\xFF\xD|
00000620  30 22 3b 0d 0a 20 0d 0a  20 20 20 20 70 72 69 6e  |0";.. ..    prin|
00000630  74 66 28 22 53 69 7a 65  20 3d 20 25 64 5c 6e 22  |tf("Size = %d\n"|
00000640  2c 20 73 74 72 6c 65 6e  28 73 68 65 6c 6c 63 6f  |, strlen(shellco|
00000650  64 65 29 29 3b 0d 0a 20  0d 0a 20 20 20 20 73 79  |de));.. ..    sy|
00000660  73 74 65 6d 28 22 50 41  55 53 45 22 29 3b 0d 0a  |stem("PAUSE");..|
00000670  20 0d 0a 20 20 20 20 28  28 76 6f 69 64 20 28 2a  | ..    ((void (*|
00000680  29 28 29 29 73 68 65 6c  6c 63 6f 64 65 29 28 29  |)())shellcode)()|
00000690  3b 0d 0a 20 0d 0a 20 20  20 20 72 65 74 75 72 6e  |;.. ..    return|
000006a0  20 30 3b 0d 0a 7d                                 | 0;..}|
000006a6
