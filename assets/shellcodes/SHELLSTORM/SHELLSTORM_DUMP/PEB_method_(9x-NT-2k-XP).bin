00000000  2f 2a 0d 0a 30 30 34 30  34 35 46 34 20 3e 20 36  |/*..004045F4 > 6|
00000010  41 20 33 30 20 20 20 20  20 20 20 20 20 20 20 20  |A 30            |
00000020  50 55 53 48 20 33 30 0d  0a 30 30 34 30 34 35 46  |PUSH 30..004045F|
00000030  36 20 20 20 35 39 20 20  20 20 20 20 20 20 20 20  |6   59          |
00000040  20 20 20 20 20 50 4f 50  20 45 43 58 0d 0a 30 30  |     POP ECX..00|
00000050  34 30 34 35 46 37 20 20  20 36 34 3a 38 42 30 39  |4045F7   64:8B09|
00000060  20 20 20 20 20 20 20 20  20 20 4d 4f 56 20 45 43  |          MOV EC|
00000070  58 2c 44 57 4f 52 44 20  50 54 52 20 46 53 3a 5b  |X,DWORD PTR FS:[|
00000080  45 43 58 5d 0d 0a 30 30  34 30 34 35 46 41 20 20  |ECX]..004045FA  |
00000090  20 38 35 43 39 20 20 20  20 20 20 20 20 20 20 20  | 85C9           |
000000a0  20 20 54 45 53 54 20 45  43 58 2c 45 43 58 0d 0a  |  TEST ECX,ECX..|
000000b0  30 30 34 30 34 35 46 43  20 20 20 37 38 20 30 43  |004045FC   78 0C|
000000c0  20 20 20 20 20 20 20 20  20 20 20 20 4a 53 20 53  |            JS S|
000000d0  48 4f 52 54 20 4f 6c 6c  79 54 65 73 74 2e 30 30  |HORT OllyTest.00|
000000e0  34 30 34 36 30 41 0d 0a  30 30 34 30 34 35 46 45  |40460A..004045FE|
000000f0  20 20 20 38 42 34 39 20  30 43 20 20 20 20 20 20  |   8B49 0C      |
00000100  20 20 20 20 4d 4f 56 20  45 43 58 2c 44 57 4f 52  |    MOV ECX,DWOR|
00000110  44 20 50 54 52 20 44 53  3a 5b 45 43 58 2b 43 5d  |D PTR DS:[ECX+C]|
00000120  0d 0a 30 30 34 30 34 36  30 31 20 20 20 38 42 37  |..00404601   8B7|
00000130  31 20 31 43 20 20 20 20  20 20 20 20 20 20 4d 4f  |1 1C          MO|
00000140  56 20 45 53 49 2c 44 57  4f 52 44 20 50 54 52 20  |V ESI,DWORD PTR |
00000150  44 53 3a 5b 45 43 58 2b  31 43 5d 0d 0a 30 30 34  |DS:[ECX+1C]..004|
00000160  30 34 36 30 34 20 20 20  41 44 20 20 20 20 20 20  |04604   AD      |
00000170  20 20 20 20 20 20 20 20  20 4c 4f 44 53 20 44 57  |         LODS DW|
00000180  4f 52 44 20 50 54 52 20  44 53 3a 5b 45 53 49 5d  |ORD PTR DS:[ESI]|
00000190  0d 0a 30 30 34 30 34 36  30 35 20 20 20 38 42 34  |..00404605   8B4|
000001a0  38 20 30 38 20 20 20 20  20 20 20 20 20 20 4d 4f  |8 08          MO|
000001b0  56 20 45 43 58 2c 44 57  4f 52 44 20 50 54 52 20  |V ECX,DWORD PTR |
000001c0  44 53 3a 5b 45 41 58 2b  38 5d 0d 0a 30 30 34 30  |DS:[EAX+8]..0040|
000001d0  34 36 30 38 20 20 20 45  42 20 30 39 20 20 20 20  |4608   EB 09    |
000001e0  20 20 20 20 20 20 20 20  4a 4d 50 20 53 48 4f 52  |        JMP SHOR|
000001f0  54 20 4f 6c 6c 79 54 65  73 74 2e 30 30 34 30 34  |T OllyTest.00404|
00000200  36 31 33 0d 0a 30 30 34  30 34 36 30 41 20 20 20  |613..0040460A   |
00000210  38 42 34 39 20 33 34 20  20 20 20 20 20 20 20 20  |8B49 34         |
00000220  20 4d 4f 56 20 45 43 58  2c 44 57 4f 52 44 20 50  | MOV ECX,DWORD P|
00000230  54 52 20 44 53 3a 5b 45  43 58 2b 33 34 5d 0d 0a  |TR DS:[ECX+34]..|
00000240  30 30 34 30 34 36 30 44  20 20 20 38 42 34 39 20  |0040460D   8B49 |
00000250  37 43 20 20 20 20 20 20  20 20 20 20 4d 4f 56 20  |7C          MOV |
00000260  45 43 58 2c 44 57 4f 52  44 20 50 54 52 20 44 53  |ECX,DWORD PTR DS|
00000270  3a 5b 45 43 58 2b 37 43  5d 0d 0a 30 30 34 30 34  |:[ECX+7C]..00404|
00000280  36 31 30 20 20 20 38 42  34 39 20 33 43 20 20 20  |610   8B49 3C   |
00000290  20 20 20 20 20 20 20 4d  4f 56 20 45 43 58 2c 44  |       MOV ECX,D|
000002a0  57 4f 52 44 20 50 54 52  20 44 53 3a 5b 45 43 58  |WORD PTR DS:[ECX|
000002b0  2b 33 43 5d 0d 0a 2a 2f  0d 0a 0d 0a 2f 2a 0d 0a  |+3C]..*/..../*..|
000002c0  33 31 20 62 79 74 65 20  43 20 50 45 42 20 6b 65  |31 byte C PEB ke|
000002d0  72 6e 65 6c 20 62 61 73  65 20 6c 6f 63 61 74 69  |rnel base locati|
000002e0  6f 6e 20 6d 65 74 68 6f  64 20 77 6f 72 6b 73 20  |on method works |
000002f0  6f 6e 20 77 69 6e 39 78  2d 77 69 6e 32 6b 33 0d  |on win9x-win2k3.|
00000300  0a 6e 6f 20 6e 75 6c 6c  20 62 79 74 65 73 2c 20  |.no null bytes, |
00000310  73 6f 20 6e 6f 20 6e 65  65 64 20 74 6f 20 78 6f  |so no need to xo|
00000320  72 2e 0d 0a 0d 0a 2d 74  77 6f 63 69 0d 0a 2a 2f  |r.....-twoci..*/|
00000330  0d 0a 0d 0a 75 6e 73 69  67 6e 65 64 20 63 68 61  |....unsigned cha|
00000340  72 20 50 45 42 43 6f 64  65 5b 5d 20 3d 0d 0a 7b  |r PEBCode[] =..{|
00000350  22 5c 78 36 41 5c 78 33  30 22 0d 0a 22 5c 78 35  |"\x6A\x30".."\x5|
00000360  39 22 0d 0a 22 5c 78 36  34 5c 78 38 42 5c 78 30  |9".."\x64\x8B\x0|
00000370  39 22 0d 0a 22 5c 78 38  35 5c 78 43 39 22 0d 0a  |9".."\x85\xC9"..|
00000380  22 5c 78 37 38 5c 78 30  43 22 0d 0a 22 5c 78 38  |"\x78\x0C".."\x8|
00000390  42 5c 78 34 39 5c 78 30  43 22 0d 0a 22 5c 78 38  |B\x49\x0C".."\x8|
000003a0  42 5c 78 37 31 5c 78 31  43 22 0d 0a 22 5c 78 41  |B\x71\x1C".."\xA|
000003b0  44 22 0d 0a 22 5c 78 38  42 5c 78 34 38 5c 78 30  |D".."\x8B\x48\x0|
000003c0  38 22 0d 0a 22 5c 78 45  42 5c 78 30 39 22 0d 0a  |8".."\xEB\x09"..|
000003d0  22 5c 78 38 42 5c 78 34  39 5c 78 33 34 22 0d 0a  |"\x8B\x49\x34"..|
000003e0  22 5c 78 38 42 5c 78 34  39 5c 78 37 43 22 0d 0a  |"\x8B\x49\x7C"..|
000003f0  22 5c 78 38 42 5c 78 34  39 5c 78 33 43 22 7d 3b  |"\x8B\x49\x3C"};|
00000400  0d 0a 0d 0a 69 6e 74 20  6d 61 69 6e 28 20 69 6e  |....int main( in|
00000410  74 20 61 72 67 63 2c 20  63 68 61 72 20 2a 61 72  |t argc, char *ar|
00000420  67 76 5b 5d 20 29 0d 0a  7b 0d 0a 20 20 20 70 72  |gv[] )..{..   pr|
00000430  69 6e 74 66 28 20 22 73  69 7a 65 6f 66 28 50 45  |intf( "sizeof(PE|
00000440  42 43 6f 64 65 29 20 3d  20 25 75 5c 6e 22 2c 20  |BCode) = %u\n", |
00000450  73 69 7a 65 6f 66 28 50  45 42 43 6f 64 65 29 20  |sizeof(PEBCode) |
00000460  29 3b 0d 0a 20 20 20 72  65 74 75 72 6e 20 30 3b  |);..   return 0;|
00000470  0d 0a 7d                                          |..}|
00000473
