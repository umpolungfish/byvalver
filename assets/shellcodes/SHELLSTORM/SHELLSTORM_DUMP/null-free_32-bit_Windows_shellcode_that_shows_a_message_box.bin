00000000  3b 20 43 6f 70 79 72 69  67 68 74 20 28 63 29 20  |; Copyright (c) |
00000010  32 30 30 39 2d 32 30 31  30 2c 20 42 65 72 65 6e  |2009-2010, Beren|
00000020  64 2d 4a 61 6e 20 22 53  6b 79 4c 69 6e 65 64 22  |d-Jan "SkyLined"|
00000030  20 57 65 76 65 72 20 3c  62 65 72 65 6e 64 6a 61  | Wever <berendja|
00000040  6e 77 65 76 65 72 40 67  6d 61 69 6c 2e 63 6f 6d  |nwever@gmail.com|
00000050  3e 0d 0a 3b 20 50 72 6f  6a 65 63 74 20 68 6f 6d  |>..; Project hom|
00000060  65 70 61 67 65 3a 20 68  74 74 70 3a 2f 2f 63 6f  |epage: http://co|
00000070  64 65 2e 67 6f 6f 67 6c  65 2e 63 6f 6d 2f 70 2f  |de.google.com/p/|
00000080  77 33 32 2d 64 6c 2d 6c  6f 61 64 6c 69 62 2d 73  |w32-dl-loadlib-s|
00000090  68 65 6c 6c 63 6f 64 65  2f 0d 0a 3b 20 41 6c 6c  |hellcode/..; All|
000000a0  20 72 69 67 68 74 73 20  72 65 73 65 72 76 65 64  | rights reserved|
000000b0  2e 20 53 65 65 20 43 4f  50 59 52 49 47 48 54 2e  |. See COPYRIGHT.|
000000c0  74 78 74 20 66 6f 72 20  64 65 74 61 69 6c 73 2e  |txt for details.|
000000d0  0d 0a 42 49 54 53 20 33  32 0d 0a 3b 20 57 69 6e  |..BITS 32..; Win|
000000e0  64 6f 77 73 20 78 38 36  20 6e 75 6c 6c 2d 66 72  |dows x86 null-fr|
000000f0  65 65 20 73 68 65 6c 6c  63 6f 64 65 20 74 68 61  |ee shellcode tha|
00000100  74 20 65 78 65 63 75 74  65 73 20 63 61 6c 63 2e  |t executes calc.|
00000110  65 78 65 2e 0d 0a 3b 20  57 6f 72 6b 73 20 69 6e  |exe...; Works in|
00000120  20 61 6e 79 20 61 70 70  6c 69 63 61 74 69 6f 6e  | any application|
00000130  20 66 6f 72 20 57 69 6e  64 6f 77 73 20 35 2e 30  | for Windows 5.0|
00000140  2d 37 2e 30 20 61 6c 6c  20 73 65 72 76 69 63 65  |-7.0 all service|
00000150  20 70 61 63 6b 73 2e 0d  0a 3b 20 28 53 65 65 20  | packs...; (See |
00000160  68 74 74 70 3a 2f 2f 73  6b 79 70 68 65 72 2e 63  |http://skypher.c|
00000170  6f 6d 2f 77 69 6b 69 2f  69 6e 64 65 78 2e 70 68  |om/wiki/index.ph|
00000180  70 2f 48 61 63 6b 69 6e  67 2f 53 68 65 6c 6c 63  |p/Hacking/Shellc|
00000190  6f 64 65 29 2e 0d 0a 3b  20 54 68 69 73 20 76 65  |ode)...; This ve|
000001a0  72 73 69 6f 6e 20 75 73  65 73 20 31 36 2d 62 69  |rsion uses 16-bi|
000001b0  74 20 68 61 73 68 65 73  2e 0d 0a 0d 0a 25 69 6e  |t hashes.....%in|
000001c0  63 6c 75 64 65 20 27 77  33 32 2d 6d 73 67 62 6f  |clude 'w32-msgbo|
000001d0  78 2d 73 68 65 6c 6c 63  6f 64 65 2d 68 61 73 68  |x-shellcode-hash|
000001e0  2d 6c 69 73 74 2e 61 73  6d 27 0d 0a 0d 0a 25 64  |-list.asm'....%d|
000001f0  65 66 69 6e 65 20 42 32  57 28 62 31 2c 62 32 29  |efine B2W(b1,b2)|
00000200  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000210  20 20 20 20 20 20 28 28  28 62 32 29 20 3c 3c 20  |      (((b2) << |
00000220  38 29 20 2b 20 28 62 31  29 29 0d 0a 25 64 65 66  |8) + (b1))..%def|
00000230  69 6e 65 20 57 32 44 57  28 77 31 2c 77 32 29 20  |ine W2DW(w1,w2) |
00000240  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000250  20 20 20 20 28 28 28 77  32 29 20 3c 3c 20 31 36  |    (((w2) << 16|
00000260  29 20 2b 20 28 77 31 29  29 0d 0a 25 64 65 66 69  |) + (w1))..%defi|
00000270  6e 65 20 42 32 44 57 28  62 31 2c 62 32 2c 62 33  |ne B2DW(b1,b2,b3|
00000280  2c 62 34 29 20 20 20 20  20 20 20 20 20 20 20 20  |,b4)            |
00000290  20 20 20 28 28 28 62 34  29 20 3c 3c 20 32 34 29  |   (((b4) << 24)|
000002a0  20 2b 20 28 28 62 33 29  20 3c 3c 20 31 36 29 20  | + ((b3) << 16) |
000002b0  2b 20 28 28 62 32 29 20  3c 3c 20 38 29 20 2b 20  |+ ((b2) << 8) + |
000002c0  28 62 31 29 29 0d 0a 0d  0a 25 69 66 64 65 66 20  |(b1))....%ifdef |
000002d0  53 54 41 43 4b 5f 41 4c  49 47 4e 0d 0a 20 20 20  |STACK_ALIGN..   |
000002e0  20 41 4e 44 20 20 20 20  20 53 50 2c 20 30 78 46  | AND     SP, 0xF|
000002f0  46 46 43 0d 0a 25 65 6e  64 69 66 0d 0a 66 69 6e  |FFC..%endif..fin|
00000300  64 5f 68 61 73 68 3a 20  3b 20 46 69 6e 64 20 6e  |d_hash: ; Find n|
00000310  74 64 6c 6c 27 73 20 49  6e 49 6e 69 74 4f 72 64  |tdll's InInitOrd|
00000320  65 72 20 6c 69 73 74 20  6f 66 20 6d 6f 64 75 6c  |er list of modul|
00000330  65 73 3a 0d 0a 20 20 20  20 58 4f 52 20 20 20 20  |es:..    XOR    |
00000340  20 45 53 49 2c 20 45 53  49 20 20 20 20 20 20 20  | ESI, ESI       |
00000350  20 20 20 20 20 20 20 20  20 20 20 20 20 3b 20 45  |             ; E|
00000360  53 49 20 3d 20 30 0d 0a  20 20 20 20 50 55 53 48  |SI = 0..    PUSH|
00000370  20 20 20 20 45 53 49 20  20 20 20 20 20 20 20 20  |    ESI         |
00000380  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000390  3b 20 53 74 61 63 6b 20  3d 20 30 0d 0a 20 20 20  |; Stack = 0..   |
000003a0  20 4d 4f 56 20 20 20 20  20 45 53 49 2c 20 5b 46  | MOV     ESI, [F|
000003b0  53 3a 45 53 49 20 2b 20  30 78 33 30 5d 20 20 20  |S:ESI + 0x30]   |
000003c0  20 20 20 20 20 3b 20 45  53 49 20 3d 20 26 28 50  |     ; ESI = &(P|
000003d0  45 42 29 20 28 5b 46 53  3a 30 78 33 30 5d 29 0d  |EB) ([FS:0x30]).|
000003e0  0a 20 20 20 20 4d 4f 56  20 20 20 20 20 45 53 49  |.    MOV     ESI|
000003f0  2c 20 5b 45 53 49 20 2b  20 30 78 30 43 5d 20 20  |, [ESI + 0x0C]  |
00000400  20 20 20 20 20 20 20 20  20 3b 20 45 53 49 20 3d  |         ; ESI =|
00000410  20 50 45 42 2d 3e 4c 64  72 0d 0a 20 20 20 20 4d  | PEB->Ldr..    M|
00000420  4f 56 20 20 20 20 20 45  53 49 2c 20 5b 45 53 49  |OV     ESI, [ESI|
00000430  20 2b 20 30 78 31 43 5d  20 20 20 20 20 20 20 20  | + 0x1C]        |
00000440  20 20 20 3b 20 45 53 49  20 3d 20 50 45 42 2d 3e  |   ; ESI = PEB->|
00000450  4c 64 72 2e 49 6e 49 6e  69 74 4f 72 64 65 72 20  |Ldr.InInitOrder |
00000460  28 66 69 72 73 74 20 6d  6f 64 75 6c 65 29 0d 0a  |(first module)..|
00000470  6e 65 78 74 5f 6d 6f 64  75 6c 65 3a 20 3b 20 47  |next_module: ; G|
00000480  65 74 20 74 68 65 20 62  61 73 65 61 64 64 72 65  |et the baseaddre|
00000490  73 73 20 6f 66 20 74 68  65 20 63 75 72 72 65 6e  |ss of the curren|
000004a0  74 20 6d 6f 64 75 6c 65  20 61 6e 64 20 66 69 6e  |t module and fin|
000004b0  64 20 74 68 65 20 6e 65  78 74 20 6d 6f 64 75 6c  |d the next modul|
000004c0  65 3a 0d 0a 20 20 20 20  4d 4f 56 20 20 20 20 20  |e:..    MOV     |
000004d0  45 42 50 2c 20 5b 45 53  49 20 2b 20 30 78 30 38  |EBP, [ESI + 0x08|
000004e0  5d 20 20 20 20 20 20 20  20 20 20 20 3b 20 45 42  |]           ; EB|
000004f0  50 20 3d 20 49 6e 49 6e  69 74 4f 72 64 65 72 5b  |P = InInitOrder[|
00000500  58 5d 2e 62 61 73 65 5f  61 64 64 72 65 73 73 0d  |X].base_address.|
00000510  0a 20 20 20 20 4d 4f 56  20 20 20 20 20 45 53 49  |.    MOV     ESI|
00000520  2c 20 5b 45 53 49 5d 20  20 20 20 20 20 20 20 20  |, [ESI]         |
00000530  20 20 20 20 20 20 20 20  20 3b 20 45 53 49 20 3d  |         ; ESI =|
00000540  20 49 6e 49 6e 69 74 4f  72 64 65 72 5b 58 5d 2e  | InInitOrder[X].|
00000550  66 6c 69 6e 6b 20 3d 3d  20 49 6e 49 6e 69 74 4f  |flink == InInitO|
00000560  72 64 65 72 5b 58 2b 31  5d 0d 0a 67 65 74 5f 70  |rder[X+1]..get_p|
00000570  72 6f 63 5f 61 64 64 72  65 73 73 5f 6c 6f 6f 70  |roc_address_loop|
00000580  3a 20 3b 20 46 69 6e 64  20 74 68 65 20 50 45 20  |: ; Find the PE |
00000590  68 65 61 64 65 72 20 61  6e 64 20 65 78 70 6f 72  |header and expor|
000005a0  74 20 61 6e 64 20 6e 61  6d 65 73 20 74 61 62 6c  |t and names tabl|
000005b0  65 73 20 6f 66 20 74 68  65 20 6d 6f 64 75 6c 65  |es of the module|
000005c0  3a 0d 0a 20 20 20 20 4d  4f 56 20 20 20 20 20 45  |:..    MOV     E|
000005d0  42 58 2c 20 5b 45 42 50  20 2b 20 30 78 33 43 5d  |BX, [EBP + 0x3C]|
000005e0  20 20 20 20 20 20 20 20  20 20 20 3b 20 45 42 58  |           ; EBX|
000005f0  20 3d 20 26 28 50 45 20  68 65 61 64 65 72 29 0d  | = &(PE header).|
00000600  0a 20 20 20 20 4d 4f 56  20 20 20 20 20 45 42 58  |.    MOV     EBX|
00000610  2c 20 5b 45 42 50 20 2b  20 45 42 58 20 2b 20 30  |, [EBP + EBX + 0|
00000620  78 37 38 5d 20 20 20 20  20 3b 20 45 42 58 20 3d  |x78]     ; EBX =|
00000630  20 6f 66 66 73 65 74 28  65 78 70 6f 72 74 20 74  | offset(export t|
00000640  61 62 6c 65 29 0d 0a 20  20 20 20 41 44 44 20 20  |able)..    ADD  |
00000650  20 20 20 45 42 58 2c 20  45 42 50 20 20 20 20 20  |   EBX, EBP     |
00000660  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 3b  |               ;|
00000670  20 45 42 58 20 3d 20 26  28 65 78 70 6f 72 74 20  | EBX = &(export |
00000680  74 61 62 6c 65 29 0d 0a  20 20 20 20 4d 4f 56 20  |table)..    MOV |
00000690  20 20 20 20 45 43 58 2c  20 5b 45 42 58 20 2b 20  |    ECX, [EBX + |
000006a0  30 78 31 38 5d 20 20 20  20 20 20 20 20 20 20 20  |0x18]           |
000006b0  3b 20 45 43 58 20 3d 20  6e 75 6d 62 65 72 20 6f  |; ECX = number o|
000006c0  66 20 6e 61 6d 65 20 70  6f 69 6e 74 65 72 73 0d  |f name pointers.|
000006d0  0a 20 20 20 20 4a 43 58  5a 20 20 20 20 6e 65 78  |.    JCXZ    nex|
000006e0  74 5f 6d 6f 64 75 6c 65  20 20 20 20 20 20 20 20  |t_module        |
000006f0  20 20 20 20 20 20 20 20  20 3b 20 4e 6f 20 6e 61  |         ; No na|
00000700  6d 65 20 70 6f 69 6e 74  65 72 73 3f 20 4e 65 78  |me pointers? Nex|
00000710  74 20 6d 6f 64 75 6c 65  2e 0d 0a 6e 65 78 74 5f  |t module...next_|
00000720  66 75 6e 63 74 69 6f 6e  5f 6c 6f 6f 70 3a 20 3b  |function_loop: ;|
00000730  20 47 65 74 20 74 68 65  20 6e 65 78 74 20 66 75  | Get the next fu|
00000740  6e 63 74 69 6f 6e 20 6e  61 6d 65 20 66 6f 72 20  |nction name for |
00000750  68 61 73 68 69 6e 67 3a  0d 0a 20 20 20 20 4d 4f  |hashing:..    MO|
00000760  56 20 20 20 20 20 45 44  49 2c 20 5b 45 42 58 20  |V     EDI, [EBX |
00000770  2b 20 30 78 32 30 5d 20  20 20 20 20 20 20 20 20  |+ 0x20]         |
00000780  20 20 3b 20 45 44 49 20  3d 20 6f 66 66 73 65 74  |  ; EDI = offset|
00000790  28 6e 61 6d 65 73 20 74  61 62 6c 65 29 0d 0a 20  |(names table).. |
000007a0  20 20 20 41 44 44 20 20  20 20 20 45 44 49 2c 20  |   ADD     EDI, |
000007b0  45 42 50 20 20 20 20 20  20 20 20 20 20 20 20 20  |EBP             |
000007c0  20 20 20 20 20 20 20 3b  20 45 44 49 20 3d 20 26  |       ; EDI = &|
000007d0  28 6e 61 6d 65 73 20 74  61 62 6c 65 29 0d 0a 20  |(names table).. |
000007e0  20 20 20 4d 4f 56 20 20  20 20 20 45 44 49 2c 20  |   MOV     EDI, |
000007f0  5b 45 44 49 20 2b 20 45  43 58 20 2a 20 34 20 2d  |[EDI + ECX * 4 -|
00000800  20 34 5d 20 20 20 20 3b  20 45 44 49 20 3d 20 6f  | 4]    ; EDI = o|
00000810  66 66 73 65 74 28 66 75  6e 63 74 69 6f 6e 20 6e  |ffset(function n|
00000820  61 6d 65 29 0d 0a 20 20  20 20 41 44 44 20 20 20  |ame)..    ADD   |
00000830  20 20 45 44 49 2c 20 45  42 50 20 20 20 20 20 20  |  EDI, EBP      |
00000840  20 20 20 20 20 20 20 20  20 20 20 20 20 20 3b 20  |              ; |
00000850  45 44 49 20 3d 20 26 28  66 75 6e 63 74 69 6f 6e  |EDI = &(function|
00000860  20 6e 61 6d 65 29 0d 0a  20 20 20 20 58 4f 52 20  | name)..    XOR |
00000870  20 20 20 20 45 41 58 2c  20 45 41 58 20 20 20 20  |    EAX, EAX    |
00000880  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000890  3b 20 45 41 58 20 3d 20  30 0d 0a 20 20 20 20 43  |; EAX = 0..    C|
000008a0  44 51 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |DQ              |
000008b0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000008c0  20 20 20 3b 20 45 44 58  20 3d 20 30 0d 0a 68 61  |   ; EDX = 0..ha|
000008d0  73 68 5f 6c 6f 6f 70 3a  20 3b 20 48 61 73 68 20  |sh_loop: ; Hash |
000008e0  74 68 65 20 66 75 6e 63  74 69 6f 6e 20 6e 61 6d  |the function nam|
000008f0  65 20 61 6e 64 20 63 6f  6d 70 61 72 65 20 77 69  |e and compare wi|
00000900  74 68 20 72 65 71 75 65  73 74 65 64 20 68 61 73  |th requested has|
00000910  68 0d 0a 20 20 20 20 58  4f 52 20 20 20 20 20 44  |h..    XOR     D|
00000920  4c 2c 20 5b 45 44 49 5d  0d 0a 20 20 20 20 52 4f  |L, [EDI]..    RO|
00000930  52 20 20 20 20 20 44 58  2c 20 42 59 54 45 20 68  |R     DX, BYTE h|
00000940  61 73 68 5f 72 6f 72 5f  76 61 6c 75 65 0d 0a 20  |ash_ror_value.. |
00000950  20 20 20 53 43 41 53 42  0d 0a 20 20 20 20 4a 4e  |   SCASB..    JN|
00000960  45 20 20 20 20 20 68 61  73 68 5f 6c 6f 6f 70 0d  |E     hash_loop.|
00000970  0a 20 20 20 20 43 4d 50  20 20 20 20 20 44 58 2c  |.    CMP     DX,|
00000980  20 68 61 73 68 5f 75 73  65 72 33 32 5f 4d 65 73  | hash_user32_Mes|
00000990  73 61 67 65 42 6f 78 41  0d 0a 20 20 20 20 4a 45  |sageBoxA..    JE|
000009a0  20 20 20 20 20 20 66 6f  75 6e 64 5f 4d 65 73 73  |      found_Mess|
000009b0  61 67 65 42 6f 78 41 20  20 20 20 20 20 20 20 20  |ageBoxA         |
000009c0  20 20 3b 0d 0a 20 20 20  20 43 4d 50 20 20 20 20  |  ;..    CMP    |
000009d0  20 44 58 2c 20 68 61 73  68 5f 6b 65 72 6e 65 6c  | DX, hash_kernel|
000009e0  33 32 5f 4c 6f 61 64 4c  69 62 72 61 72 79 41 0d  |32_LoadLibraryA.|
000009f0  0a 20 20 20 20 4c 4f 4f  50 4e 45 20 20 6e 65 78  |.    LOOPNE  nex|
00000a00  74 5f 66 75 6e 63 74 69  6f 6e 5f 6c 6f 6f 70 20  |t_function_loop |
00000a10  20 20 20 20 20 20 20 20  20 3b 20 4e 6f 74 20 74  |         ; Not t|
00000a20  68 65 20 72 69 67 68 74  20 68 61 73 68 20 61 6e  |he right hash an|
00000a30  64 20 66 75 6e 63 74 69  6f 6e 73 20 6c 65 66 74  |d functions left|
00000a40  20 69 6e 20 6d 6f 64 75  6c 65 3f 20 4e 65 78 74  | in module? Next|
00000a50  20 66 75 6e 63 74 69 6f  6e 0d 0a 20 20 20 20 4a  | function..    J|
00000a60  4e 45 20 20 20 20 20 6e  65 78 74 5f 6d 6f 64 75  |NE     next_modu|
00000a70  6c 65 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |le              |
00000a80  20 20 20 3b 20 4e 6f 74  20 74 68 65 20 72 69 67  |   ; Not the rig|
00000a90  68 74 20 68 61 73 68 20  61 6e 64 20 6e 6f 20 66  |ht hash and no f|
00000aa0  75 6e 63 74 69 6f 6e 73  20 6c 65 66 74 20 69 6e  |unctions left in|
00000ab0  20 6d 6f 64 75 6c 65 3f  20 4e 65 78 74 20 6d 6f  | module? Next mo|
00000ac0  64 75 6c 65 0d 0a 66 6f  75 6e 64 5f 4d 65 73 73  |dule..found_Mess|
00000ad0  61 67 65 42 6f 78 41 3a  0d 0a 20 20 20 20 3b 20  |ageBoxA:..    ; |
00000ae0  46 6f 75 6e 64 20 74 68  65 20 72 69 67 68 74 20  |Found the right |
00000af0  68 61 73 68 3a 20 67 65  74 20 74 68 65 20 61 64  |hash: get the ad|
00000b00  64 72 65 73 73 20 6f 66  20 74 68 65 20 66 75 6e  |dress of the fun|
00000b10  63 74 69 6f 6e 3a 0d 0a  20 20 20 20 4d 4f 56 20  |ction:..    MOV |
00000b20  20 20 20 20 45 44 58 2c  20 5b 45 42 58 20 2b 20  |    EDX, [EBX + |
00000b30  30 78 32 34 5d 20 20 20  20 20 20 20 20 20 20 20  |0x24]           |
00000b40  3b 20 45 44 58 20 3d 20  6f 66 66 73 65 74 20 6f  |; EDX = offset o|
00000b50  72 64 69 6e 61 6c 73 20  74 61 62 6c 65 0d 0a 20  |rdinals table.. |
00000b60  20 20 20 41 44 44 20 20  20 20 20 45 44 58 2c 20  |   ADD     EDX, |
00000b70  45 42 50 20 20 20 20 20  20 20 20 20 20 20 20 20  |EBP             |
00000b80  20 20 20 20 20 20 20 3b  20 45 44 58 20 3d 20 26  |       ; EDX = &|
00000b90  6f 72 69 64 69 6e 61 6c  73 20 74 61 62 6c 65 0d  |oridinals table.|
00000ba0  0a 20 20 20 20 4d 4f 56  5a 58 20 20 20 45 44 58  |.    MOVZX   EDX|
00000bb0  2c 20 57 4f 52 44 20 5b  45 44 58 20 2b 20 32 20  |, WORD [EDX + 2 |
00000bc0  2a 20 45 43 58 5d 20 20  20 3b 20 45 44 58 20 3d  |* ECX]   ; EDX =|
00000bd0  20 6f 72 64 69 6e 61 6c  20 6e 75 6d 62 65 72 20  | ordinal number |
00000be0  6f 66 20 66 75 6e 63 74  69 6f 6e 0d 0a 20 20 20  |of function..   |
00000bf0  20 4d 4f 56 20 20 20 20  20 45 44 49 2c 20 5b 45  | MOV     EDI, [E|
00000c00  42 58 20 2b 20 30 78 31  43 5d 20 20 20 20 20 20  |BX + 0x1C]      |
00000c10  20 20 20 20 20 3b 20 45  44 49 20 3d 20 6f 66 66  |     ; EDI = off|
00000c20  73 65 74 20 61 64 64 72  65 73 73 20 74 61 62 6c  |set address tabl|
00000c30  65 0d 0a 20 20 20 20 41  44 44 20 20 20 20 20 45  |e..    ADD     E|
00000c40  44 49 2c 20 45 42 50 20  20 20 20 20 20 20 20 20  |DI, EBP         |
00000c50  20 20 20 20 20 20 20 20  20 20 20 3b 20 45 44 49  |           ; EDI|
00000c60  20 3d 20 26 61 64 64 72  65 73 73 20 74 61 62 6c  | = &address tabl|
00000c70  65 0d 0a 20 20 20 20 41  44 44 20 20 20 20 20 45  |e..    ADD     E|
00000c80  42 50 2c 20 5b 45 44 49  20 2b 20 34 20 2a 20 45  |BP, [EDI + 4 * E|
00000c90  44 58 5d 20 20 20 20 20  20 20 20 3b 20 45 42 50  |DX]        ; EBP|
00000ca0  20 3d 20 26 28 66 75 6e  63 74 69 6f 6e 29 0d 0a  | = &(function)..|
00000cb0  20 20 20 20 54 45 53 54  20 20 20 20 45 53 49 2c  |    TEST    ESI,|
00000cc0  20 45 53 49 0d 0a 20 20  20 20 4a 5a 20 20 20 20  | ESI..    JZ    |
00000cd0  20 20 73 68 6f 77 5f 4d  65 73 61 67 65 42 6f 78  |  show_MesageBox|
00000ce0  41 0d 0a 20 20 20 20 50  55 53 48 20 20 20 20 42  |A..    PUSH    B|
00000cf0  32 44 57 28 27 33 27 2c  20 27 32 27 2c 20 27 20  |2DW('3', '2', ' |
00000d00  27 2c 20 27 20 27 29 20  20 20 20 3b 20 53 74 61  |', ' ')    ; Sta|
00000d10  63 6b 20 3d 20 22 65 72  33 32 22 2c 20 30 0d 0a  |ck = "er32", 0..|
00000d20  20 20 20 20 50 55 53 48  20 20 20 20 42 32 44 57  |    PUSH    B2DW|
00000d30  28 27 75 27 2c 20 27 73  27 2c 20 27 65 27 2c 20  |('u', 's', 'e', |
00000d40  27 72 27 29 20 20 20 20  3b 20 53 74 61 63 6b 20  |'r')    ; Stack |
00000d50  3d 20 22 20 20 75 73 65  72 33 32 22 2c 20 30 0d  |= "  user32", 0.|
00000d60  0a 20 20 20 20 50 55 53  48 20 20 20 20 45 53 50  |.    PUSH    ESP|
00000d70  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000d80  20 20 20 20 20 20 20 20  20 3b 20 53 74 61 63 6b  |         ; Stack|
00000d90  20 3d 20 26 28 22 20 20  75 73 65 72 33 32 22 29  | = &("  user32")|
00000da0  2c 20 22 20 20 75 73 65  72 33 32 22 2c 20 30 0d  |, "  user32", 0.|
00000db0  0a 20 20 20 20 43 41 4c  4c 20 20 20 20 45 42 50  |.    CALL    EBP|
00000dc0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000dd0  20 20 20 20 20 20 20 20  20 3b 20 4c 6f 61 64 4c  |         ; LoadL|
00000de0  69 62 72 61 72 79 41 28  26 28 22 20 20 75 73 65  |ibraryA(&("  use|
00000df0  72 33 32 22 29 29 3b 0d  0a 20 20 20 20 58 43 48  |r32"));..    XCH|
00000e00  47 20 20 20 20 45 41 58  2c 20 45 42 50 20 20 20  |G    EAX, EBP   |
00000e10  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000e20  20 3b 20 45 42 50 20 3d  20 26 28 75 73 65 72 33  | ; EBP = &(user3|
00000e30  32 2e 64 6c 6c 29 0d 0a  20 20 20 20 58 4f 52 20  |2.dll)..    XOR |
00000e40  20 20 20 20 45 53 49 2c  20 45 53 49 20 20 20 20  |    ESI, ESI    |
00000e50  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000e60  3b 20 45 53 49 20 3d 20  30 0d 0a 20 20 20 20 50  |; ESI = 0..    P|
00000e70  55 53 48 20 20 20 20 45  53 49 20 20 20 20 20 20  |USH    ESI      |
00000e80  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000e90  20 20 20 3b 20 53 74 61  63 6b 20 3d 20 30 2c 20  |   ; Stack = 0, |
00000ea0  22 20 20 75 73 65 72 33  32 22 2c 20 30 0d 0a 20  |"  user32", 0.. |
00000eb0  20 20 20 4a 4d 50 20 20  20 20 20 67 65 74 5f 70  |   JMP     get_p|
00000ec0  72 6f 63 5f 61 64 64 72  65 73 73 5f 6c 6f 6f 70  |roc_address_loop|
00000ed0  0d 0a 0d 0a 73 68 6f 77  5f 4d 65 73 61 67 65 42  |....show_MesageB|
00000ee0  6f 78 41 3a 0d 0a 20 20  20 20 3b 20 63 72 65 61  |oxA:..    ; crea|
00000ef0  74 65 20 74 68 65 20 22  48 65 6c 6c 6f 20 77 6f  |te the "Hello wo|
00000f00  72 6c 64 21 22 20 73 74  72 69 6e 67 0d 0a 20 20  |rld!" string..  |
00000f10  20 20 50 55 53 48 20 20  20 20 42 32 44 57 28 27  |  PUSH    B2DW('|
00000f20  72 27 2c 20 27 6c 27 2c  20 27 64 27 2c 20 27 21  |r', 'l', 'd', '!|
00000f30  27 29 20 20 20 20 3b 20  53 74 61 63 6b 20 3d 20  |')    ; Stack = |
00000f40  22 72 6c 64 21 22 2c 20  30 2c 20 22 20 20 75 73  |"rld!", 0, "  us|
00000f50  65 72 33 32 22 2c 20 30  0d 0a 20 20 20 20 50 55  |er32", 0..    PU|
00000f60  53 48 20 20 20 20 42 32  44 57 28 27 6f 27 2c 20  |SH    B2DW('o', |
00000f70  27 20 27 2c 20 27 77 27  2c 20 27 6f 27 29 20 20  |' ', 'w', 'o')  |
00000f80  20 20 3b 20 53 74 61 63  6b 20 3d 20 22 6f 20 77  |  ; Stack = "o w|
00000f90  6f 72 6c 64 21 22 2c 20  30 2c 20 22 20 20 75 73  |orld!", 0, "  us|
00000fa0  65 72 33 32 22 2c 20 30  0d 0a 20 20 20 20 50 55  |er32", 0..    PU|
00000fb0  53 48 20 20 20 20 42 32  44 57 28 27 48 27 2c 20  |SH    B2DW('H', |
00000fc0  27 65 27 2c 20 27 6c 27  2c 20 27 6c 27 29 20 20  |'e', 'l', 'l')  |
00000fd0  20 20 3b 20 53 74 61 63  6b 20 3d 20 22 48 65 6c  |  ; Stack = "Hel|
00000fe0  6c 6f 20 77 6f 72 6c 64  21 22 2c 20 30 2c 20 22  |lo world!", 0, "|
00000ff0  20 20 75 73 65 72 33 32  22 2c 20 30 0d 0a 20 20  |  user32", 0..  |
00001000  20 20 50 55 53 48 20 20  20 20 45 53 50 20 20 20  |  PUSH    ESP   |
00001010  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00001020  20 20 20 20 20 20 3b 20  53 74 61 63 6b 20 3d 20  |      ; Stack = |
00001030  26 28 22 48 65 6c 6c 6f  20 77 6f 72 6c 64 21 22  |&("Hello world!"|
00001040  29 2c 20 22 48 65 6c 6c  6f 20 77 6f 72 6c 64 21  |), "Hello world!|
00001050  22 2c 20 30 2c 20 22 20  20 75 73 65 72 33 32 22  |", 0, "  user32"|
00001060  2c 20 30 0d 0a 20 20 20  20 58 43 48 47 20 20 20  |, 0..    XCHG   |
00001070  20 45 41 58 2c 20 5b 45  53 50 5d 20 20 20 20 20  | EAX, [ESP]     |
00001080  20 20 20 20 20 20 20 20  20 20 20 20 20 3b 20 53  |             ; S|
00001090  74 61 63 6b 20 3d 20 30  2c 20 22 48 65 6c 6c 6f  |tack = 0, "Hello|
000010a0  20 77 6f 72 6c 64 21 22  2c 20 30 2c 20 22 20 20  | world!", 0, "  |
000010b0  75 73 65 72 33 32 22 2c  20 30 0d 0a 20 20 20 20  |user32", 0..    |
000010c0  50 55 53 48 20 20 20 20  45 41 58 20 20 20 20 20  |PUSH    EAX     |
000010d0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000010e0  20 20 20 20 3b 20 53 74  61 63 6b 20 3d 20 26 28  |    ; Stack = &(|
000010f0  22 48 65 6c 6c 6f 20 77  6f 72 6c 64 21 22 29 2c  |"Hello world!"),|
00001100  20 30 2c 20 22 48 65 6c  6c 6f 20 77 6f 72 6c 64  | 0, "Hello world|
00001110  21 22 2c 20 30 2c 20 22  20 20 75 73 65 72 33 32  |!", 0, "  user32|
00001120  22 2c 20 30 0d 0a 20 20  20 20 50 55 53 48 20 20  |", 0..    PUSH  |
00001130  20 20 45 41 58 20 20 20  20 20 20 20 20 20 20 20  |  EAX           |
00001140  20 20 20 20 20 20 20 20  20 20 20 20 20 20 3b 20  |              ; |
00001150  53 74 61 63 6b 20 3d 20  26 28 22 48 65 6c 6c 6f  |Stack = &("Hello|
00001160  20 77 6f 72 6c 64 21 22  29 2c 20 26 28 22 48 65  | world!"), &("He|
00001170  6c 6c 6f 20 77 6f 72 6c  64 21 22 29 2c 20 30 2c  |llo world!"), 0,|
00001180  20 22 48 65 6c 6c 6f 20  77 6f 72 6c 64 21 22 2c  | "Hello world!",|
00001190  20 30 2c 20 22 20 20 75  73 65 72 33 32 22 2c 20  | 0, "  user32", |
000011a0  30 0d 0a 20 20 20 20 50  55 53 48 20 20 20 20 45  |0..    PUSH    E|
000011b0  53 49 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |SI              |
000011c0  20 20 20 20 20 20 20 20  20 20 20 3b 20 53 74 61  |           ; Sta|
000011d0  63 6b 20 3d 20 30 2c 20  26 28 22 48 65 6c 6c 6f  |ck = 0, &("Hello|
000011e0  20 77 6f 72 6c 64 21 22  29 2c 20 26 28 22 48 65  | world!"), &("He|
000011f0  6c 6c 6f 20 77 6f 72 6c  64 21 22 29 2c 20 30 2c  |llo world!"), 0,|
00001200  20 22 48 65 6c 6c 6f 20  77 6f 72 6c 64 21 22 2c  | "Hello world!",|
00001210  20 30 2c 20 22 20 20 75  73 65 72 33 32 22 2c 20  | 0, "  user32", |
00001220  30 0d 0a 20 20 20 20 43  41 4c 4c 20 20 20 20 45  |0..    CALL    E|
00001230  42 50 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |BP              |
00001240  20 20 20 20 20 20 20 20  20 20 20 3b 20 4d 65 73  |           ; Mes|
00001250  73 61 67 65 42 6f 78 41  28 4e 55 4c 4c 2c 20 26  |sageBoxA(NULL, &|
00001260  28 22 48 65 6c 6c 6f 20  77 6f 72 6c 64 21 22 29  |("Hello world!")|
00001270  2c 20 26 28 22 48 65 6c  6c 6f 20 77 6f 72 6c 64  |, &("Hello world|
00001280  21 22 29 2c 20 4d 42 5f  4f 4b 29 3b 0d 0a 20 20  |!"), MB_OK);..  |
00001290  20 20 49 4e 54 33 20 20  20 20 20 20 20 20 20 20  |  INT3          |
000012a0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000012b0  20 20 20 20 20 20 3b 20  43 72 61 73 68           |      ; Crash|
000012bd
